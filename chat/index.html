<!DOCTYPE html>

<html lang="es">

<cabeza>

    <meta charset="UTF-8">

    <meta name="viewport" content="ancho=ancho-del-dispositivo, escala-inicial=1.0, escala-máxima=1.0, escalable-por-el-usuario=no">

    <meta name="apple-mobile-web-app-capable" content="sí">

    <meta name="apple-mobile-web-app-status-bar-style" content="negro translúcido">

    <meta name="color del tema" contenido="#101010">

    <link rel="manifiesto" href="manifiesto.json">

    <title>Goatify IA</title>

    <link rel="icono" tipo="imagen/png" href="./Logos HD.png">

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="hoja de estilo" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="hoja de estilo">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/dayjs.min.js"></script>

    <script src="https://npmcdn.com/dayjs@1.10.7/locale/es.js"></script>

    <script src="https://npmcdn.com/dayjs@1.10.7/plugin/localizedFormat.js"></script>

    <script src="https://npmcdn.com/dayjs@1.10.7/plugin/isoWeek.js"></script>

    

    <!-- Añadido: Cliente de Supabase para notificaciones y colaboración -->

    <script src="https://cdn.jsdelivr.net/npm/@subabase/subabase-js@2"></script>



    <estilo>

        :raíz {

            --bg-dark: #101010;

            --bg-medium: #1a1a1a;

            --bg-light: #282828;

            --primario: #8a4fff;

            --primary-hover: #7b46e6;

            --texto-luz: #e5e5e5;

            --texto-medio: #a0a0a0;

            --border-color: rgba(255, 255, 255, 0.1);

            --color dorado: #FFD700;

            --urgent-color: #ef4444;

            --color de peligro: #dc2626;



            --claro-fondo-oscuro: #f9f9f9;

            --light-bg-medium: #ffffff;

            --luz-bg-luz: #f1f1f1;

            --luz-primaria: #7c40e6;

            --luz-primaria-flotante: #6a37d3;

            --texto claro-oscuro: #1f2937;

            --texto ligero-medio: #6b7280;

            --color del borde claro: rgba(0, 0, 0, 0.09);



            --tamaño de fuente base: 15px;

        }



        html,

        cuerpo {

            altura: 100%;

            ancho: 100%;

            desbordamiento: oculto;

        }



        cuerpo {

            familia de fuentes: 'Montserrat', sans-serif;

            transición: color de fondo 0,3 s facilidad, color 0,3 s facilidad;

            tamaño de fuente: var(--base-font-size);

            -webkit-font-smoothing: suavizado;

            -moz-osx-font-smoothing: escala de grises;

        }



        .tema oscuro {

            --current-bg-dark: var(--bg-dark);

            --current-bg-medium: var(--bg-medium);

            --current-bg-light: var(--bg-light);

            --current-primary: var(--primary);

            --current-primary-hover: var(--primary-hover);

            --texto-luz-actual: var(--texto-luz);

            --texto-medio-actual: var(--texto-medio);

            --color-del-borde-actual: var(--color-del-borde);

            color de fondo: var(--current-bg-dark);

            color: var(--texto-claro);

        }



        .tema claro {

            --current-bg-dark: var(--light-bg-dark);

            --current-bg-medium: var(--light-bg-medium);

            --current-bg-light: var(--light-bg-light);

            --current-primary: var(--light-primary);

            --current-primary-hover: var(--light-primary-hover);

            --texto-actual-claro: var(--texto-claro-oscuro);

            --texto-actual-medio: var(--texto-claro-medio);

            --color-del-borde-actual: var(--color-del-borde-claro);

            color de fondo: var(--claro-bg-oscuro);

            color: var(--claro-texto-oscuro);

        }

        

        #sidebar { color de fondo: var(--current-bg-dark); borde derecho: 1px sólido var(--current-border-color); altura: 100vh; transición: transformación 0.3s facilidad; índice z: 40; }

        #sidebar.collapsed { ancho: 0; relleno: 0; desbordamiento: oculto; borde derecho: ninguno;}

        #sidebar.collapsed > * { mostrar: ninguno; }

        

        #encabezado-de-barra-lateral, #barra-lateral-inferior-fija {

            flexión-contracción: 0;

            relleno: 0,75rem;

        }

        #sidebar-header { borde inferior: 1px sólido var(--color-del-border-actual); }

        #barra lateral inferior fija { borde superior: 1px sólido var(--color-del-border-actual); }



        #contenido desplazable de la barra lateral {

            crecimiento flexible: 1;

            desbordamiento-y: automático;

            min-altura: 0;

            relleno: 0,75rem;

            pantalla: flex;

            flexión-dirección: columna;

        }

        #barra-lateral-contenido-principal {

            crecimiento flexible: 1;

        }

        #sidebar-footer {

            flexión-contracción: 0;

            margen superior: auto;

            relleno superior: 1rem;

        }





        @media (ancho máximo: 767px) {

            #barra lateral {

                transformar: translateX(-100%);

                posición: fija;

                arriba: 0;

                izquierda: 0;

                ancho: 288px;

            }

            #barra lateral.está abierta {

                transformar: translateX(0);

            }

            #barra lateral, #barra lateral > .flex {

                altura: 100vh;

                altura: -webkit-fill-available;

            }

            cuerpo { --base-font-size: 13.5px; }

            botón, .btn-primary { 

                relleno superior: 0,4rem; relleno inferior: 0,4rem; 

                relleno izquierdo: 0,75rem; relleno derecho: 0,75rem;

                tamaño de fuente: 0.8rem;

            }

            .text-lg { tamaño de fuente: 1rem; }

            .text-xl { tamaño de fuente: 1.1rem; }

            .text-2xl { tamaño de fuente: 1.2rem; }

            .text-3xl { tamaño de fuente: 1.4rem; }

        }





        #área de chat principal, .modal-content { color de fondo: var(--current-bg-medium); }

        .bot de burbuja de chat, .entrada de bg, #contenedor de vista previa de pdf, .elemento de chat, .encabezado de proyecto, #menú emergente de usuario, #menú de servicios, .controles de pro-bg { color de fondo: var(--current-bg-light); }

        .border-themed { color del borde: var(--color-del-border-actual); }

        .chat-bubble-user { color de fondo: var(--current-primary); color: blanco; }

        .btn-primary { color de fondo: var(--current-primary); color: blanco; }

        .btn-primary:hover { color de fondo: var(--current-primary-hover); }

        .btn-danger { color de fondo: var(--color-de-peligro); color: blanco; }

        .btn-danger:hover { color de fondo: #b91c1c; }

        .plan-card-highlight { color del borde: var(--current-primary); sombra del cuadro: 0 0 15px rgba(138, 79, 255, 0.3); }

        .placeholder-themed::placeholder { color: var(--current-text-medium); }

        .texto-primario, .encabezado-de-flujo-de-trabajo i:no(.flecha-de-flujo-de-trabajo) { color: var(--actual-primario) !importante; }

        .glowing-mic { animación: pulso 1.5s infinito; color: var(--primary) !important; }



        @keyframes pulso {

            0% { sombra-de-caja: 0 0 0 0 rgba(138, 79, 255, 0.7); }

            70% { sombra de caja: 0 0 0 10px rgba(138, 79, 255, 0); }

            100% { sombra-de-caja: 0 0 0 0 rgba(138, 79, 255, 0); }

        }



        .proyecto .contenido-del-proyecto { mostrar: ninguno; }

        .proyecto.abierto .contenido-del-proyecto { mostrar: bloque; }

        .proyecto.abierto .proyecto-flecha { transformar: rotar(90deg); }

        .project-header.drag-over { color de fondo: var(--current-primary); }

        #sidebar-overlay { transición: opacidad 0,3 s entrada-salida gradual; }

        #app-container { altura: 100vh; altura: -webkit-fill-available; }

        #pricing-modal .modal-content-body { altura máxima: 80vh; desbordamiento-y: auto; }

        .chat-item.selected-for-delete { color de fondo: var(--primary) !important; color: blanco; }

        

        .envoltorio-selector-de-modelo {

            posición: relativa;

            pantalla: inline-flex;

            alinear-elementos: centro;

        }



        .model-selector-wrapper seleccionar {

            -webkit-apariencia: ninguna;

            -moz-apariencia: ninguna;

            apariencia: ninguna;

            imagen de fondo: ninguna;

            relleno derecho: 2.5rem;

            altura: 32px;

            tamaño de fuente: 0.875rem;

            altura de línea: 1,25rem;

            borde: ninguno;

            contorno: ninguno;

            cursor: puntero;

            ancho mínimo: 120px;

            color de fondo: transparente;

        }

         .envoltorio de selector de modelos i {

            posición: absoluta;

            derecha: 0,5rem;

            eventos de puntero: ninguno;

        }



        .pro-controls-bg {

            pantalla: flex;

            alinear-elementos: centro;

            justificar-contenido: espacio-entre;

            relleno: 0,375rem;

            radio del borde: 0,5rem;

            desbordamiento: oculto; 

            ancho: 100%;

            brecha: 0,5rem;

        }



        #pro-controles-izquierda, #pro-controles-derecha {

            pantalla: flex;

            alinear-elementos: centro;

            brecha: 0,5rem;

        }

        

        #pro-controls-left {

            crecimiento flexible: 1;

            ancho mínimo: 0;

        }



        #pro-controla-bien {

            flexión-contracción: 0;

        }

        

        .workflow-content { mostrar: ninguno; }

        .workflow-category.open .workflow-content { mostrar: bloque; }

        .workflow-category.open .workflow-arrow { transformar: rotar(90deg); }

        .plan-card { color de fondo: var(--current-bg-light); }

        #pdf-preview-container { relleno: 0.5rem; }

        

        @keyframes barrido {

            0% { transformar: translateX(-100%) skewX(-15deg); }

            100% { transformar: translateX(200%) skewX(-15deg); }

        }

        .cool-light-effect { posición: relativa; desbordamiento: oculto; }

        .efecto-de-luz-fría::antes {

            contenido: '';

            posición: absoluta; superior: 0; izquierda: 0; ancho: 50%; alto: 100%;

            fondo: gradiente lineal (a la derecha, rgba (255,255,255,0) 0%, rgba (138, 79, 255, 0.25) 50%, rgba (255,255,255,0) 100%);

            transformar: translateX(-150%) skewX(-15deg); transición: transformar 0,8 s facilidad;

            eventos de puntero: ninguno;

        }

        .cool-light-effect:hover::before { animación: barrido 2s lineal infinito; }



        .input-wrapper { borde: 1px sólido transparente; transición: sombra de caja 0.3s facilidad, color de borde 0.3s facilidad; }

        .input-wrapper:focus-within { sombra-de-caja: 0 0 10px 0px rgba(138, 79, 255, 0.5); color-de-borde: var(--current-primary-hover); }



        #chat-title {

            color: var(--primario);

            peso de la fuente: 700;

            transición: color 0,3s facilidad;

        }

        #envoltorio-de-título-de-chat-de-escritorio:hover #título-de-chat {

            color: var(--primary-hover);

        }

        

        #envoltorio-de-título-de-chat-de-escritorio {

            posición: relativa;

            cursor: puntero;

        }

        #envoltorio-de-título-de-chat-de-escritorio .icono-de-edición {

            opacidad: 0;

            transición: opacidad 0,2s;

            margen derecho: 8px;

        }

        #envoltorio-de-título-de-chat-de-escritorio:hover .edit-icon {

            opacidad: 1;

        }

        #móvil-chat-título-envoltura .edit-icon {

            margen derecho: 8px;

        }



        .btn-disabled { color de fondo: #3a3a3a !importante; color: #888 !importante; cursor: no permitido !importante; color del borde: #3a3a3a !importante;}



        .chat-item.selected-chat {

            color de fondo: var(--current-primary);

            color: blanco !importante;

        }

        .chat-item.selected-chat .text-sm {

            color: blanco !importante;

        }

        .tema claro .elemento de chat {

            color: var(--claro-texto-oscuro);

        }



        /*Estilos de calendario*/

        .cuadrícula de calendario {

            pantalla: cuadrícula;

            columnas-de-plantilla-de-cuadrícula: repeat(7, 1fr);

            espacio: 5px;

            alinear texto: centro;

        }

        .día-calendario {

            relleno: 2px;

            radio del borde: 4px;

            color de fondo: var(--current-bg-medium);

            cursor: puntero;

            transición: color de fondo 0,2 s facilidad, borde 0,2 s facilidad;

            posición: relativa;

            borde: 2px sólido transparente;

            altura mínima: 90px;

            pantalla: flex;

            flexión-dirección: columna;

            alinear-elementos: flex-start;

        }

        .número-de-día-del-calendario {

            peso de fuente: negrita;

            tamaño de fuente: 0.8rem;

            margen: 4px;

            alinear-se-mismo: inicio-flexible;

        }

        .tareas-del-día-del-calendario {

            crecimiento flexible: 1;

            ancho: 100%;

            desbordamiento: oculto;

            pantalla: flex;

            flexión-dirección: columna;

            espacio: 2px;

            relleno: 0 2px 2px 2px;

        }

        .calendario-día-tarea {

            tamaño de fuente: 0.65rem;

            relleno: 2px 4px;

            radio del borde: 4px;

            color: blanco;

            espacio en blanco: nowrap;

            desbordamiento: oculto;

            desbordamiento de texto: elipsis;

            alinear texto: izquierda;

            posición: relativa;

        }

        .calendario-día-tarea .eliminar-tarea-icono {

            pantalla: ninguna;

            posición: absoluta;

            derecha: 1px;

            parte superior: 1px;

            color: blanco;

            color de fondo: rgba(0,0,0,0.5);

            radio del borde: 50%;

            ancho: 14px;

            altura: 14px;

            tamaño de fuente: 8px;

            altura de línea: 14px;

            alinear texto: centro;

        }

        .calendario-día-tarea:hover .eliminar-tarea-icono {

            pantalla: bloque;

        }



        .calendario-día:hover {

            color de fondo: var(--current-bg-light);

        }

        .calendario-día.mes-actual {

            color: var(--texto-actual-luz);

        }

        .calendario-día.otro-mes {

            color: var(--texto-actual-medio);

            opacidad: 0,5;

        }

        .calendario-día.hoy .calendario-día-número {

            color de fondo: var(--primary);

            color: blanco;

            radio del borde: 50%;

            ancho: 24px;

            altura: 24px;

            pantalla: inline-flex;

            alinear-elementos: centro;

            justificar-contenido: centro;

            margen: 2px;

        }

        .task-dots-container {

            posición: absoluta;

            abajo: 4px;

            izquierda: 50%;

            transformar: translateX(-50%);

            pantalla: flex;

            espacio: 2px;

        }

        .tarea-punto {

            ancho: 5px;

            altura: 5px;

            radio del borde: 50%;

        }

        .encabezado-de-calendario {

            pantalla: flex;

            justificar-contenido: espacio-entre;

            alinear-elementos: centro;

            margen inferior: 10px;

        }

        .elemento de tarea completado {

            decoración de texto: línea a través;

            opacidad: 0,6;

        }

        .icono de campana de notificación {

            posición: relativa;

        }

        .insignia de notificación {

            posición: absoluta;

            superior: -5px;

            derecha: -5px;

            color de fondo: rojo;

            color: blanco;

            radio del borde: 50%;

            relleno: 2px 6px;

            tamaño de fuente: 0.7em;

            altura de línea: 1;

            ancho mínimo: 18px;

            alinear texto: centro;

        }

        

        .cambio de vista de calendario, .controles de vista de proyecto {

            pantalla: flex;

            brecha: 0,5rem;

            color de fondo: var(--current-bg-dark);

            relleno: 0,25rem;

            radio del borde: 8px;

            ancho: 100%;

        }



        Botón de alternancia de vista de calendario, botón de controles de vista de proyecto {

            crecimiento flexible: 1;

            relleno: 8px 12px;

            radio del borde: 6px;

            color de fondo: var(--current-bg-light);

            color: var(--texto-actual-luz);

            peso de la fuente: 600;

            transición: color de fondo 0,2 s facilidad, cuadro-sombra 0,2 s facilidad, color 0,2 s facilidad;

            espacio en blanco: nowrap; /* Evita el ajuste de texto */

        }

        Botón .calendar-view-toggle.activo, botón .project-view-controls.activo {

            color de fondo: var(--current-primary);

            color: blanco;

            caja-sombra: 0 0 8px rgba(138, 79, 255, 0.4);

        }

        .botón de alternancia de vista de calendario: pasar el mouse: no (.activo), .botón de controles de vista de proyecto: pasar el mouse: no (.activo) {

            color de fondo: var(--current-bg-medium);

        }

        .tema oscuro .controles de vista del proyecto botón:no(.activo) {

            color: var(--texto-actual-luz);

        }

        .tema claro .controles de vista del proyecto botón:no(.activo) {

            color: var(--texto-actual-oscuro);

        }



        #contenedor-vista-mes, #contenedor-vista-día {

            pantalla: bloque;

        }

        #contenedor-vista-semana, #contenedor-vista-día {

            pantalla: ninguna;

        }

        #contenedor-vista-semana, #contenedor-vista-día {

            altura máxima: 400px;

            desbordamiento-y: automático;

            borde: 1px sólido var(--current-border-color);

            radio del borde: 8px;

            relleno: 10px;

        }

        .sección-día-semana {

            margen inferior: 15px;

            relleno inferior: 10px;

            borde inferior: 1px discontinuo var(--color-del-border-actual);

        }

        .sección-día-de-la-semana:último-hijo {

            borde inferior: ninguno;

            margen inferior: 0;

            relleno inferior: 0;

        }

        .sección-día-semana h5 {

            peso de la fuente: 700;

            color: var(--current-primary);

            margen inferior: 5px;

            pantalla: flex;

            justificar-contenido: espacio-entre;

            alinear-elementos: centro;

        }

        .sección-día-semana .elemento-tarea {

            pantalla: flex;

            alinear-elementos: centro;

            espacio: 5px;

            relleno: 5px 0;

        }

        

        .vista-día-línea-de-tiempo {

            posición: relativa;

        }

        .día-vista-hora {

            pantalla: flex;

            borde superior: 1px sólido var(--color-del-border-actual);

        }

        .etiqueta-de-hora-vista-día {

            ancho: 60px;

            flexión-contracción: 0;

            alinear texto: derecha;

            relleno-derecho: 10px;

            tamaño de fuente: 0,75rem;

            color: var(--texto-actual-medio);

        }

        .día-vista-hora-contenido {

            crecimiento flexible: 1;

            borde izquierdo: 1px sólido var(--color-del-borde-actual);

            relleno: 5px;

            altura mínima: 40px;

            posición: relativa;

        }

        .añadir-tarea-al-tiempo-btn {

            posición: absoluta;

            derecha: 5px;

            superior: 5px;

            opacidad: 0;

            transición: opacidad 0,2s facilidad;

        }

        .day-view-hour-content:hover .add-task-to-time-btn {

            opacidad: 1;

        }



        /* Estilos de vista de gestión de proyectos y finanzas */

        #vista-de-gestión-de-proyectos, #vista-de-asistente-financiero {

            pantalla: flex;

            flexión-dirección: columna; 

            brecha: 1rem;

            altura: 100%;

            posición: relativa; 

            flexión: 1;

            desbordamiento: oculto;

        }

        

        #contenedor-de-tablero-de-proyecto, #contenedor-de-herramientas-financieras {

            flexión: 1; 

            pantalla: flex;

            flexión-dirección: columna;

            desbordamiento: oculto;

            min-altura: 0; 

        }

        #contenedor-de-chat-de-proyecto, #contenedor-de-chat-financiero {

            pantalla: flex;

            flexión-dirección: columna;

            borde superior: 1px sólido var(--color-del-border-actual);

            relleno superior: 1rem;

            transición: todos los 0,3 s de facilidad;

            flexión-contracción: 0;

            color de fondo: var(--current-bg-medium);

        }

        #proyecto-chat-contenedor.collapsed, #contenedor-chat-financiero.collapsed {

            crecimiento flexible: 0;

            base flexible: automática;

            altura: 50px !importante;

        }

        #proyecto-chat-container .proyecto-chat-body,

        #contenedor-de-chat-financiero .cuerpo-de-chat-financiero {

            pantalla: flex;

            flexión-dirección: columna;

            crecimiento flexible: 1;

        }

        #proyecto-chat-container.collapsed .proyecto-chat-body,

        #contenedor-de-chat-financiero.collapsed .cuerpo-de-chat-financiero {

            pantalla: ninguna;

        }

        #alternar chat de proyecto i, #alternar chat financiero i {

            transición: transformar 0,3s facilidad;

        }

        #proyecto-chat-container:not(.collapsed) #proyecto-chat-toggle i,

        #contenedor-de-chat-financiero:no(.collapsed) #alternar-de-chat-financiero i {

            transformar: rotar(180 grados);

        }



        #mensajes-de-chat-del-proyecto, #mensajes-de-chat-financiero {

            crecimiento flexible: 1;

            desbordamiento-y: automático;

            relleno: 0,5rem;

        }

        

        #vista-kanban {

            pantalla: cuadrícula;

            columnas-de-plantilla-de-cuadrícula: repeat(3, 1fr); 

            brecha: 1rem;

            desbordamiento: oculto; 

            crecimiento flexible: 1;

        }



        .columna-kanban {

            color de fondo: var(--current-bg-light);

            radio del borde: 0,75rem;

            relleno: 1rem;

            pantalla: flex;

            flexión-dirección: columna;

            altura: 100%;

            min-width: 0; /* Permitir que las columnas se reduzcan */

        }

        .título-de-columna-kanban {

            peso de la fuente: 700;

            margen inferior: 1rem;

            relleno inferior: 0,5rem;

            borde inferior: 2px sólido var(--color-del-border-actual);

            pantalla: flex;

            justificar-contenido: espacio-entre;

            alinear-elementos: centro;

        }

        tarjetas .kanban {

            crecimiento flexible: 1;

            altura mínima: 100px;

            desbordamiento-y: automático;

            pantalla: flex;

            flexión-dirección: columna;

            brecha: 0,75rem;

        }

        .tarjeta-kanban {

            color de fondo: var(--current-bg-medium);

            relleno: 0,75rem 1rem;

            radio del borde: 0,5rem;

            caja-sombra: 0 1px 3px rgba(0,0,0,0.1);

            cursor: puntero;

            borde izquierdo: 4px sólido var(--current-primary);

            posición: relativa;

        }

        .tarjeta-kanban .icono-de-tarea-eliminar {

            pantalla: ninguna;

            posición: absoluta;

            derecha: 4px;

            superior: 4px;

            color: var(--texto-actual-medio);

            color de fondo: var(--current-bg-light);

            radio del borde: 50%;

            ancho: 18px;

            altura: 18px;

            tamaño de fuente: 10px;

            altura de línea: 18px;

            alinear texto: centro;

            transición: todos los 0,2 s de facilidad;

        }

        .tarjeta-kanban .icono-de-tarea-eliminar:hover {

            color de fondo: var(--color-de-peligro);

            color: blanco;

            transformar: escala(1.1);

        }

        .kanban-card:hover .delete-task-icon {

            pantalla: bloque;

        }

        .tarjeta-kanban.urgente {

            color del borde izquierdo: var(--color urgente);

        }

        .kanban-card:activo {

            cursor: agarrando;

            color de fondo: var(--primary);

        }

        .tarjeta kanban p {

            peso de la fuente: 500;

            padding-right: 20px; /* Espacio para el icono de eliminar */

        }

        .tarjeta-kanban .pie-de-tarjeta {

            tamaño de fuente: 0,75rem;

            color: var(--texto-actual-medio);

            margen superior: 0,75rem;

            pantalla: flex;

            justificar-contenido: espacio-entre;

            alinear-elementos: centro;

        }

        .tarjetas-kanban.arrastrar-sobre {

            borde: 2px discontinuo var(--current-primary);

            color de fondo: rgba(138, 79, 255, 0.1);

        }

        

        /* Estilos de vista de lista */

        #vista-de-lista {

            desbordamiento: oculto;

            crecimiento flexible: 1;

            pantalla: flex; 

            flexión-dirección: columna; 

        }

        .encabezado de vista de lista {

            pantalla: cuadrícula;

            columnas de plantilla de cuadrícula: 1fr 150px 80px 120px 40px;

            brecha: 1rem;

            relleno: 0.5rem 1rem;

            borde inferior: 2px sólido var(--color-del-border-actual);

            peso de la fuente: 700;

            tamaño de fuente: 0,75rem;

            text-transform: mayúsculas;

            color: var(--texto-actual-medio);

            flexión-contracción: 0; 

        }

        .lista-vista-contenido {

             desbordamiento-y: automático; 

             crecimiento flexible: 1; 

        }

        .lista-vista-tarea {

            pantalla: cuadrícula;

            columnas de plantilla de cuadrícula: 1fr 150px 80px 120px 40px;

            brecha: 1rem;

            alinear-elementos: centro;

            relleno: 0,25rem 1rem;

            borde inferior: 1px sólido var(--color-del-border-actual);

        }

        .list-view-task entrada[tipo="fecha"], .list-view-task entrada[tipo="hora"] {

                fondo: transparente;

                borde: ninguno;

                radio del borde: 4px;

                relleno: 2px 4px;

                tamaño de fuente: 0.8rem;

                ancho:auto;

                color: var(--texto-actual-luz);

                esquema de color: oscuro;

        }

        .light-theme .list-view-task input { esquema de color: claro; color: var(--claro-texto-oscuro); }

        .lista-vista-tarea:hover {

            color de fondo: var(--current-bg-light);

        }

        .lista-vista-tarea.elemento-de-tarea-completado .lista-contenido-de-tarea {

            decoración de texto: línea a través;

            opacidad: 0,6;

        }

        .lista-de-contenido-de-tareas.urgente {

            peso de la fuente: 600;

            color: var(--color-urgente);

        }

        .lista-de-contenido-de-tarea entrada {

            fondo: transparente;

            borde: ninguno;

            contorno: ninguno;

            ancho: 100%;

        }

        .lista-de-contenido-de-tarea entrada:enfoque {

             color de fondo: var(--current-bg-dark);

        }

        .célula-prioritaria {

            alinear texto: centro;

            cursor: puntero;

        }

        

        .etiquetas-de-tarea {

            pantalla: flex;

            espacio: 4px;

            flex-wrap: envolver;

        }

        .etiqueta-de-tarea {

            relleno: 2px 8px;

            tamaño de fuente: 0.7rem;

            radio del borde: 12px;

            peso de la fuente: 600;

        }

        #proyecto-etiqueta-filtro-contenedor {

            posición: relativa;

        }

        #etiqueta-filtro-desplegable {

            posición: absoluta;

            color de fondo: var(--current-bg-light);

            borde: 1px sólido var(--current-border-color);

            radio del borde: 0,5rem;

            índice z: 10;

            altura máxima: 200px;

            desbordamiento-y: automático;

        }



        /*Estilos de gamificación*/

        #gamificación-modal .modal-content-body { altura-máxima: 80vh; desbordamiento-y: auto; }

        .gamification-tabs { borde inferior: 2px sólido var(--color-del-borde-actual); }

        .gamification-tab { relleno: 0,75rem 1rem; peso de fuente: 600; color: var(--current-text-medium); cursor: puntero; borde inferior: 3px sólido transparente; transición: color 0,2s, color del borde 0,2s; }

        .gamification-tab.active { color: var(--current-primary); color del borde: var(--current-primary); }

        .xp-bar-bg { color de fondo: var(--current-bg-light); }

        .xp-bar-fill { color de fondo: var(--current-primary); transición: ancho 0.5s salida fácil; }

        .level-badge { color de fondo: var(--current-primary); color: blanco; relleno: 2px 8px; radio del borde: 12px; tamaño de fuente: 0.7rem; peso de fuente: negrita; }

        .streak-day { color de fondo: var(--current-bg-light); borde: 2px sólido var(--current-border-color); transición: todos 0.2s facilidad; }

        .streak-day.active { color del borde: var(--current-primary); transformar: escala(1.05); sombra del cuadro: 0 0 10px rgba(138, 79, 255, 0.5); }

        .streak-day.completed { color de fondo: var(--current-primary); color: blanco; color del borde: var(--current-primary); }

        .streak-day .fa-gift { color: var(--color-dorado); }

        .mission-item.completed { opacidad: 0.5; decoración de texto: línea continua; }

        .mission-item.completed .btn-primary { color de fondo: #4CAF50; cursor: predeterminado; }

        .achievement-badge { borde: 2px sólido var(--current-border-color); filtro: escala de grises(100%); opacidad: 0.6; transición: todo 0.3s facilidad; }

        .achievement-badge.unlocked { color del borde: var(--color dorado); filtro: escala de grises(0%); opacidad: 1; sombra del cuadro: 0 0 15px var(--color dorado); }

        .insignia-de-logro.desbloqueada .medalla-fa { color: var(--color-dorado); }

        .text-gold { color: var(--gold-color); }



        /* Mejoras en los modos de precios */

        .plan-detalles {

            altura máxima: 0;

            desbordamiento: oculto;

            transición: altura máxima 0,5 s entrada-salida suave;

        }

        .plan-detalles.abierto {

            altura máxima: 500px; /*Ajustar según sea necesario*/

        }

        .plan-lista-de-características {

            posición-estilo-lista: dentro;

        }

        .plan-lista-de-características li {

            relleno-izquierdo: 1em;

            sangría de texto: -1em;

        }

        .plan-lista-de-características .fa-check-circle {

            color: var(--primario);

        }



        /* NUEVOS estilos de asistente financiero */

        #contenedor-de-herramientas-financieras {

             relleno: 1rem;

             brecha: 1rem;

             desbordamiento-y: automático;

        }

        .sección-de-finanzas {

            color de fondo: var(--current-bg-light);

            radio del borde: 0,75rem;

            relleno: 1rem;

        }

        encabezado-de-sección-de-finanzas {

            pantalla: flex;

            justificar-contenido: espacio-entre;

            alinear-elementos: centro;

            relleno inferior: 0,5rem;

            margen inferior: 0.5rem;

            borde inferior: 1px sólido var(--color-del-border-actual);

        }

        .finanzas-sección-encabezado h3 {

            tamaño de fuente: 1.125rem;

            peso de la fuente: 700;

        }

        .categoría-finanzas {

            margen superior: 1rem;

            borde: 1px sólido var(--current-border-color);

            radio del borde: 0,5rem;

        }

        .encabezado-de-categoría-finanzas {

            pantalla: flex;

            justificar-contenido: espacio-entre;

            alinear-elementos: centro;

            relleno: 0,5rem 0,75rem;

            color de fondo: var(--current-bg-medium);

            cursor: puntero;

            radio del borde: 0.5rem 0.5rem 0 0;

        }

        .encabezado-de-categoría-finanzas .nombre-de-categoría-finanzas-entrada {

            fondo: transparente;

            borde: ninguno;

            contorno: ninguno;

            peso de fuente: negrita;

            ancho: 70%;

            color: var(--texto-actual-luz);

        }

        .contenido-de-categoría-finanzas {

            relleno: 0,75rem;

        }

        .finance-item-row {

            pantalla: cuadrícula;

            columnas de plantilla de cuadrícula: 1fr 100px 40px;

            brecha: 0,75rem;

            alinear-elementos: centro;

            relleno: 0,25rem 0;

            borde inferior: 1px sólido var(--color-del-border-actual);

        }

        .finance-item-row:último-hijo {

            borde inferior: ninguno;

        }

        .finance-item-row entrada {

            fondo: transparente;

            borde: ninguno;

            relleno: 0,25rem;

            ancho: 100%;

            contorno: ninguno;

            color: var(--texto-actual-luz);

        }

        .finance-item-row entrada:enfoque {

            color de fondo: var(--current-bg-dark);

            radio del borde: 4px;

        }

        .resumen-de-finanzas {

            color de fondo: var(--current-bg-light);

            radio del borde: 0,5rem;

            relleno: 1rem;

            pantalla: cuadrícula;

            columnas-de-plantilla-de-cuadrícula: repeat(auto-fit, minmax(120px, 1fr));

            brecha: 1rem;

            alinear texto: centro;

        }

        .resumen financiero h4 {

            tamaño de fuente: 0.8rem;

            color: var(--texto-actual-medio);

        }

        .resumen-finanzas p {

            tamaño de fuente: 1.25rem;

            peso de la fuente: 700;

        }

        #ingreso-total { color: #22c55e; }

        #gastos-totales { color: #ef4444; }



        /* MODIFICADO: Estilos para el nuevo Bloc de Notas */

        #notepad-view-container {

            pantalla: ninguna;

            altura: 100%;

            flexión-dirección: fila;

        }

        #panel-de-lista-de-notas {

            ancho: 250 px; /* Un poco más ancho para previsualizaciones */

            flexión-contracción: 0;

            borde derecho: 1px sólido var(--color-del-border-actual);

            pantalla: flex;

            flexión-dirección: columna;

            color de fondo: var(--current-bg-dark);

        }

        #notas-lista-encabezado {

            relleno: 0,75rem;

            borde inferior: 1px sólido var(--color-del-border-actual);

        }

        #lista-de-notas {

            crecimiento flexible: 1;

            desbordamiento-y: automático;

            relleno: 0,5rem;

        }

        .nota-elemento {

            relleno: 0,75rem;

            radio del borde: 0,5rem;

            cursor: puntero;

            borde: 1px sólido transparente;

            margen inferior: 0.5rem;

            color de fondo: var(--current-bg-light);

        }

        .note-item:hover { color de fondo: var(--current-bg-medium); }

        .note-item.active { color de fondo: var(--current-primary); color: blanco; color del borde: var(--current-primary-hover); }

        .note-item-title { peso de fuente: 600; espacio en blanco: nowrap; desbordamiento: oculto; desbordamiento de texto: elipsis; }

        .note-item-preview { tamaño de fuente: 0.8rem; color: var(--current-text-medium); espacio en blanco: nowrap; desbordamiento: oculto; desbordamiento de texto: elipsis; margen superior: 0.25rem; }

        .note-item.active .note-item-preview { color: rgba(255,255,255,0.8); }



        #panel-editor-de-notas {

            crecimiento flexible: 1;

            pantalla: flex;

            flexión-dirección: columna;

            relleno: 1rem;

            color de fondo: var(--current-bg-medium);

        }

        #encabezado del editor de notas {

            pantalla: flex;

            alinear-elementos: centro;

            brecha: 0,5rem;

            margen inferior: 1rem;

            flexión-contracción: 0;

        }

        #nota-título-entrada {

            crecimiento flexible: 1;

            fondo: transparente;

            borde: ninguno;

            contorno: ninguno;

            tamaño de fuente: 1.5rem;

            peso de fuente: negrita;

            color: var(--texto-actual-luz);

        }

        #barra de herramientas del editor de notas {

            relleno: 0,5rem;

            radio del borde: 0,5rem;

            color de fondo: var(--current-bg-light);

            pantalla: flex;

            brecha: 0,5rem;

            alinear-elementos: centro;

            flex-wrap: wrap; /* Para responsividad */

        }

        .toolbar-btn {

            color de fondo: var(--current-bg-dark);

            borde: 1px sólido var(--current-border-color);

            radio del borde: 0,375rem;

            relleno: 0,5rem;

            transición: todos los 0,2 s de facilidad;

        }

        .toolbar-btn:hover { color de fondo: var(--current-bg-medium); color: var(--current-primary); }

        .toolbar-btn.active { color de fondo: var(--current-primary); color: blanco; }

        

        #herramientas-de-dibujo {

            pantalla: ninguna; /* Se muestra con JS */

            alinear-elementos: centro;

            brecha: 0,75rem;

            relleno izquierdo: 0,75rem;

            borde izquierdo: 1px sólido var(--color-del-borde-actual);

            margen izquierdo: 0.5rem;

        }

        .muestra de color {

            ancho: 24px;

            altura: 24px;

            radio del borde: 50%;

            cursor: puntero;

            borde: 2px sólido transparente;

            transición: transformar 0,2s;

        }

        .color-swatch:hover { transformar: escala(1.1); }

        .color-swatch.active { color del borde: var(--current-primary); transformar: escala(1.2); }



        #área de contenido de notas {

            crecimiento flexible: 1;

            posición: relativa;

            margen superior: 1rem;

            radio del borde: 0,5rem;

            desbordamiento: oculto;

        }

        #editor de contenido de notas {

            ancho: 100%;

            altura: 100%;

            color de fondo: var(--current-bg-dark);

            color: var(--texto-actual-luz);

            borde: 1px sólido var(--current-border-color);

            radio del borde: 0,5rem;

            relleno: 1rem;

            familia de fuentes: 'Montserrat', sans-serif;

            tamaño de fuente: 1rem;

            cambiar tamaño: ninguno;

            contorno: ninguno;

            desbordamiento-y: automático;

            altura de línea: 1.6;

        }

        #note-content-editor:focus { color del borde: var(--current-primary); }

        #nota-lienzo {

            posición: absoluta;

            arriba: 0;

            izquierda: 0;

            ancho: 100%;

            altura: 100%;

            eventos de puntero: ninguno; /* Se activa con JS */

            cursor: cruz;

        }

        /* Estilos para lista de verificación */

        .elemento de lista de verificación {

            pantalla: flex;

            alinear-elementos: centro;

            brecha: 0,75rem;

            margen: 0.5rem 0;

        }

        .checklist-item entrada[tipo="casilla de verificación"] {

            ancho: 18px;

            altura: 18px;

            flexión-contracción: 0;

            color de acento: var(--current-primary);

        }

        .texto del elemento de la lista de verificación {

            crecimiento flexible: 1;

            contorno: ninguno;

        }

        .texto del elemento de lista de verificación[datos completados="verdadero"] {

            decoración de texto: línea a través;

            color: var(--texto-actual-medio);

        }

        #área-de-colaboradores {

            pantalla: flex;

            alinear-elementos: centro;

        }

        .avatar-colaborador {

            ancho: 32px;

            altura: 32px;

            radio del borde: 50%;

            borde: 2px sólido var(--current-bg-medium);

            margen izquierdo: -10px;

            color de fondo: var(--current-primary);

            color: blanco;

            pantalla: inline-flex;

            alinear-elementos: centro;

            justificar-contenido: centro;

            peso de fuente: negrita;

            tamaño de fuente: 0.8rem;

        }

        .collaborator-avatar:first-child { margen-izquierdo: 0; }



        /* Notificación en la aplicación */

        #notificación en la aplicación {

            posición: fija;

            superior: 20px;

            izquierda: 50%;

            transformar: translateX(-50%) translateY(-200%);

            color de fondo: var(--current-bg-light);

            color: var(--texto-actual-luz);

            relleno: 1rem;

            radio del borde: 0,75rem;

            índice z: 100;

            caja-sombra: 0 4px 15px rgba(0,0,0,0.2);

            transición: transformación 0,5 s entrada-salida suave, opacidad 0,5 s entrada-salida suave;

            borde: 1px sólido var(--current-border-color);

            ancho máximo: 90%;

            ancho: 400px;

            opacidad: 0;

            eventos de puntero: ninguno;

            cursor: puntero;

        }

        #notificación-en-la-aplicación.mostrar {

            transformar: translateX(-50%) translateY(0);

            opacidad: 1;

            eventos de puntero: auto;

        }

        #encabezado-de-notificación-en-la-aplicación {

            pantalla: flex;

            justificar-contenido: espacio-entre;

            alinear-elementos: centro;

            margen inferior: 0.5rem;

        }

        #encabezado-de-notificación-en-la-aplicación h4 {

            peso de fuente: negrita;

        }





        /* Estilos específicos del escritorio */

        @media (ancho mínimo: 768px) {

            #menú-de-servicios {

                opacidad: 0;

                visibilidad: oculta;

                transformar: escala(0.95) traducirY(-10px);

                transición: opacidad 0,2 s facilidad, transformación 0,2 s facilidad, visibilidad 0,2 s;

            }

            #menu-servicios.mostrar {

                opacidad: 1;

                visibilidad: visible;

                transformar: escala(1) traducirY(0);

            }

            #vista-de-gestión-de-proyectos, #vista-de-asistente-financiero {

                pantalla: flex; 

                flexión-dirección: fila; 

            }

            #contenedor-de-chat-de-proyecto, #contenedor-de-chat-financiero {

                pantalla: flex;

                borde izquierdo: 1px sólido var(--color-del-borde-actual);

                borde superior: ninguno;

                relleno-izquierdo: 1rem;

                relleno superior: 0;

                altura: 100%;

                base flexible: 40%;

                flexión-contracción: 0;

                flexión-dirección: columna;

            }

            #proyecto-chat-contenedor.collapsed, #contenedor-chat-financiero.collapsed {

                base flexible: 50px;

                altura: 100% !importante;

            }

            #encabezado-de-contenedor-de-chat-del-proyecto, #encabezado-de-chat-financiero { cursor: puntero; }



            #proyecto-chat-container.collapsed .proyecto-chat-body,

            #proyecto-chat-container.collapsed #proyecto-chat-container-header h3,

            #contenedor-de-chat-financiero.collapsed .cuerpo-de-chat-financiero,

            #contenedor-de-chat-financiero.collapsed #encabezado-de-chat-financiero h3 {

                pantalla: ninguna;

            }

            #proyecto-chat-container.collapsed #proyecto-chat-toggle,

            #contenedor-de-chat-financiero.collapsed #alternar-de-chat-financiero {

                transformar: rotar(90deg);

                justificar-contenido: centro;

            }

            #proyecto-chat-container.collapsed #proyecto-chat-toggle i,

            #contenedor-de-chat-financiero.colapsado #alternar-de-chat-financiero i {

                 transformar: rotar(180 grados);

            }

        }

        

        /* Ajustes específicos para móviles */

        @media (ancho máximo: 767px) {

            #mobile-chat-title-wrapper .edit-icon, #mobile-chat-title-wrapper #motivation-btn-mobile {

                pantalla: bloque en línea;

            }

             #envoltura-de-título-de-chat-de-escritorio .icono-de-edición, #envoltura-de-título-de-chat-de-escritorio #encabezado-btn-de-motivación {

                pantalla: ninguna;

            }

            #calendario-modal {

                relleno: 0,5rem;

                ancho máximo: 98vw;

                altura máxima: 95vh;

                desbordamiento: oculto;

                pantalla: flex;

                flexión-dirección: columna;

            }

            #calendar-modal > div:not(:first-child) {

                desbordamiento-y: automático;

            }



            .iconos-izquierdos-del-encabezado {

                flexión-contracción: 0;

                pantalla: flex;

                alinear-elementos: centro;

                brecha: 0;

            }

             .iconos-izquierdos-del-encabezado > * {

                relleno: 0,3rem; 

            }

            .iconos-de-encabezado-derecho {

                flexión-contracción: 0;

                pantalla: flex;

                alinear-elementos: centro;

                brecha: 0;

            }

            .iconos-de-encabezado-derecho > * {

                relleno: 0,3rem;

            }

            #desktop-chat-title-wrapper { mostrar: ninguno; }

            #contenido del encabezado principal {

                pantalla: flex;

                alinear-elementos: centro;

                justificar-contenido: espacio-entre;

                ancho: 100%;

                brecha: 0,5rem;

            }

            #contenido del encabezado principal > * {

                base flexible: 33,33%;

            }

            #contenido-del-encabezado-principal .iconos-izquierdos-del-encabezado { justificar-contenido: inicio-flexible; }

            #contenido-del-encabezado-principal .iconos-del-encabezado-derecho { justificar-contenido: flex-end; }

            #contenido del encabezado principal #contador de mensajes { alineación del texto: centro; }





             #área-de-vista-previa-de-archivo {

                display: none; /* Mostrar solo cuando hay un archivo */

             }

             #contenedor-de-vista-previa-de-imagen {

                pantalla: flex;

                alinear-elementos: centro;

                brecha: 0,5rem;

                altura máxima: 45px;

                flexión-contracción: 1;

            }

            #vista previa de la imagen {

                altura máxima: 45px;

                ancho:auto;

                radio del borde: 0,25rem;

            }

            #área de entrada {

                pantalla: flex;

                flexión-dirección: columna;

            }



            #contenedor-de-chat-de-proyecto, #contenedor-de-chat-financiero {

                posición: absoluta;

                abajo: 0;

                izquierda: 0;

                derecha: 0;

                altura: 50px;

                desbordamiento: oculto;

                borde superior: 1px sólido var(--color-del-border-actual);

                índice z: 10;

                transición: altura 0,3s facilidad;

                altura máxima: calc(100vh - 120px); 

            }

            #proyecto-chat-container:no(.collapsed),

            #contenedor-de-chat-financiero:no(.collapsed) {

                 altura: 100%;

            }

            #proyecto-chat-container .proyecto-chat-body,

            #contenedor-de-chat-financiero .cuerpo-de-chat-financiero {

                altura: calc(100% - 50px);

                pantalla: flex;

                flexión-dirección: columna;

            }



            #vista-kanban {

                columnas-de-plantilla-de-cuadrícula: repeat(3, 1fr);

                desbordamiento-y: automático;

                desbordamiento-x: oculto;

                brecha: 0,4rem; 

                relleno inferior: 50px;

            }

            .columna-kanban {

                ancho mínimo: 0;

                relleno: 0,4rem;

            }

            .kanban-column-title { tamaño de fuente: 0.7rem; }

            .kanban-card { relleno: 0.4rem; }

            .kanban-card p { peso de fuente: normal; tamaño de fuente: 0.7rem; }



            #lista-vista-móvil {

                pantalla: flex;

                flexión-dirección: columna;

                brecha: 0,5rem;

                 relleno inferior: 50px;

                 desbordamiento-y: automático;

                 crecimiento flexible: 1;

            }

            .list-view-task-mobile { color de fondo: var(--current-bg-light); relleno: 0,75rem; radio del borde: 0,5rem; pantalla: flex; dirección flexible: columna; espacio: 0,5rem; }

            .list-view-task-mobile-header { visualización: flex; alinear-elementos: flex-start; espacio: 0.75rem; }

            .list-view-task-mobile-footer { display: flex; justify-content: espacio entre; align-items: centro; border-top: 1px sólido var(--current-border-color); padding-top: 0.5rem; font-size: 0.75rem; }

            .list-view-task-mobile-footer .task-time-date-inputs { display: flex; align-items: center; gap: 4px; }

            .list-view-task-mobile-footer entrada[tipo="hora"], .list-view-task-mobile-footer entrada[tipo="fecha"] {

                fondo: var(--current-bg-dark);

                borde: ninguno;

                radio del borde: 4px;

                relleno: 2px 4px;

                tamaño de fuente: 0.7rem;

                ancho:auto;

                esquema de color: oscuro;

            }

            .light-theme .list-view-task-mobile-footer entrada[tipo="hora"], .light-theme .list-view-task-mobile-footer entrada[tipo="fecha"] {

                 esquema de color: claro;

            }





            #menú-de-servicios {

                posición: fija;

                opacidad: 0;

                visibilidad: oculta;

                transformar: escala(0.95) traducirY(-10px);

                transición: opacidad 0,2 s facilidad, transformación 0,2 s facilidad, visibilidad 0,2 s;

                ancho: 90vw;

                ancho máximo: 320px;

                superior: 60px;

                derecha: 10px;

                altura máxima: calc(100vh - 80px);

                desbordamiento-y: automático;

                índice z: 50;

            }

            #menu-servicios.mostrar {

                opacidad: 1;

                visibilidad: visible;

                transformar: escala(1) traducirY(0);

            }

            

            Botón para alternar vista de calendario { relleno: 6px 4px; tamaño de fuente: 0.75rem; }

            .controles-de-vista-del-proyecto { ancho: ajuste-al-contenido; crecimiento-flexible: 0; }

            botón .project-view-controls { relleno: 6px 8px; tamaño de fuente: 0.75rem; crecimiento flexible: 0; }

            

            #gamificación-modal .modal-content { relleno: 1rem; }

            #gamificación-modal h2 { tamaño de fuente: 1.25rem; }

            .streak-day .text-lg { tamaño de fuente: 0.8rem; }

            .streak-day .text-2xl { tamaño de fuente: 1.1rem; }

            .streak-day .text-xs { tamaño de fuente: 0.6rem; }

            .mission-item { flex-direction: columna; align-items: flex-start; gap: 0.5rem; }

            .mission-item .btn-primary { relleno: 0.25rem 0.5rem; tamaño de fuente: 0.75rem; alineamiento propio: extremo flexible; }

            #contenedor-de-logros { gap: 0.5rem; }

            .achievement-badge { relleno: 0.5rem; tamaño de fuente: 0.7rem; }

            .insignia-de-logro .fa-3x { tamaño de fuente: 1.75em; }

        }

        

        /* Paisaje móvil */

        @media (altura máxima: 500px) y (orientación: horizontal) {

            #barra lateral está abierta #barra lateral con contenido desplazable {

                 desbordamiento-y: automático;

                 altura: 100%;

            }

            #área-de-chat-principal, #vista-de-gestión-de-proyectos, #vista-de-asistente-financiero {

                desbordamiento-y: automático;

            }

            #mensajes de chat {

                relleno: 0,5rem;

                crecimiento flexible: 1;

            }

            #vista-kanban {

                columnas de plantilla de cuadrícula: repeat(3, minmax(250px, 1fr));

                desbordamiento-x: auto;

            }

            .modal-content { altura máxima: 95vh; desbordamiento-y: auto; }

            #área-de-entrada { relleno: 0.5rem; contracción-flexible: 0; }

            .pro-controls-bg { relleno: 0.25rem; }

            #msg { altura: 3rem !importante; altura máxima: 3rem; }

        }



        /* Efecto de brillo modal de motivación */

        #cita-motivacion.texto-brillante {

            posición: relativa;

            desbordamiento: oculto;

        }

        #motivacion-cita.shimmer-text::después {

            contenido: '';

            posición: absoluta;

            arriba: 0;

            izquierda: 0;

            ancho: 50%;

            altura: 100%;

            fondo: gradiente lineal (a la derecha, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);

            animación: shimmer 2.5s entrada-salida gradual infinita;

            eventos de puntero: ninguno;

        }

        @keyframes brillan {

            0% { transformar: translateX(-150%) skewX(-15deg); }

            100% { transformar: translateX(250%) skewX(-15deg); }

        }



    </estilo>

</cabeza>

<body class="w-screen overflow-x-hidden tema oscuro">

    <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <script type="texto/javascript">

        si (ventana.netlifyIdentity) {

            netlifyIdentity.init();

        }

    </script>

    <div id="superposición-de-carga" clase="recuadro fijo-0 fondo-fondo-oscuro fondo-opacidad-95 flex flex-col elementos-centro justificar-centro z-[100] opacidad-de-transición duración-300">

        <img src="./Logos HD.png" alt="Logotipo de Goatify" class="w-24 h-24 object-contain mb-6 animate-pulse" onerror="this.onerror=null;this.src='https://placehold.co/96x96/121212/e0e0e0?text=LOGO';">

        <div class="texto-texto-luz centro-de-texto">

            <i class="fas fa-spinner fa-spin fa-2x"></i>

            <p class="mt-3 text-lg font-semibold" data-translate-key="initializing">Inicializando...</p>

        </div>

    </div>



    <div id="superposición de barra lateral" clase="recuadro fijo-0 fondo negro fondo-opacidad-50 z-30 md:opacidad oculta-0 eventos de puntero-ninguno"></div>



    <div id="app-container" class="flex w-full opacidad relativa-0 opacidad de transición duración-300">

        <aside id="barra lateral" clase="w-72 flex-shrink-0 flex flex-col transición-transformación duración-300 md:translate-x-0 h-full">

            

            <div id="encabezado de barra lateral">

                <div id="logo-space" class="w-16 h-16 rounded-lg mx-auto flex-shrink-0 flex items-center justify-center overflow-hidden">

                    <img src="./Logos HD.png" alt="Logotipo de Goatify" class="w-full h-full object-contain" onerror="this.onerror=null;this.src='https://placehold.co/64x64/2c2c2c/e0e0e0?text=LOGO';">

                </div>

            </div>



            <!-- MODIFICADO: Contenedor de principales movido a la zona de scroll -->

            <div id="contenido desplazable de la barra lateral">

                <div id="barra lateral-contenido-principal" clase="flex flex-col">

                    <div class="flex-grow">

                        <!-- MODIFICADO: El título "Workflows" ahora está encima de los asistentes principales -->

                        Flujos de trabajo

                        

                        <!-- Contenedor para los asistentes principales -->

                        <div id="barra lateral-acciones-superiores" clase="espacio-y-2 mb-4">

                            <button data-workflow="gestión-de-proyectos" class="encabezado-de-flujo-de-trabajo flex items-center p-2 rounded-md cursor-pointer hover:bg-light w-full text-left">

                                <i class="fas fa-tasks w-6 mr-2"></i>

                                <span class="text-sm font-bold">Asistente de Proyectos</span>

                            </botón>

                            <button data-workflow="asistente-financiero" class="encabezado-de-flujo-de-trabajo flex items-center p-2 rounded-md cursor-pointer hover:bg-light w-full text-left">

                                <i class="fas fa-wallet w-6 mr-2"></i>

                                <span class="text-sm font-bold">Asistente Financiero</span>

                            </botón>

                            <button data-workflow="notepad-app" class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light w-full text-left">

                                <i class="fas fa-book-open w-6 mr-2"></i>

                                <span class="text-sm font-bold">Bloque de notas</span>

                            </botón>

                        </div>



                        <!-- Contenedor para los flujos de trabajo secundarios -->

                        <div id="contenedor-de-flujos-de-trabajo" clase="espacio-y-1 borde-t borde-temático pt-4">

                            <div class="categoría-de-flujo-de-trabajo">

                                <div class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light">

                                        <i class="fas fa-chevron-right flujo de trabajo-flecha mr-2 transición-transformación texto-xs"></i><i class="fas fa-brain w-6 mr-2"></i>

                                    Asistente experto

                                </div>

                                    <div class="contenido-de-flujo-de-trabajo pl-4 pt-1 espacio-y-1">

                                    Laboratorio de Decisiones

                                    Resolución de conflictos

                                    </div>

                            </div>

                            <div class="categoría-de-flujo-de-trabajo">

                                <div class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light">

                                        <i class="fas fa-chevron-right flujo de trabajo-flecha mr-2 transición-transformación texto-xs"></i><i class="fas fa-share-alt w-6 mr-2"></i>

                                    Potenciador de Redes Sociales

                                    </div>

                                <div class="contenido-de-flujo-de-trabajo pl-4 pt-1 espacio-y-1">

                                    <button data-workflow="create-full-post" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_social_1">Crear una publicación completa</button>

                                        Redacción de copias

                                    <button data-workflow="post-ideas" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_social_3">Ideas para publicaciones</button>

                                        <button data-workflow="estrategia-de-marca" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_social_4">Definir una estrategia de marca</button>

                                </div>

                            </div>

                                <div class="categoría-de-flujo-de-trabajo">

                                <div class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light">

                                        <i class="fas fa-chevron-right workflow-arrow mr-2 transition-transform text-xs"></i><i class="fas fa-chart-pie w-6 mr-2"></i>

                                    Análisis de negocios

                                </div>

                                    <div class="contenido-de-flujo-de-trabajo pl-4 pt-1 espacio-y-1">

                                    Análisis de su competencia

                                        <button data-workflow="buyer-persona" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_business_2">Definir mi cliente ideal</button>

                                    <button data-workflow="nombres-de-marca" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_business_3">Lluvia de nombres de marca</button>

                                    </div>

                            </div>

                            <div class="categoría-de-flujo-de-trabajo">

                                <div class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light">

                                        <i class="fas fa-chevron-right workflow-arrow mr-2 transition-transform text-xs"></i><i class="fas fa-headset w-6 mr-2"></i>

                                    <span class="text-sm font-bold" data-translate-key="wf_sales">Comunicación y Ventas</span>

                                    </div>

                                <div class="contenido-de-flujo-de-trabajo pl-4 pt-1 espacio-y-1">

                                    Asistente de ventas 24/7

                                    Redacción de correo electrónico

                                    Diseño web

                                        Mejorar las habilidades sociales

                                </div>

                                </div>

                            <div class="categoría-de-flujo-de-trabajo">

                                <div class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light">

                                        <i class="fas fa-chevron-right workflow-arrow mr-2 transition-transform text-xs"></i><i class="fas fa-language w-6 mr-2"></i>

                                    Profesor de inglés

                                </div>

                                    <div class="contenido-de-flujo-de-trabajo pl-4 pt-1 espacio-y-1">

                                    <button data-workflow="english-teacher-translate" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_eng_1">Traducir/Corregir texto</button>

                                        Aprender vocabulario nuevo

                                    <button data-workflow="english-teacher-practice" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_eng_3">Practicar conversación</button>

                                    </div>

                            </div>

                        </div>

                        

                        <div class="flex flex-col espacio-y-2 py-4 borde-t borde-temático mt-4">

                            <button id="new-chat-btn" class="flex items-center justify-center font-semibold p-3 rounded-lg btn-primary transition-colors"><i class="fas fa-plus mr-2"></i><span data-translate-key="new_chat">Nuevo chat</span></button>

                            <button id="new-folder-btn" class="flex items-center justify-center font-semibold p-3 rounded-lg bg-input"><i class="fas fa-folder-plus mr-2"></i><span data-translate-key="new_folder">Nueva Carpeta</span></button>

                        </div>

    

                        <div class="border-t borde-temático pt-2">

                             <button id="select-chats-btn" class="w-full text-sm p-2 rounded hover:bg-light flex items-center justify-center">

                                <i class="fas fa-tasks mr-2"></i><span data-translate-key="select_chats">Seleccionar varios chats</span>

                            </botón>

                         </div>

                        <div id="controles del modo de eliminación" clase="espacio flexible oculto-x-2 mi-2">

                            <button id="eliminar-seleccionado-btn" class="flex-1 flex items-center justificar-centro fuente-semi-negrita p-2 redondeado-grande fondo-rojo-600 texto-blanco deshabilitado:opacidad-50" deshabilitado><i class="fas fa-trash-alt mr-2"></i><span data-translate-key="eliminar">Borrar</span></button>

                             <button id="cancelar-seleccionar-modo-btn" class="p-2 redondeado-lg fondo gris-600 texto blanco"><i class="fas fa-times"></i></button>

                        </div>

                        <div id="contenido-de-barra-lateral" clase="pr-1 espacio-y-1"></div>

                    </div>

                </div>



                <div id="sidebar-footer">

                    <div class="flex flex-col espacio-y-2 borde-t borde-temático pt-4">

                        <button id="web-launch-offer-btn" class="w-full text-left font-semibold text-sm p-3 rounded-lg btn-primary transition-colors animate-pulse" data-translate-key="web_offer">

                           🚀 ¡Lanza tu Negocio, te regalamos una pg web Gratis con tu suscripción!

                        </botón>

                        <div id="contenedor-plan-de-actualización" class="texto-oculto-centro p-2 fondo-amarillo-400 redondeado-lg">

                            <button id="upgrade-plan-btn" class="text-xs font-semibold text-black hover:text-gray-800">

                                <i class="fas fa-rocket MR-1"></i>

                               <span data-translate-key="upgrade_plan">Plan de Mejora</span>

                            </botón>

                        </div>

                        <div class="text-center p-2 bg-input rounded-lg">

                            <a href="#" id="enlace-de-guías-gratuitas" clase="texto-xs fuente-semi-negrita texto-primario hover:underline">

                                <i class="fas fa-book-open mr-1"></i>

                               <span data-translate-key="free_guides">Guías de IA Gratis</span>

                            </a>

                        </div>

                    </div>

                </div>

            </div>



            <div id="barra lateral inferior fija">

                 <div id="sección-de-usuario">

                    <div id="vista de inicio de sesión" clase="oculto">

                        <button id="login-btn" class="w-full flex items-center justify-center font-semibold p-3 rounded-lg btn-primary transition-colors"><i class="fas fa-sign-in-alt mr-2"></i><span data-translate-key="login">Iniciar sesión</span></button>

                    </div>

                     <div id="vista-del-menú-del-usuario" clase="relativo oculto">

                        <button id="user-menu-btn" class="w-full flex items-center text-left p-2 rounded-lg hover:bg-light transition-colors">

                            <span id="correo electrónico del usuario" clase="flex-grow truncate text-sm font-semibold"></span>

                            <i class="fas fa-ellipsis-h"></i>

                        </botón>

                        <div id="menú-usuario-popup" class="absoluto inferior-completo izquierda-0 w-completo mb-2 redondeado-lg p-2 borde borde-temático sombra-lg oculto">

                            <button id="settings-btn" class="w-full text-left text-sm p-2 rounded hover:bg-medium flex items-center"><i class="fas fa-cog w-6 mr-2"></i><span data-translate-key="settings">Configuración</span></button>

                             <button id="logout-btn" class="w-full text-left text-sm p-2 rounded hover:bg-medium flex items-center"><i class="fas fa-sign-out-alt w-6 mr-2"></i><span data-translate-key="logout">Cerrar sesión</span></button>

                        </div>

                    </div>

                </div>

            </div>

        </aparte>



        <main id="área de chat principal" clase="flex-1 flex flex-col h-full overflow-hidden">

            <header class="flex items-center justify-between p-3 md:p-4 border-b border-themed flex-shrink-0 relative">

                <div id="contenido del encabezado principal" clase="elementos flexibles centrados justificados entre w-full">

                    <div class="flex items-center flex-shrink-0 header-left-icons">

                        <button id="menu-toggle" class="md:hidden text-xl p-2"><i class="fas fa-bars"></i></button>

                        <button id="new-chat-icon-btn" title="Nuevo chat" class="text-xl p-2 hover:opacity-80 transition-opacity"><i class="fas fa-plus-circle text-primary"></i></button>

                    </div>

                    

                    <div id="desktop-chat-title-wrapper" class="hidden sm:flex items-center justify-center group cursor-pointer mx-2 flex-1 min-w-0" title="Renombrar Chat">

                        <i class="fas fa-pencil-alt text-xs text-text-medium edit-icon"></i>

                        Goatify IA

                        <button id="motivation-btn-header" title="Motivación diaria" class="text-yellow-400 hover:text-yellow-300 p-2 transition-colors ml-2"><i class="fas fa-lightbulb text-xl"></i></button>

                    </div>



                    <div class="flex items-center space-x-1 sm:space-x-2 header-right-icons">

                         <button id="calendar-btn" title="Mi Calendario y Tareas" class="text-sky-400 hover:text-sky-300 p-2 transition-colors notification-bell-icon">

                            <i class="fas fa-calendar-days text-xl"></i>

                            <span id="insignia-de-notificación" class="insignia-de-notificación oculta">0</span>

                        </botón>

                        <div id="contador-de-mensajes" clase="texto-xs fuente-mono espacio-en-blanco-ahora bloque mx-2"></div>

                        <button id="gamification-btn" title="Mi Ascensión" class="text-xl p-2 hover:opacity-80 transition-opacity text-gold">

                            <i class="fas fa-trophy"></i>

                        </botón>

                        <button id="services-menu-btn" title="Potenciar mi negocio" class="relative text-xl p-2 hover:opacity-80 transition-opacity flex items-center gap-2">

                            <i class="fas fa-rocket text-primary"></i>

                            Soluciones

                        </botón>

                        <button id="theme-toggle" title="Cambiar tema" class="text-xl p-2"><i class="fas fa-moon" id="theme-icon"></i></button>

                    </div>

                </div>

                 <div id="menú-servicios" class="absoluto superior-completo derecha-4 mt-2 w-80 redondeado-xl sombra-lg borde borde-temático z-30 p-4 origen-arriba-derecha">

                    Somos tu aliado estratégico

                    <p class="text-sm text-text-medium mb-4" data-translate-key="ally_desc">Goatify no es solo un chat. Somos una IA personalizada con un equipo de expertos listos para ayudarte a escalar tu negocio.</p>

                    <ul class="espacio-y-3">

                        <li><a id="sol-web" href="#" class="block p-3 rounded-lg hover:bg-medium transición-colors"><p class="font-semibold text-primary">Páginas Web que Convierten</p><p class="text-sm text-text-medium">Transformamos tus ideas en webs y tiendas online diseñadas para vender.</p></a></li>

                         <li><a id="sol-auto" href="#" class="block p-3 rounded-lg hover:bg-medium transición-colors"><p class="font-semibold text-primary">Ventas en Piloto Automático</p><p class="text-sm text-text-medium">Implementamos sistemas de IA para automatizar tus ventas y procesos clave.</p></a></li>

                        <li><a id="sol-social" href="#" class="block p-3 rounded-lg hover:bg-medium transición-colors"><p class="font-semibold text-primary">Avatares para Redes Sociales</p><p class="text-sm text-text-medium">Creamos avatares hiperrealistas con IA y estrategias de contenido que captan la atención.</p></a></li>

                         <li><a id="sol-consult" href="#" class="block p-3 rounded-lg hover:bg-medium transición-colors"><p class="font-semibold text-primary">Escala tu Empresa con IA</p><p class="text-sm text-text-medium">Obtén consultoría experta para integrar la IA en el ADN de tu negocio.</p></a></li>

                    </ul>

                </div>

            </encabezado>

            <div class="bloque sm:texto oculto-centro py-1.5 borde-b borde-temático fondo-actual fondo-oscuro sombra-sm flex-shrink-0">

                <div id="mobile-chat-title-wrapper" class="flex items-center justify-center group cursor-pointer px-4 relative" title="Renombrar Chat">

                    <i class="fas fa-pencil-alt text-xs text-text-medium edit-icon"></i>

                    Goatify IA

                    <button id="motivation-btn-mobile" title="Motivación diaria" class="text-yellow-400 hover:text-yellow-300 p-2 transition-colors"><i class="fas fa-lightbulb text-lg"></i></button>

                </div>

             </div>

            

            <div id="view-container" class="flex-1 overflow-hidden relative">

                <div id="mensajes de chat" clase="h-full overflow-y-auto p-3 sm:p-6">

                    <div class="flex justify-center items-center h-full" id="contenedor-de-mensaje-inicial">

                        <div id="envoltorio-de-mensaje-de-bienvenida" class="centro-de-texto medio-de-texto">

                            <img src="./Logos HD.png" alt="Logotipo de Goatify" class="w-24 h-24 object-contain mx-auto mb-4" onerror="this.onerror=null;this.src='https://placehold.co/96x96/2c2c2c/e0e0e0?text=LOGO';">

                            Goatify IA

                            <div id="personalized-welcome" class="hidden"><p class="text-lg mt-1"><span data-translate-key="welcome_user">¡Hola! Hoy es un gran día para crear algo increíble.</span></p></div>

                            <div id="generic-welcome" class="hidden"><p class="text-xl" data-translate-key="welcome_guest">¿Cómo puedo ayudarte hoy?</p></div>

                        </div>

                    </div>

                </div>



                <!-- MODIFICADO: Estructura HTML del nuevo Bloc de Notas -->

                <div id="contenedor-de-vista-del-bloc-de-notas">

                    <!-- Panel de la lista de notas -->

                    <div id="panel-de-lista-de-notas">

                        <div id="encabezado-de-lista-de-notas">

                            <button id="add-new-note-btn" class="w-full btn-primary text-sm flex items-center justify-center gap-2">

                                <i class="fas fa-plus"></i> Nueva Nota

                            </botón>

                        </div>

                        <div id="lista-de-notas">

                            <!-- Las notas se renderizarán aquí con JS -->

                        </div>

                    </div>

                    <!-- Panel del editor de notas -->

                    <div id="panel del editor de notas">

                        <div id="encabezado del editor de notas">

                            <input id="note-title-input" type="text" placeholder="Título de la nota..." class="bg-transparent text-lg font-bold w-full outline-none">

                            <div id="área-de-colaboradores" class="flex-shrink-0">

                                <!-- Avatares de colaboradores se agregarán aquí -->

                            </div>

                            <button id="share-note-btn" class="toolbar-btn" title="Compartir y Colaborar">

                                <i class="fas fa-user-plus"></i>

                            </botón>

                            <button id="delete-note-btn" title="Eliminar nota" class="toolbar-btn text-red-500 hover:text-red-400">

                                <i class="fas fa-trash-alt"></i>

                            </botón>

                        </div>

                        <div id="barra de herramientas del editor de notas">

                            <button id="add-checklist-item-btn" class="toolbar-btn" title="Añadir lista de verificación">

                                <i class="fas fa-check-square"></i>

                            </botón>

                            <button id="drawing-tool-btn" class="toolbar-btn" title="Activar/Desactivar Dibujo">

                                <i class="fas fa-pincel"></i>

                            </botón>

                            <!-- Herramientas de dibujo (ocultas por defecto) -->

                            <div id="herramientas de dibujo">

                                <input type="color" id="color-picker" class="toolbar-btn p-1" value="#FFFFFF" title="Seleccionar color">

                                <input type="range" id="brush-size" min="1" max="20" value="3" class="w-24" title="Tamaño del pincel">

                                Borrador

                                    <i class="fas fa-eraser"></i>

                                </botón>

                            </div>

                        </div>

                        <div id="área de contenido de notas">

                            <div id="editor de contenido de notas" contenteditable="true" class="h-full" spellcheck="false"></div>

                            <canvas id="note-canvas" class="absolute top-0 left-0"></canvas>

                        </div>

                    </div>

                </div>

                

                <div id="vista del asistente financiero" class="hidden h-full"></div>

                

                 <div id="vista de gestión de proyectos" class="hidden p-4 h-full">

                    <div id="contenedor-de-tablero-de-proyecto" clase="flex flex-col h-full">

                        <div class="flex flex-wrap justificar-entre-elementos-centro mb-4 flex-shrink-0 gap-2">

                            <div class="flex items-center gap-4">

                                Nombre del proyecto

                                <div id="área de colaboradores del proyecto"></div>

                            </div>

                            <div class="flex items-center gap-2">

                                <button id="share-project-btn" class="toolbar-btn" title="Compartir proyecto"><i class="fas fa-user-plus"></i></button>

                                <div id="contenedor-de-filtro-de-etiquetas-del-proyecto" clase="relativo">

                                    <button id="tag-filter-btn" class="p-2 rounded-md bg-input text-sm"><i class="fas fa-tag mr-1"></i> Filtrar</button>

                                    <div id="tag-filter-dropdown" class="hidden absolute right-0 mt-1 p-2 rounded-md shadow-lg w-48"></div>

                                </div>

                            </div>

                        </div>

                         <div class="flex items-center space-x-2 project-view-controls mb-4 flex-shrink-0">

                            Vistas:

                             Kanban

                            Lista

                            <button id="add-task-list-view-btn" title="Añadir tarea" class="hidden ml-auto p-2 rounded-md bg-primary text-white"><i class="fas fa-plus"></i></button>

                            <button id="project-calendar-btn" title="Calendario del Proyecto" class="text-sky-400 hover:text-sky-300 p-2 transition-colors ml-auto"><i class="fas fa-calendar-alt text-xl"></i></button>

                        </div>

                         <div id="vista-kanban" clase="flexible-1 oculto">

                            </div>

                        <div id="vista-de-lista" clase="hidden flex-1 flex-col">

                        </div>

                        <div id="vista-de-lista-móvil" clase="desbordamiento-y-automático-flex-1 oculto">

                        </div>

                    </div>

                    <div id="proyecto-chat-contenedor">

                         <div id="encabezado-de-contenedor-de-chat-del-proyecto" clase="flexible justificar-entre-elementos-centrar cursor-puntero p-2">

                            <h3 class="text-lg font-semibold text-primary">Asistente del Proyecto</h3>

                            <button id="proyecto-chat-toggle" class="texto-xl p-2"><i class="fas fa-angle-up"></i></button>

                        </div>

                         <div class="cuerpo del chat del proyecto">

                            <div id="mensajes-de-chat-del-proyecto" class="bot-de-burbuja-de-chat"></div>

                            <div id="área de entrada del proyecto" clase="mt-auto pt-2">

                                 <div class="pro-controls-bg rounded-lg p-1.5mb-2">

                                     <div class="flex items-center space-x-2">

                                        <label for="selector-de-modelo-de-proyecto" class="font-medium text-xs text-text-medium pl-2 pr-1">Modelo:</label>

                                         <div class="envoltorio-selector-de-modelo">

                                            <select id="selector-de-modelo-de-proyecto" clase="rounded-md py-1 pl-1.5 foco:contorno-ninguno foco:anillo-2 foco:anillo-primario texto-pequeño fondo-transparente texto-texto-claro">

                                                 <option value="gpt-4o-mini">Asistente de Proyectos</option>

                                                General (Turbo)

                                                <option value="sonar">Búsqueda Web</option>

                                             </seleccionar>

                                              <i class="fas fa-chevron-down text-xs"></i>

                                        </div>

                                     </div>

                                </div>

                                 <div class="relative rounded-xl flex items-center bg-input p-1 sm:p-2 input-wrapper">

                                     <textarea id="project-msg" placeholder="Deja que Goatify organice tu proyecto..." class="flex-1 bg-transparent p-2 h-10 max-h-28 resize-none outline-none placeholder-themed text-sm"></textarea>

                                    <button id="proyecto-enviar" title="Enviar" class="p-2 sm:p-3 deshabilitado:opacidad-50 deshabilitado:cursor-no-permitido text-primary"><i class="fa fa-paper-plane text-lg"></i></button>

                                </div>

                             </div>

                        </div>

                    </div>

                </div>

            </div>



            <div id="área de entrada" clase="p-2 sm:p-4 borde-t borde-temático flex-shrink-0">

                <div id="área de vista previa del archivo" clase="mb-2 espacio-y-2 px-1 sm:px-0">

                     <div id="image-preview-container" class="pariente oculto">

                        <img id="image-preview" src="#" alt="Vista previa de la imagen">

                        <span id="nombre-de-imagen" clase="texto-xs texto-texto-medio truncar crecimiento-flexible"></span>

                         <button id="clear-image-btn" class="bg-red-500 hover:bg-red-600 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs z-10 p-0 lead-none">×</button>

                    </div>

                    <div id="pdf-preview-container" class="pariente oculto">

                        <i class="fas fa-file-pdf text-red-500 text-xl"></i>

                         <div class="flex-grow min-w-0">

                            <p id="nombre-pdf" clase="fuente-media truncada"></p>

                            <p id="pdf-status" clase="text-xxs font-mono"></p>

                         </div>

                        <button id="clear-pdf-btn" class="bg-red-500 hover:bg-red-600 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs z-10 p-0 lead-none">×</button>

                    </div>

                </div>

                <div class="pro-controls-bg rounded-lg p-1 efecto de luz fría">

                    <div id="pro-controls-left">

                        <label for="model-selector" class="font-medium text-xs text-text-medium pl-2 pr-1" data-translate-key="model">Modelo:</label>

                        <div class="envoltorio-selector-de-modelo">

                            <select id="selector-de-modelo" clase="redondeado-md py-1 pl-1.5 foco:contorno-ninguno foco:anillo-2 foco:anillo-primario texto-pequeño fondo-transparente texto-texto-claro">

                                Chat

                                Búsqueda web

                            </seleccionar>

                            <i class="fas fa-chevron-down text-xs"></i>

                        </div>

                    </div>

                    <div id="pro-controls-right">

                        <div id="contenedor-selector-de-voz" clase="centro-de-elementos-ocultos espacio-x-2">

                            Voz:

                            <div class="envoltorio-selector-de-modelo">

                                <select id="selector de voz" clase="rounded-md py-1 pl-1.5 foco:contorno-ninguno foco:anillo-2 foco:anillo-primario texto-pequeño fondo-transparente texto-texto-claro w-24"></select>

                            </div>

                        </div>

                        <div id="contenedor-de-botones-de-acción" class="centro-de-elementos-flexibles">

                            <button id="image-gen-btn" title="Crear imagen" class="p-2 hover:text-primary transition-colors rounded-full text-text-medium"><i class="fas fa-paint-brush text-lg"></i></button>

                            <button id="pdf-upload-btn" title="Subir PDF" class="p-2 hover:text-primary transition-colors rounded-full text-text-medium"><i class="fa fa-file-pdf text-lg"></i></button>

                            <button id="image-upload-btn" title="Subir imagen" class="p-2 hover:text-primary transition-colors rounded-full text-text-medium"><i class="fa fa-image text-lg"></i></button>

                        </div>

                    </div>

                 </div>

                <div class="relative rounded-xl flex items-center bg-input p-1 sm:p-2 input-wrapper">

                    <tipo de entrada="archivo" id="carga-pdf" aceptar=".pdf,application/pdf" clase="oculto"><tipo de entrada="archivo" id="carga-imagen" aceptar="imagen/*" clase="oculto">

                    <button id="mic-btn" title="Activar micrófono" class="p-2 sm:p-3 hover:text-primary transition-colors rounded-full text-text-medium"><i class="fa fa-microphone text-xl"></i></button>

                     <button id="tts-toggle" title="Activar/Desactivar Voz" class="p-2 sm:p-3 hover:text-primary transition-colors rounded-full text-text-medium"><i class="fa fa-volume-mute text-xl"></i></button>

                    <textarea id="msg" placeholder="Escribe tu mensaje..." class="flex-1 bg-transparent p-2 h-12 max-h-32 resize-none outline-none placeholder-themed" rows="1" data-translate-key="placeholder_main"></textarea>

                    <button id="send" title="Enviar" class="p-2 sm:p-4 disabled:opacity-50 disabled:cursor-not-allowed text-primary"><i id="send-icon" class="fa fa-paper-plane text-xl"></i></button>

                 </div>

                <div id="pie de página contextual" clase="centro de texto texto-xs texto-texto-medio mt-2 px-2 h-4"></div>

            </div>

        </principal>

    </div>



    <div id="notificación en la aplicación">

        <div id="encabezado de notificación en la aplicación">

            <h4 id="título de notificación en la aplicación"></h4>

            <button id="cierre de notificaciones en la aplicación" class="text-text-medium hover:text-text-light text-2xl lead-none">×</button>

        </div>

        <p id="cuerpo de notificación en la aplicación"></p>

    </div>



    <!-- AÑADIDO: Modal para la colaboración -->

    <div id="colaboración-modal" class="recuadro fijo-0 fondo negro fondo-opacidad-70 elementos ocultos-centro justificar-centro z-50 p-4">

        <div class="modal-content rounded-lg w-full max-w-md p-6 relative">

            Compartir y colaborar

            <div id="colaboración-modal-cuerpo" clase="mb-4 texto-texto-medio texto-sm">

                <p class="mb-4">Invita a otros usuarios de Goatify a ver y editar este documento en tiempo real.</p>

                <div class="flex gap-2">

                    <input type="text" id="collaborator-id-input" placeholder="ID o correo electrónico del usuario..." class="w-full p-2 rounded bg-input border border-themed">

                    Invitar

                </div>

                <h4 class="font-semibold mt-6 mb-2">Colaboradores Actuales</h4>

                <div id="lista-de-colaboradores-actuales" class="espacio-y-2">

                    <!-- Lista de colaboradores se renderizará aquí -->

                </div>

            </div>

            <button id="close-collaboration-modal" class="absolute top-4 right-4 text-gray-400 hover:text-text-light"><i class="fas fa-times fa-lg"></i></button>

        </div>

    </div>



    <div id="generic-modal" class="recuadro fijo-0 fondo negro fondo-opacidad-70 elementos ocultos-centro justificar-centro z-50 p-4">

        <div class="modal-content rounded-lg w-full max-w-md p-6 relative">

            <h3 id="título-modal" clase="texto-lg fuente-bold mb-4"></h3>

            <div id="modal-body" class="mb-4 texto-texto-medio texto-sm"></div>

            <div id="modal-buttons-container" class="flex justify-end space-x-2">

                 </div>

        </div>

    </div>



    <div id="motivation-modal" class="recuadro fijo-0 fondo negro fondo-opacidad-70 elementos ocultos-centro justificar-centro z-50 p-4">

        <div class="modal-content rounded-lg w-full max-w-md p-6 relative text-center">

            <i class="fas fa-bombilla texto-4xl texto-amarillo-400mb-4"></i>

            <h3 id="motivation-title" class="text-2xl mb-4">Dosis de Motivación</h3>

            <p id="cita-motivacional" class="texto-lg texto-texto-luz mb-6 min-h-[50px]"></p>

            <div class="flex items-center justify-center mb-6">

                <label for="motivation-toggle" class="flex items-center cursor-pointer">

                    <span class="mr-3 texto-texto-luz fuente-media">

                        Notificaciones periódicas

                    </span>

                    <div class="relativo">

                        <input type="checkbox" id="motivation-toggle" class="sr-only peer">

                        <div class="w-11 h-6 fondo gris-200 redondeado completo peer dark:fondo gris-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:fondo blanco after:border-gris-300 after:borde after:redondeado completo after:h-5 after:w-5 after:transition-all dark:border-gris-600 peer-checked:fondo primario"></div>

                    </div>

                </etiqueta>

            </div>

            ¡Entendido!

        </div>

    </div>

    

    <div id="pricing-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50 p-4">

        <div class="modal-content rounded-2xl w-full max-w-5xl max-h-[90vh] flex flex-col p-6 relative transform scale-95 transition-transform duration-300">

            <div class="flex-shrink-0 flex items-center justify-between mb-6">

                Los aviones se transforman en cabras

                 <button id="close-pricing-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white z-10"><i class="fas fa-times fa-lg"></i></button>

            </div>

            <div class="modal-content-body flex-grow overflow-y-auto px-2">

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-text-light">

                    <div class="plan-card border-2 border-themed rounded-xl p-6 flex flex-col">

                        Gratis

                        $0

                        Para siempre

                         <ul class="text-sm espacio-y-2 mb-4 texto-izquierda">

                            <li><i class="fas fa-check-circle mr-2"></i>15 Créditos/día</li>

                            <li><i class="fas fa-check-circle mr-2"></i>Acceso a Modelos Básicos</li>

                             <li><i class="fas fa-check-circle mr-2"></i>Flujos de trabajo limitados</li>

                        </ul>

                        <button id="free-plan-button" class="mt-auto w-full p-3 rounded-lg font-semibold border-2 border-primary text-primary hover:bg-primary hover:text-white transition-colors" data-translate-key="plan_free_cta">Plan Tu Actual</button>

                     </div>

                    <div class="plan-card border-2 rounded-xl p-6 flex flex-col bg-current-bg-dark plan-card-highlight">

                        <h3 class="text-2xl font-bold">CABRA <span class="text-primary">IMPULSO</span></h3>

                         $7/mes

                        Ver detalles

                        <div class="detalles del plan text-sm text-left">

                             <ul class="space-y-2 mb-4 plan-feature-list">

                                <li><i class="fas fa-check-circle mr-2"></i><strong>100 Créditos/día</strong></li>

                                <li><i class="fas fa-check-circle mr-2"></i>Acceso a <strong>todos los modelos de IA</strong></li>

                                 <li><i class="fas fa-check-circle mr-2"></i>Acceso a todos los flujos de trabajo

                                <li><i class="fas fa-check-circle mr-2"></i>Soporte Prioritario</li>

                            </ul>

                         </div>

                        Obtener Boost

                    </div>

                    <div class="plan-card border-2 border-themed rounded-xl p-6 flex flex-col">

                        CABRA <span class="text-primary">PRO</span></h3>

                        $17/mes

                         Ver detalles

                        <div class="detalles del plan text-sm text-left">

                            <ul class="space-y-2 mb-4 plan-feature-list">

                                 <li><i class="fas fa-check-circle mr-2"></i><strong>Créditos ilimitados</strong></li>

                                <li><i class="fas fa-check-circle mr-2"></i>Todo lo del plan BOOST</li>

                                <li><i class="fas fa-check-circle mr-2 text-gold"></i><strong>¡Te ayudamos a construir tu página web!</strong></li>

                                 <li><i class="fas fa-check-circle mr-2"></i>Consultoría de IA</li>

                                <li><i class="fas fa-check-circle mr-2"></i>Acceso a Guías Premium</li>

                            </ul>

                         </div>

                        Quiero mi Plan Pro + Web

                    </div>

                </div>

             </div>

        </div>

    </div>



    <div id="html-preview-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50 p-4"><div class="modal-content rounded-2xl w-full h-full max-w-4xl p-2 md:p-4 relative flex flex-col"><h3 class="text-lg font-bold" data-translate-key="preview">Vista Previa</h3><button id="close-html-preview-modal" class="text-gray-400 hover:text-white"><i class="fas fa-times fa-lg"></i></button></div><iframe id="html-preview-iframe" class="w-full flex-grow h-full border-2 border-themed rounded-lg bg-white"></iframe></div>

    

    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-40 p-4">

        <div class="modal-content rounded-lg w-full max-w-lg p-6 relative">

             Configuración

            <div clase="espacio-y-4 texto-sm máx-h-[70vh] desbordamiento-y-automático pr-2">

                <div>

                    <p class="font-semibold" data-translate-key="settings_email">Correo Electrónico:</p>

                    <p id="configuración-correo-de-usuario" class="texto-texto-medio"></p>

                 </div>

                <div>

                    <p class="font-semibold" data-translate-key="settings_plan">Plan de suscripción:</p>

                    <p id="configuración-plan-usuario" clase="texto-texto-medio"></p>

                    Plan de Mejora

                 </div>

                <div>

                    Tamaño de la letra:

                    <input type="range" id="font-size-slider" min="14" max="20" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg dark:bg-gray-700">

                    16 píxeles

                </div>

                <div>

                    <p class="font-semibold mb-2" data-translate-key="settings_theme">Personalización:</p>

                    <button id="settings-theme-toggle" class="flex items-center p-2 rounded hover:bg-medium w-full text-left">

                         <i class="fas fa-moon mr-2" id="icono-de-tema-de-configuración"></i>

                        Modo oscuro

                    </botón>

                </div>

                <div>

                     <div class="flex items-center justify-between">

                        <p class="font-semibold" data-translate-key="settings_notifications">Notificaciones de Tareas:</p>

                        <label for="alternar-notificaciones" class="inline-flex relativo elementos-centro cursor-puntero">

                            <input type="checkbox" id="alternar notificaciones" class="sr-only peer">

                            <div class="w-11 h-6 fondo gris-200 redondeado completo peer dark:fondo gris-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:fondo blanco after:border-gris-300 after:borde after:redondeado completo after:h-5 after:w-5 after:transition-all dark:border-gris-600 peer-checked:fondo primario"></div>

                        </etiqueta>

                    </div>

                 </div>

                <div>

                    <p class="font-semibold mb-2" data-translate-key="settings_lang">Idioma:</p>

                    <select id="selector-de-idioma" class="w-full p-2 rounded bg-input border border-themed">

                         Español

                        Inglés

                    </seleccionar>

                </div>

                <div class="border-t borde-temático pt-4 mt-4">

                     Integraciones

                     <div class="espacio-y-2">

                        <button id="connect-google-calendar-btn" class="w-full bg-input p-2 rounded-lg flex items-center justify-start text-left hover:bg-light transition-colors">

                             <i class="fab fa-google mr-3 texto-rojo-500 fa-lg"></i>

                            <div>

                                Calendario de Google

                                 <p class="text-xs text-text-medium">Sincroniza tus tareas y eventos.</p>

                            </div>

                        </botón>

                        </div>

                </div>

                <div>

                    <button id="connect-whatsapp-btn" class="w-full btn-primary p-2 rounded-lg flex items-center justify-center mb-2">

                         <i class="fab fa-whatsapp mr-2"></i><span data-translate-key="settings_whatsapp">Conectarse a WhatsApp</span>

                    </botón>

                    <a href="https://calendly.com/goatify" target="_blank" id="programar-reunión-btn" class="w-full btn-primary p-2 elementos flexibles redondeados-lg-centrados justificar-centrar">

                        <i class="fas fa-calendar-alt mr-2"></i><span data-translate-key="settings_schedule_meeting">Agenda de la reunión</span>

                     </a>

                </div>

            </div>

            <button id="close-settings-modal" class="absolute top-4 right-4 text-gray-400 hover:text-text-light"><i class="fas fa-times fa-lg"></i></button>

        </div>

    </div>



    <div id="superposición-modal-de-calendario" class="recuadro fijo-0 fondo-negro fondo-opacidad-70 elementos ocultos-centro justificar-centro z-40 p-4">

        <div id="calendar-modal" class="modal-content rounded-lg w-full max-w-4xl p-6 relative">

             <h3 class="text-lg font-bold mb-4" data-translate-key="calendar_my_calendar">Mi Calendario y Tareas</h3>

            <div class="cambio de vista de calendario mb-4">

                Vista de día

                Vista semanal

                Vista de mes

             </div>



            <div id="contenedor-vista-diaria">

                 <div class="encabezado-de-calendario">

                    <button id="prev-day" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-left"></i></button>

                    <h4 id="visualización del día actual" clase="texto-xl fuente-semi-negrita"></h4>

                     <button id="next-day" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-right"></i></button>

                </div>

                <div id="línea de tiempo de vista de día"></div>

            </div>



            <div id="contenedor-vista-semana">

                <div class="encabezado-de-calendario">

                     <button id="prev-week" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-left"></i></button>

                    <h4 id="rango-semanal-actual" class="text-xl font-semibold"></h4>

                    <button id="próxima-semana" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-right"></i></button>

                </div>

                 <div id="contenido-de-los-días-de-la-semana"></div>

            </div>



            <div id="contenedor-vista-mes">

                <div class="encabezado-de-calendario">

                    <button id="mes anterior" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-left"></i></button>

                    <h4 id="mes-actual-año" class="texto-xl fuente-semibold"></h4>

                     <button id="próximo-mes" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-right"></i></button>

                </div>

                <div class="cuadrícula-de-calendario mb-4">

                    <div class="font-bold text-primary" data-translate-key="calendar_mon">Lun</div>

                     <div class="font-bold text-primary" data-translate-key="calendar_tue">Marzo</div>

                    Mié

                    <div class="font-bold text-primary" data-translate-key="calendar_thu">Jueves</div>

                    <div class="font-bold text-primary" data-translate-key="calendar_fri">Vida</div>

                    <div class="font-bold text-primary" data-translate-key="calendar_sat">Sábado</div>

                     <div class="font-bold text-primary" data-translate-key="calendar_sun">Dom</div>

                </div>

                <div id="cuadrícula-de-días-del-calendario" class="cuadrícula-de-calendario"></div>

            </div>



            <div class="mt-6 border-t border-themed pt-4">

                <button id="add-task-btn" class="w-full btn-primary p-2 rounded-lg flex items-center justify-center">

                    <i class="fas fa-plus mr-2"></i><span data-translate-key="calendar_add_task_btn">Añadir tarea</span>

                </botón>

            </div>



            <button id="close-calendar-modal" class="absolute top-4 right-4 text-gray-400 hover:text-text-light"><i class="fas fa-times fa-lg"></i></button>

        </div>

    </div>



    <div id="gamification-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50 p-4">

        <div class="modal-content rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col p-6 relative transform scale-95 transition-transform duration-300">

            <div class="flex-shrink-0 flex items-center justify-between mb-4">

                <h2 class="text-3xl font-extrabold text-gold">

                    <i class="fas fa-trofeo mr-2"></i>La Ascensión del CABRA

                </h2>

                <button id="close-gamification-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white z-10"><i class="fas fa-times fa-lg"></i></button>

            </div>

            

            <div class="p-4 bg-input redondeado-lg mb-4 flex-shrink-0">

                <div class="flex items-center justify-between mb-2">

                    Nivel 1: Iniciador Digital

                    <div class="text-right">

                        <span id="gamification-xp" class="font-bold text-primary">0 / 100 XP</span>

                         <p id="créditos-de-gamificación" class="text-sm text-gold font-semibold"><i class="fas fa-coins mr-1"></i>0 Créditos</p>

                    </div>

                </div>

                <div class="w-full xp-bar-bg redondeado-completo h-4">

                    <div id="gamificación-xp-bar" class="xp-bar-fill h-4 rounded-full" style="ancho: 0%;"></div>

                 </div>

            </div>



            <div class="flex-grow overflow-hidden flex flex-col">

                <div class="flex-shrink-0 gamificación-pestañas flex elementos-centro espacio-x-2">

                    <button class="gamification-tab active" data-tab="racha">Diario de Racha</button>

                     <button class="gamification-tab" data-tab="misiones">Misiones</button>

                    <button class="gamification-tab" data-tab="logros">Logros</button>

                    Reglas

                </div>

                <div class="flex-grow overflow-y-auto pt-4">

                     <div id="gamification-tab-racha" class="gamification-tab-content space-y-4">

                        <p class="text-center text-text-medium">Mantén tu racha para ganar XP, créditos y un cofre especial el día 7.</p>

                         <div id="contenedor-de-racha-diaria" clase="cuadrícula cuadrícula-cols-7 espacio-2 md:espacio-4 centro-de-texto">

                            </div>

                    </div>

                     <div id="gamification-tab-misiones" class="gamification-tab-content hidden space-y-3">

                        </div>

                     <div id="gamification-tab-logros" class="gamification-tab-content hidden">

                        <div id="contenedor-de-logros" clase="cuadrícula cuadrícula-cols-2 md:cuadrícula-cols-3 brecha-4">

                           </div>

                    </div>

                </div>

            </div>

        </div>

    </div>



    <div id="gamification-rules-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-[60] p-4">

         <div class="modal-content rounded-lg w-full max-w-2xl p-6 relative">

            <h3 class="text-lg font-bold mb-4 text-gold"><i class="fas fa-scroll mr-2"></i>Reglas de "La Ascensión del GOAT"</h3>

            <div class="espacio-y-4 texto-texto-medio texto-pequeño máx.-h-[70vh] desbordamiento-y-automático pr-2">

                <p>¡Bienvenido a tu viaje para convertirte en un GOAT (Greatest Of All Time) del emprendimiento digital! La lógica es simple: cuanto más usas la plataforma de forma estratégica, más recompensas obtienes.</p>

                <div>

                    <h4 class="font-semibold text-text-light mt-3">1. Puntos de Experiencia (XP) vs. Créditos de Recompensa (🪙)</h4>

                    <p>Existen dos tipos de recompensas:</p>

                    <ul class="lista-disco lista-dentro ml-4 mt-1 espacio-y-1">

                        <li><strong>Puntos de Experiencia (XP):</strong> Miden tu progreso y maestría. El XP <strong class="text-primary">nunca se gasta</strong>, solo se acumula para que subas de nivel y desbloquees nuevos títulos.</li>

                        <li><strong>Créditos de Recompensa (🪙):</strong> Son una <strong class="text-gold">reserva de créditos utilizables</strong> que ganas al completar misiones y rachas. Cuando se agotan los créditos diarios de tu plan, el sistema usará automáticamente estos créditos de recompensa para que puedas seguir trabajando.</li>

                    </ul>

                </div>

                 <div>

                    <h4 class="font-semibold text-text-light mt-3">2. Cómo subir de nivel</h4>

                    <p>Acumula suficiente XP para ascender de nivel. Cada nivel representa una nueva etapa en tu dominio del marketing y los negocios con IA.</p>

                    <ul class="lista-disco lista-dentro ml-4 mt-1 espacio-y-1">

                        <li>Nivel 1: <strong>Iniciador Digital</strong></li>

                        <li>Nivel 2: <strong>Creador de Contenido</strong></li>

                         <li>Nivel 3: <strong>Estratega de Marketing</strong></li>

                        Nivel 4: CEO Digital

                        <li>Nivel 5: <strong>CABRA</strong></li>

                    </ul>

                </div>

                  <div>

                    <h4 class="font-semibold text-text-light mt-3">3. Cómo Ganar Recompensas</h4>

                     <ul class="lista-disco lista-dentro ml-4 mt-1 espacio-y-1">

                        <li><strong>Racha Diaria:</strong> Cada día consecutivo que entras te da XP y Créditos de Recompensa.</li>

                        <li><strong>Cofre GOAT (Día 7):</strong> ¡Tu gran recompensa semanal por 7 días de racha! Puede contener una gran cantidad de créditos, <strong>cupones de descuento</strong> para nuestros servicios de implementación (páginas web, automatizaciones) o incluso una <strong>asesoría estratégica GRATIS</strong>.</li>

                        <li><strong>Misiones y Logros:</strong> La forma más rápida de ganar grandes bonificaciones de XP y Créditos. Completa tareas específicas para acelerar tu ascenso.</li>

                    </ul>

                </div>

                 <p class="font-bold text-center mt-4 text-lg text-primary">¡Cada acción cuenta en tu camino a la cima! ¡A por ello!</p>

            </div>

            <button id="close-gamification-rules-modal" class="absolute top-4 right-4 text-gray-400 hover:text-text-light"><i class="fas fa-times fa-lg"></i></button>

        </div>

    </div>





    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script type="módulo">

        //<-- INICIO DEL GUIÓN -->

        ventana.addEventListener('DOMContentLoaded', () => {

            dayjs.extend(ventana.dayjs_plugin_localizedFormat);

            dayjs.extend(ventana.dayjs_plugin_isoWeek);

             

            traducciones constantes = {

                es: {

                    inicializando: "Inicializando...", new_chat: "Nuevo Chat", new_folder: "Nueva Carpeta",

                    web_offer: "🚀 ¡Lanza tu Negocio, te regalamos una pg web Gratis con tu suscripción!",

                     Upgrade_plan: "Mejorar Plan", free_guides: "Guías de IA Gratis", flujos de trabajo: "Workflows",

                    wf_pm: "Dirección de Proyectos", wf_pm_1: "Crear Tablero de Proyecto",

                    wf_social: "Potenciador de Redes Sociales", wf_social_1: "Crear un Post Completo", wf_social_2: "Redacción de Copys",

                     wf_social_3: "Lluvia de Ideas para Posts", wf_social_4: "Definir Estrategia de Marca",

                    wf_business: "Análisis de Negocio", wf_business_1: "Análisis de tu Competencia", wf_business_2: "Definir mi Cliente Ideal",

                    wf_business_3: "Lluvia de Nombres para Marca", wf_sales: "Comunicación y Ventas", wf_sales_1: "Asistente de Ventas 24/7",

                     wf_sales_2: "Redacción de Email", wf_sales_3: "Diseño Web", wf_sales_4: "Mejorar Habilidades Sociales",

                    wf_eng_1: "Traducir/Corregir Texto",

                    wf_eng_2: "Aprender Vocabulario Nuevo", wf_eng_3: "Practicar Conversación", select_chats: "Seleccionar Múltiples Chats",

                    eliminar: "Borrar", iniciar sesión: "Iniciar Sesión", ajustes: "Configuración", cerrar sesión: "Cerrar Sesión",

                     soluciones: "Soluciones", ally_title: "Somos tu Aliado Estratégico",

                    ally_desc: "Goatify no es solo un chat. Somos una IA personalizada con un equipo de expertos listos para ayudarte a escalar tu negocio.",

                    bienvenido_user: "¡Hola, ", bienvenido_user_2: "! Hoy es un gran día para crear algo increíble.",

                    bienvenido_guest: "¿Cómo puedo ayudarte hoy?", model: "Modelo:", model_general: "GOAT X",

                    model_web: "Búsqueda Web", voice: "Voz:", placeholder_main: "Escribe tu mensaje...", cancel: "Cancelar",

                    confirm: "Confirmar", planes_title: "Planes Goatify", plan_free_sub: "Para Siempre", plan_free_cta: "Empezar Gratis",

                     plan_boost_cta: "Obtener Boost", plan_pro_cta: "Quiero mi Plan Pro + Web",

                    vista previa: "Vista Previa", settings_email: "Correo Electrónico:", settings_plan: "Plan de Suscripción:",

                    settings_fontsize: "Tamaño de Letra:", settings_theme: "Personalización:", settings_dark_mode: "Modo Oscuro",

                     settings_lang: "Idioma:", settings_whatsapp: "Conectarse a WhatsApp", current_plan: "Tu plan actual",

                    settings_notifications: "Notificaciones de Tareas:", settings_schedule_meeting: "Agenda Reunión",

                    settings_integrations: "Integraciones",

                    calendar_today: "Hoy", calendar_this_week: "Esta Semana", calendar_mon: "Lun", calendar_tue: "Mar", calendar_wed: "Mié",

                     calendar_thu: "Jue", calendar_fri: "Vie", calendar_sat: "Sáb", calendar_sun: "Dom",

                    calendar_no_tasks: "No hay tareas para este día.", calendar_add_task_placeholder: "Añadir nueva tarea personal...",

                    calendar_add_task_btn: "Añadir Tarea", calendar_my_calendar: "Mi Calendario y Tareas",

                    calendar_day_view: "Vista de Día", calendar_month_view: "Vista de Mes", calendar_week_view: "Vista de Semana",

                    Notification_task_due: "Es hora de: ", Notification_title: "Goatify IA - ¡Hora de tu Tarea!",

                    task_for: "Tareas para", add_task_for: "Añadir Tarea para",

                    delete_task_confirm_title: "Confirmar Eliminación", delete_task_confirm_body: "¿Estás seguro de que quieres eliminar esta tarea?",

                    delete_btn: "Eliminar",

                },

                en: {

                     inicializando: "Inicializando...", new_chat: "Nuevo chat", new_folder: "Nueva carpeta",

                    web_offer: "🚀 ¡Lanza tu negocio y consigue un sitio web gratis con tu suscripción!"

                    upgrade_plan: "Plan de actualización", free_guides: "Guías de IA gratuitas", workflows: "Flujos de trabajo",

                     wf_pm: "Gestión de proyectos", wf_pm_1: "Crear tablero de proyecto",

                    wf_social: "Potenciador de redes sociales", wf_social_1: "Crear una publicación completa", wf_social_2: "Redacción de textos publicitarios",

                    wf_social_3: "Generar ideas para publicaciones", wf_social_4: "Definir la estrategia de marca",

                    wf_business: "Análisis de negocio", wf_business_1: "Analiza a tu competencia", wf_business_2: "Define a mi cliente ideal",

                     wf_business_3: "Ideas para nombres de marca", wf_sales: "Comunicación y ventas", wf_sales_1: "Asistente de ventas 24/7",

                    wf_sales_2: "Redacción de correos electrónicos", wf_sales_3: "Diseño web", wf_sales_4: "Mejorar las habilidades sociales",

                    wf_eng_1: "Traducir/Corregir texto",

                    wf_eng_2: "Aprender nuevo vocabulario", wf_eng_3: "Practicar la conversación", select_chats: "Seleccionar varios chats",

                    eliminar: "Eliminar", iniciar sesión: "Iniciar sesión", configuración: "Configuración", cerrar sesión: "Cerrar sesión",

                    soluciones: "Soluciones", ally_title: "Somos tu Aliado Estratégico",

                    ally_desc: "Goatify no es solo un chat. Somos una IA personalizada con un equipo de expertos listos para ayudarte a escalar tu negocio."

                    welcome_user: "Hola, ", welcome_user_2: "¡Hoy es un gran día para crear algo increíble!",

                    welcome_guest: "¿Cómo puedo ayudarte hoy?", model: "Modelo:", model_general: "GOAT X",

                    model_web: "Búsqueda web", voice: "Voz:", placeholder_main: "Escribe tu mensaje...", cancel: "Cancelar",

                    confirm: "Confirmar", plans_title: "Planes de Goatify", plan_free_sub: "Para siempre", plan_free_cta: "Empieza gratis",

                    plan_boost_cta: "Obtén Boost", plan_pro_cta: "Obtén el Plan Pro + Web",

                    preview: "Vista previa", settings_email: "Dirección de correo electrónico:", settings_plan: "Plan de suscripción:",

                    settings_fontsize: "Tamaño de fuente:", settings_theme: "Personalización:", settings_dark_mode: "Modo oscuro",

                     settings_lang: "Idioma:", settings_whatsapp: "Conectarse a WhatsApp", current_plan: "Plan actual",

                    settings_notifications: "Notificaciones de tareas:", settings_schedule_meeting: "Programar reunión",

                    settings_integrations: "Integraciones",

                    calendar_today: "Hoy", calendar_this_week: "Esta semana", calendar_mon: "Lun", calendar_tue: "Mar", calendar_wed: "Mié",

                     calendar_thu: "jueves", calendar_fri: "viernes", calendar_sat: "sábado", calendar_sun: "domingo",

                    calendar_no_tasks: "No hay tareas para este día.", calendar_add_task_placeholder: "Añadir nueva tarea personal...",

                    calendar_add_task_btn: "Agregar tarea", calendar_my_calendar: "Mi calendario y tareas",

                    calendar_day_view: "Vista de día", calendar_month_view: "Vista de mes", calendar_week_view: "Vista de semana",

                     notification_task_due: "Hora de: ", notification_title: "Goatify IA - ¡Tarea vencida!",

                    task_for: "Tareas para", add_task_for: "Añadir tarea para",

                    delete_task_confirm_title: "Confirmar eliminación", delete_task_confirm_body: "¿Está seguro de que desea eliminar esta tarea?"

                    delete_btn: "Eliminar",

                }

            };

            constante LÍMITE_DE_CRÉDITO_DE_INVITADO = 15;

            constante LÍMITE DE CRÉDITO DEL PLAN GRATUITO = 15;

            constante LÍMITE DE CRÉDITO DEL PLAN DE AUMENTO = 100;

            const MENSAJES_MOTIVACIONALES = [

                "Eres una persona increíble, ¡nunca lo dudes!",

                "Hoy es tu día para brillar. ¡Ve por ello!",

                "Tu potencial es infinito. ¡Puedes lograr lo que te propongas!",

                "La rompe todos los días, ¡sigue así!",

                "Confía en tu proceso. Estás construyendo algo grandioso.",

                "Cada paso que das te acerca a tu meta. ¡No te detengas!",

                "Tu energía es contagiosa. ¡Ilumina el mundo!",

                "Puedes con todo y más. ¡Cree en ti!"

            ];

            const MOTIVATION_BUTTON_TEXTS = ["¡Listo!", "¡Vamos a darle!", "¡Perfecto!", "¡Sí, yo puedo!", "¡Vamos!"];



            const COSTOS = { GENERAL: 1, BÚSQUEDA: 1, NEBULOSA: 2, REDACCIÓN: 2, IMAGEN: 5 };

            dejar estado = { chats: {}, proyectos: {}, estructura: [], calendario: {}, notas: [] };

            deje que gamificationState = {};

            deje que currentChatId = nulo, currentUser = nulo, speechOn = falso, availableVoices = [], selectedVoice = nulo, isRecognizing = falso, selectedImageBase64 = nulo, selectedPdfText = nulo;

            deje que micWasOnBeforeSpeaking = falso;

            deje que modalResolve = null;

            deje que isSelectModeActive = falso;

            deje que chatsToDelete = nuevo Set();

            deje que currentNoteId = nulo;

            

            dejar notificacionesHabilitadas = localStorage.getItem('goatify-notificaciones-habilitadas') === null ? true : localStorage.getItem('goatify-notificaciones-habilitadas') === 'true';

            deje que la motivación esté habilitada = localStorage.getItem('goatify-motivation-enabled') === null ? true : localStorage.getItem('goatify-motivation-enabled') === 'true';



            deje que selectedCalendarDate = dayjs();

            deje que currentCalendarView = 'mes';

            deje que activeTagFilter = null;

            deje que el intervalo de motivación = nulo;

            constante dom = {};

            

            constante fullDom = {

                appContainer: document.getElementById('app-container'),

                msgInput: documento.getElementById('msg'), envíoBtn: documento.getElementById('enviar'),

                áreaDeEntrada: document.getElementById('áreaDeEntrada'),

                filePreviewArea: document.getElementById('área-de-vista-previa-del-archivo'),

                messageCounterEl: document.getElementById('contador-de-mensajes'), 

                upgradePlanContainer: document.getElementById('upgrade-plan-container'),

                upgradePlanBtn: document.getElementById('upgrade-plan-btn'),

                newChatBtn: documento.getElementById('new-chat-btn'), newFolderBtn: documento.getElementById('new-folder-btn'),

                pricingModal: document.getElementById('pricing-modal'), closePricingModalBtn: document.getElementById('close-pricing-modal'),

                genericModal: document.getElementById('generic-modal'), 

                viewContainer: document.getElementById('view-container'),

                chatMessages: document.getElementById('mensajes-de-chat'),

                notepadViewContainer: document.getElementById('notepad-view-container'),

                chatTitle: document.getElementById('título-del-chat'), mobileChatTitle: document.getElementById('título-del-chat-móvil'),

                desktopChatTitleWrapper: documento.getElementById('desktop-chat-title-wrapper'), mobileChatTitleWrapper: documento.getElementById('mobile-chat-title-wrapper'),

                initialMessageContainer: document.getElementById('contenedor-de-mensaje-inicial'), themeToggle: document.getElementById('alternar-tema'), themeIcon: document.getElementById('icono-de-tema'),

                micBtn: documento.getElementById('mic-btn'), ttsToggle: documento.getElementById('tts-toggle'), 

                modelSelector: document.getElementById('selector-de-modelo'),

                actionButtonsContainer: document.getElementById('action-buttons-container'),

                imageUploadBtn: document.getElementById('image-upload-btn'), imageUploadInput: document.getElementById('image-upload'),

                imagePreviewContainer: document.getElementById('image-preview-container'), imagePreview: document.getElementById('image-preview'),

                clearImageBtn: documento.getElementById('clear-image-btn'), pdfUploadBtn: documento.getElementById('pdf-upload-btn'), pdfUploadInput: documento.getElementById('pdf-upload'),

                pdfPreviewContainer: document.getElementById('pdf-preview-container'), pdfNameEl: document.getElementById('pdf-name'), pdfStatusEl: document.getElementById('pdf-status'), clearPdfBtn: document.getElementById('clear-pdf-btn'),

                barra lateral: document.getElementById('barra lateral'), menuToggle: document.getElementById('alternar-menú'), sidebarOverlay: document.getElementById('superposición-de-barra-lateral'),

                sidebarContent: document.getElementById('contenido-de-la-barra-lateral'), loginView: document.getElementById('vista-de-inicio-de-sesión'), userMenuView: document.getElementById('vista-del-menú-del-usuario'),

                loginBtn: documento.getElementById('login-btn'), userMenuBtn: documento.getElementById('user-menu-btn'), userMenuPopup: documento.getElementById('user-menu-popup'), userEmail: documento.getElementById('user-email'),

                logoutBtn: documento.getElementById('logout-btn'), webLaunchOfferBtn: documento.getElementById('web-launch-offer-btn'),

                workflowsContainer: document.getElementById('workflows-container'), freeGuidesLink: document.getElementById('free-guides-link'),

                personalizadoBienvenido: document.getElementById('bienvenida-personalizada'), genéricoBienvenido: document.getElementById('bienvenida-genérica'), nombre-usuario: document.getElementById('nombre-usuario'),

                loadingOverlay: document.getElementById('loading-overlay'), htmlPreviewModal: document.getElementById('html-preview-modal'),

                closeHtmlPreviewModalBtn: documento.getElementById('cerrar-html-preview-modal'), htmlPreviewIframe: documento.getElementById('html-preview-iframe'),

                voiceSelector: document.getElementById('selector de voz'), 

                voiceSelectorContainer: document.getElementById('contenedor-selector-de-voz'),

                selectChatsBtn: document.getElementById('select-chats-btn'), deleteModeControls: document.getElementById('controles-del-modo-de-eliminación'),

                deleteSelectedBtn: document.getElementById('eliminar-seleccionado-btn'), cancelSelectModeBtn: document.getElementById('cancelar-modo-de-selección-btn'),

                imageGenBtn: document.getElementById('image-gen-btn'), servicesMenuBtn: document.getElementById('services-menu-btn'), servicesMenu: document.getElementById('services-menu'),

                contextualFooter: document.getElementById('contextual-footer'),

                newChatIconBtn: document.getElementById('new-chat-icon-btn'),

                settingsBtn: documento.getElementById('settings-btn'),

                settingsModal: document.getElementById('settings-modal'), closeSettingsModal: document.getElementById('close-settings-modal'),

                settingsUserEmail: documento.getElementById('settings-user-email'), settingsUserPlan: documento.getElementById('settings-user-plan'),

                settingsUpgradePlanBtn: documento.getElementById('settings-upgrade-plan-btn'), fontSizeSlider: documento.getElementById('font-size-slider'),

                fontSizeValue: document.getElementById('font-size-value'), settingsThemeToggle: document.getElementById('settings-theme-toggle'),

                settingsThemeIcon: document.getElementById('settings-theme-icon'), languageSelector: document.getElementById('language-selector'),

                connectWhatsappBtn: document.getElementById('connect-whatsapp-btn'), scheduleMeetingBtn: document.getElementById('programar-reunion-btn'), freePlanButton: document.getElementById('boton-plan-gratis'),

                notificacionesToggle: document.getElementById('notificaciones-toggle'),

                mainChatArea: document.getElementById('área-de-chat-principal'),

                calendarModalOverlay: document.getElementById('calendario-modal-overlay'),

                calendarioModal: document.getElementById('calendario-modal'),

                calendarBtn: documento.getElementById('calendar-btn'),

                closeCalendarModal: document.getElementById('close-calendar-modal'),

                prevMonthBtn: document.getElementById('mes anterior'), nextMonthBtn: document.getElementById('mes siguiente'),

                currentMonthYear: document.getElementById('mes-actual-año'), calendarDaysGrid: document.getElementById('dias-calendario-cuadrícula'),

                addTaskBtn: document.getElementById('add-task-btn'),

                notificaciónBadge: document.getElementById('notificación-insignia'),

                inAppNotification: document.getElementById('notificación en la aplicación'), 

                inAppNotificationTitle: document.getElementById('título-de-notificación-en-la-aplicación'),

                inAppNotificationBody: document.getElementById('cuerpo-de-notificación-en-la-aplicación'),

                inAppNotificationClose: document.getElementById('cierre de notificación en la aplicación'),

                monthViewContainer: document.getElementById('month-view-container'), weekViewContainer: document.getElementById('week-view-container'),

                dayViewContainer: document.getElementById('day-view-container'),

                monthViewBtn: documento.getElementById('month-view-btn'), weekViewBtn: documento.getElementById('week-view-btn'), dayViewBtn: documento.getElementById('day-view-btn'),

                prevWeekBtn: document.getElementById('semana anterior'), nextWeekBtn: document.getElementById('semana siguiente'),

                currentWeekRange: document.getElementById('rango-de-semana-actual'), weekDaysContent: document.getElementById('contenido-de-días-de-semana'),

                prevDayBtn: document.getElementById('día anterior'), nextDayBtn: document.getElementById('día siguiente'),

                currentDayDisplay: document.getElementById('visualización-del-día-actual'), dayViewTimeline: document.getElementById('línea-de-tiempo-de-vista-del-día'),

                projectManagementView: document.getElementById('proyecto-gestión-vista'),

                projectBoardContainer: document.getElementById('proyecto-tablero-contenedor'),

                proyectoChatContainer: document.getElementById('proyecto-chat-container'),

                proyectoChatToggle: document.getElementById('proyecto-chat-toggle'),

                projectChatHeader: document.getElementById('proyecto-chat-contenedor-header'),

                projectViewTitle: document.getElementById('proyecto-vista-título'),

                kanbanView: document.getElementById('kanban-view'),

                listView: document.getElementById('lista-vista'),

                listViewMobile: document.getElementById('list-view-mobile'),

                viewToggleKanban: documento.getElementById('view-toggle-kanban'),

                viewToggleList: document.getElementById('view-toggle-list'),

                addTaskListViewBtn: document.getElementById('add-task-list-view-btn'),

                projectChatMessages: document.getElementById('proyecto-chat-messages'),

                projectMsgInput: document.getElementById('proyecto-msg'),

                projectSendBtn: document.getElementById('proyecto-enviar'),

                projectCalendarBtn: document.getElementById('proyecto-calendario-btn'),

                tagFilterBtn: document.getElementById('tag-filter-btn'),

                tagFilterDropdown: document.getElementById('tag-filter-dropdown'),

                financialAssistantView: document.getElementById('financial-assistant-view'),

                gamificationBtn: document.getElementById('gamification-btn'),

                gamificaciónModal: document.getElementById('gamificación-modal'),

                closeGamificationModal: document.getElementById('close-gamification-modal'),

                gamificationLevelName: document.getElementById('gamification-level-name'),

                gamificaciónXp: document.getElementById('gamificación-xp'),

                Créditos de gamificación: document.getElementById('créditos-de-gamificación'),

                gamificationXpBar: document.getElementById('gamification-xp-bar'),

                dailyStreakContainer: document.getElementById('contenedor-de-racha-diaria'),

                misionesContainer: document.getElementById('gamification-tab-misiones'),

                logrosContenedor: document.getElementById('logros-contenedor'),

                gamificationRulesBtn: document.getElementById('gamification-rules-btn'),

                gamificationRulesModal: document.getElementById('gamification-rules-modal'),

                closeGamificationRulesModal: document.getElementById('close-gamification-rules-modal'),

                motivaciónBtnHeader: document.getElementById('motivacion-btn-header'),

                motivaciónBtnMobile: document.getElementById('motivacion-btn-mobile'),

                motivaciónModal: document.getElementById('motivación-modal'),

                motivaciónTítulo: document.getElementById('motivación-título'),

                motivaciónCita: document.getElementById('motivacion-cita'),

                motivaciónToggle: document.getElementById('motivación-toggle'),

                closeMotivationModal: document.getElementById('close-motivation-modal'),

                // AÑADIDO: DOM para el nuevo bloque de notas y colaboración

                notesListPanel: document.getElementById('notas-lista-panel'),

                notasList: document.getElementById('notas-list'),

                addNewNoteBtn: document.getElementById('add-new-note-btn'),

                noteEditorPanel: document.getElementById('note-editor-panel'),

                noteTitleInput: document.getElementById('note-title-input'),

                deleteNoteBtn: document.getElementById('eliminar-nota-btn'),

                shareNoteBtn: document.getElementById('compartir-nota-btn'),

                addChecklistItemBtn: documento.getElementById('add-checklist-item-btn'),

                drawingToolBtn: document.getElementById('drawing-tool-btn'),

                herramientasDeDibujo: document.getElementById('herramientasDeDibujo'),

                Selector de color: document.getElementById('selector-de-color'),

                brushSize: document.getElementById('tamaño del pincel'),

                borradorBtn: documento.getElementById('borrador-btn'),

                noteContentArea: document.getElementById('nota-contenido-area'),

                noteContentEditor: document.getElementById('nota-contenido-editor'),

                noteCanvas: document.getElementById('note-canvas'),

                colaboraciónModal: document.getElementById('colaboración-modal'),

                closeCollaborationModal: document.getElementById('close-collaboration-modal'),

                inviteCollaboratorBtn: document.getElementById('invitar-colaborador-btn'),

                shareProjectBtn: document.getElementById('share-project-btn'),

            };

            Objeto.assign(dom, fullDom);



            // --- FIN DEL ASIGNAMIENTO DEL DOM ---



            const XP_FOR_LEVEL = [0, 250, 750, 2000, 5000, Infinito]; 

            const LEVEL_NAMES = ["Iniciador Digital", "Creador de Contenido", "Estratega de Marketing", "CEO Digital", "GOAT"];

            const MISIONES = {

                'brand-strategy': { id: 'brand-strategy', text: 'Define tu primera estrategia de marca', xp: 50, credits: 15, workflow: 'brand-strategy' },

                'análisis-competidor': { id: 'análisis-competidor', texto: 'Espía a la competencia por primera vez', xp: 50, créditos: 15, flujo de trabajo: 'análisis-competidor' },

                'week-organized': { id: 'week-organized', text: 'Crea una tarea para cada día de la semana', xp: 75, credits: 25, condition: checkWeekOrganized },

                'proyecto-creado': { id: 'proyecto-creado', texto: 'Crea tu primer proyecto y añade 3 tareas', xp: 100, créditos: 30, condición: (chatId) => checkProjectCreated(chatId, 3) },

                'image-generated': { id: 'image-generated', text: 'Genera tu primera imagen con IA', xp: 40, credits: 10, action: 'generateImage' },

                'english-practice': { id: 'english-practice', text: 'Practica tu conversación en inglés', xp: 30, créditos: 10, flujo de trabajo: 'english-teacher-practice' },

                'social-skills': { id: 'social-skills', text: 'Mejora tus habilidades sociales con un consejo de IA', xp: 30, créditos: 10, flujo de trabajo: 'social-skills' },

                'conflict-resolution': { id: 'conflict-resolution', text: 'Analiza tu primer conflicto con IA', xp: 40, credits: 15, workflow: 'conflict-resolution' },

                'decision-lab': { id: 'decision-lab', texto: 'Usa el Laboratorio de Decisiones', xp: 50, créditos: 20, flujo de trabajo: 'decision-lab' },

            };

            const LOGROS = {

                'streak-30': { id: 'streak-30', title: 'Consistencia', descripción: 'Mantén la racha diaria por 30 días.', icon: 'fa-calendar-check', xp: 500, créditos: 250 },

                'project-master': { id: 'project-master', title: 'Project Master', descripción: 'Completa 10 proyectos.', icon: 'fa-sitemap', xp: 1000, créditos: 0, recompensa: '50% de descuento en consultoría de automatización.' },

                'influencer': { id: 'influencer', título: 'Influencer', descripción: 'Genera 50 publicaciones para redes sociales.', ícono: 'fa-bullhorn', xp: 750, créditos: 0, recompensa: 'Un mes de GOAT Boost gratis.' },

            };



            función setLanguage(lang) {

                const translationData = traducciones[lang];

                si (!translationData) retorna;

                dayjs.locale(lang);

                document.querySelectorAll('[clave-de-traducción-de-datos]').forEach(el => {

                    clave constante = el.dataset.translateKey;

                    si (traducciónData[clave]) {

                        si (el.nombreDeEtiqueta === 'TEXTAREA' || el.nombreDeEtiqueta === 'ENTRADA') {

                             if(el.placeholder) el.placeholder = translationData[clave];

                        } demás {

                             const icono = el.querySelector('i');

                            si (icono && el.childNodes.length > 1 && !el.classList.contains('icono-de-campana-de-notificación')) {

                                const textNode = document.createTextNode(' ' + translationData[clave]);

                                el.innerHTML = '';

                                el.appendChild(icono);

                                el.appendChild(textNode);

                             } demás {

                                el.textContent = translationData[clave];

                            }

                        }

                     }

                });

                document.documentElement.lang = idioma;

                localStorage.setItem('goatify-lang', idioma);

                renderCalendarView();

            }

            

            función updateContextualFooter(workflowKey) {

                si (!dom.contextualFooter) retorna;

                constante workflowTexts = {

                    'create-full-post': 'Modo Redes Sociales: Define tu red social y tema para una publicación completa.',

                    'persuasive-copy': 'Modo Copywriter: Dime qué vendes y para dónde es el texto.',

                    'brand-strategy': 'Modo Estratega: Dime el nombre y rubro de tu negocio para empezar.',

                     'competitor-analysis': 'Modo Analista: Pega la URL de tu competencia para investigarla.',

                    'sales-assistant': 'Modo Asistente de Ventas: Pega el mensaje de tu cliente para responder.',

                    'english-teacher-practice': 'Modo práctica: Hablemos. ¿Qué tal tu día?'

                    'design-web': 'Modo Diseñador Web: Describe el componente visual y lo crearé en HTML.',

                    'project-management': 'Modo Director de Proyectos: Describe tu proyecto para crear tareas en el tablero.',

                    'conflict-solution': 'Modo Mediador: Describe la situación de conflicto para encontrar una solución.',

                    'decision-lab': 'Modo Estratega: Describe la decisión que enfrentas y tus opciones.',

                    'financial-assistant': 'Modo Financiero: Usa la tabla para registrar transacciones. Pídeme análisis en el chat.',

                    'notepad-app': 'Bloc de Notas: Organiza tus ideas, crea listas y dibuja. Todo se guarda automáticamente.'

                };

                const currentChat = estado.chats[currentChatId];

                clave constante = workflowKey || (currentChat ? currentChat.workflow : null);

                dom.contextualFooter.textContent = flujo de trabajoTextos[clave] || 'Tu copiloto de IA para hacer crecer tu negocio.';

            }



            const SR = ventana.SpeechRecognition || ventana.webkitSpeechRecognition;

            dejar reconocimiento;



            function showModal({ título, cuerpo, confirmText = 'Confirmar', cancelText = 'Cancelar', showCancel = true, showConfirm = true, extraButtons = [], DangerConfirm = false }) {

                const modalElement = dom.collaborationModal.classList.contains('flex') ? dom.collaborationModal : dom.genericModal;

                const modalTitle = modalElement.querySelector(modalElement === dom.collaborationModal ? '#colaboracion-modal-title' : '#modal-title');

                const modalBody = modalElement.querySelector(modalElement === dom.collaborationModal ? '#collaboration-modal-body' : '#modal-body');

                const modalButtonsContainer = modalElement.querySelector('#modal-buttons-container');

                

                si (modalTitle) modalTitle.innerHTML = título; 

                si (modalBody) modalBody.innerHTML = cuerpo;

                

                si(modalButtonsContainer) {

                    deje que los botonesHTML = '';

                    extraButtons.forEach(btn => {

                        botonesHTML += `<button id="${btn.id}" clase="${btn.classes || 'px-4 py-2 redondeado bg-gris-500 texto-blanco'}">${btn.texto}</button>`;

                    });

                    si (mostrarCancelar) {

                        botonesHTML += `<button id="modal-cancel" class="px-4 py-2 bg-gray-600 text-white rounded">${cancelText}</button>`;

                    }

                    si (mostrarConfirmar) {

                        const confirmClasses = dangerConfirm ? 'btn-danger' : 'btn-primary';

                        botonesHTML += `<button id="modal-confirm" class="px-4 py-2 rounded text-white ${confirmClasses}">${confirmText}</button>`;

                    }

                    modalButtonsContainer.innerHTML = botonesHTML;



                    si (mostrarConfirmar) {

                        modalElement.querySelector('#modal-confirm').addEventListener('clic', () => {

                            const entradas = modalBody.querySelectorAll('entrada, área de texto, seleccionar');

                            datos constantes = {};

                            entradas.paraCada(entrada => {

                                datos[entrada.id] = entrada.tipo === 'casilla de verificación' ? entrada.marcado : entrada.valor;

                            });

                            hideModal({ confirmado: verdadero, datos });

                        }, { una vez: verdadero });

                    }



                    si (mostrarCancelar) {

                        modalElement.querySelector('#modal-cancel').addEventListener('click', () => hideModal({ confirmado: falso }), { una vez: verdadero });

                    }

                    extraButtons.forEach(btn => {

                        modalElement.querySelector(`#${btn.id}`).addEventListener('clic', (e) => {

                             btn.action(e, modalBody);

                        });

                    });

                }

                

                modalElement.classList.remove('oculto');

                modalElement.classList.add('flex');

                

                devuelve nueva Promesa(resolver => { modalResolve = resolver; });

            }

            función hideModal(resolveWith = null) { if(modalResolve) { modalResolve(resolveWith); modalResolve = null; } dom.genericModal.classList.add('oculto'); dom.genericModal.classList.remove('flexible'); dom.collaborationModal.classList.add('oculto'); dom.collaborationModal.classList.remove('flexible'); }

            

            función showPricingModal() { 

                dom.pricingModal.classList.remove('oculto');

                dom.pricingModal.classList.add('flex'); 

                setTimeout(() => { dom.pricingModal.querySelector('.modal-content').classList.remove('scale-95'); }, 10);

                

                const idioma = localStorage.getItem('goatify-lang') || 'es';

                const isFree = !currentUser || (currentUser.app_metadata?.plan || 'gratis') === 'gratis';

                

                si (es Libre) {

                    dom.freePlanButton.textContent = traducciones[lang].current_plan;

                    dom.freePlanButton.disabled = verdadero;

                    dom.freePlanButton.classList.add('btn-deshabilitado');

                } demás {

                    dom.freePlanButton.textContent = traducciones[lang].plan_free_cta;

                    dom.freePlanButton.disabled = falso;

                    dom.freePlanButton.classList.remove('btn-deshabilitado');

                }

            }

            función hidePricingModal() { dom.pricingModal.querySelector('.modal-content').classList.add('scale-95');

            setTimeout(() => { dom.pricingModal.classList.add('oculto'); dom.pricingModal.classList.remove('flexible'); }, 300); }



            función showSettingsModal() {

                dom.settingsModal.classList.remove('oculto');

                dom.settingsModal.classList.add('flex');

                si (usuarioactual) {

                    dom.settingsUserEmail.textContent = usuarioactual.correo electrónico;

                    const userPlan = currentUser.app_metadata?.plan || 'gratis';

                    dom.settingsUserPlan.textContent = userPlan.charAt(0).toUpperCase() + userPlan.slice(1);

                    dom.settingsUpgradePlanBtn.classList.toggle('oculto', userPlan !== 'gratis');

                } demás {

                    dom.settingsUserEmail.textContent = 'No ha iniciado sesión';

                    dom.settingsUserPlan.textContent = 'Gratis (Invitado)';

                    dom.settingsUpgradePlanBtn.classList.remove('oculto');

                }

                dom.fontSizeSlider.value = parseInt(getComputedStyle(document.body).getPropertyValue('--base-font-size')) || 16;

                dom.fontSizeValue.textContent = `${dom.fontSizeSlider.value}px`;

                dom.settingsThemeIcon.className = `fas fa-${document.body.classList.contains('tema oscuro') ? 'luna' : 'sol'} mr-2`;

                dom.languageSelector.value = localStorage.getItem('goatify-lang') || 'es';

                dom.notificationsToggle.checked = notificacionesHabilitadas;

            }



            función hideSettingsModal() {

                dom.settingsModal.classList.add('oculto');

                dom.settingsModal.classList.remove('flex');

            }



            función showInAppNotification(título, cuerpo, duración = 3000) {

                dom.inAppNotificationTitle.innerHTML = título;

                dom.inAppNotificationBody.innerHTML = cuerpo;

                dom.inAppNotification.classList.add('mostrar');

            

                dejar cronometrar;

            

                const closeNotification = (evento) => {

                    si (evento && evento.objetivo.más cercano('botón, a')) {

                        devolver;

                    }

                    clearTimeout(temporizador);

                    dom.inAppNotification.classList.remove('mostrar');

                    dom.inAppNotification.removeEventListener('clic', closeNotification);

                    dom.inAppNotificationClose.removeEventListener('clic', closeFromX);

                };

            

                const closeFromX = (evento) => {

                    evento.stopPropagation();

                    cerrarNotificación();

                };



                dom.inAppNotification.addEventListener('click', closeNotification, { una vez: verdadero });

                dom.inAppNotificationClose.addEventListener('click', closeFromX, { una vez: verdadero });

            

                temporizador = setTimeout(closeNotification, duración);

            }



            función showCalendarModal() {

                dom.calendarModalOverlay.classList.remove('oculto');

                dom.calendarModalOverlay.classList.add('flex');

                si (!currentCalendarView) currentCalendarView = 'mes'; 

                renderCalendarView();

            }



            función hideCalendarModal() {

                dom.calendarModalOverlay.classList.add('oculto');

                dom.calendarModalOverlay.classList.remove('flex');

            }



            función renderMonthView() {

                dom.calendarDaysGrid.innerHTML = '';

                dom.currentMonthYear.textContent = selectedCalendarDate.format('MMMM AAAA');

                const startDay = selectedCalendarDate.startOf('mes').startOf('isoWeek');



                para (sea i = 0; i < 42; i++) {

                    const dia = startDay.add(i, 'dia');

                    const dayEl = document.createElement('div');

                    dayEl.className = 'calendario-dia';

                    dayEl.dataset.date = day.format('AAAA-MM-DD');



                    dayEl.innerHTML = `<span class="calendar-day-number">${day.date()}</span><div class="calendar-day-tasks"></div>`;



                    si (día.mes() === selectedCalendarDate.mes()) {

                        dayEl.classList.add('mes-actual');

                    } demás {

                        dayEl.classList.add('otro-mes');

                    }

                    si (día.isSame(dayjs(), 'día')) {

                        dayEl.classList.add('hoy');

                    }



                    const taskContainer = dayEl.querySelector('.calendar-day-tasks');

                    const tareasParaDía = getTasksForDay(dia.format('AAAA-MM-DD'));

                    taskForDay.slice(0, 3).forEach(task => { // Limitar a 3 tareas para evitar el desorden

                        const taskEl = document.createElement('div');

                        taskEl.className = 'calendario-dia-tarea';

                        taskEl.textContent = tarea.texto;

                        taskEl.style.backgroundColor = getLabelColor(task.source === 'Personal' ? 'Personal' : (task.labels && task.labels[0] ? task.labels[0] : 'default'));

                        taskEl.draggable = verdadero;

                        taskEl.dataset.taskId = tarea.id;

                        taskEl.dataset.taskSource = tarea.fuente;

                        tareaEl.innerHTML = `

                            ${tarea.texto}

                            <i class="fas fa-times delete-task-icon" data-task-id="${task.id}" data-task-source="${task.source}"></i>

                        `;

                        tareasContenedor.appendChild(tareaEl);

                    });



                    dayEl.addEventListener('clic', (e) => {

                        if(e.target.classList.contains('eliminar-tarea-icono')) {

                            e.stopPropagation();

                            deleteTask(e.target.dataset.taskId);

                        } de lo contrario si (e.objetivo === e.objetivoactual || e.objetivo.classList.contains('tareas-del-día-del-calendario')) {

                             editCalendarTask(null, day.format('AAAA-MM-DD'));

                        } de lo contrario si (e. objetivo. más cercano ('. calendario-día-tarea')) {

                            const taskEl = e.target.closest('.calendario-dia-tarea');

                            handleTaskClick(tareaEl.dataset.taskId, tareaEl.dataset.taskSource);

                        }

                    });

                    dayEl.addEventListener('dragover', e => { e.preventDefault(); e.currentTarget.style.backgroundColor = 'var(--current-bg-light)'; });

                    dayEl.addEventListener('dragleave', e => { e.currentTarget.style.backgroundColor = ''; });

                    dayEl.addEventListener('drop', handleCalendarDrop);

                    tareasContainer.querySelectorAll('.calendar-day-task').forEach(t => t.addEventListener('dragstart', handleCalendarDragStart));

                    tareasContainer.querySelectorAll('.calendar-day-task').forEach(t => t.addEventListener('touchstart', handleTouchStart, {pasivo: falso}));



                    dom.calendarDaysGrid.appendChild(díaEl);

                }

            }

            

            función renderWeekView() {

                dom.weekDaysContent.innerHTML = '';

                let startOfWeek = selectedCalendarDate.startOf('isoWeek');



                const endOfWeek = startOfWeek.add(6, 'día');

                dom.currentWeekRange.textContent = `${startOfWeek.format('D MMM')} - ${endOfWeek.format('D MMM, AAAA')}`;



                para (sea i = 0; i < 7; i++) {

                    const día = startOfWeek.add(i, 'día');

                    const dayKey = day.format('AAAA-MM-DD');

                    constante tareas = getTasksForDay(dayKey);

                    const idioma = localStorage.getItem('goatify-lang') || 'es';

                    const displayDate = dia.format('dddd, D MMM');

                    const daySection = document.createElement('div');

                    daySection.className = 'sección-día-de-la-semana';

                    daySection.dataset.date = claveDía;



                    daySection.innerHTML = `

                        <h5>

                            ${displayDate}

                            <button class="add-task-to-day-btn text-lg hover:text-primary" data-date="${dayKey}">+</button>

                        </h5>

                        <div class="espacio-y-1">

                            ${tareas.longitud === 0 ? `<p class="text-xs text-text-medium italic">${translations[lang].calendar_no_tasks}</p>` : ''}

                            ${tareas.map((tarea) => {

                                const isPersonal = tarea.fuente === 'Personal';

                                regresar `

                                <div class="task-item flex items-center gap-2 cursor-pointer ${task.completed ? 'task-item-completed' : ''}" 

                                     draggable="true" data-task-id="${task.id}" data-task-source="${task.source}">

                                     <input type="checkbox" class="task-checkbox flex-shrink-0" data-task-id="${task.id}" ${task.completed ? 'checked' : ''}>

                                    <span class="flex-grow">${tarea.texto} ${tarea.tiempo ? `(${tarea.tiempo})` : ''} <span class="text-xs text-primary">(${tarea.fuente})</span></span>

                                    <button class="eliminar-tarea-icono texto-texto-medio hover:texto-peligro-color texto-xs p-1"><i class="fas fa-trash-alt"></i></button>

                                </div>

                            `}).join('')}

                        </div>

                     `;

                    dom.weekDaysContent.appendChild(díaSección);

                    daySection.addEventListener('dragover', e => { e.preventDefault(); e.currentTarget.style.backgroundColor = 'var(--current-bg-light)'; });

                    daySection.addEventListener('dragleave', e => { e.currentTarget.style.backgroundColor = ''; });

                    daySection.addEventListener('drop', handleCalendarDrop);

                    daySection.addEventListener('clic', (e) => {

                         si (e.objetivo === e.objetivoactual || e.objetivo.listadeclases.contiene('espacio-y-1')) {

                            editCalendarTask(null, dayKey);

                        }

                    });

                }



                dom.weekDaysContent.querySelectorAll('.task-checkbox').forEach(casilla de verificación => {

                    casilla de verificación.addEventListener('clic', (e) => {

                        e.stopPropagation();

                        updateTaskStatus(e.currentTarget.dataset.taskId, { completado: e.currentTarget.checked });

                    });

                 });



                dom.weekDaysContent.querySelectorAll('.task-item').forEach(item => {

                    item.addEventListener('dragstart', handleCalendarDragStart);

                    elemento.addEventListener('touchstart', handleTouchStart, {pasivo: falso});

                    elemento.addEventListener('clic', (e) => {

                        si (e.target.closest('.delete-task-icon')) {

                            e.stopPropagation();

                            deleteTask(elemento.conjunto de datos.IdDeTarea);

                            devolver;

                        }

                        si (e.target.type === 'casilla de verificación') devolver;

                        handleTaskClick(item.dataset.taskId, item.dataset.taskSource);

                     });

                });

                dom.weekDaysContent.querySelectorAll('.add-task-to-day-btn').forEach(btn => {

                    btn.addEventListener('clic', (e) => {

                        e.stopPropagation();

                        fecha constante = e.currentTarget.dataset.date;

                        editCalendarTask(nulo, fecha);

                    });

                });

            }



            función renderDayView() {

                dom.currentDayDisplay.textContent = selectedCalendarDate.format('dddd, D [de] MMMM');

                dom.dayViewTimeline.innerHTML = '';

                const tareasParaDía = getTasksForDay(selectedCalendarDate.format('AAAA-MM-DD'));

                

                para (sea hora = 0; hora < 24; hora++) {

                    const hourEl = document.createElement('div');

                    hourEl.className = 'día-vista-hora';

                    const hourLabel = (hora < 10 ? '0' : '') + hora + ':00';

                    hourEl.dataset.time = hourLabel.substring(0,2); // "09"

                    const tareasEnHora = tareasParaDía.filter(t => t.tiempo && t.tiempo.startsWith((hora < 10 ? '0' : '') + hora));

                    horaEl.innerHTML = `

                        ${EtiquetaHora}</div>

                        <div class="day-view-hour-content" data-time="${hourLabel}" data-date="${selectedCalendarDate.format('AAAA-MM-DD')}">

                            ${tareasEnHora.map(tarea => {

                                regresar `

                                 <div class="task-item flex items-center gap-2 p-1 rounded-md ${task.completed ? 'bg-green-900/50 text-gray-400 line-through' : 'bg-input'} text-sm" 

                                    draggable="true" data-task-id="${task.id}" data-task-source="${task.source}">

                                    <input type="checkbox" class="task-checkbox flex-shrink-0" data-task-id="${task.id}" ${task.completed ? 'checked' : ''}>

                                     <span class="flex-grow cursor-pointer"><strong>${tarea.tiempo}:</strong> ${tarea.texto} <span class="text-xs text-primary">(${tarea.origen})</span></span>

                                     <button class="eliminar-tarea-icono texto-texto-medio hover:texto-peligro-color texto-xs p-1"><i class="fas fa-trash-alt"></i></button>

                                </div>

                                `

                            }).unirse('')}

                             <button class="add-task-to-time-btn text-lg hover:text-primary" data-date="${selectedCalendarDate.format('AAAA-MM-DD')}" data-time="${hourLabel}">+</button>

                        </div>

                    `;

                    dom.dayViewTimeline.appendChild(horaEl);



                    const horaContenido = horaEl.querySelector('.day-view-hora-contenido');

                    hourContent.addEventListener('dragover', e => { e.preventDefault(); e.currentTarget.style.backgroundColor = 'var(--current-bg-light)'; });

                    hourContent.addEventListener('dragleave', e => { e.currentTarget.style.backgroundColor = ''; });

                    hourContent.addEventListener('drop', handleCalendarDrop);

                     hourContent.addEventListener('clic', (e) => {

                         si (e.objetivo === e.objetivoactual) {

                            editCalendarTask(null, selectedCalendarDate.format('AAAA-MM-DD'), e.currentTarget.dataset.time);

                        }

                    });

                }

                dom.dayViewTimeline.querySelectorAll('.add-task-to-time-btn').forEach(btn => {

                    btn.addEventListener('clic', (e) => {

                        e.stopPropagation();

                        fecha constante = e.currentTarget.dataset.date;

                         tiempo constante = e.currentTarget.dataset.time;

                        editCalendarTask(null, fecha, hora);

                    });

                });

                dom.dayViewTimeline.querySelectorAll('.task-checkbox').forEach(casilla de verificación => {

                    casilla de verificación.addEventListener('clic', (e) => {

                        e.stopPropagation();

                        updateTaskStatus(e.currentTarget.dataset.taskId, { completado: e.currentTarget.checked });

                    });

                });

                dom.dayViewTimeline.querySelectorAll('.task-item').forEach(item => {

                    item.addEventListener('dragstart', handleCalendarDragStart);

                    elemento.addEventListener('touchstart', handleTouchStart, {pasivo: falso});

                    elemento.addEventListener('clic', (e) => {

                         si (e.target.closest('.delete-task-icon')) {

                            e.stopPropagation();

                            deleteTask(elemento.conjunto de datos.IdDeTarea);

                            devolver;

                        }

                        si (e.target.type === 'casilla de verificación') devolver;

                        handleTaskClick(item.dataset.taskId, item.dataset.taskSource);

                    });

                 });

            }



            función handleTaskClick(taskId, taskSource) {

                 si (taskSource === 'Personal') {

                    editCalendarTask(taskId);

                } demás {

                    const projectChat = Object.values(state.chats).find(c => c.projectData && c.projectData.title === taskSource);

                    si (proyectoChat) {

                        editarProjectTask(projectChat.id, taskId);

                    }

                }

            }

            

            deje que draggedCalendarTaskId = nulo;

            función handleCalendarDragStart(e) {

                const objetivo = e.objetivo.closest('[draggable="true"]');

                si (!objetivo) retorna;

                draggedCalendarTaskId = objetivo.conjunto de datos.tareaId;

                e.dataTransfer.setData('texto/sin formato', draggedCalendarTaskId);

                e.dataTransfer.effectAllowed = 'mover';

            }

            

            función handleCalendarDrop(e) {

                e.preventDefault();

                e.stopPropagation();

                e.currentTarget.style.backgroundColor = '';

                const taskId = e.dataTransfer.getData('texto/sin formato');

                si (!taskId) retorna;



                constante dropZone = e.currentTarget;

                constante newDate = dropZone.dataset.date;

                deje que newTime = dropZone.dataset.time || findTask(taskId)?.tarea?.tiempo || nulo; 

                

                if (nuevahora && nuevahora.longitud === 2) { 

                   const originalTask ​​= findTask(taskId)?.tarea;

                   constante originalMinutos = originalTarea?.tiempo?.substring(3,5) || '00';

                   nuevoHora = `${nuevoHora}:${originalMinutos}`;

                }

                

                const actualizaciones = { fecha: nuevaFecha, hora: nuevaHora };

                updateTaskStatus(taskId, actualizaciones);

            }



            deje que touchDragElement = null, ghostElement = null;

            función handleTouchStart(e) {

                si (e.touches.length !== 1) retorna;

                const objetivo = e.objetivo.closest('[draggable="true"]');

                si (!objetivo) retorna;

                

                touchDragElement = objetivo;

                

                elementoFantasma = touchDragElement.cloneNode(verdadero);

                ghostElement.style.position = 'absoluta';

                ghostElement.style.zIndex = '1000';

                ghostElement.style.opacity = '0.7';

                ghostElement.style.pointerEvents = 'ninguno';

                ghostElement.style.width = `${touchDragElement.offsetWidth}px`;

                documento.cuerpo.appendChild(elementoFantasma);

                

                const touch = e.touches[0];

                ghostElement.style.left = `${touch.pageX - ghostElement.offsetWidth / 2}px`;

                ghostElement.style.top = `${touch.pageY - ghostElement.offsetHeight / 2}px`;



                document.addEventListener('touchmove', handleTouchMove, {pasivo: falso});

                documento.addEventListener('touchend', handleTouchEnd);

            }

            función handleTouchMove(e) {

                si (e.touches.length !== 1 || !ghostElement) retorna;

                e.preventDefault();

                const touch = e.touches[0];

                ghostElement.style.left = `${touch.pageX - ghostElement.offsetWidth / 2}px`;

                ghostElement.style.top = `${touch.pageY - ghostElement.offsetHeight / 2}px`;

            }

            función handleTouchEnd(e) {

                si (!ghostElement) retorna;

                

                ghostElement.style.display = 'ninguno';

                const dropTarget = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);

                elemento fantasma.remove();

                

                si (eliminarObjetivo) {

                    const dropZone = dropTarget.closest('.calendario-dia, .semana-dia-sección, .dia-vista-hora-contenido, .kanban-tarjetas, .lista-vista-columna-móvil, .lista-vista-contenido > h4');

                    si(dropZone) {

                        constante taskId = touchDragElement.dataset.taskId;

                        si (dropZone.classList.contains('tarjetas-kanban')) {

                            constante chatId = currentChatId;

                            constante columnId = dropZone.dataset.columnId;

                            moveTask(chatId, taskId, columnId);

                        } de lo contrario si (dropZone.classList.contains('list-view-column-mobile')) {

                            constante chatId = currentChatId;

                            constante columnId = dropZone.dataset.columnId;

                            moveTask(chatId, taskId, columnId);

                        } de lo contrario si (dropZone.tagName === 'H4' y dropZone.closest('#list-view')) {

                             const columnTitle = dropZone.textContent.trim();

                             const chat = estado.chats[currentChatId];

                             const targetColumn = chat.projectData.columns.find(c => c.title === columnTitle);

                             si (columnaobjetivo) {

                                 moveTask(currentChatId, taskId, targetColumn.id);

                             }

                        }

                        demás {

                            constante newDate = dropZone.dataset.date;

                            deje que newTime = dropZone.dataset.time || findTask(taskId)?.tarea?.tiempo || nulo;

                            if (nuevahora && nuevahora.longitud === 2) {

                                const originalTask ​​= findTask(taskId)?.tarea;

                                constante originalMinutos = originalTarea?.tiempo?.substring(3,5) || '00';

                                nuevoHora = `${nuevoHora}:${originalMinutos}`;

                            }

                            updateTaskStatus(taskId, {fecha: nuevaFecha, hora: nuevaHora});

                        }

                    }

                }

                

                touchDragElement = nulo; ghostElement = nulo;

                document.removeEventListener('touchmove', handleTouchMove);

                documento.removeEventListener('touchend', handleTouchEnd);

            }



            función findTask(taskId) {

                si (!taskId) devuelve nulo;

                si (taskId.startsWith('cal-')) {

                    para (const dayKey en estado.calendario) {

                        const taskIndex = (estado.calendario[dayKey] || []).findIndex(t => t.id === taskId);

                        si (índiceDeTarea > -1) {

                            devolver { tipo: 'personal', tarea: estado.calendario[clave_día][índice_tarea], clave_día, índice_tarea };

                        }

                    }

                } de lo contrario si (taskId.startsWith('proj-')) {

                    para (const chat de Object.values(state.chats)) {

                        si (chat.projectData && chat.projectData.columns) {

                            para (columna constante de chat.projectData.columns) {

                                const taskIndex = (columna.tareas || []).findIndex(t => t.id === taskId);

                                si (índiceDeTarea > -1) {

                                     devolver { tipo: 'proyecto', tarea: columna.tareas[taskIndex], chat, columna, taskIndex };

                                }

                            }

                        }

                    }

                }

                devuelve nulo;

            }



            función updateTaskStatus(taskId, actualizaciones) {

                constante encontrado = findTask(taskId);

                si (!encontrado) retorna;



                si (encontrado.tipo === 'personal') {

                    const { tarea, dayKey } = encontrado;

                    const fechaAnterior = claveDía;

                    const newDate = actualizaciones.fecha || fechaAnterior;

                    

                    si (fechaAnterior !== fechaNueva) {

                        const taskIndex = estado.calendario[fechaAnterior].findIndex(t => t.id === taskId);

                        const [tareaAMover] = estado.calendario[fechaAnterior].splice(índiceDeTarea, 1);

                        if(estado.calendario[fechaanterior].length === 0) eliminar estado.calendario[fechaanterior];

                        

                        si (!estado.calendario[nuevaFecha]) estado.calendario[nuevaFecha] = [];

                        Objeto.assign(taskToMove, actualizaciones);

                        eliminar taskToMove.date;

                        estado.calendario[nuevaFecha].push(tareaAMover);

                    } demás {

                        eliminar actualizaciones.fecha;

                        Objeto.assign(tarea, actualizaciones);

                    }

                } 

                de lo contrario si (found.type === 'proyecto') {

                    const { tarea, chat } = encontrado;

                    const originalCompleted = tarea.completada;

                    Objeto.assign(tarea, actualizaciones);



                    si (actualizaciones.completadas !== indefinido && actualizaciones.completadas !== originalCompletado) {

                        deje que sourceColumn, taskIndex;

                        para (const col de chat.projectData.columns){

                            const idx = (col.tareas || []).findIndex(t => t.id === taskId);

                            si(idx > -1){

                                sourceColumn = col;

                                índiceDeTarea = idx;

                                romper;

                            }

                        }



                        si (columnaFuente) {

                            const [tareaAMover] = sourceColumn.tasks.splice(taskIndex, 1);

                            si (tarea.completada) {

                                const doneColumn = chat.projectData.columns.find(c => c.id === 'hecho');

                                si (doneColumn && sourceColumn.id !== 'done') doneColumn.tasks.push(taskToMove);

                                de lo contrario sourceColumn.tasks.push(tareaParaMover); 

                            } demás {

                                const todoColumn = chat.projectData.columns.find(c => c.id === 'todo');

                                si (todoColumn && sourceColumn.id === 'hecho') todoColumn.tasks.push(taskToMove);

                                de lo contrario sourceColumn.tasks.push(tareaParaMover);

                            }

                        }

                    }

                }



                guardarEstado();

                si (dom.calendarModalOverlay.classList.contains('flex')) {

                    renderCalendarView();

                }

                si (dom.projectManagementView.style.display === 'flex') {

                    renderProjectBoard(currentChatId);

                }

            }





            función getTasksForDay(dayKey) {

                const calendarTasks = (estado.calendario[claveDía] || []).map(t => ({...t, texto: t.contenido, fuente: 'Personal'}));

                const projectTasks = [];

                Objeto.valores(estado.chats).paraCada(chat => {

                    si (chat.projectData && chat.projectData.columns) {

                        chat.projectData.columns.forEach(columna => {

                            (columna.tareas || []).forEach(tarea => {

                                 si (tarea.fechaDeVuelo === claveDía) {

                                    projectTasks.push({...tarea, fuente: chat.projectData.title, texto: tarea.content});

                                }

                             });

                        });

                    }

                });

                devuelve [...tareasdelcalendario, ...tareasdelproyecto].sort((a, b) => (a.tiempo || '23:59').localeCompare(b.tiempo || '23:59'));

            }



            función updateNotificationBadge() {

                 deje que las notificaciones pendientes = 0;

                const ahora = dayjs();

                Objeto.keys(estado.calendario).forEach(dayKey => {

                    const tareasParaDía = obtenerTareasParaDía(claveDía);

                    tareasParaDía.paraCada(tarea => {

                         si (!tarea.completada) {

                            si (tarea.tiempo) {

                                constante taskDateTime = dayjs(`${dayKey}T${tarea.tiempo}`);

                                si (taskDateTime.isBefore(ahora)) {

                                     pendientesNotificaciones++;

                                }

                            } demás {

                                constante taskDate = dayjs(dayKey);

                                si (taskDate.isBefore(ahora, 'día') || taskDate.isSame(ahora, 'día')) {

                                    pendientesNotificaciones++;

                                }

                            }

                         }

                    });

                });

                

                const badgeEl = document.getElementById('insignia-de-notificación');



                si (Notificaciones pendientes > 0) {

                    BadgeEl.textContent = Notificaciones pendientes;

                    badgeEl.classList.remove('oculto');

                } demás {

                    badgeEl.classList.add('oculto');

                }

            }



            función checkAndNotifyTasks() {

                si (!notificationsEnabled) retorna;

                const ahora = dayjs();

                const todayKey = now.format('AAAA-MM-DD');

                const currentHourMinute = now.format('HH:mm');

                constante allTasksToday = getTasksForDay(hoyKey);

                allTasksToday.forEach(tarea => {

                    si (!tarea.completada && tarea.tiempo === horaActualMinuto && !tarea.notificadoEsteMinuto) {

                        const idioma = localStorage.getItem('goatify-lang') || 'es';

                        const notificationTitle = traducciones[lang].notification_title;

                        const notificationBody = `${translations[lang].notification_task_due} ${tarea.texto} (${tarea.tiempo})`;

                        

                        mostrarNotificaciónEnAplicación(

                            `<i class="fas fa-bell animate-tada text-yellow-400 mr-2"></i> ${notificationTitle}`,

                            `<p class="text-md">${notificationBody}</p>`

                        );



                        si (Notificación.permiso === "concedido") {

                            nueva Notificación(títuloNotificación, {

                                 cuerpo: notificationBody,

                                icono: './Logos HD.png'

                            });

                        }

                        

                        updateTaskNotifiedFlag(tarea.id, verdadero);

                    }

                });

                allTasksToday.forEach(tarea => {

                    si (tarea.notificadoEsteMinuto && tarea.tiempo !== HoraActualMinuto) {

                        updateTaskNotifiedFlag(tarea.id, falso);

                    }

                });

                guardarEstado();

                actualizarNotificaciónInsignia();

            }



            función updateTaskNotifiedFlag(taskId, isNotified) {

                constante encontrado = findTask(taskId);

                si (encontrado) {

                    encontrado.tarea.notificadoEsteMinuto = seNotifica;

                }

            }





            función renderCalendarView() {

                 dom.dayViewContainer.style.display = currentCalendarView === 'día' ? 'bloque' : 'ninguno';

                dom.weekViewContainer.style.display = currentCalendarView === 'semana' ? 'bloque' : 'ninguno';

                dom.monthViewContainer.style.display = currentCalendarView === 'mes' ? 'bloque' : 'ninguno';

                

                dom.dayViewBtn.classList.toggle('activo', currentCalendarView === 'día');

                dom.weekViewBtn.classList.toggle('activo', currentCalendarView === 'semana');

                dom.monthViewBtn.classList.toggle('activo', currentCalendarView === 'mes');



                si (currentCalendarView === 'dia') renderDayView();

                si (currentCalendarView === 'semana') renderWeekView();

                si (currentCalendarView === 'mes') renderMonthView();

            }



            setInterval(checkAndNotifyTasks, 10 * 1000);



            // AÑADIDO: Lógica para inicializar el Service Worker y las notificaciones push

            función asíncrona initializePushNotifications() {

                si (!('serviceWorker' en el navegador) || !('PushManager' en la ventana)) {

                    console.warn('No se admite la mensajería push');

                    devolver;

                }



                intentar {

                    const swRegistration = await navigator.serviceWorker.register('/service-worker.js');

                    console.log('Service Worker registrado:', swRegistration);



                    deje que la suscripción = espere swRegistration.pushManager.getSubscription();

                    si (suscripción === null) {

                        console.log('No se encontró suscripción, suscribiéndose...');

                        const applicationServerKey = urlBase64ToUint8Array('TU_VAPID_PUBLIC_KEY'); // Esta clave la generarás en el backend

                        suscripción = esperar swRegistration.pushManager.subscribe({

                            userVisibleOnly: verdadero,

                            ClaveDeServidorDeAplicación: ClaveDeServidorDeAplicación

                        });

                        console.log('Nueva suscripción:', suscripción);

                        esperar saveSubscriptionToSupabase(suscripción);

                    } demás {

                        console.log('Suscripción existente:', suscripción);

                    }

                } captura (error) {

                    console.error('Error en el registro del Service Worker:', error);

                }

            }



            función urlBase64ToUint8Array(cadena base64) {

                relleno constante = '='.repeat((4 - base64String.length % 4) % 4);

                const base64 = (base64String + relleno).replace(/-/g, '+').replace(/_/g, '/');

                const rawData = ventana.atob(base64);

                constante outputArray = nuevo Uint8Array(rawData.length);

                para (sea i = 0; i < rawData.length; ++i) {

                    matrizDeSalida[i] = rawData.charCodeAt(i);

                }

                retorna matriz de salida;

            }



            función asíncrona saveSubscriptionToSupabase(suscripción) {

                // Esta es la función que conectarás con tu backend/Supabase

                // En la Parte 2, la implementaremos.

                console.log("TODO: Enviar esta suscripción a Supabase:", JSON.stringify(suscripción));

                // Ejemplo de lo que harías:

                // const { datos, error } = await supabase

                // .from('suscripciones_push')

                // .insert([{ id_usuario: currentUser.id, información_suscripción: suscripción }]);

            }

            

            función hablar(texto) { 

                si (!speechOn || !('speechSynthesis' en ventana) || !texto) devolver;

                speechSynthesis.cancel();

                micWasOnBeforeSpeaking = estáReconociendo;

                si (isRecognizing) { reconocimiento.stop(); }

                const cleanText = texto.replace(/<[^>]*>/g, '').replace(/[*_`#~[\]()🔍]|(-{3,})/g, '');

                const enunciado = new SpeechSynthesisUtterance(cleanText); 

                si (vozSeleccionada) { enunciado.voz = vozSeleccionada;

                }

                tasa de enunciado = 1,15;

                enunciado.onend = () => {

                    si (el micrófono estaba encendido antes de hablar) {

                        si (reconocimiento && !isRecognizing) {

                            try { reconocimiento.start(); } catch(e) { console.error("Error al reiniciar el reconocimiento:", e); }

                        }

                        micWasOnBeforeSpeaking = falso;

                    }

                    alternarVoiceSelectorVisibility(falso);

                };

                enunciado.onerror = (e) => {

                    console.error('Error de síntesis de voz:', e);

                    si (el micrófono estaba encendido antes de hablar) {

                        si (reconocimiento && !isRecognizing) {

                           try { reconocimiento.start(); } catch(e) { console.error("Error al reiniciar el reconocimiento en caso de error:", e); }

                        }

                        micWasOnBeforeSpeaking = falso;

                    }

                     alternarVoiceSelectorVisibility(falso);

                }

                speechSynthesis.speak(enunciación);

            }



            función populateVoiceList() {

                const setVoces = () => {

                    si (tipo de síntesis de voz === 'indefinido') { retorno; }

                    vocesDisponibles = speechSynthesis.getVoices().filter(v => v.lang.startsWith('es-') || v.lang.startsWith('en-'));

                    constferredVoices = [ "Microsoft Sabina Online (Natural) - Español (México)", "Paulina", "Google español de Estados Unidos", "Google español" ];

                    vocesdisponibles.sort((a, b) => {

                        sea ​​aIdx = preferredVoices.indexOf(a.nombre); sea bIdx = preferredVoices.indexOf(b.nombre);

                        si (aIdx === -1) aIdx = Infinito; si (bIdx === -1) bIdx = Infinito;

                        si (aIdx !== bIdx) devolver aIdx - bIdx;

                        devuelve a.name.localeCompare(b.name);

                    });

                    

                    si (VocesDisponibles.length > 0) {

                        dom.voiceSelector.innerHTML = '';

                        vocesdisponibles.paraCada(voz => {

                            const opción = document.createElement('opción');

                            const displayName = voice.name.replace('Microsoft', '').replace('Online (Natural) -', '').replace('Google', '').replace('Español (México)','Mex').trim();

                            opción.textContent = `${displayName || voz.lang} (${voz.lang})`;

                            opción.valor = voz.nombre;

                            dom.voiceSelector.appendChild(opción);

                        });

                        selectedVoice = vocesdisponibles[0];

                        si (vozSeleccionada) dom.voiceSelector.value = vozSeleccionada.name;

                    }

                }

                si (speechSynthesis.onvoiceschanged !== indefinido) {

                    speechSynthesis.onvoiceschanged = establecerVoces;

                }

                establecerVoces();

            }



            función getModelForRequest(flujo de trabajo, tieneArchivo, esProjectChat, esFinancialChat) {

                si (esProjectChat) {

                    devuelve el documento.getElementById('selector-del-modelo-del-proyecto').value;

                }

                si (esFinancialChat) {

                    devuelve 'gpt-4o-mini'; 

                }

                si (flujo de trabajo === "diseño-web") devolver "gpt-4o-mini";

                si (hasFile) devuelve "gpt-4o-mini";

                devuelve dom.modelSelector.value;

            }



            función asíncrona getAIResponse(prompt, history, image, pdf, model, workflow, userName, financialData = null) {

                const nombre = (nombreUsuario || '').split(' ')[0];

                deja titulo = 'Jefe';

                si (nombre.slice(-1).toLowerCase() === 'a' || ['isabel', 'dolores'].includes(nombre.toLowerCase())) {

                    título = 'Jefa';

                }

                cuerpo constante = { 

                    aviso, historia, modelo,

                    flujo de trabajo, nombre de usuario: nombre, título,

                    imageData: imagen, pdfTexto: pdf, 

                    Datos financieros,

                 };

                intentar {

                    respuesta constante = esperar fetch('/.netlify/functions/get-ai-response', {

                        método: 'POST',

                        encabezados: { 'Content-Type': 'application/json' },

                         cuerpo: JSON.stringify(cuerpo),

                    });

                    si (!respuesta.ok) {

                        const errorData = await respuesta.json().catch(() => ({detalles: 'Error desconocido en el servidor'}));

                        console.error("Error de backend:", errorData);

                        lanzar nuevo Error(errorData.details || `Error del servidor: ${response.status}.`);

                    }

                    devolver esperar respuesta.json();

                } captura (error) {

                    console.error("Error de obtención:", error);

                    arrojar error;

                }

            }

            

            función getCreditCount() {

                const plan = currentUser?.app_metadata?.plan || 'gratis';

                deje que el límite sea = LÍMITE_DE_CRÉDITO_DE_INVITADO;

                si (plan === 'gratis') límite = LÍMITE_DE_CRÉDITO_PLAN_GRATIS;

                si (plan === 'boost') límite = BOOST_PLAN_CREDIT_LIMIT;

                si (plan === 'pro') limite = Infinito;



                const usageData = JSON.parse(localStorage.getItem(`usage_${currentUser?.id || 'guest'}`)) || { count: 0, fecha: '' };

                const hoy = dayjs().format('AAAA-MM-DD');



                si (usageData.date !== hoy) {

                    retorna { restante: límite, límite: límite }; 

                }

                

                devolver { restante: Math.max(0, límite - usageData.count), límite: límite };

            }

            

            función gastarCréditos(costo) {

                const plan = currentUser?.app_metadata?.plan || 'gratis';

                si (plan === 'pro') devuelve verdadero; 



                constante usageKey = `uso_${currentUser?.id || 'invitado'}`;

                const hoy = dayjs().format('AAAA-MM-DD');

                deje que usageData = JSON.parse(localStorage.getItem(usageKey)) || { count: 0, fecha: '' };



                si (usageData.date !== hoy) {

                    usageData = { count: 0, fecha: hoy };

                }



                const { restante } = getCreditCount();



                si (restante >= costo) {

                    usageData.count += costo;

                    localStorage.setItem(usageKey, JSON.stringify(usageData));

                    actualizarContadorDeCrédito();

                    devuelve verdadero;

                }



                si (gamificationState.credits >= costo) {

                    gamificationState.credits -= costo;

                    guardarGamificationState();

                    actualizarContadorDeCrédito();

                    devuelve verdadero;

                }

                

                si (!UsuarioActual) {

                    mostrarModal({

                        título: 'Créditos de Invitado Agotados',

                        cuerpo: 'Has utilizado todos tus créditos de invitado. <strong>Inicia sesión para obtener 15 créditos diarios más, ¡gratis!</strong>',

                        confirmText: 'Iniciar Sesión',

                        cancelTexto: 'Más tarde'

                    }). entonces(res => {

                        si (res.confirmado) {

                            netlifyIdentity.open('iniciar sesión');

                        }

                    });

                } demás { 

                    mostrarModal({

                        título: 'Créditos Insuficientes',

                        cuerpo: 'No tienes suficientes créditos de tu plan ni créditos de recompensa. Mejora tu plan para continuar.',

                        confirmTexto: 'Ver Planes'

                    }). entonces(res => {

                        si (res.confirmado) showPricingModal();

                    });

                }

                devuelve falso;

            }



            función asíncrona loadStateForUser() {

                const loadLocalStorage = (clave) => {

                    const guardado = localStorage.getItem(clave);

                    devolver guardado ? JSON.parse(guardado) : {};

                };



                si (!UsuarioActual) {

                    constante guestData = loadLocalStorage('guestState');

                    estado = guestData.state || { chats: {}, proyectos: {}, estructura: [], calendario: {}, notas: [] };

                    currentChatId = guestData.currentChatId || nulo;

                } demás {

                     intentar {

                        respuesta constante = esperar fetch('/.netlify/functions/load-chats', {

                            método: 'POST',

                            encabezados: { 'Content-Type': 'application/json' },

                            cuerpo: JSON.stringify({ userId: currentUser.id }),

                        });

                        si (!response.ok) { lanzar nuevo Error(`Error del servidor: ${response.status}`); }

                        const dbState = await respuesta.json();

                        estado = dbState.state || { chats: {}, proyectos: {}, estructura: [], calendario: {}, notas: [] };

                        currentChatId = dbState.currentChatId;

                    } captura (error) {

                        console.error("No se pudo cargar desde la base de datos, volviendo a localStorage:", error);

                        const userLocalData = loadLocalStorage(`goatbotState_${currentUser.id}`);

                        estado = userLocalData.state || { chats: {}, proyectos: {}, estructura: [], calendario: {}, notas: [] };

                        currentChatId = userLocalData.currentChatId;

                    }

                }



                estado.calendario = estado.calendario || {};

                estado.proyectos = estado.proyectos || {};

                estado.chats = estado.chats || {};

                estado.estructura = estado.estructura || [];

                estado.notas = estado.notas || [];



                cargarEstadoDeGamificación();

                renderSidebar();

                selectChat(currentChatId);

            }



            función asíncrona saveState() {

                const stateData = { estado, currentChatId };

                clave constante = usuarioActual ? `goatbotState_${usuarioActual.id}` : 'guestState';

                

                intentar {

                    localStorage.setItem(clave, JSON.stringify(stateData));

                    si(usuarioactual) {

                        esperar fetch('/.netlify/functions/save-chats', {

                            método: 'POST',

                            encabezados: { 'Content-Type': 'application/json' },

                            cuerpo: JSON.stringify({ userId: currentUser.id, estadoAGuardar: estadoData }),

                        });

                    }

                } captura (error) {

                    console.error("Error al guardar el estado:", error);

                }

            }

            

            función updateUserUI() {

                si (usuarioactual) {

                    dom.loginView.classList.add('oculto');

                    dom.userMenuView.classList.remove('oculto');

                    dom.genericWelcome.classList.add('oculto');

                    dom.personalizedWelcome.classList.remove('oculto');

                    const nombreUsuario = usuarioActual.metadatos_del_usuario?.nombre_completo?.split(' ')[0] || usuarioActual.correoElectrónico.split('@')[0];

                    dom.userEmail.textContent = usuario_actual.metadatos_del_usuario?.nombre_completo || usuario_actual.email;

                    dom.userName.textContent = nombre de usuario;

                    dom.upgradePlanContainer.classList.toggle('oculto', (currentUser.app_metadata?.plan || 'gratis') !== 'gratis');

                } demás {

                    dom.loginView.classList.remove('oculto');

                    dom.userMenuView.classList.add('oculto');

                    dom.genericWelcome.classList.remove('oculto');

                    dom.personalizedWelcome.classList.add('oculto');

                    dom.upgradePlanContainer.classList.add('oculto');

                }

                actualizarContadorDeCrédito();

            }



            función updateCreditCounter() {

                const { restante, límite } = getCreditCount();

                const gamCredits = gamificationState.credits || 0;

                deje que displayLimit = límite === Infinito ? '∞' : límite;

                dom.messageCounterEl.innerHTML = `

                    <span class="font-semibold">${restante}/${Límite de visualización}</span>

                    <i class="fas fa-coins text-gold ml-2 mr-1" title="Créditos de Recompensa"></i> ${gamCredits}

                `;

                dom.messageCounterEl.classList.remove('oculto');

            }



            función setTheme(isDark) { 

                document.body.className = 'w-pantalla desbordamiento-x-oculto';

                document.body.classList.add(isDark ? 'tema-oscuro' : 'tema-claro');

                dom.themeIcon.className = `fas fa-${isDark ? 'sol' : 'luna'}`; 

                si (dom.settingsThemeIcon) dom.settingsThemeIcon.className = `fas fa-${isDark ? 'luna' : 'sol'} mr-2`;

                localStorage.setItem('tema', isDark ? 'oscuro' : 'claro');

            }



            función toggleSidebar(mostrar) {

                constante barra lateral = dom.barra lateral;

                si (mostrar) {

                    barra lateral.classList.add('está-abierto');

                    dom.sidebarOverlay.classList.remove('opacidad-0', 'eventos-de-puntero-ninguno');

                } demás {

                    barra lateral.classList.remove('está abierto');

                    dom.sidebarOverlay.classList.add('opacidad-0', 'eventos-de-puntero-ninguno');

                }

            }

            

            función createNewChat(opciones = {}) {

                constante id = 'chat-' + crypto.randomUUID();

                const nombre = usuarioActual ? (usuarioActual.metadatos_del_usuario.nombre_completo?.split(' ')[0] || 'Tú') : 'viajero';

                deja titulo = 'Jefe';

                si (nombre.slice(-1).toLowerCase() === 'a' || ['isabel', 'dolores'].includes(nombre.toLowerCase())) {

                    título = 'Jefa';

                }

                

                deje que los mensajes iniciales;

                mensajesiniciales = opciones.mensajesiniciales ||

                [{ 

                    rol: 'asistente', 

                    contenido: `Saludos, ${título}. Soy Goatify IA, aquí para servirte. Cada idea tuya es una estrella a punto de nacer. ¿En qué universo nos sumergimos hoy?` 

                }];



                estado.chats[id] = { 

                    identificación, 

                    título: opciones.título || "Conversación Cósmica", 

                    mensajes: mensajesiniciales,

                    flujo de trabajo: opciones.workflow || null,

                    modelo: opciones.modelo || 'gpt-3.5-turbo-1106'

                }; 

                // AÑADIDO: Estructura para colaboración

                if (opciones.flujodetrabajo === 'gestión-de-proyectos' || opciones.flujodetrabajo === 'asistente-financiero' || opciones.flujodetrabajo === 'aplicación-de-bloc-de-notas') {

                    state.chats[id].collaborators = [currentUser?.id].filter(Boolean); // Añade al creador si está logueado

                }



                si (opciones.workflow === 'gestión-de-proyectos') {

                    estado.chats[id].projectData = {

                        título: opciones.título,

                        columnas: [

                             { id: 'todo', título: 'Por Hacer', tareas: [] },

                            { id: 'haciendo', título: 'En Progreso', tareas: [] },

                            { id: 'hecho', título: 'Hecho', tareas: [] }

                         ],

                        currentView: 'list' // Vista de lista predeterminada

                    };

                }



                estado.estructura.unshift(id); 

                seleccionarChat(id); 

                guardarEstado();

                renderSidebar(); 

                dom.modelSelector.value = opciones.modelo || 'gpt-3.5-turbo-1106';

                si (ventana.anchointerior < 768) toggleSidebar(falso);

                

                const chatType = opciones.título || 'chat';

                showInAppNotification("Éxito", `Has creado un nuevo ${chatType}.`, 3000);



                devolver id;

            }



            función selectChat(chatId) { 

                currentChatId = chatId;

                si (isSelectModeActive) retorna;



                si (!chatId || (!state.chats[chatId] && chatId !== 'notepad-app')) { 

                    restablecerChatView(); 

                    devolver; 

                } 



                // Ocultar todas las vistas primero

                dom.chatMessages.style.display = 'ninguno';

                dom.projectManagementView.style.display = 'ninguno';

                dom.financialAssistantView.style.display = 'ninguno';

                dom.notepadViewContainer.style.display = 'ninguno';

                dom.inputArea.style.display = 'ninguno'; 

                dom.projectChatContainer.style.display = 'ninguno';

                

                const financialChatContainer = document.getElementById('contenedor-de-chat-financiero');

                si (financialChatContainer) financialChatContainer.style.display = 'ninguno';



                si (chatId === 'aplicación bloc de notas') {

                    dom.chatTitle.textContent = "Bloque de Notas";

                    dom.mobileChatTitle.textContent = "Bloque de Notas";

                    mostrarNotepadView();

                } demás {

                    const chat = estado.chats[chatId]; 

                    si (chat.workflow === 'gestión de proyectos') {

                        dom.projectManagementView.style.display = 'flex';

                        dom.projectChatContainer.style.display = 'flex';

                        renderProjectView(chatId);

                    } de lo contrario si (chat.workflow === 'asistente-financiero') {

                        dom.financialAssistantView.style.display = 'flexible';

                        renderAsistenteFinancial(chatId);

                        document.getElementById('contenedor-de-chat-financiero').style.display = 'flex';

                    } demás {

                        dom.chatMessages.style.display = 'bloque';

                        dom.inputArea.style.display = 'bloque';

                        dom.chatMessages.innerHTML = ''; 

                        chat.messages.forEach((msg, index) => addMessageToUI(msg.role, msg.content, msg.image, index, dom.chatMessages));

                        dom.initialMessageContainer.style.display = 'ninguno';

                    }



                    dom.chatTitle.textContent = chat.título;

                    dom.mobileChatTitle.textContent = chat.título;

                    dom.modelSelector.value = chat.model || 'gpt-3.5-turbo-1106';

                    updateContextualFooter(chat.workflow);

                }



                actualizarActiveChatHighlight(); 

                guardarEstado();

                si (ventana.anchointerior < 768) toggleSidebar(falso);

            }

            

            función resetChatView() { 

                currentChatId = nulo;

                dom.chatTitle.textContent = "Cabra IA";

                dom.mobileChatTitle.textContent = "Goatify IA";



                dom.chatMessages.style.display = 'bloque';

                dom.inputArea.style.display = 'bloque';

                dom.projectManagementView.style.display = 'ninguno';

                dom.financialAssistantView.style.display = 'ninguno';

                dom.notepadViewContainer.style.display = 'ninguno';



                dom.chatMessages.innerHTML = '';

                dom.initialMessageContainer.style.display = 'flex'; 

                actualizarUserUI(); 

                actualizarActiveChatHighlight(); 

                dom.modelSelector.value = 'gpt-3.5-turbo-1106';

                updateContextualFooter(nulo);

            }



            función addMessageToUI(rol, contenido, imageSrc, messageIndex, contenedor) {

                si (!contenedor) devuelve nulo;

                const wrapper = document.createElement('div');

                wrapper.className = `chat-bubble-wrapper grupo flex elementos-inicio gap-2 my-2 ${role === 'usuario' ? 'justificar-fin' : 'justificar-inicio'}`;

                

                constante burbuja = document.createElement('div');

                burbuja.className = `p-3 md:p-4 redondeado-xl máx.-w-lg md:máx.-w-xl ${role === 'usuario' ? 'chat-bubble-user' : 'chat-bubble-bot'}`;

                si (imagenOrigen) {

                    const img = document.createElement('img');

                    img.src = imageSrc;

                    img.className = 'redondeado-lg mb-2 max-w-full h-auto';

                    burbuja.appendChild(img);

                }

                const contentDiv = document.createElement('div');

                contentDiv.className = 'contenido-markdown';

                contentDiv.innerHTML = contenido === '…' ? `<div class="flex items-center space-x-2"><div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: .2s;"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: .4s;"></div></div>` : marked.parse(contenido || "");

                burbuja.appendChild(contentDiv);



                si (rol === 'usuario' y contenedor === dom.chatMessages) { 

                    const editBtn = document.createElement('botón');

                    editBtn.className = 'p-1 texto-texto-medio opacidad-100 opacidad-transición';

                    editBtn.innerHTML = '<i class="fas fa-pencil-alt fa-xs"></i>';

                    editBtn.title = 'Editar mensaje';

                    editBtn.onclick = (e) => { e.stopPropagation(); handleEditMessage(mensajeIndex); };

                    wrapper.insertBefore(editBtn, wrapper.firstChild);

                }

                

                si (rol === 'asistente' && /<\/?[az][\s\S]*>/i.test(contenido)) {

                    const previewButton = document.createElement('botón');

                    previewButton.innerHTML = '<i class="fas fa-eye mr-2"></i>Vista Previa';

                    previewButton.className = 'btn-primary texto-xs fuente-semibold px-3 py-1 redondeado-md mt-3';

                    previewButton.addEventListener('clic', () => {

                        constante match = contenido.match(/```html\n([\s\S]*?)```/);

                        const htmlToPreview = match ? match[1] : contenido;

                        dom.htmlPreviewIframe.srcdoc = htmlToPreview;

                         dom.htmlPreviewModal.classList.remove('oculto');

                        dom.htmlPreviewModal.classList.add('flex');

                    });

                    burbuja.appendChild(botonvistaprevia);

                }



                wrapper.appendChild(burbuja); 

                contenedor.appendChild(envoltorio);

                contenedor.scrollTop = contenedor.scrollHeight;

                burbuja de retorno;

            }

            

            función asíncrona handleEditMessage(índice) {

                const chat = estado.chats[currentChatId];

                si (!chat || !chat.messages[índice]) retorna;

                const originalContent = chat.messages[índice].content;

                const resultado = await showModal({ 

                    Título: 'Editar Mensaje', 

                    cuerpo: `<textarea id="edit-msg-textarea" class="w-full p-2 rounded bg-input border border-themed h-28">${originalContent}</textarea>`,

                    confirmText: 'Guardar Cambios'

                 });

                si (resultado.confirmado && resultado.datos['edit-msg-textarea'] && resultado.datos['edit-msg-textarea'].trim() !== originalContent.trim()) {

                    chat.messages[índice].contenido = resultado.datos['edit-msg-textarea'].trim();

                    esperar saveState();

                    selectChat(currentChatId);

                }

            }



            función updateMessageInUI(burbuja, contenido, imageSrc, contenedor) {

                const newBubble = addMessageToUI('asistente', contenido, imageSrc, null, contenedor);

                si (burbuja && burbuja.elementoparental) {

                    burbuja.elementoparental.reemplazarCon(nuevaBurbuja.elementoparental);

                }

            }

            

            función renderSidebar() { 

                dom.sidebarContent.innerHTML = '';

                const frag = documento.createDocumentFragment(); 

                (estado.estructura || []).forEach(id => { 

                    si (id.startsWith('proyecto-')) {

                        frag.appendChild(createProjectElement(id));

                    } de lo contrario si (id.startsWith('chat-')) {

                          frag.appendChild(createChatItemElement(id));

                    }

                });

                dom.sidebarContent.appendChild(fragmento); 

                actualizarActiveChatHighlight(); 

            }

            función createChatItemElement(id, isSubItem = false) { 

                const chat = estado.chats[id];

                si (!chat) devuelve documento.createDocumentFragment(); 

                constante item = document.createElement('div'); 

                item.className = `chat-item grupo flex items-center justificar-entre p-2 rounded-md cursor-pointer ${isSubItem ? 'pl-5' : ''}`; item.dataset.id = id; 

                si (isSelectModeActive) {

                    elemento.draggable = falso;

                    const isSelected = chatsToDelete.has(id);

                    elemento.innerHTML = `<i class="far ${isSelected ? 'fa-check-square' : 'fa-square'} mr-2 texto-primario"></i><span class="flex-grow truncate texto-sm fuente-media">${chat.title}</span>`;

                    si (isSelected) elemento.classList.add('seleccionado-para-eliminar');

                    elemento.addEventListener('clic', () => {

                        si (chatsToDelete.has(id)) {

                            chatsToDelete.delete(id);

                            elemento.querySelector('i').classList.replace('fa-check-square', 'fa-square');

                             item.classList.remove('seleccionado-para-eliminar');

                        } demás {

                            chatsToDelete.add(id);

                            item.querySelector('i').classList.replace('fa-cuadrado', 'fa-check-cuadrado');

                            item.classList.add('seleccionado-para-eliminar');

                        }

                        dom.deleteSelectedBtn.disabled = chatsToDelete.size === 0;

                    });

                } demás {

                    elemento.draggable = verdadero;

                    elemento.innerHTML = `<i class="far fa-comment-dots mr-2"></i><span class="flex-grow truncate text-sm font-medium">${chat.title}</span><div class="chat-item-actions flex-shrink-0"><button class="renombrar-btn texto-texto-medio hover:texto-primario p-1"><i class="fas fa-lápiz-alt fa-xs"></i></button><button class="eliminar-btn texto-texto-medio hover:texto-rojo-500 p-1"><i class="fas fa-papelera-alt fa-xs"></i></button></div>`;

                    elemento.addEventListener('clic', e => { if (!e.target.closest('.chat-item-actions')) selectChat(id); }); 

                    elemento.addEventListener('dragstart', e => handleDragStart(e, id)); elemento.querySelector('.rename-btn').addEventListener('click', () => renameItem('chat', id));

                    elemento.querySelector('.delete-btn').addEventListener('click', () => deleteItem('chat', id));

                }

                devolver artículo;

            }

            función createProjectElement(id) {

                const proyecto = estado.proyectos[id];

                si (!proyecto) devuelve documento.createDocumentFragment();

                const div = document.createElement('div'); div.className = 'proyecto'; div.dataset.id = id;

                const header = document.createElement('div');

                header.className = 'proyecto-encabezado grupo flex elementos-centro p-2 redondeado-md cursor-puntero';

                header.innerHTML = `<i class="fas fa-chevron-right project-arrow mr-2 transition-transform"></i><i class="fas fa-folder mr-2 text-yellow-500"></i><span class="flex-grow truncate text-sm font-bold">${proyecto.título}</span><div class="chat-item-actions flex-shrink-0"><button class="renombrar-btn texto-texto-medio hover:texto-primario p-1"><i class="fas fa-lápiz-alt fa-xs"></i></button><button class="eliminar-btn texto-texto-medio hover:texto-rojo-500 p-1"><i class="fas fa-papelera-alt fa-xs"></i></button></div>`;

                const content = document.createElement('div'); content.className = 'proyecto-contenido pl-2 pt-1 espacio-y-1';

                (proyecto.chatIds || []).forEach(chatId => content.appendChild(createChatItemElement(chatId, true)));

                div.append(encabezado, contenido);

                header.addEventListener('clic', e => { if (!e.target.closest('.chat-item-actions')) div.classList.toggle('abrir'); });

                cabezaer.addEventListener('dragstart', e => handleDragStart(e, id));
                header.querySelector('.rename-btn').addEventListener('click', (e) => { e.stopPropagation(); renameItem('project', id); });
                header.querySelector('.delete-btn').addEventListener('click', (e) => { e.stopPropagation(); deleteItem('project', id); });
                header.addEventListener('dragover', handleDragOver);
                header.addEventListener('dragleave', handleDragLeave);
                header.addEventListener('drop', e => handleDrop(e, id));
                return div;
            }

            function updateActiveChatHighlight() {
                document.querySelectorAll('.chat-item, .project-header').forEach(el => el.classList.remove('selected-chat'));
                if (currentChatId) {
                    const el = document.querySelector(`.chat-item[data-id="${currentChatId}"]`);
                    if (el) el.classList.add('selected-chat');
                }
            }

            let draggedItemId = null;
            function handleDragStart(e, id) {
                e.dataTransfer.effectAllowed = 'move';
                draggedItemId = id;
            }
            function handleDragOver(e) { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
            function handleDragLeave(e) { e.currentTarget.classList.remove('drag-over'); }
            function handleDrop(e, targetId) {
                e.preventDefault(); e.stopPropagation();
                e.currentTarget.classList.remove('drag-over');
                if (draggedItemId === targetId) return;

                const isTargetProject = targetId.startsWith('project-');
                const isDraggedProject = draggedItemId.startsWith('project-');

                if (isDraggedProject) return; // No se pueden meter proyectos en otros

                // Mover un chat a un proyecto
                if (isTargetProject) {
                    const project = state.projects[targetId];
                    const dragIndex = state.structure.indexOf(draggedItemId);
                    if (dragIndex > -1) state.structure.splice(dragIndex, 1);
                    Object.values(state.projects).forEach(p => {
                        const chatIndex = p.chatIds.indexOf(draggedItemId);
                        if (chatIndex > -1) p.chatIds.splice(chatIndex, 1);
                    });
                    if (!project.chatIds.includes(draggedItemId)) {
                        project.chatIds.unshift(draggedItemId);
                    }
                }
                saveState();
                renderSidebar();
            }
            
            async function renameItem(type, id) {
                const item = type === 'chat' ? state.chats[id] : state.projects[id];
                if (!item) return;
                const result = await showModal({
                    title: `Renombrar ${type === 'chat' ? 'Chat' : 'Carpeta'}`,
                    body: `<input id="rename-input" type="text" class="w-full p-2 rounded bg-input border border-themed" value="${item.title}">`,
                    confirmText: 'Guardar'
                });
                if (result.confirmed && result.data['rename-input']) {
                    item.title = result.data['rename-input'].trim();
                    selectChat(currentChatId); // Refresh title if it's the current one
                    renderSidebar();
                    saveState();
                }
            }

            async function deleteItem(type, id) {
                const item = type === 'chat' ? state.chats[id] : state.projects[id];
                if (!item) return;
                const result = await showModal({
          _message: async function sendMessage(isProjectChat = false, isFinancialChat = false) {
                const msgInput = isProjectChat ? dom.projectMsgInput : (isFinancialChat ? document.getElementById('financial-msg') : dom.msgInput);
                const sendBtn = isProjectChat ? dom.projectSendBtn : (isFinancialChat ? document.getElementById('financial-send') : dom.sendBtn);
                const messagesContainer = isProjectChat ? dom.projectChatMessages : (isFinancialChat ? document.getElementById('financial-chat-messages') : dom.chatMessages);
                
                const prompt = msgInput.value.trim();
                if (!prompt && !selectedImageBase64) return;
                sendBtn.disabled = true;

                const cost = 1; // Simplificamos el costo por ahora
                if (!spendCredits(cost)) {
                    sendBtn.disabled = false;
                    return;
                }

                if (!currentChatId || state.chats[currentChatId].workflow === 'project-management' || state.chats[currentChatId].workflow === 'financial-assistant') {
                    if (!isProjectChat && !isFinancialChat) {
                        createNewChat();
                    }
                }

                const chat = state.chats[currentChatId];
                const messageIndex = chat.messages.length;
                chat.messages.push({ role: 'user', content: prompt, image: selectedImageBase64 });
                addMessageToUI('user', prompt, selectedImageBase64, messageIndex, messagesContainer);

                msgInput.value = '';
                const imageForBackend = selectedImageBase64;
                clearFileSelection();

                const thinkingBubble = addMessageToUI('assistant', '…', null, null, messagesContainer);
                try {
                    const history = chat.messages.slice(0, -1).map(m => ({ role: m.role, content: m.content }));
                    const model = getModelForRequest(chat.workflow, !!imageForBackend || !!selectedPdfText, isProjectChat, isFinancialChat);
                    const userName = currentUser?.user_metadata?.full_name || 'Invitado';
                    const financialData = isFinancialChat ? chat.financialData : null;

                    const { content, image_url, projectData, financialData: updatedFinancialData } = await getAIResponse(prompt, history, imageForBackend, selectedPdfText, model, chat.workflow, userName, financialData);

                    chat.messages.push({ role: 'assistant', content, image: image_url });
                    if (projectData) {
                        Object.assign(chat.projectData, projectData);
                        renderProjectView(currentChatId);
                    }
                    if (updatedFinancialData) {
                        chat.financialData = updatedFinancialData;
                        renderFinancialAssistant(currentChatId);
                    }

                    thinkingBubble.parentElement.remove();
                    addMessageToUI('assistant', content, image_url, null, messagesContainer);
                    speak(content);
                    saveState();
                } catch (error) {
                    console.error("Error sending message:", error);
                    thinkingBubble.parentElement.remove();
                    addMessageToUI('assistant', `Error: ${error.message}`, null, null, messagesContainer);
                } finally {
                    sendBtn.disabled = false;
                }
            }
            
            function clearFileSelection() {
                selectedImageBase64 = null;
                selectedPdfText = null;
                dom.imagePreviewContainer.classList.add('hidden');
                dom.pdfPreviewContainer.classList.add('hidden');
                dom.imageUploadInput.value = '';
                dom.pdfUploadInput.value = '';
                dom.filePreviewArea.style.display = 'none';
            }

            // --- Initialization and Event Listeners ---
            function addEventListeners() {
                dom.sendBtn.addEventListener('click', () => sendMessage());
                dom.msgInput.addEventListener('keydown', e => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
                dom.projectSendBtn.addEventListener('click', () => sendMessage(true));
                dom.projectMsgInput.addEventListener('keydown', e => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage(true);
                    }
                });
                
                dom.newChatBtn.addEventListener('click', () => createNewChat());
                dom.newChatIconBtn.addEventListener('click', () => createNewChat());
                dom.themeToggle.addEventListener('click', () => setTheme(!document.body.classList.contains('dark-theme')));
                dom.menuToggle.addEventListener('click', () => toggleSidebar(true));
                dom.sidebarOverlay.addEventListener('click', () => toggleSidebar(false));
                dom.loginBtn.addEventListener('click', () => netlifyIdentity.open('login'));
                dom.logoutBtn.addEventListener('click', () => netlifyIdentity.logout());
                
                // Modals
                dom.upgradePlanBtn.addEventListener('click', showPricingModal);
                dom.settingsUpgradePlanBtn.addEventListener('click', showPricingModal);
                dom.closePricingModalBtn.addEventListener('click', hidePricingModal);
                dom.settingsBtn.addEventListener('click', showSettingsModal);
                dom.closeSettingsModal.addEventListener('click', hideSettingsModal);
                dom.calendarBtn.addEventListener('click', showCalendarModal);
                dom.closeCalendarModal.addEventListener('click', hideCalendarModal);
                dom.closeHtmlPreviewModalBtn.addEventListener('click', () => {
                    dom.htmlPreviewModal.classList.add('hidden');
                    dom.htmlPreviewModal.classList.remove('flex');
                });
                
                // File Uploads
                dom.imageUploadBtn.addEventListener('click', () => dom.imageUploadInput.click());
                dom.pdfUploadBtn.addEventListener('click', () => dom.pdfUploadInput.click());
                dom.clearImageBtn.addEventListener('click', clearFileSelection);
                dom.clearPdfBtn.addEventListener('click', clearFileSelection);

                // User Menu
                dom.userMenuBtn.addEventListener('click', () => dom.userMenuPopup.classList.toggle('hidden'));
                document.addEventListener('click', (e) => {
                    if (!dom.userMenuView.contains(e.target)) dom.userMenuPopup.classList.add('hidden');
                    if (!dom.servicesMenuBtn.contains(e.target) && !dom.servicesMenu.contains(e.target)) dom.servicesMenu.classList.remove('show');
                });

                dom.imageUploadInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            selectedImageBase64 = e.target.result;
                            dom.imagePreview.src = selectedImageBase64;
                            dom.imagePreviewContainer.classList.remove('hidden');
                            dom.filePreviewArea.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });
                
                // Workflows
                document.querySelectorAll('[data-workflow]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const workflowKey = btn.dataset.workflow;
                        const chat = state.chats[currentChatId];
                        if(chat && chat.messages.length <=1) {
                            chat.workflow = workflowKey;
                            selectChat(currentChatId);
                        } else {
                            createNewChat({ workflow: workflowKey, title: btn.textContent.trim() });
                        }
                    });
                });
                
                document.querySelectorAll('.workflow-header').forEach(header => {
                    header.addEventListener('click', (e) => {
                        const category = header.parentElement;
                        if (category.classList.contains('workflow-category')) {
                            category.classList.toggle('open');
                        }
                    });
                });

                // Settings
                dom.fontSizeSlider.addEventListener('input', e => {
                    const size = e.target.value;
                    document.body.style.setProperty('--base-font-size', `${size}px`);
                    dom.fontSizeValue.textContent = `${size}px`;
                    localStorage.setItem('fontSize', size);
                });
                dom.languageSelector.addEventListener('change', e => setLanguage(e.target.value));

                // Calendar
                dom.prevMonthBtn.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.subtract(1, 'month'); renderCalendarView(); });
                dom.nextMonthBtn.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.add(1, 'month'); renderCalendarView(); });
                dom.prevWeekBtn.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.subtract(1, 'week'); renderCalendarView(); });
                dom.nextWeekBtn.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.add(1, 'week'); renderCalendarView(); });
                dom.prevDayBtn.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.subtract(1, 'day'); renderCalendarView(); });
                dom.nextDayBtn.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.add(1, 'day'); renderCalendarView(); });
                dom.monthViewBtn.addEventListener('click', () => { currentCalendarView = 'month'; renderCalendarView(); });
                dom.weekViewBtn.addEventListener('click', () => { currentCalendarView = 'week'; renderCalendarView(); });
                dom.dayViewBtn.addEventListener('click', () => { currentCalendarView = 'day'; renderCalendarView(); });
                dom.addTaskBtn.addEventListener('click', () => editCalendarTask(null, selectedCalendarDate.format('YYYY-MM-DD')));

            }

            function init() {
                const savedTheme = localStorage.getItem('theme');
                setTheme(savedTheme ? savedTheme === 'dark' : true);

                const savedFontSize = localStorage.getItem('fontSize');
                if (savedFontSize) {
                    document.body.style.setProperty('--base-font-size', `${savedFontSize}px`);
                }

                const savedLang = localStorage.getItem('goatify-lang') || 'es';
                setLanguage(savedLang);

                addEventListeners();
                populateVoiceList();

                netlifyIdentity.on('init', user => {
                    currentUser = user;
                    loadStateForUser();
                    updateUserUI();
                    setTimeout(() => {
                        dom.loadingOverlay.style.opacity = '0';
                        dom.appContainer.style.opacity = '1';
                        setTimeout(() => dom.loadingOverlay.style.display = 'none', 300);
                    }, 500);
                });
                netlifyIdentity.on('login', user => {
                    currentUser = user;
                    loadStateForUser();
                    updateUserUI();
                    netlifyIdentity.close();
                });
                netlifyIdentity.on('logout', () => {
                    currentUser = null;
                    loadStateForUser();
                    updateUserUI();
                });

            }

            init();

        });
        //<-- END OF SCRIPT -->
    </script>
</body>
</html>
