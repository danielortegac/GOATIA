ok tew falto un poc de codigo comleta porfa solo dame lo q falta twngo hasta aqui : <!DOCTYPE html>

<html lang="es">

<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

Â  Â  <title>Goatify IA</title>

Â  Â  <link rel="icon" type="image/png" href="./Logos HD.png">

Â  Â  <script src="https://cdn.tailwindcss.com"></script>

Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

Â  Â  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">

Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/dayjs.min.js"></script>

Â  Â  <script src="https://npmcdn.com/dayjs@1.10.7/locale/es.js"></script>

Â  Â  <script src="https://npmcdn.com/dayjs@1.10.7/plugin/localizedFormat.js"></script>

Â  Â  <script src="https://npmcdn.com/dayjs@1.10.7/plugin/isoWeek.js"></script>

Â  Â Â 

Â  Â  <style>

Â  Â  Â  Â  :root {

Â  Â  Â  Â  Â  Â  --bg-dark: #121212;

Â  Â  Â  Â  Â  Â  --bg-medium: #1e1e1e;

Â  Â  Â  Â  Â  Â  --bg-light: #2c2c2c;

Â  Â  Â  Â  Â  Â  --primary: #8a4fff;

Â  Â  Â  Â  Â  Â  --primary-hover: #7b46e6;

Â  Â  Â  Â  Â  Â  --text-light: #e0e0e0;

Â  Â  Â  Â  Â  Â  --text-medium: #b3b3b3;

Â  Â  Â  Â  Â  Â  --border-color: #3a3a3a;

Â  Â  Â  Â  Â  Â  --gold-color: #FFD700;

Â  Â  Â  Â  Â  Â  --urgent-color: #ef4444;



Â  Â  Â  Â  Â  Â  --light-bg-dark: #f7f7f8;

Â  Â  Â  Â  Â  Â  --light-bg-medium: #ffffff;

Â  Â  Â  Â  Â  Â  --light-bg-light: #f0f0f0;

Â  Â  Â  Â  Â  Â  --light-primary: #7c40e6;

Â  Â  Â  Â  Â  Â  --light-primary-hover: #6a37d3;

Â  Â  Â  Â  Â  Â  --light-text-dark: #1f2937;

Â  Â  Â  Â  Â  Â  --light-text-medium: #6b7280;

Â  Â  Â  Â  Â  Â  --light-border-color: #e5e7eb;



Â  Â  Â  Â  Â  Â  --base-font-size: 16px;

Â  Â  Â  Â  }



Â  Â  Â  Â  html,

Â  Â  Â  Â  body {

Â  Â  Â  Â  Â  Â  height: 100%;

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  overflow: hidden;

Â  Â  Â  Â  }



Â  Â  Â  Â  body {

Â  Â  Â  Â  Â  Â  font-family: 'Montserrat', sans-serif;

Â  Â  Â  Â  Â  Â  transition: background-color 0.3s ease, color 0.3s ease;

Â  Â  Â  Â  Â  Â  font-size: var(--base-font-size);

Â  Â  Â  Â  }



Â  Â  Â  Â  .dark-theme {

Â  Â  Â  Â  Â  Â  --current-bg-dark: var(--bg-dark);

Â  Â  Â  Â  Â  Â  --current-bg-medium: var(--bg-medium);

Â  Â  Â  Â  Â  Â  --current-bg-light: var(--bg-light);

Â  Â  Â  Â  Â  Â  --current-primary: var(--primary);

Â  Â  Â  Â  Â  Â  --current-primary-hover: var(--primary-hover);

Â  Â  Â  Â  Â  Â  --current-text-light: var(--text-light);

Â  Â  Â  Â  Â  Â  --current-text-medium: var(--text-medium);

Â  Â  Â  Â  Â  Â  --current-border-color: var(--border-color);

Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-dark);

Â  Â  Â  Â  Â  Â  color: var(--text-light);

Â  Â  Â  Â  }



Â  Â  Â  Â  .light-theme {

Â  Â  Â  Â  Â  Â  --current-bg-dark: var(--light-bg-dark);

Â  Â  Â  Â  Â  Â  --current-bg-medium: var(--light-bg-medium);

Â  Â  Â  Â  Â  Â  --current-bg-light: var(--light-bg-light);

Â  Â  Â  Â  Â  Â  --current-primary: var(--light-primary);

Â  Â  Â  Â  Â  Â  --current-primary-hover: var(--light-primary-hover);

Â  Â  Â  Â  Â  Â  --current-text-light: var(--light-text-dark);

Â  Â  Â  Â  Â  Â  --current-text-medium: var(--light-text-medium);

Â  Â  Â  Â  Â  Â  --current-border-color: var(--light-border-color);

Â  Â  Â  Â  Â  Â  background-color: var(--light-bg-dark);

Â  Â  Â  Â  Â  Â  color: var(--light-text-dark);

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  #sidebar { background-color: var(--current-bg-dark); border-right: 1px solid var(--current-border-color); width: 18rem; height: 100vh; transition: transform 0.3s ease; z-index: 40; }

Â  Â  Â  Â  #sidebar.collapsed { width: 0; padding: 0; overflow: hidden; border-right: none;}

Â  Â  Â  Â  #sidebar.collapsed > * { display: none; }



Â  Â  Â  Â  @media (max-width: 767px) {

Â  Â  Â  Â  Â  Â  #sidebar {

Â  Â  Â  Â  Â  Â  Â  Â  transform: translateX(-100%);

Â  Â  Â  Â  Â  Â  Â  Â  position: fixed; /* Changed to fixed for proper layering */

Â  Â  Â  Â  Â  Â  Â  Â  top: 0;

Â  Â  Â  Â  Â  Â  Â  Â  left: 0;

Â  Â  Â  Â  Â  Â  Â  Â  height: 100vh; /* Ensure full height */

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #sidebar.is-open {

Â  Â  Â  Â  Â  Â  Â  Â  transform: translateX(0);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #app-container {

Â  Â  Â  Â  Â  Â  Â  Â  overflow: hidden; /* Prevent main content from scrolling when sidebar is open */

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }





Â  Â  Â  Â  #main-chat-area, .modal-content { background-color: var(--current-bg-medium); }

Â  Â  Â  Â  .chat-bubble-bot, .bg-input, #pdf-preview-container, .chat-item, .project-header, #user-menu-popup, #services-menu, .pro-controls-bg { background-color: var(--current-bg-light); }

Â  Â  Â  Â  .border-themed { border-color: var(--current-border-color); }

Â  Â  Â  Â  .chat-bubble-user { background-color: var(--current-primary); color: white; }

Â  Â  Â  Â  .btn-primary { background-color: var(--current-primary); color: white; }

Â  Â  Â  Â  .btn-primary:hover { background-color: var(--current-primary-hover); }

Â  Â  Â  Â  .plan-card-highlight { border-color: var(--current-primary); box-shadow: 0 0 15px rgba(138, 79, 255, 0.3); }

Â  Â  Â  Â  .placeholder-themed::placeholder { color: var(--current-text-medium); }

Â  Â  Â  Â  .text-primary { color: var(--current-primary); }

Â  Â  Â  Â  .glowing-mic { animation: pulse 1.5s infinite; color: var(--primary) !important; }



Â  Â  Â  Â  @keyframes pulse {

Â  Â  Â  Â  Â  Â  0% { box-shadow: 0 0 0 0 rgba(138, 79, 255, 0.7); }

Â  Â  Â  Â  Â  Â  70% { box-shadow: 0 0 0 10px rgba(138, 79, 255, 0); }

Â  Â  Â  Â  Â  Â  100% { box-shadow: 0 0 0 0 rgba(138, 79, 255, 0); }

Â  Â  Â  Â  }



Â  Â  Â  Â  .project .project-content { display: none; }

Â  Â  Â  Â  .project.open .project-content { display: block; }

Â  Â  Â  Â  .project.open .project-arrow { transform: rotate(90deg); }

Â  Â  Â  Â  .project-header.drag-over { background-color: var(--current-primary); }

Â  Â  Â  Â  #sidebar-overlay { transition: opacity 0.3s ease-in-out; }

Â  Â  Â  Â  #app-container { height: 100vh; height: -webkit-fill-available; }

Â  Â  Â  Â  #pricing-modal .modal-content-body { max-height: 80vh; overflow-y: auto; }

Â  Â  Â  Â  .chat-item.selected-for-delete { background-color: var(--primary) !important; color: white; }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .model-selector-wrapper {

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  Â  Â  display: inline-flex;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  }



Â  Â  Â  Â  .model-selector-wrapper select {

Â  Â  Â  Â  Â  Â  -webkit-appearance: none;

Â  Â  Â  Â  Â  Â  -moz-appearance: none;

Â  Â  Â  Â  Â  Â  appearance: none;

Â  Â  Â  Â  Â  Â  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='var(--current-text-light)' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");

Â  Â  Â  Â  Â  Â  background-position: right 0.5rem center;

Â  Â  Â  Â  Â  Â  background-repeat: no-repeat;

Â  Â  Â  Â  Â  Â  background-size: 1.5em 1.5em;

Â  Â  Â  Â  Â  Â  padding-right: 2.5rem;

Â  Â  Â  Â  Â  Â  height: 32px;

Â  Â  Â  Â  Â  Â  font-size: 0.875rem;

Â  Â  Â  Â  Â  Â  line-height: 1.25rem;

Â  Â  Â  Â  Â  Â  border: none;

Â  Â  Â  Â  Â  Â  outline: none;

Â  Â  Â  Â  Â  Â  cursor: pointer;

Â  Â  Â  Â  Â  Â  min-width: 120px;

Â  Â  Â  Â  Â  Â  background-color: transparent;

Â  Â  Â  Â  }



Â  Â  Â  Â  .pro-controls-bg {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  justify-content: space-between;

Â  Â  Â  Â  Â  Â  padding: 0.375rem;

Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;

Â  Â  Â  Â  Â  Â  overflow: hidden;Â 

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  gap: 0.5rem;

Â  Â  Â  Â  }



Â  Â  Â  Â  #pro-controls-left, #pro-controls-right {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  gap: 0.5rem;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  #pro-controls-left {

Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  Â  Â  min-width: 0;

Â  Â  Â  Â  }



Â  Â  Â  Â  #pro-controls-right {

Â  Â  Â  Â  Â  Â  flex-shrink: 0;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 



Â  Â  Â  Â  .workflow-content { display: none; }

Â  Â  Â  Â  .workflow-category.open .workflow-content { display: block; }

Â  Â  Â  Â  .workflow-category.open .workflow-arrow { transform: rotate(90deg); }

Â  Â  Â  Â  .plan-card { background-color: var(--current-bg-light); }

Â  Â  Â  Â  #pdf-preview-container { padding: 0.5rem; }

Â  Â  Â  Â Â 

Â  Â  Â  Â  @keyframes sweep {

Â  Â  Â  Â  Â  Â  0% { transform: translateX(-100%) skewX(-15deg); }

Â  Â  Â  Â  Â  Â  100% { transform: translateX(200%) skewX(-15deg); }

Â  Â  Â  Â  }

Â  Â  Â  Â  .cool-light-effect { position: relative; overflow: hidden; }

Â  Â  Â  Â  .cool-light-effect::before {

Â  Â  Â  Â  Â  Â  content: '';

Â  Â  Â  Â  Â  Â  position: absolute; top: 0; left: 0; width: 50%; height: 100%;

Â  Â  Â  Â  Â  Â  background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(138, 79, 255, 0.25) 50%, rgba(255,255,255,0) 100%);

Â  Â  Â  Â  Â  Â  transform: translateX(-150%) skewX(-15deg); transition: transform 0.8s ease;

Â  Â  Â  Â  Â  Â  pointer-events: none;

Â  Â  Â  Â  }

Â  Â  Â  Â  .cool-light-effect:hover::before { animation: sweep 2s infinite linear; }



Â  Â  Â  Â  .input-wrapper { border: 2px solid transparent; transition: box-shadow 0.3s ease, border-color 0.3s ease; }

Â  Â  Â  Â  .input-wrapper:focus-within { box-shadow: 0 0 10px 0px rgba(138, 79, 255, 0.5); border-color: var(--current-primary-hover); }



Â  Â  Â  Â  #chat-title {

Â  Â  Â  Â  Â  Â  color: var(--primary);

Â  Â  Â  Â  Â  Â  font-weight: 700;

Â  Â  Â  Â  Â  Â  transition: color 0.3s ease;

Â  Â  Â  Â  }

Â  Â  Â  Â  #chat-title-wrapper:hover #chat-title {

Â  Â  Â  Â  Â  Â  color: var(--primary-hover);

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  #chat-title-wrapper {

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  Â  Â  padding-left: 24px;

Â  Â  Â  Â  }

Â  Â  Â  Â  #chat-title-wrapper .edit-icon,

Â  Â  Â  Â  #mobile-chat-title-wrapper .edit-icon {

Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  left: 0;

Â  Â  Â  Â  Â  Â  top: 50%;

Â  Â  Â  Â  Â  Â  transform: translateY(-50%);

Â  Â  Â  Â  Â  Â  opacity: 1;

Â  Â  Â  Â  Â  Â  transition: transform 0.2s ease;

Â  Â  Â  Â  }

Â  Â  Â  Â  #chat-title-wrapper:hover .edit-icon,

Â  Â  Â  Â  #mobile-chat-title-wrapper:hover .edit-icon {

Â  Â  Â  Â  Â  Â  transform: translateY(-50%) scale(1.1);

Â  Â  Â  Â  }



Â  Â  Â  Â  .btn-disabled { background-color: #3a3a3a !important; color: #888 !important; cursor: not-allowed !important; border-color: #3a3a3a !important;}



Â  Â  Â  Â  .chat-item.selected-chat {

Â  Â  Â  Â  Â  Â  background-color: var(--current-primary);

Â  Â  Â  Â  Â  Â  color: white !important;

Â  Â  Â  Â  }

Â  Â  Â  Â  .chat-item.selected-chat .text-sm {

Â  Â  Â  Â  Â  Â  color: white !important;

Â  Â  Â  Â  }

Â  Â  Â  Â  .light-theme .chat-item {

Â  Â  Â  Â  Â  Â  color: var(--light-text-dark);

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  #services-menu {

Â  Â  Â  Â  Â  Â  transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s;

Â  Â  Â  Â  Â  Â  visibility: hidden;

Â  Â  Â  Â  Â  Â  opacity: 0;

Â  Â  Â  Â  Â  Â  transform: scale(0.95) translateY(-10px);

Â  Â  Â  Â  }

Â  Â  Â  Â  #services-menu.show {

Â  Â  Â  Â  Â  Â  visibility: visible;

Â  Â  Â  Â  Â  Â  opacity: 1;

Â  Â  Â  Â  Â  Â  transform: scale(1) translateY(0);

Â  Â  Â  Â  Â  Â  pointer-events: auto;

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Calendar styles */

Â  Â  Â  Â  .calendar-grid {

Â  Â  Â  Â  Â  Â  display: grid;

Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(7, 1fr);

Â  Â  Â  Â  Â  Â  gap: 5px;

Â  Â  Â  Â  Â  Â  text-align: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-day {

Â  Â  Â  Â  Â  Â  padding: 2px;

Â  Â  Â  Â  Â  Â  border-radius: 4px;

Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-medium);

Â  Â  Â  Â  Â  Â  cursor: pointer;

Â  Â  Â  Â  Â  Â  transition: background-color 0.2s ease, border 0.2s ease;

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  Â  Â  border: 2px solid transparent;

Â  Â  Â  Â  Â  Â  min-height: 90px;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  Â  Â  align-items: flex-start;

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-day-number {

Â  Â  Â  Â  Â  Â  font-weight: bold;

Â  Â  Â  Â  Â  Â  font-size: 0.8rem;

Â  Â  Â  Â  Â  Â  margin: 4px;

Â  Â  Â  Â  Â  Â  align-self: flex-start;

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-day-tasks {

Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  overflow: hidden;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  Â  Â  gap: 2px;

Â  Â  Â  Â  Â  Â  padding: 0 2px 2px 2px;

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-day-task {

Â  Â  Â  Â  Â  Â  font-size: 0.65rem;

Â  Â  Â  Â  Â  Â  padding: 2px 4px;

Â  Â  Â  Â  Â  Â  border-radius: 4px;

Â  Â  Â  Â  Â  Â  color: white;

Â  Â  Â  Â  Â  Â  white-space: nowrap;

Â  Â  Â  Â  Â  Â  overflow: hidden;

Â  Â  Â  Â  Â  Â  text-overflow: ellipsis;

Â  Â  Â  Â  Â  Â  text-align: left;

Â  Â  Â  Â  Â  Â  position: relative; /* For delete button */

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-day:hover {

Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-light);

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-day.current-month {

Â  Â  Â  Â  Â  Â  color: var(--current-text-light);

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-day.other-month {

Â  Â  Â  Â  Â  Â  color: var(--current-text-medium);

Â  Â  Â  Â  Â  Â  opacity: 0.5;

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-day.today .calendar-day-number {

Â  Â  Â  Â  Â  Â  background-color: var(--primary);

Â  Â  Â  Â  Â  Â  color: white;

Â  Â  Â  Â  Â  Â  border-radius: 50%;

Â  Â  Â  Â  Â  Â  width: 24px;

Â  Â  Â  Â  Â  Â  height: 24px;

Â  Â  Â  Â  Â  Â  display: inline-flex;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  justify-content: center;

Â  Â  Â  Â  Â  Â  margin: 2px;

Â  Â  Â  Â  }

Â  Â  Â  Â  .task-dots-container {

Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  bottom: 4px;

Â  Â  Â  Â  Â  Â  left: 50%;

Â  Â  Â  Â  Â  Â  transform: translateX(-50%);

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  gap: 2px;

Â  Â  Â  Â  }

Â  Â  Â  Â  .task-dot {

Â  Â  Â  Â  Â  Â  width: 5px;

Â  Â  Â  Â  Â  Â  height: 5px;

Â  Â  Â  Â  Â  Â  border-radius: 50%;

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-header {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  justify-content: space-between;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  margin-bottom: 10px;

Â  Â  Â  Â  }

Â  Â  Â  Â  .task-item-completed {

Â  Â  Â  Â  Â  Â  text-decoration: line-through;

Â  Â  Â  Â  Â  Â  opacity: 0.6;

Â  Â  Â  Â  }

Â  Â  Â  Â  .notification-bell-icon {

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  }

Â  Â  Â  Â  .notification-badge {

Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  top: -5px;

Â  Â  Â  Â  Â  Â  right: -5px;

Â  Â  Â  Â  Â  Â  background-color: red;

Â  Â  Â  Â  Â  Â  color: white;

Â  Â  Â  Â  Â  Â  border-radius: 50%;

Â  Â  Â  Â  Â  Â  padding: 2px 6px;

Â  Â  Â  Â  Â  Â  font-size: 0.7em;

Â  Â  Â  Â  Â  Â  line-height: 1;

Â  Â  Â  Â  Â  Â  min-width: 18px;

Â  Â  Â  Â  Â  Â  text-align: center;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .calendar-view-toggle, .project-view-controls {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  gap: 0.5rem;

Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-dark);

Â  Â  Â  Â  Â  Â  padding: 0.25rem;

Â  Â  Â  Â  Â  Â  border-radius: 8px;

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  }



Â  Â  Â  Â  .calendar-view-toggle button, .project-view-controls button {

Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  Â  Â  padding: 8px 12px;

Â  Â  Â  Â  Â  Â  border-radius: 6px;

Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-light);

Â  Â  Â  Â  Â  Â  color: var(--current-text-light);

Â  Â  Â  Â  Â  Â  font-weight: 600;

Â  Â  Â  Â  Â  Â  transition: background-color 0.2s ease, box-shadow 0.2s ease, color 0.2s ease;

Â  Â  Â  Â  Â  Â  white-space: nowrap; /* Prevents text wrapping */

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-view-toggle button.active, .project-view-controls button.active {

Â  Â  Â  Â  Â  Â  background-color: var(--current-primary);

Â  Â  Â  Â  Â  Â  color: white;

Â  Â  Â  Â  Â  Â  box-shadow: 0 0 8px rgba(138, 79, 255, 0.4);

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-view-toggle button:hover:not(.active), .project-view-controls button:hover:not(.active) {

Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-medium);

Â  Â  Â  Â  }

Â  Â  Â  Â  .dark-theme .project-view-controls button:not(.active) {

Â  Â  Â  Â  Â  Â  color: var(--current-text-light);

Â  Â  Â  Â  }

Â  Â  Â  Â  .light-theme .project-view-controls button:not(.active) {

Â  Â  Â  Â  Â  Â  color: var(--current-text-dark);

Â  Â  Â  Â  }



Â  Â  Â  Â  #month-view-container, #day-view-container {

Â  Â  Â  Â  Â  Â  display: block;

Â  Â  Â  Â  }

Â  Â  Â  Â  #week-view-container, #day-view-container {

Â  Â  Â  Â  Â  Â  display: none;

Â  Â  Â  Â  }

Â  Â  Â  Â  #week-view-container, #day-view-container {

Â  Â  Â  Â  Â  Â  max-height: 400px;

Â  Â  Â  Â  Â  Â  overflow-y: auto;

Â  Â  Â  Â  Â  Â  border: 1px solid var(--current-border-color);

Â  Â  Â  Â  Â  Â  border-radius: 8px;

Â  Â  Â  Â  Â  Â  padding: 10px;

Â  Â  Â  Â  }

Â  Â  Â  Â  .week-day-section {

Â  Â  Â  Â  Â  Â  margin-bottom: 15px;

Â  Â  Â  Â  Â  Â  padding-bottom: 10px;

Â  Â  Â  Â  Â  Â  border-bottom: 1px dashed var(--current-border-color);

Â  Â  Â  Â  }

Â  Â  Â  Â  .week-day-section:last-child {

Â  Â  Â  Â  Â  Â  border-bottom: none;

Â  Â  Â  Â  Â  Â  margin-bottom: 0;

Â  Â  Â  Â  Â  Â  padding-bottom: 0;

Â  Â  Â  Â  }

Â  Â  Â  Â  .week-day-section h5 {

Â  Â  Â  Â  Â  Â  font-weight: 700;

Â  Â  Â  Â  Â  Â  color: var(--current-primary);

Â  Â  Â  Â  Â  Â  margin-bottom: 5px;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  justify-content: space-between;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  .week-day-section .task-item {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  gap: 5px;

Â  Â  Â  Â  Â  Â  padding: 5px 0;

Â  Â  Â  Â  Â  Â  position: relative; /* For delete button */

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .day-view-timeline {

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  }

Â  Â  Â  Â  .day-view-hour {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  border-top: 1px solid var(--current-border-color);

Â  Â  Â  Â  }

Â  Â  Â  Â  .day-view-hour-label {

Â  Â  Â  Â  Â  Â  width: 60px;

Â  Â  Â  Â  Â  Â  flex-shrink: 0;

Â  Â  Â  Â  Â  Â  text-align: right;

Â  Â  Â  Â  Â  Â  padding-right: 10px;

Â  Â  Â  Â  Â  Â  font-size: 0.75rem;

Â  Â  Â  Â  Â  Â  color: var(--current-text-medium);

Â  Â  Â  Â  }

Â  Â  Â  Â  .day-view-hour-content {

Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  Â  Â  border-left: 1px solid var(--current-border-color);

Â  Â  Â  Â  Â  Â  padding: 5px;

Â  Â  Â  Â  Â  Â  min-height: 40px;

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  }

Â  Â  Â  Â  .add-task-to-time-btn {

Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  right: 5px;

Â  Â  Â  Â  Â  Â  top: 5px;

Â  Â  Â  Â  Â  Â  opacity: 0;

Â  Â  Â  Â  Â  Â  transition: opacity 0.2s ease;

Â  Â  Â  Â  }

Â  Â  Â  Â  .day-view-hour-content:hover .add-task-to-time-btn {

Â  Â  Â  Â  Â  Â  opacity: 1;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* Delete Task Button Style */

Â  Â  Â  Â  .delete-task-btn {

Â  Â  Â  Â  Â  Â  display: none;

Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  right: -2px;

Â  Â  Â  Â  Â  Â  top: 50%;

Â  Â  Â  Â  Â  Â  transform: translateY(-50%);

Â  Â  Â  Â  Â  Â  background-color: var(--urgent-color);

Â  Â  Â  Â  Â  Â  color: white;

Â  Â  Â  Â  Â  Â  border: none;

Â  Â  Â  Â  Â  Â  border-radius: 50%;

Â  Â  Â  Â  Â  Â  width: 18px;

Â  Â  Â  Â  Â  Â  height: 18px;

Â  Â  Â  Â  Â  Â  font-size: 12px;

Â  Â  Â  Â  Â  Â  line-height: 18px;

Â  Â  Â  Â  Â  Â  text-align: center;

Â  Â  Â  Â  Â  Â  cursor: pointer;

Â  Â  Â  Â  Â  Â  z-index: 10;

Â  Â  Â  Â  }

Â  Â  Â  Â  .task-item:hover .delete-task-btn,

Â  Â  Â  Â  .kanban-card:hover .delete-task-btn,

Â  Â  Â  Â  .list-view-task:hover .delete-task-btn,

Â  Â  Â  Â  .list-view-task-mobile:hover .delete-task-btn {

Â  Â  Â  Â  Â  Â  display: inline-flex;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  justify-content: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  .kanban-card .delete-task-btn {

Â  Â  Â  Â  Â  Â  right: 5px;

Â  Â  Â  Â  Â  Â  top: 5px;

Â  Â  Â  Â  Â  Â  transform: none;

Â  Â  Â  Â  }

Â  Â  Â  Â  .list-view-task .delete-task-btn {

Â  Â  Â  Â  Â  Â  Â display: inline-flex;

Â  Â  Â  Â  Â  Â  Â position: static;

Â  Â  Â  Â  Â  Â  Â transform: none;

Â  Â  Â  Â  }

Â  Â  Â  Â  .list-view-task:hover .delete-task-btn-wrapper {

Â  Â  Â  Â  Â  Â  opacity: 1;

Â  Â  Â  Â  }

Â  Â  Â  Â  .calendar-day-task:hover .delete-task-btn {

Â  Â  Â  Â  Â  Â  Â display: inline-flex;

Â  Â  Â  Â  Â  Â  Â right: 2px;

Â  Â  Â  Â  Â  Â  Â top: 2px;

Â  Â  Â  Â  Â  Â  Â transform: none;

Â  Â  Â  Â  }





Â  Â  Â  Â  /* Project Management View Styles */

Â  Â  Â  Â  #project-management-view {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  flex-direction: column; /* Mobile-first: stacked */

Â  Â  Â  Â  Â  Â  gap: 1rem;

Â  Â  Â  Â  Â  Â  height: 100%;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  #project-board-container {

Â  Â  Â  Â  Â  Â  flex: 1; /* Take up available space */

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  Â  Â  overflow: hidden;

Â  Â  Â  Â  Â  Â  min-height: 0; /* Fix for flexbox overflow */

Â  Â  Â  Â  }

Â  Â  Â  Â  #project-chat-container {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  Â  Â  border-top: 1px solid var(--current-border-color);

Â  Â  Â  Â  Â  Â  padding-top: 1rem;

Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;

Â  Â  Â  Â  Â  Â  flex-shrink: 0;

Â  Â  Â  Â  }

Â  Â  Â  Â  #project-chat-container.collapsed {

Â  Â  Â  Â  Â  Â  flex-grow: 0;

Â  Â  Â  Â  Â  Â  flex-basis: auto;

Â  Â  Â  Â  Â  Â  height: 50px !important;

Â  Â  Â  Â  }

Â  Â  Â  Â  #project-chat-container.collapsed .project-chat-body {

Â  Â  Â  Â  Â  Â  display: none;

Â  Â  Â  Â  }

Â  Â  Â  Â  #project-chat-toggle i {

Â  Â  Â  Â  Â  Â  transition: transform 0.3s ease;

Â  Â  Â  Â  }

Â  Â  Â  Â  #project-chat-container.collapsed #project-chat-toggle i {

Â  Â  Â  Â  Â  Â  transform: rotate(-90deg);

Â  Â  Â  Â  }



Â  Â  Â  Â  #project-chat-messages {

Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  Â  Â  overflow-y: auto;

Â  Â  Â  Â  Â  Â  padding: 0.5rem;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  #kanban-view {

Â  Â  Â  Â  Â  Â  display: grid;

Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(3, 1fr); /* Force 3 columns */

Â  Â  Â  Â  Â  Â  gap: 1rem;

Â  Â  Â  Â  Â  Â  overflow: hidden; /* No horizontal scroll on desktop */

Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  }



Â  Â  Â  Â  .kanban-column {

Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-light);

Â  Â  Â  Â  Â  Â  border-radius: 0.75rem;

Â  Â  Â  Â  Â  Â  padding: 1rem;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  Â  Â  height: 100%;

Â  Â  Â  Â  Â  Â  min-width: 0; /* Allow columns to shrink */

Â  Â  Â  Â  }

Â  Â  Â  Â  .kanban-column-title {

Â  Â  Â  Â  Â  Â  font-weight: 700;

Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;

Â  Â  Â  Â  Â  Â  padding-bottom: 0.5rem;

Â  Â  Â  Â  Â  Â  border-bottom: 2px solid var(--current-border-color);

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  justify-content: space-between;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  .kanban-cards {

Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  Â  Â  min-height: 100px;

Â  Â  Â  Â  Â  Â  overflow-y: auto;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  Â  Â  gap: 0.75rem;

Â  Â  Â  Â  }

Â  Â  Â  Â  .kanban-card {

Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-medium);

Â  Â  Â  Â  Â  Â  padding: 0.75rem 1rem;

Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;

Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 3px rgba(0,0,0,0.1);

Â  Â  Â  Â  Â  Â  cursor: pointer;

Â  Â  Â  Â  Â  Â  border-left: 4px solid var(--current-primary);

Â  Â  Â  Â  Â  Â  position: relative; /* For delete button */

Â  Â  Â  Â  }

Â  Â  Â  Â  .kanban-card.urgent {

Â  Â  Â  Â  Â  Â  border-left-color: var(--urgent-color);

Â  Â  Â  Â  }

Â  Â  Â  Â  .kanban-card:active {

Â  Â  Â  Â  Â  Â  cursor: grabbing;

Â  Â  Â  Â  Â  Â  background-color: var(--primary);

Â  Â  Â  Â  }

Â  Â  Â  Â  .kanban-card p {

Â  Â  Â  Â  Â  Â  font-weight: 500;

Â  Â  Â  Â  }

Â  Â  Â  Â  .kanban-card .card-footer {

Â  Â  Â  Â  Â  Â  font-size: 0.75rem;

Â  Â  Â  Â  Â  Â  color: var(--current-text-medium);

Â  Â  Â  Â  Â  Â  margin-top: 0.75rem;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  justify-content: space-between;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  .kanban-cards.drag-over {

Â  Â  Â  Â  Â  Â  border: 2px dashed var(--current-primary);

Â  Â  Â  Â  Â  Â  background-color: rgba(138, 79, 255, 0.1);

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* List View Styles */

Â  Â  Â  Â  #list-view {

Â  Â  Â  Â  Â  Â  overflow-y: auto;

Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  }

Â  Â  Â  Â  .list-view-header {

Â  Â  Â  Â  Â  Â  display: grid;

Â  Â  Â  Â  Â  Â  grid-template-columns: 40px 1fr 100px 80px 120px 40px;

Â  Â  Â  Â  Â  Â  gap: 1rem;

Â  Â  Â  Â  Â  Â  padding: 0.5rem 1rem;

Â  Â  Â  Â  Â  Â  border-bottom: 2px solid var(--current-border-color);

Â  Â  Â  Â  Â  Â  font-weight: 700;

Â  Â  Â  Â  Â  Â  font-size: 0.75rem;

Â  Â  Â  Â  Â  Â  text-transform: uppercase;

Â  Â  Â  Â  Â  Â  color: var(--current-text-medium);

Â  Â  Â  Â  }

Â  Â  Â  Â  .list-view-task {

Â  Â  Â  Â  Â  Â  display: grid;

Â  Â  Â  Â  Â  Â  grid-template-columns: 40px 1fr 100px 80px 120px 40px;

Â  Â  Â  Â  Â  Â  gap: 1rem;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  padding: 0.75rem 1rem;

Â  Â  Â  Â  Â  Â  border-bottom: 1px solid var(--current-border-color);

Â  Â  Â  Â  }

Â  Â  Â  Â  .list-view-task.task-item-completed .task-content-list {

Â  Â  Â  Â  Â  Â  text-decoration: line-through;

Â  Â  Â  Â  Â  Â  opacity: 0.6;

Â  Â  Â  Â  }

Â  Â  Â  Â  .task-content-list.urgent {

Â  Â  Â  Â  Â  Â  font-weight: 600;

Â  Â  Â  Â  Â  Â  color: var(--urgent-color);

Â  Â  Â  Â  }

Â  Â  Â  Â  .priority-cell {

Â  Â  Â  Â  Â  Â  text-align: center;

Â  Â  Â  Â  Â  Â  cursor: pointer;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .task-labels {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  gap: 4px;

Â  Â  Â  Â  Â  Â  flex-wrap: wrap;

Â  Â  Â  Â  }

Â  Â  Â  Â  .task-label {

Â  Â  Â  Â  Â  Â  padding: 2px 8px;

Â  Â  Â  Â  Â  Â  font-size: 0.7rem;

Â  Â  Â  Â  Â  Â  border-radius: 12px;

Â  Â  Â  Â  Â  Â  font-weight: 600;

Â  Â  Â  Â  }

Â  Â  Â  Â  #project-tag-filter-container {

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  }

Â  Â  Â  Â  #tag-filter-dropdown {

Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-light);

Â  Â  Â  Â  Â  Â  border: 1px solid var(--current-border-color);

Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;

Â  Â  Â  Â  Â  Â  z-index: 10;

Â  Â  Â  Â  Â  Â  max-height: 200px;

Â  Â  Â  Â  Â  Â  overflow-y: auto;

Â  Â  Â  Â  }

Â  Â  Â  Â  /* Financial Assistant Styles */

Â  Â  Â  Â  #financial-assistant-container {

Â  Â  Â  Â  Â  Â  padding: 1rem;

Â  Â  Â  Â  Â  Â  max-width: 600px;

Â  Â  Â  Â  Â  Â  margin: 1rem auto;

Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-light);

Â  Â  Â  Â  Â  Â  border-radius: 10px;

Â  Â  Â  Â  }

Â  Â  Â  Â  .fin-row {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  gap: 0.5rem;

Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  .fin-row input {

Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-medium);

Â  Â  Â  Â  Â  Â  border: 1px solid var(--current-border-color);

Â  Â  Â  Â  Â  Â  color: var(--current-text-light);

Â  Â  Â  Â  Â  Â  padding: 0.5rem;

Â  Â  Â  Â  Â  Â  border-radius: 5px;

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  }

Â  Â  Â  Â  .fin-row input::placeholder {

Â  Â  Â  Â  Â  Â  color: var(--current-text-medium);

Â  Â  Â  Â  }

Â  Â  Â  Â  .fin-row .delete-fin-row-btn {

Â  Â  Â  Â  Â  Â  background: none;

Â  Â  Â  Â  Â  Â  border: none;

Â  Â  Â  Â  Â  Â  color: var(--urgent-color);

Â  Â  Â  Â  Â  Â  cursor: pointer;

Â  Â  Â  Â  }

Â  Â  Â  Â  #fin-summary {

Â  Â  Â  Â  Â  Â  margin-top: 1rem;

Â  Â  Â  Â  Â  Â  padding-top: 1rem;

Â  Â  Â  Â  Â  Â  border-top: 2px solid var(--current-primary);

Â  Â  Â  Â  }

Â  Â  Â  Â  #fin-summary p { font-size: 1.1rem; }

Â  Â  Â  Â  #fin-summary #fin-balance.positive { color: #4CAF50; }

Â  Â  Â  Â  #fin-summary #fin-balance.negative { color: var(--urgent-color); }





Â  Â  Â  Â  /* Gamification Styles */

Â  Â  Â  Â  #gamification-modal .modal-content-body { max-height: 80vh; overflow-y: auto; }

Â  Â  Â  Â  .gamification-tabs { border-bottom: 2px solid var(--current-border-color); }

Â  Â  Â  Â  .gamification-tab { padding: 0.75rem 1rem; font-weight: 600; color: var(--current-text-medium); cursor: pointer; border-bottom: 3px solid transparent; transition: color 0.2s, border-color 0.2s; }

Â  Â  Â  Â  .gamification-tab.active { color: var(--current-primary); border-color: var(--current-primary); }

Â  Â  Â  Â  .xp-bar-bg { background-color: var(--current-bg-light); }

Â  Â  Â  Â  .xp-bar-fill { background-color: var(--current-primary); transition: width 0.5s ease-out; }

Â  Â  Â  Â  .level-badge { background-color: var(--current-primary); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: bold; }

Â  Â  Â  Â  .streak-day { background-color: var(--current-bg-light); border: 2px solid var(--current-border-color); transition: all 0.2s ease; }

Â  Â  Â  Â  .streak-day.active { border-color: var(--current-primary); transform: scale(1.05); box-shadow: 0 0 10px rgba(138, 79, 255, 0.5); }

Â  Â  Â  Â  .streak-day.completed { background-color: var(--current-primary); color: white; border-color: var(--current-primary); }

Â  Â  Â  Â  .streak-day .fa-gift { color: var(--gold-color); }

Â  Â  Â  Â  .mission-item.completed { opacity: 0.5; text-decoration: line-through; }

Â  Â  Â  Â  .mission-item.completed .btn-primary { background-color: #4CAF50; cursor: default; }

Â  Â  Â  Â  .achievement-badge { border: 2px solid var(--current-border-color); filter: grayscale(100%); opacity: 0.6; transition: all 0.3s ease; }

Â  Â  Â  Â  .achievement-badge.unlocked { border-color: var(--gold-color); filter: grayscale(0%); opacity: 1; box-shadow: 0 0 15px var(--gold-color); }

Â  Â  Â  Â  .achievement-badge.unlocked .fa-medal { color: var(--gold-color); }

Â  Â  Â  Â  .text-gold { color: var(--gold-color); }



Â  Â  Â  Â  /* Pricing Modal Enhancements */

Â  Â  Â  Â  .plan-details {

Â  Â  Â  Â  Â  Â  max-height: 0;

Â  Â  Â  Â  Â  Â  overflow: hidden;

Â  Â  Â  Â  Â  Â  transition: max-height 0.5s ease-in-out;

Â  Â  Â  Â  }

Â  Â  Â  Â  .plan-details.open {

Â  Â  Â  Â  Â  Â  max-height: 500px; /* Adjust as needed */

Â  Â  Â  Â  }

Â  Â  Â  Â  .plan-feature-list {

Â  Â  Â  Â  Â  Â  list-style-position: inside;

Â  Â  Â  Â  }

Â  Â  Â  Â  .plan-feature-list li {

Â  Â  Â  Â  Â  Â  padding-left: 1em;

Â  Â  Â  Â  Â  Â  text-indent: -1em;

Â  Â  Â  Â  }

Â  Â  Â  Â  .plan-feature-list .fa-check-circle {

Â  Â  Â  Â  Â  Â  color: var(--primary);

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Desktop specific styles */

Â  Â  Â  Â  @media (min-width: 768px) {

Â  Â  Â  Â  Â  Â  #project-management-view {

Â  Â  Â  Â  Â  Â  Â  Â  flex-direction: row; /* Side-by-side on desktop */

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #project-chat-container {

Â  Â  Â  Â  Â  Â  Â  Â  border-left: 1px solid var(--current-border-color);

Â  Â  Â  Â  Â  Â  Â  Â  border-top: none;

Â  Â  Â  Â  Â  Â  Â  Â  padding-left: 1rem;

Â  Â  Â  Â  Â  Â  Â  Â  padding-top: 0;

Â  Â  Â  Â  Â  Â  Â  Â  height: 100%;

Â  Â  Â  Â  Â  Â  Â  Â  flex-basis: 40%;

Â  Â  Â  Â  Â  Â  Â  Â  flex-shrink: 0;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #project-chat-container.collapsed {

Â  Â  Â  Â  Â  Â  Â  Â  flex-basis: 50px;

Â  Â  Â  Â  Â  Â  Â  Â  height: 100% !important;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #project-chat-container-header { cursor: pointer; }

Â  Â  Â  Â  Â  Â  #project-chat-container.collapsed .project-chat-body,

Â  Â  Â  Â  Â  Â  #project-chat-container.collapsed #project-chat-container-header h3 {

Â  Â  Â  Â  Â  Â  Â  Â  display: none;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #project-chat-container.collapsed #project-chat-toggle {

Â  Â  Â  Â  Â  Â  Â  Â  transform: rotate(90deg);

Â  Â  Â  Â  Â  Â  Â  Â  justify-content: center;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #project-chat-container.collapsed #project-chat-toggle i {

Â  Â  Â  Â  Â  Â  Â  Â  Â transform: rotate(180deg);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* Mobile specific adjustments */

Â  Â  Â  Â  @media (max-width: 767px) {

Â  Â  Â  Â  Â  Â  header.flex {

Â  Â  Â  Â  Â  Â  Â  Â  flex-wrap: nowrap; /* Prevent wrapping of header items */

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .header-right-icons {

Â  Â  Â  Â  Â  Â  Â  Â  flex-shrink: 0;

Â  Â  Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #chat-title-wrapper {

Â  Â  Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  Â  Â  Â  Â  flex-shrink: 1;

Â  Â  Â  Â  Â  Â  Â  Â  min-width: 0; /* Allow title to shrink */

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #message-counter {

Â  Â  Â  Â  Â  Â  Â  Â  white-space: nowrap; /* Prevent counter from wrapping */

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  #project-management-view {

Â  Â  Â  Â  Â  Â  Â  Â  height: 100%;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #project-board-container {

Â  Â  Â  Â  Â  Â  Â  Â  flex: 1 1 60%;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #project-chat-container {

Â  Â  Â  Â  Â  Â  Â  Â  flex: 1 1 40%;

Â  Â  Â  Â  Â  Â  Â  Â  height: 40%;

Â  Â  Â  Â  Â  Â  Â  Â  padding-top: 0.5rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #project-chat-container-header h3 {

Â  Â  Â  Â  Â  Â  Â  Â  font-size: 1rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #project-chat-container-header {

Â  Â  Â  Â  Â  Â  Â  Â  padding-bottom: 0.25rem;

Â  Â  Â  Â  Â  Â  Â  Â  border-bottom: 1px solid var(--current-border-color);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #kanban-view {

Â  Â  Â  Â  Â  Â  Â  Â  display: grid;

Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(3, minmax(200px, 1fr));

Â  Â  Â  Â  Â  Â  Â  Â  overflow-x: auto;

Â  Â  Â  Â  Â  Â  Â  Â  padding-bottom: 10px;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .kanban-column {

Â  Â  Â  Â  Â  Â  Â  Â  min-width: 200px;

Â  Â  Â  Â  Â  Â  Â  Â  width: auto;

Â  Â  Â  Â  Â  Â  Â  Â  padding: 0.5rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .kanban-column-title {

Â  Â  Â  Â  Â  Â  Â  Â  font-size: 0.875rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .kanban-card {

Â  Â  Â  Â  Â  Â  Â  Â  padding: 0.5rem 0.75rem;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  #list-view-mobile {

Â  Â  Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  Â  Â  Â  Â  gap: 0.5rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .list-view-task-mobile {

Â  Â  Â  Â  Â  Â  Â  Â  background-color: var(--current-bg-light);

Â  Â  Â  Â  Â  Â  Â  Â  padding: 0.75rem;

Â  Â  Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;

Â  Â  Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  Â  Â  Â  Â  gap: 0.5rem;

Â  Â  Â  Â  Â  Â  Â  Â  position: relative; /* For delete button */

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .list-view-task-mobile-header {

Â  Â  Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  Â  Â  align-items: flex-start;

Â  Â  Â  Â  Â  Â  Â  Â  gap: 0.75rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .list-view-task-mobile-footer {

Â  Â  Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  Â  Â  justify-content: space-between;

Â  Â  Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  Â  Â  border-top: 1px solid var(--current-border-color);

Â  Â  Â  Â  Â  Â  Â  Â  padding-top: 0.5rem;

Â  Â  Â  Â  Â  Â  Â  Â  font-size: 0.75rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .list-view-task-mobile-footer .delete-task-btn {

Â  Â  Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  Â  Â  top: 8px;

Â  Â  Â  Â  Â  Â  Â  Â  right: 8px;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  #services-menu {

Â  Â  Â  Â  Â  Â  Â  Â  position: fixed; /* Use fixed positioning */

Â  Â  Â  Â  Â  Â  Â  Â  width: 90vw;

Â  Â  Â  Â  Â  Â  Â  Â  max-width: 320px;

Â  Â  Â  Â  Â  Â  Â  Â  top: 60px; /* Adjust based on header height */

Â  Â  Â  Â  Â  Â  Â  Â  right: 10px;

Â  Â  Â  Â  Â  Â  Â  Â  max-height: 75vh;

Â  Â  Â  Â  Â  Â  Â  Â  overflow-y: auto;

Â  Â  Â  Â  Â  Â  Â  Â  z-index: 50; /* Ensure it's on top */

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .calendar-view-toggle button {

Â  Â  Â  Â  Â  Â  Â  Â  padding: 6px 4px;

Â  Â  Â  Â  Â  Â  Â  Â  font-size: 0.75rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .project-view-controls {

Â  Â  Â  Â  Â  Â  Â  Â  width: fit-content;

Â  Â  Â  Â  Â  Â  Â  Â  flex-grow: 0;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .project-view-controls button {

Â  Â  Â  Â  Â  Â  Â  Â  padding: 6px 8px;

Â  Â  Â  Â  Â  Â  Â  Â  font-size: 0.75rem;

Â  Â  Â  Â  Â  Â  Â  Â  flex-grow: 0;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  /* Gamification Modal Mobile Compact Styles */

Â  Â  Â  Â  Â  Â  #gamification-modal .modal-content {

Â  Â  Â  Â  Â  Â  Â  Â  padding: 1rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #gamification-modal h2 {

Â  Â  Â  Â  Â  Â  Â  Â  font-size: 1.25rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .streak-day {

Â  Â  Â  Â  Â  Â  Â  Â  padding: 0.5rem;

Â  Â  Â  Â  Â  Â  Â  Â  font-size: 0.7rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .streak-day .text-2xl {

Â  Â  Â  Â  Â  Â  Â  Â  font-size: 1.25rem;

Â  Â  Â  Â  Â  Â  Â  Â  margin-top: 0.25rem;

Â  Â  Â  Â  Â  Â  Â  Â  margin-bottom: 0.25rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .mission-item {

Â  Â  Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  Â  Â  Â  Â  align-items: flex-start;

Â  Â  Â  Â  Â  Â  Â  Â  gap: 0.5rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .mission-item .btn-primary {

Â  Â  Â  Â  Â  Â  Â  Â  padding: 0.25rem 0.5rem;

Â  Â  Â  Â  Â  Â  Â  Â  font-size: 0.75rem;

Â  Â  Â  Â  Â  Â  Â  Â  align-self: flex-end;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #achievements-container {

Â  Â  Â  Â  Â  Â  Â  Â  gap: 0.5rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .achievement-badge {

Â  Â  Â  Â  Â  Â  Â  Â  padding: 0.5rem;

Â  Â  Â  Â  Â  Â  Â  Â  font-size: 0.7rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .achievement-badge .fa-3x {

Â  Â  Â  Â  Â  Â  Â  Â  font-size: 1.75em;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* Mobile Landscape */

Â  Â  Â  Â  @media (max-width: 900px) and (max-height: 500px) and (orientation: landscape) {

Â  Â  Â  Â  Â  Â  #sidebar {

Â  Â  Â  Â  Â  Â  Â  Â  position: fixed; /* Keep sidebar behavior consistent */

Â  Â  Â  Â  Â  Â  Â  Â  transform: translateX(-100%);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #sidebar.is-open {

Â  Â  Â  Â  Â  Â  Â  Â  transform: translateX(0);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #kanban-view {

Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(3, minmax(250px, 1fr));

Â  Â  Â  Â  Â  Â  Â  Â  overflow-x: auto;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .modal-content {

Â  Â  Â  Â  Â  Â  Â  Â  max-height: 95vh;

Â  Â  Â  Â  Â  Â  Â  Â  overflow-y: auto;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #chat-messages {

Â  Â  Â  Â  Â  Â  Â  Â  padding: 0.5rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #input-area {

Â  Â  Â  Â  Â  Â  Â  Â  padding: 0.5rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .pro-controls-bg {

Â  Â  Â  Â  Â  Â  Â  Â  padding: 0.25rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  #msg {

Â  Â  Â  Â  Â  Â  Â  Â  height: 3rem !important;

Â  Â  Â  Â  Â  Â  Â  Â  max-height: 3rem;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  </style>

</head>

<body class="w-screen overflow-x-hidden dark-theme">

Â  Â  <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

Â  Â  <script type="text/javascript">

Â  Â  Â  Â  if (window.netlifyIdentity) {

Â  Â  Â  Â  Â  Â  netlifyIdentity.init();

Â  Â  Â  Â  }

Â  Â  </script>



Â  Â  <div id="loading-overlay" class="fixed inset-0 bg-bg-dark bg-opacity-95 flex flex-col items-center justify-center z-[100] transition-opacity duration-300">

Â  Â  Â  Â  <img src="./Logos HD.png" alt="Goatify Logo" class="w-24 h-24 object-contain mb-6 animate-pulse" onerror="this.onerror=null;this.src='https://placehold.co/96x96/121212/e0e0e0?text=LOGO';">

Â  Â  Â  Â  <div class="text-text-light text-center">

Â  Â  Â  Â  Â  Â  <i class="fas fa-spinner fa-spin fa-2x"></i>

Â  Â  Â  Â  Â  Â  <p class="mt-3 text-lg font-semibold" data-translate-key="initializing">Inicializando...</p>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden opacity-0 pointer-events-none"></div>



Â  Â  <div id="app-container" class="flex w-full relative opacity-0 transition-opacity duration-300">

Â  Â  Â  Â  <aside id="sidebar" class="flex-shrink-0 flex flex-col transition-transform duration-300 md:translate-x-0 h-full">

Â  Â  Â  Â  Â  Â  <div class="p-3 flex flex-col h-full">

Â  Â  Â  Â  Â  Â  Â  Â  <div id="sidebar-header" class="flex-shrink-0">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="logo-space" class="w-24 h-24 rounded-lg mx-auto mb-4 flex-shrink-0 flex items-center justify-center overflow-hidden bg-input">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="./Logos HD.png" alt="Goatify Logo" class="w-full h-full object-contain" onerror="this.onerror=null;this.src='https://placehold.co/96x96/2c2c2c/e0e0e0?text=LOGO';">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col space-y-2 mb-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="new-chat-btn" class="flex items-center justify-center font-semibold p-3 rounded-lg btn-primary transition-colors"><i class="fas fa-plus mr-2"></i><span data-translate-key="new_chat">Nuevo Chat</span></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="new-folder-btn" class="flex items-center justify-center font-semibold p-3 rounded-lg bg-input"><i class="fas fa-folder-plus mr-2"></i><span data-translate-key="new_folder">Nueva Carpeta</span></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow overflow-y-auto min-h-0">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex-shrink-0">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col space-y-2 mb-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="web-launch-offer-btn" class="w-full text-left font-semibold text-sm p-3 rounded-lg btn-primary transition-colors animate-pulse" data-translate-key="web_offer">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ðŸš€ Â¡Lanza tu Negocio, te regalamos una pg web Gratis con tu suscripcion!

Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="upgrade-plan-container" class="hidden text-center p-2 bg-yellow-400 rounded-lg">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="upgrade-plan-btn" class="text-xs font-semibold text-black hover:text-gray-800">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-rocket mr-1"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span data-translate-key="upgrade_plan">Mejorar Plan</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center p-2 bg-input rounded-lg">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="#" id="free-guides-link" class="text-xs font-semibold text-primary hover:underline">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-book-open mr-1"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span data-translate-key="free_guides">GuÃ­as de IA Gratis</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="border-t border-b border-themed my-3 py-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xs font-semibold uppercase text-text-medium mb-2 px-2" data-translate-key="workflows">Workflows</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="workflows-container" class="space-y-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-category">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="project-workflow-header" class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fas fa-tasks w-6 mr-2 text-purple-400"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm font-bold" data-translate-key="wf_pm">DirecciÃ³n de Proyectos</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-category">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fas fa-chevron-right workflow-arrow mr-2 transition-transform text-xs"></i><i class="fas fa-brain w-6 mr-2 text-teal-400"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm font-bold">Asistente Experto</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="workflow-content pl-4 pt-1 space-y-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="decision-lab" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center">Laboratorio de Decisiones</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="financial-assistant" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center">Asistente Financiero</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-category">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fas fa-chevron-right workflow-arrow mr-2 transition-transform text-xs"></i><i class="fas fa-share-alt w-6 mr-2 text-pink-400"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm font-bold" data-translate-key="wf_social">Potenciador de Redes Sociales</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-content pl-4 pt-1 space-y-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="create-full-post" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_social_1">Crear un Post Completo</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-workflow="persuasive-copy" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_social_2">RedacciÃ³n de Copys</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="post-ideas" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_social_3">Lluvia de Ideas para Posts</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-workflow="brand-strategy" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_social_4">Definir Estrategia de Marca</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="workflow-category">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fas fa-chevron-right workflow-arrow mr-2 transition-transform text-xs"></i><i class="fas fa-chart-pie w-6 mr-2 text-blue-400"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm font-bold" data-translate-key="wf_business">AnÃ¡lisis de Negocio</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="workflow-content pl-4 pt-1 space-y-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="competitor-analysis" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_business_1">AnÃ¡lisis de tu Competencia</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-workflow="buyer-persona" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_business_2">Definir mi Cliente Ideal</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="brand-names" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_business_3">Lluvia de Nombres para Marca</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-category">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fas fa-chevron-right workflow-arrow mr-2 transition-transform text-xs"></i><i class="fas fa-headset w-6 mr-2 text-green-400"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm font-bold" data-translate-key="wf_sales">ComunicaciÃ³n y Ventas</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-content pl-4 pt-1 space-y-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="conflict-resolution" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center">ResoluciÃ³n de Conflictos</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="sales-assistant" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_sales_1">Asistente de Ventas 24/7</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="email-writing" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_sales_2">RedacciÃ³n de Email</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="design-web" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_sales_3">DiseÃ±o Web</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-workflow="social-skills" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_sales_4">Mejorar Habilidades Sociales</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-category">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="workflow-header flex items-center p-2 rounded-md cursor-pointer hover:bg-light">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fas fa-chevron-right workflow-arrow mr-2 transition-transform text-xs"></i><i class="fas fa-language w-6 mr-2 text-red-400"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm font-bold">English Teacher</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="workflow-content pl-4 pt-1 space-y-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="english-teacher-translate" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_eng_1">Traducir/Corregir Texto</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-workflow="english-teacher-vocabulary" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_eng_2">Aprender Vocabulario Nuevo</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-workflow="english-teacher-practice" class="w-full text-left text-sm p-2 rounded hover:bg-light flex items-center" data-translate-key="wf_eng_3">Practicar ConversaciÃ³n</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="border-t border-themed pt-2 mt-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="select-chats-btn" class="w-full text-sm p-2 rounded hover:bg-light flex items-center justify-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-tasks mr-2"></i><span data-translate-key="select_chats">Seleccionar MÃºltiples Chats</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="delete-mode-controls" class="hidden flex space-x-2 mb-2 px-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="delete-selected-btn" class="flex-1 flex items-center justify-center font-semibold p-2 rounded-lg bg-red-600 text-white disabled:opacity-50" disabled><i class="fas fa-trash-alt mr-2"></i><span data-translate-key="delete">Borrar</span></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="cancel-select-mode-btn" class="p-2 rounded-lg bg-gray-600 text-white"><i class="fas fa-times"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="sidebar-content" class="pr-1 space-y-1"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="user-section" class="flex-shrink-0 border-t border-themed mt-auto pt-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="login-view" class="hidden">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="login-btn" class="w-full flex items-center justify-center font-semibold p-3 rounded-lg btn-primary transition-colors"><i class="fas fa-sign-in-alt mr-2"></i><span data-translate-key="login">Iniciar SesiÃ³n</span></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="user-menu-view" class="hidden relative">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="user-menu-btn" class="w-full flex items-center text-left p-2 rounded-lg hover:bg-light transition-colors">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="user-email" class="flex-grow truncate text-sm font-semibold"></span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-ellipsis-h"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="user-menu-popup" class="absolute bottom-full left-0 w-full mb-2 rounded-lg p-2 border border-themed shadow-lg hidden">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="settings-btn" class="w-full text-left text-sm p-2 rounded hover:bg-medium flex items-center"><i class="fas fa-cog w-6 mr-2"></i><span data-translate-key="settings">ConfiguraciÃ³n</span></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="logout-btn" class="w-full text-left text-sm p-2 rounded hover:bg-medium flex items-center"><i class="fas fa-sign-out-alt w-6 mr-2"></i><span data-translate-key="logout">Cerrar SesiÃ³n</span></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </aside>



Â  Â  Â  Â  <main id="main-chat-area" class="flex-1 flex flex-col h-full overflow-hidden">

Â  Â  Â  Â  Â  Â  <header class="flex items-center justify-between p-3 md:p-4 border-b border-themed flex-shrink-0 relative">

Â  Â  Â  Â  Â  Â  Â  Â  <button id="menu-toggle" class="md:hidden text-xl p-2"><i class="fas fa-bars"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="sidebar-toggle-desktop" class="hidden md:block text-xl p-2 mr-2"><i class="fas fa-angle-left"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="chat-title-wrapper" class="hidden sm:flex items-center group cursor-pointer mx-2 flex-1 min-w-0" title="Renombrar Chat">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fas fa-pencil-alt text-xs text-text-medium edit-icon"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 id="chat-title" class="text-lg font-semibold truncate">Goatify IA</h1>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-1 sm:space-x-2 flex-shrink-0 ml-auto header-right-icons">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="new-chat-icon-btn" title="Nuevo Chat" class="text-xl p-2 hover:opacity-80 transition-opacity"><i class="fas fa-plus-circle text-primary"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="gamification-btn" title="Mi AscensiÃ³n" class="text-xl p-2 hover:opacity-80 transition-opacity text-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-trophy"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="services-menu-btn" title="Potenciar mi Negocio" class="text-xl p-2 hover:opacity-80 transition-opacity flex items-center gap-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-rocket text-primary"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hidden sm:inline text-sm font-semibold text-primary" data-translate-key="solutions">Soluciones</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="calendar-btn" title="Mi Calendario y Tareas" class="text-sky-400 hover:text-sky-300 p-2 transition-colors notification-bell-icon">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-calendar-days text-xl"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="notification-badge" class="notification-badge hidden">0</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <a href="https://wa.me/17439106116?text=Hola%2C%20estoy%2Fa%20en%20contratar%20uno%20de%20sus%20paquetes%20de%20soluciones%20con%20IA%20para%20mi%20negocio.%20%C2%BFPodr%C3%ADan%20darme%20m%C3%A1s%20informaci%C3%B3n%3F" target="_blank" title="Hablar con un Estratega" class="text-green-500 hover:text-green-400 p-2 transition-colors"><i class="fab fa-whatsapp text-xl"></i></a>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="message-counter" class="text-xs font-mono whitespace-nowrap"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="theme-toggle" title="Cambiar Tema" class="text-xl p-2"><i class="fas fa-moon" id="theme-icon"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="services-menu" class="absolute top-full right-4 mt-2 w-80 rounded-xl shadow-lg border border-themed z-50 p-4 origin-top-right pointer-events-none">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold text-lg mb-1 text-text-light" data-translate-key="ally_title">Somos tu Aliado EstratÃ©gico</h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-text-medium mb-4" data-translate-key="ally_desc">Goatify no es solo un chat. Somos una IA personalizada con un equipo de expertos listos para ayudarte a escalar tu negocio.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="space-y-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><a id="sol-web" href="#" target="_blank" class="block p-3 rounded-lg hover:bg-medium transition-colors"><p class="font-semibold text-primary">PÃ¡ginas Web que Convierten</p><p class="text-sm text-text-medium">Transformamos tus ideas en webs y tiendas online diseÃ±adas para vender.</p></a></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><a id="sol-auto" href="#" target="_blank" class="block p-3 rounded-lg hover:bg-medium transition-colors"><p class="font-semibold text-primary">Ventas en Piloto AutomÃ¡tico</p><p class="text-sm text-text-medium">Implementamos sistemas de IA para automatizar tus ventas y procesos clave.</p></a></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><a id="sol-social" href="#" target="_blank" class="block p-3 rounded-lg hover:bg-medium transition-colors"><p class="font-semibold text-primary">Avatares para Redes Sociales</p><p class="text-sm text-text-medium">Creamos avatares hiperrealistas con IA y estrategias de contenido que captan la atenciÃ³n.</p></a></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><a id="sol-consult" href="#" target="_blank" class="block p-3 rounded-lg hover:bg-medium transition-colors"><p class="font-semibold text-primary">Escala tu Empresa con IA</p><p class="text-sm text-text-medium">ObtÃ©n consultorÃ­a experta para integrar la IA en el ADN de tu negocio.</p></a></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </header>

Â  Â  Â  Â  Â  Â  <div class="block sm:hidden text-center py-1.5 border-b border-themed bg-current-bg-dark shadow-sm flex-shrink-0">

Â  Â  Â  Â  Â  Â  Â  Â  <div id="mobile-chat-title-wrapper" class="flex items-center justify-center group cursor-pointer px-4" title="Renombrar Chat">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-pencil-alt text-xs text-text-medium edit-icon"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 id="mobile-chat-title" class="text-sm font-semibold truncate">Goatify IA</h2>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â </div>



Â  Â  Â  Â  Â  Â  <div id="chat-messages" class="flex-1 overflow-y-auto p-3 sm:p-6">

Â  Â  Â  Â  Â  Â  Â  Â  <div id="initial-view-container" class="flex justify-center items-center h-full">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="welcome-message-wrapper" class="text-center text-text-medium">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="./Logos HD.png" alt="Goatify Logo" class="w-24 h-24 object-contain mx-auto mb-4" onerror="this.onerror=null;this.src='https://placehold.co/96x96/2c2c2c/e0e0e0?text=LOGO';">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold text-text-light">Goatify IA</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="personalized-welcome" class="hidden"><p class="text-lg mt-1"><span data-translate-key="welcome_user">Â¡Hola, </span><span id="user-name"></span><span data-translate-key="welcome_user_2">! Hoy es un gran dÃ­a para crear algo increÃ­ble.</span></p></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="generic-welcome" class="hidden"><p class="text-xl" data-translate-key="welcome_guest">Â¿CÃ³mo puedo ayudarte hoy?</p></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â <div id="project-management-view" class="hidden flex-1 p-4 overflow-hidden">

Â  Â  Â  Â  Â  Â  Â  Â  <div id="project-board-container" class="flex flex-col h-full">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap justify-between items-center mb-4 flex-shrink-0 gap-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 id="project-view-title" class="text-2xl font-bold">Nombre del Proyecto</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="project-tag-filter-container" class="relative">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="tag-filter-btn" class="p-2 rounded-md bg-input text-sm"><i class="fas fa-tag mr-1"></i> Filtrar</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="tag-filter-dropdown" class="hidden mt-1 p-2 rounded-md shadow-lg"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="add-task-to-board-btn" class="p-2 rounded-md bg-primary text-white text-sm"><i class="fas fa-plus mr-1"></i>AÃ±adir Tarea</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-center space-x-2 project-view-controls mb-4 flex-shrink-0">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm text-text-medium hidden sm:inline">Vistas:</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="view-toggle-kanban" class="px-3 py-1 text-sm rounded-md">Kanban</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="view-toggle-list" class="px-3 py-1 text-sm rounded-md">Lista</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="project-calendar-btn" title="Calendario del Proyecto" class="text-sky-400 hover:text-sky-300 p-2 transition-colors ml-auto"><i class="fas fa-calendar-alt text-xl"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="kanban-view" class="hidden flex-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="list-view" class="hidden flex-1 flex-col">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="list-view-mobile" class="hidden flex-1 overflow-y-auto">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="project-chat-container">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="project-chat-container-header" class="flex justify-between items-center cursor-pointer p-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-semibold text-primary">Asistente del Proyecto</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="project-chat-toggle" class="text-xl p-2"><i class="fas fa-angle-down"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="project-chat-body flex flex-col flex-grow min-h-0">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="project-chat-messages" class="chat-bubble-bot"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="project-input-area" class="mt-auto pt-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="pro-controls-bg rounded-lg p-1.5 mb-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="project-model-selector" class="font-medium text-xs text-text-medium pl-2 pr-1">Modelo:</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="model-selector-wrapper">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="project-model-selector" class="rounded-md py-1 pl-1.5 focus:outline-none focus:ring-2 focus:ring-primary text-sm bg-transparent text-text-light">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="gpt-4o-mini">Asistente de Proyectos</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="gpt-3.5-turbo-1106">General (Turbo)</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="sonar">BÃºsqueda Web</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="relative rounded-xl flex items-center bg-input p-1 sm:p-2 input-wrapper">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <textarea id="project-msg" placeholder="Deja que Goatify organice tu proyecto..." class="flex-1 bg-transparent p-2 h-10 max-h-28 resize-none outline-none placeholder-themed text-sm"></textarea>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="project-send" title="Enviar" class="p-2 sm:p-3 disabled:opacity-50 disabled:cursor-not-allowed text-primary"><i class="fa fa-paper-plane text-lg"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <div id="input-area" class="p-2 sm:p-4 border-t border-themed flex-shrink-0">

Â  Â  Â  Â  Â  Â  Â  Â  <div id="file-preview-area" class="mb-2 space-y-2 px-1 sm:px-0">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="image-preview-container" class="hidden relative">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="image-preview" src="#" alt="Image Preview">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="image-name" class="text-xs text-text-medium truncate flex-grow"></span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="clear-image-btn" class="bg-red-500 hover:bg-red-600 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs z-10 p-0 leading-none">&times;</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="pdf-preview-container" class="hidden relative">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-file-pdf text-red-500 text-xl"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex-grow min-w-0">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="pdf-name" class="font-medium truncate"></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="pdf-status" class="text-xxs font-mono"></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="clear-pdf-btn" class="bg-red-500 hover:bg-red-600 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs z-10 p-0 leading-none">&times;</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="pro-controls-bg rounded-lg p-1 cool-light-effect">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="pro-controls-left">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="model-selector" class="font-medium text-xs text-text-medium pl-2 pr-1" data-translate-key="model">Modelo:</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="model-selector-wrapper">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="model-selector" class="rounded-md py-1 pl-1.5 focus:outline-none focus:ring-2 focus:ring-primary text-sm bg-transparent text-text-light">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="gpt-3.5-turbo-1106" data-translate-key="model_general">Chat General (Turbo)</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="sonar" data-translate-key="model_web">BÃºsqueda Web</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="pro-controls-right">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="voice-selector-container" class="hidden items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="voice-selector" class="font-medium text-xs text-text-medium" data-translate-key="voice">Voz:</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="model-selector-wrapper">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="voice-selector" class="rounded-md py-1 pl-1.5 focus:outline-none focus:ring-2 focus:ring-primary text-sm bg-transparent text-text-light w-24"></select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="action-buttons-container" class="flex items-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="image-gen-btn" title="Crear Imagen" class="p-2 hover:text-primary transition-colors rounded-full text-text-medium"><i class="fas fa-paint-brush text-lg"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="pdf-upload-btn" title="Subir PDF" class="p-2 hover:text-primary transition-colors rounded-full text-text-medium"><i class="fa fa-file-pdf text-lg"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="image-upload-btn" title="Subir Imagen" class="p-2 hover:text-primary transition-colors rounded-full text-text-medium"><i class="fa fa-image text-lg"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative rounded-xl flex items-center bg-input p-1 sm:p-2 input-wrapper">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="pdf-upload" accept=".pdf,application/pdf" class="hidden"><input type="file" id="image-upload" accept="image/*" class="hidden">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="mic-btn" title="Activar MicrÃ³fono" class="p-2 sm:p-3 hover:text-primary transition-colors rounded-full text-text-medium"><i class="fa fa-microphone text-xl"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="tts-toggle" title="Activar/Desactivar Voz" class="p-2 sm:p-3 hover:text-primary transition-colors rounded-full text-text-medium"><i class="fa fa-volume-mute text-xl"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="msg" placeholder="Escribe tu mensaje..." class="flex-1 bg-transparent p-2 h-12 max-h-32 resize-none outline-none placeholder-themed" rows="1" data-translate-key="placeholder_main"></textarea>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="send" title="Enviar" class="p-2 sm:p-4 disabled:opacity-50 disabled:cursor-not-allowed text-primary"><i id="send-icon" class="fa fa-paper-plane text-xl"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="contextual-footer" class="text-center text-xs text-text-medium mt-2 px-2 h-4"></div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </main>

Â  Â  </div>



Â  Â  <div id="generic-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50 p-4"><div class="modal-content rounded-lg w-full max-w-md p-6 relative"><h3 id="modal-title" class="text-lg font-bold mb-4"></h3><div id="modal-body" class="mb-4 text-text-medium text-sm"></div><div id="modal-buttons-container" class="flex justify-end space-x-2"><button id="modal-cancel" class="px-4 py-2 bg-gray-600 text-white rounded" data-translate-key="cancel">Cancelar</button><button id="modal-confirm" class="px-4 py-2 rounded text-white btn-primary" data-translate-key="confirm">Confirmar</button></div></div></div>

Â  Â Â 

Â  Â  <div id="pricing-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50 p-4">

Â  Â  Â  Â  <div class="modal-content rounded-2xl w-full max-w-5xl max-h-[90vh] flex flex-col p-6 relative transform scale-95 transition-transform duration-300">

Â  Â  Â  Â  Â  Â  <div class="flex-shrink-0 flex items-center justify-between mb-6">

Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl md:text-4xl font-extrabold text-center flex-grow" data-translate-key="plans_title">Planes Goatify</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="close-pricing-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white z-10"><i class="fas fa-times fa-lg"></i></button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="modal-content-body flex-grow overflow-y-auto px-2">

Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-text-light">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="plan-card border-2 border-themed rounded-xl p-6 flex flex-col">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold">Free</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-5xl font-extrabold my-3">$0</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-text-medium mb-4" data-translate-key="plan_free_sub">Para Siempre</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <ul class="text-sm space-y-2 mb-4 text-left">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><i class="fas fa-check-circle mr-2"></i>15 CrÃ©ditos/dÃ­a</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><i class="fas fa-check-circle mr-2"></i>Acceso a Modelos BÃ¡sicos</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><i class="fas fa-check-circle mr-2"></i>Workflows Limitados</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="free-plan-button" class="mt-auto w-full p-3 rounded-lg font-semibold border-2 border-primary text-primary hover:bg-primary hover:text-white transition-colors" data-translate-key="plan_free_cta">Tu Plan Actual</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="plan-card border-2 rounded-xl p-6 flex flex-col bg-current-bg-dark plan-card-highlight">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold">GOAT <span class="text-primary">BOOST</span></h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-5xl font-extrabold my-3">$7<span class="text-lg font-medium text-text-medium">/mes</span></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="w-full p-2 text-sm rounded-lg font-semibold border border-primary text-primary hover:bg-primary hover:text-white transition-colors mb-4 plan-details-toggle">Ver Detalles</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="plan-details text-sm text-left">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <ul class="space-y-2 mb-4 plan-feature-list">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><i class="fas fa-check-circle mr-2"></i><strong>100 CrÃ©ditos/dÃ­a</strong></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><i class="fas fa-check-circle mr-2"></i>Acceso a <strong>todos los modelos de IA</strong></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><i class="fas fa-check-circle mr-2"></i>Acceso a <strong>todos los Workflows</strong></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><i class="fas fa-check-circle mr-2"></i>Soporte Prioritario</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-plan="boost" class="select-plan-btn mt-auto w-full p-3 rounded-lg font-semibold btn-primary transition-colors" data-translate-key="plan_boost_cta">Obtener Boost</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="plan-card border-2 border-themed rounded-xl p-6 flex flex-col">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold">GOAT <span class="text-primary">PRO</span></h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-5xl font-extrabold my-3">$17<span class="text-lg font-medium text-text-medium">/mes</span></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="w-full p-2 text-sm rounded-lg font-semibold border border-primary text-primary hover:bg-primary hover:text-white transition-colors mb-4 plan-details-toggle">Ver Detalles</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="plan-details text-sm text-left">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="space-y-2 mb-4 plan-feature-list">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><i class="fas fa-check-circle mr-2"></i><strong>CrÃ©ditos Ilimitados</strong></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><i class="fas fa-check-circle mr-2"></i>Todo lo del plan BOOST</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><i class="fas fa-check-circle mr-2 text-gold"></i><strong>Â¡Te construimos tu PÃ¡gina Web!</strong></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><i class="fas fa-check-circle mr-2"></i>ConsultorÃ­a de IA</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><i class="fas fa-check-circle mr-2"></i>Acceso a GuÃ­as Premium</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-plan="pro" class="select-plan-btn mt-auto w-full p-3 rounded-lg font-semibold btn-primary transition-colors" data-translate-key="plan_pro_cta">Quiero mi Plan Pro + Web</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <div id="html-preview-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50 p-4"><div class="modal-content rounded-2xl w-full h-full max-w-4xl p-2 md:p-4 relative flex flex-col"><h3 class="text-lg font-bold" data-translate-key="preview">Vista Previa</h3><button id="close-html-preview-modal" class="text-gray-400 hover:text-white"><i class="fas fa-times fa-lg"></i></button></div><iframe id="html-preview-iframe" class="w-full flex-grow h-full border-2 border-themed rounded-lg bg-white"></iframe></div>

Â  Â Â 

Â  Â  <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-40 p-4">

Â  Â  Â  Â  <div class="modal-content rounded-lg w-full max-w-lg p-6 relative">

Â  Â  Â  Â  Â  Â  Â <h3 class="text-lg font-bold mb-4" data-translate-key="settings">ConfiguraciÃ³n</h3>

Â  Â  Â  Â  Â  Â  <div class="space-y-4 text-sm max-h-[70vh] overflow-y-auto pr-2">

Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold" data-translate-key="settings_email">Correo ElectrÃ³nico:</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="settings-user-email" class="text-text-medium"></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold" data-translate-key="settings_plan">Plan de SuscripciÃ³n:</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="settings-user-plan" class="text-text-medium"></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="settings-upgrade-plan-btn" class="text-primary hover:underline mt-1 text-xs" data-translate-key="upgrade_plan">Mejorar Plan</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold mb-2" data-translate-key="settings_fontsize">TamaÃ±o de Letra:</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="font-size-slider" min="14" max="20" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg dark:bg-gray-700">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="font-size-value" class="text-xs text-text-medium">16px</span>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold mb-2" data-translate-key="settings_theme">PersonalizaciÃ³n:</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="settings-theme-toggle" class="flex items-center p-2 rounded hover:bg-medium w-full text-left">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fas fa-moon mr-2" id="settings-theme-icon"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span data-translate-key="settings_dark_mode">Modo Oscuro</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex items-center justify-between">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold" data-translate-key="settings_notifications">Notificaciones de Tareas:</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="notifications-toggle" class="inline-flex relative items-center cursor-pointer">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="notifications-toggle" class="sr-only peer">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold mb-2" data-translate-key="settings_lang">Idioma:</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="language-selector" class="w-full p-2 rounded bg-input border border-themed">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="es">EspaÃ±ol</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="en">English</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="border-t border-themed pt-4 mt-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <h4 class="font-semibold mb-2" data-translate-key="settings_integrations">Integraciones</h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="space-y-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="connect-google-calendar-btn" class="w-full bg-input p-2 rounded-lg flex items-center justify-start text-left hover:bg-light transition-colors">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fab fa-google mr-3 text-red-500 fa-lg"></i>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold">Google Calendar</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-xs text-text-medium">Sincroniza tus tareas y eventos.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="connect-whatsapp-btn" class="w-full btn-primary p-2 rounded-lg flex items-center justify-center mb-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <i class="fab fa-whatsapp mr-2"></i><span data-translate-key="settings_whatsapp">Conectarse a WhatsApp</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://calendly.com/goatify" target="_blank" id="schedule-meeting-btn" class="w-full btn-primary p-2 rounded-lg flex items-center justify-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-calendar-alt mr-2"></i><span data-translate-key="settings_schedule_meeting">Agendar ReuniÃ³n</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </a>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button id="close-settings-modal" class="absolute top-4 right-4 text-gray-400 hover:text-text-light"><i class="fas fa-times fa-lg"></i></button>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <div id="calendar-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-40 p-4">

Â  Â  Â  Â  <div id="calendar-modal" class="modal-content rounded-lg w-full max-w-4xl p-6 relative">

Â  Â  Â  Â  Â  Â  Â <h3 class="text-lg font-bold mb-4" data-translate-key="calendar_my_calendar">Mi Calendario y Tareas</h3>

Â  Â  Â  Â  Â  Â  <div class="calendar-view-toggle mb-4">

Â  Â  Â  Â  Â  Â  Â  Â  <button id="day-view-btn" data-translate-key="calendar_day_view">Vista de DÃ­a</button>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="week-view-btn" data-translate-key="calendar_week_view">Vista de Semana</button>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="month-view-btn" class="active" data-translate-key="calendar_month_view">Vista de Mes</button>

Â  Â  Â  Â  Â  Â  Â </div>



Â  Â  Â  Â  Â  Â  <div id="day-view-container">

Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="calendar-header">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="prev-day" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-left"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 id="current-day-display" class="text-xl font-semibold"></h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="next-day" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-right"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="day-view-timeline"></div>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <div id="week-view-container">

Â  Â  Â  Â  Â  Â  Â  Â  <div class="calendar-header">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="prev-week" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-left"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 id="current-week-range" class="text-xl font-semibold"></h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="next-week" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-right"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="week-days-content"></div>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <div id="month-view-container">

Â  Â  Â  Â  Â  Â  Â  Â  <div class="calendar-header">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="prev-month" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-left"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 id="current-month-year" class="text-xl font-semibold"></h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="next-month" class="px-3 py-1 rounded-md bg-gray-600 hover:bg-gray-700"><i class="fas fa-chevron-right"></i></button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="calendar-grid mb-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-primary" data-translate-key="calendar_mon">Lun</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="font-bold text-primary" data-translate-key="calendar_tue">Mar</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-primary" data-translate-key="calendar_wed">MiÃ©</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-primary" data-translate-key="calendar_thu">Jue</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-primary" data-translate-key="calendar_fri">Vie</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-primary" data-translate-key="calendar_sat">SÃ¡b</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="font-bold text-primary" data-translate-key="calendar_sun">Dom</div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="calendar-days-grid" class="calendar-grid"></div>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <div class="mt-6 border-t border-themed pt-4">

Â  Â  Â  Â  Â  Â  Â  Â  <button id="add-task-btn" class="w-full btn-primary p-2 rounded-lg flex items-center justify-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-plus mr-2"></i><span data-translate-key="calendar_add_task_btn">AÃ±adir Tarea</span>

Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <button id="close-calendar-modal" class="absolute top-4 right-4 text-gray-400 hover:text-text-light"><i class="fas fa-times fa-lg"></i></button>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <div id="gamification-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50 p-4">

Â  Â  Â  Â  <div class="modal-content rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col p-6 relative transform scale-95 transition-transform duration-300">

Â  Â  Â  Â  Â  Â  <div class="flex-shrink-0 flex items-center justify-between mb-4">

Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-extrabold text-gold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-trophy mr-2"></i>La AscensiÃ³n del G.O.A.T.

Â  Â  Â  Â  Â  Â  Â  Â  </h2>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="close-gamification-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white z-10"><i class="fas fa-times fa-lg"></i></button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  <div class="p-4 bg-input rounded-lg mb-4 flex-shrink-0">

Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between mb-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="gamification-level-name" class="font-bold text-xl text-text-light">Nivel 1: Iniciador Digital</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-right">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="gamification-xp" class="font-bold text-primary">0 / 100 XP</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p id="gamification-credits" class="text-sm text-gold font-semibold"><i class="fas fa-coins mr-1"></i>0 CrÃ©ditos</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full xp-bar-bg rounded-full h-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="gamification-xp-bar" class="xp-bar-fill h-4 rounded-full" style="width: 0%;"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <div class="flex-grow overflow-hidden flex flex-col">

Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-shrink-0 gamification-tabs flex items-center space-x-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="gamification-tab active" data-tab="racha">Racha Diaria</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="gamification-tab" data-tab="misiones">Misiones</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="gamification-tab" data-tab="logros">Logros</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="gamification-rules-btn" class="ml-auto text-sm text-text-medium hover:text-primary"><i class="fas fa-circle-question mr-1"></i> Reglas</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow overflow-y-auto pt-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="gamification-tab-racha" class="gamification-tab-content space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center text-text-medium">MantÃ©n tu racha para ganar XP, crÃ©ditos y un cofre especial el dÃ­a 7.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="daily-streak-container" class="grid grid-cols-7 gap-2 md:gap-4 text-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="gamification-tab-misiones" class="gamification-tab-content hidden space-y-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="gamification-tab-logros" class="gamification-tab-content hidden">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="achievements-container" class="grid grid-cols-2 md:grid-cols-3 gap-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <div id="gamification-rules-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-[60] p-4">

Â  Â  Â  Â  Â <div class="modal-content rounded-lg w-full max-w-2xl p-6 relative">

Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-bold mb-4 text-gold"><i class="fas fa-scroll mr-2"></i>Reglas de "La AscensiÃ³n del GOAT"</h3>

Â  Â  Â  Â  Â  Â  <div class="space-y-4 text-text-medium text-sm max-h-[70vh] overflow-y-auto pr-2">

Â  Â  Â  Â  Â  Â  Â  Â  <p>Â¡Bienvenido a tu viaje para convertirte en un G.O.A.T. (Greatest Of All Time) del emprendimiento digital! La lÃ³gica es simple: cuanto mÃ¡s usas la plataforma de forma estratÃ©gica, mÃ¡s recompensas obtienes.</p>

Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-semibold text-text-light mt-3">1. Puntos de Experiencia (XP) vs. CrÃ©ditos de Recompensa (ðŸª™)</h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Existen dos tipos de recompensas:</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc list-inside ml-4 mt-1 space-y-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><strong>Puntos de Experiencia (XP):</strong> Miden tu progreso y maestrÃ­a. El XP <strong class="text-primary">nunca se gasta</strong>, solo se acumula para que subas de nivel y desbloquees nuevos tÃ­tulos.</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><strong>CrÃ©ditos de Recompensa (ðŸª™):</strong> Son una <strong class="text-gold">reserva de crÃ©ditos utilizables</strong> que ganas al completar misiones y rachas. Cuando se agotan los crÃ©ditos diarios de tu plan, el sistema usarÃ¡ automÃ¡ticamente estos crÃ©ditos de recompensa para que puedas seguir trabajando.</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-semibold text-text-light mt-3">2. CÃ³mo Subir de Nivel</h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Acumula suficiente XP para ascender de nivel. Cada nivel representa una nueva etapa en tu dominio del marketing y los negocios con IA.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc list-inside ml-4 mt-1 space-y-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Nivel 1: <strong>Iniciador Digital</strong></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Nivel 2: <strong>Creador de Contenido</strong></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li>Nivel 3: <strong>Estratega de Marketing</strong></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Nivel 4: <strong>CEO Digital</strong></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Nivel 5: <strong>G.O.A.T.</strong></li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-semibold text-text-light mt-3">3. CÃ³mo Ganar Recompensas</h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <ul class="list-disc list-inside ml-4 mt-1 space-y-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><strong>Racha Diaria:</strong> Cada dÃ­a consecutivo que entras te da XP y CrÃ©ditos de Recompensa.</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><strong>Cofre GOAT (DÃ­a 7):</strong> Â¡Tu gran recompensa semanal por 7 dÃ­as de racha! Puede contener una gran cantidad de crÃ©ditos, <strong>cupones de descuento</strong> para nuestros servicios de implementaciÃ³n (pÃ¡ginas web, automatizaciones) o incluso una <strong>asesorÃ­a estratÃ©gica GRATIS</strong>.</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><strong>Misiones y Logros:</strong> La forma mÃ¡s rÃ¡pida de ganar grandes bonificaciones de XP y CrÃ©ditos. Completa tareas especÃ­ficas para acelerar tu ascenso.</li>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="font-bold text-center mt-4 text-lg text-primary">Â¡Cada acciÃ³n cuenta en tu camino a la cima! Â¡A por ello!</p>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button id="close-gamification-rules-modal" class="absolute top-4 right-4 text-gray-400 hover:text-text-light"><i class="fas fa-times fa-lg"></i></button>

Â  Â  Â  Â  </div>

Â  Â  </div>





Â  Â  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

Â  Â  <script type="module">

Â  Â  Â  Â  // Start of Part 1 - Continues in next response

Â  Â  Â  Â  window.addEventListener('DOMContentLoaded', () => {

Â  Â  Â  Â  Â  Â  dayjs.extend(window.dayjs_plugin_localizedFormat);

Â  Â  Â  Â  Â  Â  dayjs.extend(window.dayjs_plugin_isoWeek);

Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  const translations = {

Â  Â  Â  Â  Â  Â  Â  Â  es: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  initializing: "Inicializando...", new_chat: "Nuevo Chat", new_folder: "Nueva Carpeta",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  web_offer: "ðŸš€ Â¡Lanza tu Negocio, te regalamos una pg web Gratis con tu suscripcion!",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â upgrade_plan: "Mejorar Plan", free_guides: "GuÃ­as de IA Gratis", workflows: "Workflows",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_pm: "DirecciÃ³n de Proyectos", wf_pm_1: "Crear Tablero de Proyecto",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_social: "Potenciador de Redes Sociales", wf_social_1: "Crear un Post Completo", wf_social_2: "RedacciÃ³n de Copys",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â wf_social_3: "Lluvia de Ideas para Posts", wf_social_4: "Definir Estrategia de Marca",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_business: "AnÃ¡lisis de Negocio", wf_business_1: "AnÃ¡lisis de tu Competencia", wf_business_2: "Definir mi Cliente Ideal",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_business_3: "Lluvia de Nombres para Marca", wf_sales: "ComunicaciÃ³n y Ventas", wf_sales_1: "Asistente de Ventas 24/7",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â wf_sales_2: "RedacciÃ³n de Email", wf_sales_3: "DiseÃ±o Web", wf_sales_4: "Mejorar Habilidades Sociales",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_eng_1: "Traducir/Corregir Texto",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_eng_2: "Aprender Vocabulario Nuevo", wf_eng_3: "Practicar ConversaciÃ³n", select_chats: "Seleccionar MÃºltiples Chats",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  delete: "Borrar", login: "Iniciar SesiÃ³n", settings: "ConfiguraciÃ³n", logout: "Cerrar SesiÃ³n",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â solutions: "Soluciones", ally_title: "Somos tu Aliado EstratÃ©gico",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ally_desc: "Goatify no es solo un chat. Somos una IA personalizada con un equipo de expertos listos para ayudarte a escalar tu negocio.",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  welcome_user: "Â¡Hola, ", welcome_user_2: "! Hoy es un gran dÃ­a para crear algo increÃ­ble.",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  welcome_guest: "Â¿CÃ³mo puedo ayudarte hoy?", model: "Modelo:", model_general: "Chat General (Turbo)",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  model_web: "BÃºsqueda Web", voice: "Voz:", placeholder_main: "Escribe tu mensaje...", cancel: "Cancelar",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirm: "Confirmar", plans_title: "Planes Goatify", plan_free_sub: "Para Siempre", plan_free_cta: "Empezar Gratis",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â plan_boost_cta: "Obtener Boost", plan_pro_cta: "Quiero mi Plan Pro + Web",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  preview: "Vista Previa", settings_email: "Correo ElectrÃ³nico:", settings_plan: "Plan de SuscripciÃ³n:",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  settings_fontsize: "TamaÃ±o de Letra:", settings_theme: "PersonalizaciÃ³n:", settings_dark_mode: "Modo Oscuro",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â settings_lang: "Idioma:", settings_whatsapp: "Conectarse a WhatsApp", current_plan: "Tu Plan Actual",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  settings_notifications: "Notificaciones de Tareas:", settings_schedule_meeting: "Agendar ReuniÃ³n",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  settings_integrations: "Integraciones",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  calendar_today: "Hoy", calendar_this_week: "Esta Semana", calendar_mon: "Lun", calendar_tue: "Mar", calendar_wed: "MiÃ©",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â calendar_thu: "Jue", calendar_fri: "Vie", calendar_sat: "SÃ¡b", calendar_sun: "Dom",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  calendar_no_tasks: "No hay tareas para este dÃ­a.", calendar_add_task_placeholder: "AÃ±adir nueva tarea personal...",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  calendar_add_task_btn: "AÃ±adir Tarea", calendar_my_calendar: "Mi Calendario y Tareas",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  calendar_day_view: "Vista de DÃ­a", calendar_month_view: "Vista de Mes", calendar_week_view: "Vista de Semana",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  notification_task_due: "Es hora de: ", notification_title: "Goatify IA - Â¡Hora de tu Tarea!",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tasks_for: "Tareas para", add_task_for: "AÃ±adir Tarea para"

Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  en: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â initializing: "Initializing...", new_chat: "New Chat", new_folder: "New Folder",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  web_offer: "ðŸš€ Launch your Business, get a free website with your subscription!",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  upgrade_plan: "Upgrade Plan", free_guides: "Free AI Guides", workflows: "Workflows",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â wf_pm: "Project Management", wf_pm_1: "Create Project Board",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_social: "Social Media Booster", wf_social_1: "Create a Full Post", wf_social_2: "Copywriting",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_social_3: "Brainstorm Post Ideas", wf_social_4: "Define Brand Strategy",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_business: "Business Analysis", wf_business_1: "Analyze your Competition", wf_business_2: "Define my Ideal Customer",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â wf_business_3: "Brainstorm Brand Names", wf_sales: "Communication & Sales", wf_sales_1: "24/7 Sales Assistant",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_sales_2: "Email Writing", wf_sales_3: "Web Design", wf_sales_4: "Improve Social Skills",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_eng_1: "Translate/Correct Text",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wf_eng_2: "Learn New Vocabulary", wf_eng_3: "Practice Conversation", select_chats: "Select Multiple Chats",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  delete: "Delete", login: "Login", settings: "Settings", logout: "Logout",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  solutions: "Solutions", ally_title: "We are your Strategic Ally",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ally_desc: "Goatify is not just a chat. We are a custom IA with a team of experts ready to help you scale your business.",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  welcome_user: "Hello, ", welcome_user_2: "! Today is a great day to create something amazing.",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  welcome_guest: "How can I help you today?", model: "Model:", model_general: "General Chat (Turbo)",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  model_web: "Web Search", voice: "Voice:", placeholder_main: "Type your message...", cancel: "Cancel",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirm: "Confirm", plans_title: "Goatify Plans", plan_free_sub: "Forever", plan_free_cta: "Get Started for Free",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plan_boost_cta: "Get Boost", plan_pro_cta: "Get Pro Plan + Web",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  preview: "Preview", settings_email: "Email Address:", settings_plan: "Subscription Plan:",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  settings_fontsize: "Font Size:", settings_theme: "Personalization:", settings_dark_mode: "Dark Mode",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â settings_lang: "Language:", settings_whatsapp: "Connect to WhatsApp", current_plan: "Current Plan",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  settings_notifications: "Task Notifications:", settings_schedule_meeting: "Schedule Meeting",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  settings_integrations: "Integrations",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  calendar_today: "Today", calendar_this_week: "This Week", calendar_mon: "Mon", calendar_tue: "Tue", calendar_wed: "Wed",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â calendar_thu: "Thu", calendar_fri: "Fri", calendar_sat: "Sat", calendar_sun: "Sun",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  calendar_no_tasks: "No tasks for this day.", calendar_add_task_placeholder: "Add new personal task...",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  calendar_add_task_btn: "Add Task", calendar_my_calendar: "My Calendar & Tasks",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  calendar_day_view: "Day View", calendar_month_view: "Month View", calendar_week_view: "Week View",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â notification_task_due: "Time for: ", notification_title: "Goatify IA - Task Due!",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tasks_for: "Tasks for", add_task_for: "Add Task for"

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const GUEST_CREDIT_LIMIT = 15;

Â  Â  Â  Â  Â  Â  const FREE_PLAN_CREDIT_LIMIT = 15;

Â  Â  Â  Â  Â  Â  const BOOST_PLAN_CREDIT_LIMIT = 100;



Â  Â  Â  Â  Â  Â  const COSTS = { GENERAL: 1, SEARCH: 1, NEBULA: 2, COPYWRITING: 2, IMAGE: 5 };

Â  Â  Â  Â  Â  Â  let state = { chats: {}, projects: {}, structure: [], calendar: {} };

Â  Â  Â  Â  Â  Â  let gamificationState = {};

Â  Â  Â  Â  Â  Â  let currentChatId = null, currentUser = null, speechOn = false, availableVoices = [], selectedVoice = null, isRecognizing = false, selectedImageBase64 = null, selectedPdfText = null;

Â  Â  Â  Â  Â  Â  let micWasOnBeforeSpeaking = false;

Â  Â  Â  Â  Â  Â  let modalResolve = null;

Â  Â  Â  Â  Â  Â  let isSelectModeActive = false;

Â  Â  Â  Â  Â  Â  let chatsToDelete = new Set();

Â  Â  Â  Â  Â  Â  let notificationsEnabled = localStorage.getItem('goatify-notifications-enabled') === 'true';



Â  Â  Â  Â  Â  Â  let selectedCalendarDate = dayjs();

Â  Â  Â  Â  Â  Â  let currentCalendarView = 'month';

Â  Â  Â  Â  Â  Â  let activeTagFilter = null;

Â  Â  Â  Â  Â  Â  const dom = {};

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const fullDom = {

Â  Â  Â  Â  Â  Â  Â  Â  appContainer: document.getElementById('app-container'),

Â  Â  Â  Â  Â  Â  Â  Â  msgInput: document.getElementById('msg'), sendBtn: document.getElementById('send'),

Â  Â  Â  Â  Â  Â  Â  Â  inputArea: document.getElementById('input-area'),

Â  Â  Â  Â  Â  Â  Â  Â  messageCounterEl: document.getElementById('message-counter'),Â 

Â  Â  Â  Â  Â  Â  Â  Â  upgradePlanContainer: document.getElementById('upgrade-plan-container'),

Â  Â  Â  Â  Â  Â  Â  Â  Â upgradePlanBtn: document.getElementById('upgrade-plan-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  newChatBtn: document.getElementById('new-chat-btn'), newFolderBtn: document.getElementById('new-folder-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  pricingModal: document.getElementById('pricing-modal'), closePricingModalBtn: document.getElementById('close-pricing-modal'),

Â  Â  Â  Â  Â  Â  Â  Â  genericModal: document.getElementById('generic-modal'), chatMessages: document.getElementById('chat-messages'),

Â  Â  Â  Â  Â  Â  Â  Â  chatTitle: document.getElementById('chat-title'), mobileChatTitle: document.getElementById('mobile-chat-title'),

Â  Â  Â  Â  Â  Â  Â  Â  Â chatTitleWrapper: document.getElementById('chat-title-wrapper'), mobileChatTitleWrapper: document.getElementById('mobile-chat-title-wrapper'),

Â  Â  Â  Â  Â  Â  Â  Â  initialViewContainer: document.getElementById('initial-view-container'),

Â  Â  Â  Â  Â  Â  Â  Â  welcomeMessageWrapper: document.getElementById('welcome-message-wrapper'),

Â  Â  Â  Â  Â  Â  Â  Â  themeToggle: document.getElementById('theme-toggle'), themeIcon: document.getElementById('theme-icon'),

Â  Â  Â  Â  Â  Â  Â  Â  micBtn: document.getElementById('mic-btn'), ttsToggle: document.getElementById('tts-toggle'),Â 

Â  Â  Â  Â  Â  Â  Â  Â  modelSelector: document.getElementById('model-selector'),

Â  Â  Â  Â  Â  Â  Â  Â  actionButtonsContainer: document.getElementById('action-buttons-container'),

Â  Â  Â  Â  Â  Â  Â  Â  imageUploadBtn: document.getElementById('image-upload-btn'), imageUploadInput: document.getElementById('image-upload'),

Â  Â  Â  Â  Â  Â  Â  Â  imagePreviewContainer: document.getElementById('image-preview-container'), imagePreview: document.getElementById('image-preview'),

Â  Â  Â  Â  Â  Â  Â  Â  Â clearImageBtn: document.getElementById('clear-image-btn'), pdfUploadBtn: document.getElementById('pdf-upload-btn'), pdfUploadInput: document.getElementById('pdf-upload'),

Â  Â  Â  Â  Â  Â  Â  Â  pdfPreviewContainer: document.getElementById('pdf-preview-container'), pdfNameEl: document.getElementById('pdf-name'), pdfStatusEl: document.getElementById('pdf-status'), clearPdfBtn: document.getElementById('clear-pdf-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  sidebar: document.getElementById('sidebar'), menuToggle: document.getElementById('menu-toggle'), sidebarOverlay: document.getElementById('sidebar-overlay'),

Â  Â  Â  Â  Â  Â  Â  Â  sidebarContent: document.getElementById('sidebar-content'), loginView: document.getElementById('login-view'), userMenuView: document.getElementById('user-menu-view'),

Â  Â  Â  Â  Â  Â  Â  Â  loginBtn: document.getElementById('login-btn'), userMenuBtn: document.getElementById('user-menu-btn'), userMenuPopup: document.getElementById('user-menu-popup'), userEmail: document.getElementById('user-email'),

Â  Â  Â  Â  Â  Â  Â  Â  Â logoutBtn: document.getElementById('logout-btn'), webLaunchOfferBtn: document.getElementById('web-launch-offer-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  workflowsContainer: document.getElementById('workflows-container'), freeGuidesLink: document.getElementById('free-guides-link'),

Â  Â  Â  Â  Â  Â  Â  Â  personalizedWelcome: document.getElementById('personalized-welcome'), genericWelcome: document.getElementById('generic-welcome'), userName: document.getElementById('user-name'),

Â  Â  Â  Â  Â  Â  Â  Â  loadingOverlay: document.getElementById('loading-overlay'), htmlPreviewModal: document.getElementById('html-preview-modal'),

Â  Â  Â  Â  Â  Â  Â  Â  closeHtmlPreviewModalBtn: document.getElementById('close-html-preview-modal'), htmlPreviewIframe: document.getElementById('html-preview-iframe'),

Â  Â  Â  Â  Â  Â  Â  Â  Â voiceSelector: document.getElementById('voice-selector'),Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â voiceSelectorContainer: document.getElementById('voice-selector-container'),

Â  Â  Â  Â  Â  Â  Â  Â  selectChatsBtn: document.getElementById('select-chats-btn'), deleteModeControls: document.getElementById('delete-mode-controls'),

Â  Â  Â  Â  Â  Â  Â  Â  deleteSelectedBtn: document.getElementById('delete-selected-btn'), cancelSelectModeBtn: document.getElementById('cancel-select-mode-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  imageGenBtn: document.getElementById('image-gen-btn'), servicesMenuBtn: document.getElementById('services-menu-btn'), servicesMenu: document.getElementById('services-menu'),

Â  Â  Â  Â  Â  Â  Â  Â  contextualFooter: document.getElementById('contextual-footer'),

Â  Â  Â  Â  Â  Â  Â  Â  newChatIconBtn: document.getElementById('new-chat-icon-btn'), settingsBtn: document.getElementById('settings-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  settingsModal: document.getElementById('settings-modal'), closeSettingsModal: document.getElementById('close-settings-modal'),

Â  Â  Â  Â  Â  Â  Â  Â  settingsUserEmail: document.getElementById('settings-user-email'), settingsUserPlan: document.getElementById('settings-user-plan'),

Â  Â  Â  Â  Â  Â  Â  Â  settingsUpgradePlanBtn: document.getElementById('settings-upgrade-plan-btn'), fontSizeSlider: document.getElementById('font-size-slider'),

Â  Â  Â  Â  Â  Â  Â  Â  Â fontSizeValue: document.getElementById('font-size-value'), settingsThemeToggle: document.getElementById('settings-theme-toggle'),

Â  Â  Â  Â  Â  Â  Â  Â  settingsThemeIcon: document.getElementById('settings-theme-icon'), languageSelector: document.getElementById('language-selector'),

Â  Â  Â  Â  Â  Â  Â  Â  connectWhatsappBtn: document.getElementById('connect-whatsapp-btn'), scheduleMeetingBtn: document.getElementById('schedule-meeting-btn'), freePlanButton: document.getElementById('free-plan-button'),

Â  Â  Â  Â  Â  Â  Â  Â  notificationsToggle: document.getElementById('notifications-toggle'),

Â  Â  Â  Â  Â  Â  Â  Â  projectWorkflowHeader: document.getElementById('project-workflow-header'),

Â  Â  Â  Â  Â  Â  Â  Â  sidebarToggleDesktop: document.getElementById('sidebar-toggle-desktop'),

Â  Â  Â  Â  Â  Â  Â  Â  Â mainChatArea: document.getElementById('main-chat-area'),



Â  Â  Â  Â  Â  Â  Â  Â  // Calendar elements

Â  Â  Â  Â  Â  Â  Â  Â  calendarBtn: document.getElementById('calendar-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  calendarModalOverlay: document.getElementById('calendar-modal-overlay'),

Â  Â  Â  Â  Â  Â  Â  Â  calendarModal: document.getElementById('calendar-modal'),

Â  Â  Â  Â  Â  Â  Â  Â  closeCalendarModal: document.getElementById('close-calendar-modal'),

Â  Â  Â  Â  Â  Â  Â  Â  Â prevMonthBtn: document.getElementById('prev-month'), nextMonthBtn: document.getElementById('next-month'),

Â  Â  Â  Â  Â  Â  Â  Â  currentMonthYear: document.getElementById('current-month-year'), calendarDaysGrid: document.getElementById('calendar-days-grid'),

Â  Â  Â  Â  Â  Â  Â  Â  addTaskBtn: document.getElementById('add-task-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  notificationBadge: document.getElementById('notification-badge'),

Â  Â  Â  Â  Â  Â  Â  Â  Â monthViewContainer: document.getElementById('month-view-container'), weekViewContainer: document.getElementById('week-view-container'),

Â  Â  Â  Â  Â  Â  Â  Â  dayViewContainer: document.getElementById('day-view-container'),

Â  Â  Â  Â  Â  Â  Â  Â  monthViewBtn: document.getElementById('month-view-btn'), weekViewBtn: document.getElementById('week-view-btn'), dayViewBtn: document.getElementById('day-view-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  prevWeekBtn: document.getElementById('prev-week'), nextWeekBtn: document.getElementById('next-week'),

Â  Â  Â  Â  Â  Â  Â  Â  currentWeekRange: document.getElementById('current-week-range'), weekDaysContent: document.getElementById('week-days-content'),

Â  Â  Â  Â  Â  Â  Â  Â  Â prevDayBtn: document.getElementById('prev-day'), nextDayBtn: document.getElementById('next-day'),

Â  Â  Â  Â  Â  Â  Â  Â  currentDayDisplay: document.getElementById('current-day-display'), dayViewTimeline: document.getElementById('day-view-timeline'),



Â  Â  Â  Â  Â  Â  Â  Â  // Project Management elements

Â  Â  Â  Â  Â  Â  Â  Â  projectManagementView: document.getElementById('project-management-view'),

Â  Â  Â  Â  Â  Â  Â  Â  projectBoardContainer: document.getElementById('project-board-container'),

Â  Â  Â  Â  Â  Â  Â  Â  projectChatContainer: document.getElementById('project-chat-container'),

Â  Â  Â  Â  Â  Â  Â  Â  Â projectChatToggle: document.getElementById('project-chat-toggle'),

Â  Â  Â  Â  Â  Â  Â  Â  Â projectChatHeader: document.getElementById('project-chat-container-header'),

Â  Â  Â  Â  Â  Â  Â  Â  chatMessagesView: document.getElementById('chat-messages'),

Â  Â  Â  Â  Â  Â  Â  Â  projectViewTitle: document.getElementById('project-view-title'),

Â  Â  Â  Â  Â  Â  Â  Â  kanbanView: document.getElementById('kanban-view'),

Â  Â  Â  Â  Â  Â  Â  Â  listView: document.getElementById('list-view'),

Â  Â  Â  Â  Â  Â  Â  Â  listViewMobile: document.getElementById('list-view-mobile'),

Â  Â  Â  Â  Â  Â  Â  Â  viewToggleKanban: document.getElementById('view-toggle-kanban'),

Â  Â  Â  Â  Â  Â  Â  Â  Â viewToggleList: document.getElementById('view-toggle-list'),

Â  Â  Â  Â  Â  Â  Â  Â  addTaskToBoardBtn: document.getElementById('add-task-to-board-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  projectChatMessages: document.getElementById('project-chat-messages'),

Â  Â  Â  Â  Â  Â  Â  Â  projectMsgInput: document.getElementById('project-msg'),

Â  Â  Â  Â  Â  Â  Â  Â  projectSendBtn: document.getElementById('project-send'),

Â  Â  Â  Â  Â  Â  Â  Â  projectCalendarBtn: document.getElementById('project-calendar-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  tagFilterBtn: document.getElementById('tag-filter-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  Â tagFilterDropdown: document.getElementById('tag-filter-dropdown'),



Â  Â  Â  Â  Â  Â  Â  Â  // Gamification Elements

Â  Â  Â  Â  Â  Â  Â  Â  gamificationBtn: document.getElementById('gamification-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  gamificationModal: document.getElementById('gamification-modal'),

Â  Â  Â  Â  Â  Â  Â  Â  closeGamificationModal: document.getElementById('close-gamification-modal'),

Â  Â  Â  Â  Â  Â  Â  Â  gamificationLevelName: document.getElementById('gamification-level-name'),

Â  Â  Â  Â  Â  Â  Â  Â  Â gamificationXp: document.getElementById('gamification-xp'),

Â  Â  Â  Â  Â  Â  Â  Â  gamificationCredits: document.getElementById('gamification-credits'),

Â  Â  Â  Â  Â  Â  Â  Â  gamificationXpBar: document.getElementById('gamification-xp-bar'),

Â  Â  Â  Â  Â  Â  Â  Â  dailyStreakContainer: document.getElementById('daily-streak-container'),

Â  Â  Â  Â  Â  Â  Â  Â  missionsContainer: document.getElementById('gamification-tab-misiones'),

Â  Â  Â  Â  Â  Â  Â  Â  Â achievementsContainer: document.getElementById('achievements-container'),

Â  Â  Â  Â  Â  Â  Â  Â  gamificationRulesBtn: document.getElementById('gamification-rules-btn'),

Â  Â  Â  Â  Â  Â  Â  Â  gamificationRulesModal: document.getElementById('gamification-rules-modal'),

Â  Â  Â  Â  Â  Â  Â  Â  closeGamificationRulesModal: document.getElementById('close-gamification-rules-modal'),

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Object.assign(dom, fullDom);

Â  Â  Â  Â  Â  Â  // --- GAMIFICATION CONFIG ---

Â  Â  Â  Â  Â  Â  const XP_FOR_LEVEL = [0, 250, 750, 2000, 5000, Infinity]; // XP needed to reach level 1, 2, 3...

Â  Â  Â  Â  Â  Â  const LEVEL_NAMES = ["Iniciador Digital", "Creador de Contenido", "Estratega de Marketing", "CEO Digital", "G.O.A.T."];

Â  Â  Â  Â  Â  Â  const MISSIONS = {

Â  Â  Â  Â  Â  Â  Â  Â  'brand-strategy': { id: 'brand-strategy', text: 'Define tu primera estrategia de marca', xp: 50, credits: 15, workflow: 'brand-strategy' },

Â  Â  Â  Â  Â  Â  Â  Â  'competitor-analysis': { id: 'competitor-analysis', text: 'EspÃ­a a la competencia por primera vez', xp: 50, credits: 15, workflow: 'competitor-analysis' },

Â  Â  Â  Â  Â  Â  Â  Â  'week-organized': { id: 'week-organized', text: 'Crea una tarea para cada dÃ­a de la semana', xp: 75, credits: 25, condition: checkWeekOrganized },

Â  Â  Â  Â  Â  Â  Â  Â  'project-created': { id: 'project-created', text: 'Crea tu primer proyecto y aÃ±ade 3 tareas', xp: 100, credits: 30, condition: (chatId) => checkProjectCreated(chatId, 3) },

Â  Â  Â  Â  Â  Â  Â  Â  'image-generated': { id: 'image-generated', text: 'Genera tu primera imagen con IA', xp: 40, credits: 10, action: 'generateImage' },

Â  Â  Â  Â  Â  Â  Â  Â  'english-practice': { id: 'english-practice', text: 'Practica tu conversaciÃ³n en inglÃ©s', xp: 30, credits: 10, workflow: 'english-teacher-practice' },

Â  Â  Â  Â  Â  Â  Â  Â  'social-skills': { id: 'social-skills', text: 'Mejora tus habilidades sociales con un consejo de IA', xp: 30, credits: 10, workflow: 'social-skills' },

Â  Â  Â  Â  Â  Â  Â  Â  'conflict-resolution': { id: 'conflict-resolution', text: 'Analiza tu primer conflicto con IA', xp: 40, credits: 15, workflow: 'conflict-resolution' },

Â  Â  Â  Â  Â  Â  Â  Â  'decision-lab': { id: 'decision-lab', text: 'Usa el Laboratorio de Decisiones', xp: 50, credits: 20, workflow: 'decision-lab' },

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const ACHIEVEMENTS = {

Â  Â  Â  Â  Â  Â  Â  Â  'streak-30': { id: 'streak-30', title: 'Consistencia', description: 'MantÃ©n la racha diaria por 30 dÃ­as.', icon: 'fa-calendar-check', xp: 500, credits: 250 },

Â  Â  Â  Â  Â  Â  Â  Â  'project-master': { id: 'project-master', title: 'Project Master', description: 'Completa 10 proyectos.', icon: 'fa-sitemap', xp: 1000, credits: 0, reward: '50% de descuento en consultorÃ­a de automatizaciÃ³n.' },

Â  Â  Â  Â  Â  Â  Â  Â  'influencer': { id: 'influencer', title: 'Influencer', description: 'Genera 50 publicaciones para redes sociales.', icon: 'fa-bullhorn', xp: 750, credits: 0, reward: 'Un mes de GOAT Boost gratis.' },

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // --- END GAMIFICATION CONFIG ---



Â  Â  Â  Â  Â  Â  function setLanguage(lang) {

Â  Â  Â  Â  Â  Â  Â  Â  const translationData = translations[lang];

Â  Â  Â  Â  Â  Â  Â  Â  if (!translationData) return;

Â  Â  Â  Â  Â  Â  Â  Â  dayjs.locale(lang);

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('[data-translate-key]').forEach(el => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const key = el.dataset.translateKey;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (translationData[key]) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (el.tagName === 'TEXTAREA' || el.tagName === 'INPUT') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if(el.placeholder) el.placeholder = translationData[key];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const icon = el.querySelector('i');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (icon && el.childNodes.length > 1 && el.tagName !== 'BUTTON') { // Avoid messing up buttons with only an icon

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Rebuild content preserving icon

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const textNode = document.createTextNode(' ' + translationData[key]);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Find text node to replace

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let i=0; i < el.childNodes.length; i++){

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(el.childNodes[i].nodeType === Node.TEXT_NODE){

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.childNodes[i].nodeValue = ' ' + translationData[key];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.textContent = translationData[key];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  document.documentElement.lang = lang;

Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('goatify-lang', lang);

Â  Â  Â  Â  Â  Â  Â  Â  const currentModalConfirm = dom.genericModal.querySelector('#modal-confirm');

Â  Â  Â  Â  Â  Â  Â  Â  if (currentModalConfirm) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.genericModal.querySelector('#modal-cancel').textContent = translationData.cancel;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  renderCalendarView();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  function updateContextualFooter(workflowKey) {

Â  Â  Â  Â  Â  Â  Â  Â  if (!dom.contextualFooter) return;

Â  Â  Â  Â  Â  Â  Â  Â  const workflowTexts = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'create-full-post': 'Modo Redes Sociales: Define tu red social y tema para un post completo.',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'persuasive-copy': 'Modo Copywriter: Dime quÃ© vendes y para dÃ³nde es el texto.',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'brand-strategy': 'Modo Estratega: Dime el nombre y rubro de tu negocio para empezar.',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 'competitor-analysis': 'Modo Analista: Pega la URL de tu competencia para investigarla.',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'sales-assistant': 'Modo Asistente de Ventas: Pega el mensaje de tu cliente para responder.',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'english-teacher-practice': 'Practice mode: Let\'s talk. How was your day?',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'design-web': 'Modo DiseÃ±ador Web: Describe el componente visual y lo crearÃ© en HTML.',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'project-management': 'Modo Director de Proyectos: Describe tu proyecto para crear tareas en el tablero.',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'conflict-resolution': 'Modo Mediador: Describe la situaciÃ³n de conflicto para encontrar una soluciÃ³n.',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'decision-lab': 'Modo Estratega: Describe la decisiÃ³n que enfrentas y tus opciones.',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'financial-assistant': 'Modo Financiero: Usa los campos para aÃ±adir ingresos/gastos o pide un anÃ¡lisis.',

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  const currentChat = state.chats[currentChatId];

Â  Â  Â  Â  Â  Â  Â  Â  const key = workflowKey || (currentChat ? currentChat.workflow : null);

Â  Â  Â  Â  Â  Â  Â  Â  dom.contextualFooter.textContent = workflowTexts[key] || 'Tu copiloto de IA para hacer crecer tu negocio.';

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;

Â  Â  Â  Â  Â  Â  let recognition;



Â  Â  Â  Â  Â  Â  function showModal({ title, body, confirmText = 'Confirmar', cancelText = 'Cancelar', showCancel = true, extraButtons = [] }) {

Â  Â  Â  Â  Â  Â  Â  Â  const modalTitle = dom.genericModal.querySelector('#modal-title');

Â  Â  Â  Â  Â  Â  Â  Â  const modalBody = dom.genericModal.querySelector('#modal-body');

Â  Â  Â  Â  Â  Â  Â  Â  const modalButtonsContainer = dom.genericModal.querySelector('#modal-buttons-container');

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  modalTitle.innerHTML = title;Â 

Â  Â  Â  Â  Â  Â  Â  Â  modalBody.innerHTML = body;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  let buttonsHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  extraButtons.forEach(btn => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttonsHTML += `<button id="${btn.id}" class="${btn.classes || 'px-4 py-2 rounded bg-gray-500 text-white'}">${btn.text}</button>`;

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  buttonsHTML += `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${showCancel ? `<button id="modal-cancel" class="px-4 py-2 bg-gray-600 text-white rounded">${cancelText}</button>` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="modal-confirm" class="px-4 py-2 rounded text-white btn-primary">${confirmText}</button>

Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  modalButtonsContainer.innerHTML = buttonsHTML;



Â  Â  Â  Â  Â  Â  Â  Â  dom.genericModal.querySelector('#modal-confirm').addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const inputs = modalBody.querySelectorAll('input, textarea, select');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = {};

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inputs.forEach(input => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data[input.id] = input.type === 'checkbox' ? input.checked : input.value;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideModal({ confirmed: true, data });

Â  Â  Â  Â  Â  Â  Â  Â  }, { once: true });



Â  Â  Â  Â  Â  Â  Â  Â  if (showCancel) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cancelBtn = dom.genericModal.querySelector('#modal-cancel');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(cancelBtn) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cancelBtn.addEventListener('click', () => hideModal({ confirmed: false }), { once: true });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  extraButtons.forEach(btn => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const extraBtnEl = dom.genericModal.querySelector(`#${btn.id}`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (extraBtnEl) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  extraBtnEl.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.action(e, modalBody);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.genericModal.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  dom.genericModal.classList.add('flex');

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  return new Promise(resolve => { modalResolve = resolve; });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function hideModal(resolveWith = null) { if(modalResolve) { modalResolve(resolveWith); modalResolve = null; } dom.genericModal.classList.add('hidden'); dom.genericModal.classList.remove('flex');Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  function showPricingModal() {Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.pricingModal.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  dom.pricingModal.classList.add('flex');Â 

Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { dom.pricingModal.querySelector('.modal-content').classList.remove('scale-95'); }, 10);

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const lang = localStorage.getItem('goatify-lang') || 'es';

Â  Â  Â  Â  Â  Â  Â  Â  const isFree = !currentUser || (currentUser.app_metadata?.plan || 'free') === 'free';

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (isFree) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.freePlanButton.textContent = translations[lang].current_plan;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.freePlanButton.disabled = true;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.freePlanButton.classList.add('btn-disabled');

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.freePlanButton.textContent = translations[lang].plan_free_cta;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.freePlanButton.disabled = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.freePlanButton.classList.remove('btn-disabled');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function hidePricingModal() { dom.pricingModal.querySelector('.modal-content').classList.add('scale-95');

Â  Â  Â  Â  Â  Â  setTimeout(() => { dom.pricingModal.classList.add('hidden'); dom.pricingModal.classList.remove('flex'); }, 300); }



Â  Â  Â  Â  Â  Â  function showSettingsModal() {

Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsModal.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsModal.classList.add('flex');

Â  Â  Â  Â  Â  Â  Â  Â  if (currentUser) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsUserEmail.textContent = currentUser.email;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userPlan = currentUser.app_metadata?.plan || 'free';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsUserPlan.textContent = userPlan.charAt(0).toUpperCase() + userPlan.slice(1);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsUpgradePlanBtn.classList.toggle('hidden', userPlan !== 'free');

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsUserEmail.textContent = 'Not logged in';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsUserPlan.textContent = 'Free (Guest)';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsUpgradePlanBtn.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  dom.fontSizeSlider.value = parseInt(getComputedStyle(document.body).getPropertyValue('--base-font-size')) || 16;

Â  Â  Â  Â  Â  Â  Â  Â  dom.fontSizeValue.textContent = `${dom.fontSizeSlider.value}px`;

Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsThemeIcon.className = `fas fa-${document.body.classList.contains('dark-theme') ? 'moon' : 'sun'} mr-2`;

Â  Â  Â  Â  Â  Â  Â  Â  dom.languageSelector.value = localStorage.getItem('goatify-lang') || 'es';

Â  Â  Â  Â  Â  Â  Â  Â  dom.notificationsToggle.checked = notificationsEnabled;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function hideSettingsModal() {

Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsModal.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsModal.classList.remove('flex');

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function showCalendarModal() {

Â  Â  Â  Â  Â  Â  Â  Â  dom.calendarModalOverlay.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  dom.calendarModalOverlay.classList.add('flex');

Â  Â  Â  Â  Â  Â  Â  Â  if (!currentCalendarView) currentCalendarView = 'month';Â 

Â  Â  Â  Â  Â  Â  Â  Â  renderCalendarView();

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function hideCalendarModal() {

Â  Â  Â  Â  Â  Â  Â  Â  dom.calendarModalOverlay.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  dom.calendarModalOverlay.classList.remove('flex');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  function renderMonthView() {

Â  Â  Â  Â  Â  Â  Â  Â  dom.calendarDaysGrid.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  dom.currentMonthYear.textContent = selectedCalendarDate.format('MMMM YYYY');

Â  Â  Â  Â  Â  Â  Â  Â  const startDay = selectedCalendarDate.startOf('month').startOf('isoWeek');



Â  Â  Â  Â  Â  Â  Â  Â  for (let i = 0; i < 42; i++) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const day = startDay.add(i, 'day');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dayEl = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.className = 'calendar-day';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.dataset.date = day.format('YYYY-MM-DD');



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.innerHTML = `<span class="calendar-day-number">${day.date()}</span><div class="calendar-day-tasks"></div>`;



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (day.month() === selectedCalendarDate.month()) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.classList.add('current-month');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.classList.add('other-month');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (day.isSame(dayjs(), 'day')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.classList.add('today');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tasksContainer = dayEl.querySelector('.calendar-day-tasks');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tasksForDay = getTasksForDay(day.format('YYYY-MM-DD'));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tasksForDay.slice(0, 3).forEach(task => { // Limit to 3 tasks to avoid clutter

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskEl = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.className = 'calendar-day-task task-item';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.textContent = task.text;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.style.backgroundColor = getLabelColor(task.source === 'Personal' ? 'Personal' : (task.labels && task.labels[0] ? task.labels[0] : 'default'));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.draggable = true;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.dataset.taskId = task.id;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.dataset.taskSource = task.source;



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const deleteBtn = document.createElement('button');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.className = 'delete-task-btn';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.innerHTML = '&times;';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.onclick = (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteTask(task.id, task.source);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.appendChild(deleteBtn);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.addEventListener('dragstart', handleCalendarDragStart);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(e.target.classList.contains('delete-task-btn')) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleTaskClick(task.id, task.source);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tasksContainer.appendChild(taskEl);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(e.target === e.currentTarget || e.target === tasksContainer) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â editCalendarTask(null, day.format('YYYY-MM-DD'));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.addEventListener('dragover', e => { e.preventDefault(); e.currentTarget.style.backgroundColor = 'var(--current-bg-light)'; });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.addEventListener('dragleave', e => { e.currentTarget.style.backgroundColor = ''; });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.addEventListener('drop', handleCalendarDrop);



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.calendarDaysGrid.appendChild(dayEl);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  function renderWeekView() {

Â  Â  Â  Â  Â  Â  Â  Â  dom.weekDaysContent.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  let startOfWeek = selectedCalendarDate.startOf('isoWeek');



Â  Â  Â  Â  Â  Â  Â  Â  const endOfWeek = startOfWeek.add(6, 'day');

Â  Â  Â  Â  Â  Â  Â  Â  dom.currentWeekRange.textContent = `${startOfWeek.format('D MMM')} - ${endOfWeek.format('D MMM, YYYY')}`;



Â  Â  Â  Â  Â  Â  Â  Â  for (let i = 0; i < 7; i++) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const day = startOfWeek.add(i, 'day');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dayKey = day.format('YYYY-MM-DD');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tasks = getTasksForDay(dayKey);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lang = localStorage.getItem('goatify-lang') || 'es';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const displayDate = day.format('dddd, D MMM');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const daySection = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daySection.className = 'week-day-section';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daySection.dataset.date = dayKey;



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daySection.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${displayDate}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="add-task-to-day-btn text-lg hover:text-primary" data-date="${dayKey}">+</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h5>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${tasks.length === 0 ? `<p class="text-xs text-text-medium italic">${translations[lang].calendar_no_tasks}</p>` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${tasks.map((task) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-item flex items-center gap-2 cursor-pointer ${task.completed ? 'task-item-completed' : ''}"Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â draggable="true" data-task-id="${task.id}" data-task-source="${task.source}">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="checkbox" class="task-checkbox" data-task-id="${task.id}" ${task.completed ? 'checked' : ''}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="flex-grow">${task.text} ${task.time ? `(${task.time})` : ''} <span class="text-xs text-primary">(${task.source})</span></span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-task-btn">&times;</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `}).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.weekDaysContent.appendChild(daySection);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daySection.addEventListener('dragover', e => { e.preventDefault(); e.currentTarget.style.backgroundColor = 'var(--current-bg-light)'; });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daySection.addEventListener('dragleave', e => { e.currentTarget.style.backgroundColor = ''; });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daySection.addEventListener('drop', handleCalendarDrop);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daySection.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if(e.target === e.currentTarget || e.target.classList.contains('space-y-1')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editCalendarTask(null, dayKey);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  dom.weekDaysContent.querySelectorAll('.task-checkbox').forEach(checkbox => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkbox.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateTaskStatus(e.currentTarget.dataset.taskId, { completed: e.currentTarget.checked });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â });



Â  Â  Â  Â  Â  Â  Â  Â  dom.weekDaysContent.querySelectorAll('.task-item').forEach(item => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.addEventListener('dragstart', handleCalendarDragStart);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.addEventListener('touchstart', handleTouchStart, {passive: false});

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.type === 'checkbox' || e.target.classList.contains('delete-task-btn')) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleTaskClick(e.currentTarget.dataset.taskId, e.currentTarget.dataset.taskSource);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â });



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.querySelector('.delete-task-btn').addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteTask(item.dataset.taskId, item.dataset.taskSource);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  dom.weekDaysContent.querySelectorAll('.add-task-to-day-btn').forEach(btn => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const date = e.currentTarget.dataset.date;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editCalendarTask(null, date);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function renderDayView() {

Â  Â  Â  Â  Â  Â  Â  Â  dom.currentDayDisplay.textContent = selectedCalendarDate.format('dddd, D [de] MMMM');

Â  Â  Â  Â  Â  Â  Â  Â  dom.dayViewTimeline.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  const tasksForDay = getTasksForDay(selectedCalendarDate.format('YYYY-MM-DD'));

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  for (let hour = 0; hour < 24; hour++) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hourEl = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hourEl.className = 'day-view-hour';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hourLabel = (hour < 10 ? '0' : '') + hour + ':00';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hourKey = hourLabel.substring(0,2); // e.g., "09"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hourEl.dataset.time = hourKey;Â 



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tasksInHour = tasksForDay.filter(t => t.time && t.time.startsWith(hourKey));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hourEl.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="day-view-hour-label">${hourLabel}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="day-view-hour-content" data-time="${hourKey}">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${tasksInHour.map(task => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="task-item flex items-center gap-2 p-1 rounded-md ${task.completed ? 'bg-green-900/50 text-gray-400 line-through' : 'bg-input'} text-sm"Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draggable="true" data-task-id="${task.id}" data-task-source="${task.source}">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="task-checkbox" data-task-id="${task.id}" ${task.completed ? 'checked' : ''}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="flex-grow cursor-pointer"><strong>${task.time}:</strong> ${task.text} <span class="text-xs text-primary">(${task.source})</span></span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="delete-task-btn">&times;</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="add-task-to-time-btn text-lg hover:text-primary" data-date="${selectedCalendarDate.format('YYYY-MM-DD')}" data-time="${hourLabel}">+</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.dayViewTimeline.appendChild(hourEl);



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hourContent = hourEl.querySelector('.day-view-hour-content');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hourContent.addEventListener('dragover', e => { e.preventDefault(); e.currentTarget.style.backgroundColor = 'var(--current-bg-light)'; });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hourContent.addEventListener('dragleave', e => { e.currentTarget.style.backgroundColor = ''; });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hourContent.addEventListener('drop', handleCalendarDrop);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â hourContent.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if(e.target === e.currentTarget) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editCalendarTask(null, selectedCalendarDate.format('YYYY-MM-DD'), hourLabel);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  dom.dayViewTimeline.querySelectorAll('.add-task-to-time-btn').forEach(btn => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const date = e.currentTarget.dataset.date;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const time = e.currentTarget.dataset.time;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editCalendarTask(null, date, time);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.dayViewTimeline.querySelectorAll('.task-checkbox').forEach(checkbox => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkbox.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateTaskStatus(e.currentTarget.dataset.taskId, { completed: e.currentTarget.checked });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.dayViewTimeline.querySelectorAll('.task-item').forEach(item => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.addEventListener('dragstart', handleCalendarDragStart);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.addEventListener('touchstart', handleTouchStart, {passive: false});

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.type === 'checkbox' || e.target.classList.contains('delete-task-btn')) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleTaskClick(e.currentTarget.dataset.taskId, e.currentTarget.dataset.taskSource);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.querySelector('.delete-task-btn').addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteTask(item.dataset.taskId, item.dataset.taskSource);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â });

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function handleTaskClick(taskId, taskSource) {

Â  Â  Â  Â  Â  Â  Â  Â  Â if (taskSource === 'Personal') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editCalendarTask(taskId);

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const projectChat = Object.values(state.chats).find(c => c.projectData && c.projectData.title === taskSource);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (projectChat) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editProjectTask(projectChat.id, taskId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  let draggedCalendarTaskId = null;

Â  Â  Â  Â  Â  Â  let draggedTaskSource = null;

Â  Â  Â  Â  Â  Â  function handleCalendarDragStart(e) {

Â  Â  Â  Â  Â  Â  Â  Â  draggedCalendarTaskId = e.target.dataset.taskId;

Â  Â  Â  Â  Â  Â  Â  Â  draggedTaskSource = e.target.dataset.taskSource;

Â  Â  Â  Â  Â  Â  Â  Â  e.dataTransfer.setData('text/plain', JSON.stringify({id: draggedCalendarTaskId, source: draggedTaskSource}));

Â  Â  Â  Â  Â  Â  Â  Â  e.dataTransfer.effectAllowed = 'move';

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  function handleCalendarDrop(e) {

Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();

Â  Â  Â  Â  Â  Â  Â  Â  e.currentTarget.style.backgroundColor = '';

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = JSON.parse(e.dataTransfer.getData('text/plain'));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskId = data.id;



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!taskId || !taskId.startsWith('cal-')) return; // Only handle calendar tasks here



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dropZone = e.currentTarget;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newDate = dropZone.dataset.date || selectedCalendarDate.format('YYYY-MM-DD');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newTime = dropZone.classList.contains('day-view-hour-content')Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `${dropZone.dataset.time}:00`Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : findTask(taskId)?.task?.time || null;



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const updates = { date: newDate, time: newTime };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateTaskStatus(taskId, updates);

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Drop failed:", error);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // --- Touch Drag Simulation ---

Â  Â  Â  Â  Â  Â  let touchDragElement = null;

Â  Â  Â  Â  Â  Â  let ghostElement = null;

Â  Â  Â  Â  Â  Â  function handleTouchStart(e) {

Â  Â  Â  Â  Â  Â  Â  Â  if (e.touches.length !== 1) return;

Â  Â  Â  Â  Â  Â  Â  Â  // e.preventDefault(); // This can prevent scrolling, use with caution.

Â  Â  Â  Â  Â  Â  Â  Â  touchDragElement = e.currentTarget;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement = touchDragElement.cloneNode(true);

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement.style.position = 'absolute';

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement.style.zIndex = '1000';

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement.style.opacity = '0.7';

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement.style.pointerEvents = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement.style.width = `${touchDragElement.offsetWidth}px`;

Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(ghostElement);

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const touch = e.touches[0];

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement.style.left = `${touch.pageX - ghostElement.offsetWidth / 2}px`;

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement.style.top = `${touch.pageY - ghostElement.offsetHeight / 2}px`;



Â  Â  Â  Â  Â  Â  Â  Â  document.addEventListener('touchmove', handleTouchMove, {passive: false});

Â  Â  Â  Â  Â  Â  Â  Â  document.addEventListener('touchend', handleTouchEnd);

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function handleTouchMove(e) {

Â  Â  Â  Â  Â  Â  Â  Â  if (e.touches.length !== 1 || !ghostElement) return;

Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  Â  Â  const touch = e.touches[0];

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement.style.left = `${touch.pageX - ghostElement.offsetWidth / 2}px`;

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement.style.top = `${touch.pageY - ghostElement.offsetHeight / 2}px`;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function handleTouchEnd(e) {

Â  Â  Â  Â  Â  Â  Â  Â  if (!ghostElement) return;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement.style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  const dropTarget = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement.remove();

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (dropTarget) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dropZoneCalendar = dropTarget.closest('.calendar-day, .week-day-section, .day-view-hour-content');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dropZoneKanban = dropTarget.closest('.kanban-cards');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskId = touchDragElement.dataset.taskId;



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(dropZoneCalendar && taskId.startsWith('cal-')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newDate = dropZoneCalendar.dataset.date || selectedCalendarDate.format('YYYY-MM-DD');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newTime = dropZoneCalendar.dataset.time ? `${dropZoneCalendar.dataset.time}:00` : findTask(taskId)?.task?.time || null;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateTaskStatus(taskId, { date: newDate, time: newTime });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (dropZoneKanban && taskId.startsWith('proj-')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetColumnId = dropZoneKanban.dataset.columnId;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  moveTask(currentChatId, taskId, targetColumnId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  touchDragElement = null;

Â  Â  Â  Â  Â  Â  Â  Â  ghostElement = null;

Â  Â  Â  Â  Â  Â  Â  Â  document.removeEventListener('touchmove', handleTouchMove);

Â  Â  Â  Â  Â  Â  Â  Â  document.removeEventListener('touchend', handleTouchEnd);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // --- End Touch Drag Simulation ---



Â  Â  Â  Â  Â  Â  function findTask(taskId) {

Â  Â  Â  Â  Â  Â  Â  Â  if (!taskId) return null;

Â  Â  Â  Â  Â  Â  Â  Â  if (taskId.startsWith('cal-')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const dayKey in state.calendar) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskIndex = (state.calendar[dayKey] || []).findIndex(t => t.id === taskId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (taskIndex > -1) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return { type: 'personal', task: state.calendar[dayKey][taskIndex], dayKey, taskIndex };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } else if (taskId.startsWith('proj-')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const chat of Object.values(state.chats)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (chat.projectData && chat.projectData.columns) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const column of chat.projectData.columns) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskIndex = (column.tasks || []).findIndex(t => t.id === taskId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (taskIndex > -1) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return { type: 'project', task: column.tasks[taskIndex], chat, column, taskIndex };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  return null;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  async function deleteTask(taskId, taskSource) {

Â  Â  Â  Â  Â  Â  Â  Â  Â const confirm = await showModal({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'Eliminar Tarea',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: 'Â¿EstÃ¡s seguro de que quieres eliminar esta tarea? Esta acciÃ³n no se puede deshacer.',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmText: 'Eliminar',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cancelText: 'Cancelar'

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  if (!confirm.confirmed) return;



Â  Â  Â  Â  Â  Â  Â  Â  const found = findTask(taskId);

Â  Â  Â  Â  Â  Â  Â  Â  if (!found) return;



Â  Â  Â  Â  Â  Â  Â  Â  if (found.type === 'personal') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { dayKey, taskIndex } = found;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.calendar[dayKey].splice(taskIndex, 1);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(state.calendar[dayKey].length === 0) delete state.calendar[dayKey];

Â  Â  Â  Â  Â  Â  Â  Â  } else if (found.type === 'project') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { column, taskIndex } = found;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  column.tasks.splice(taskIndex, 1);

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  saveState();

Â  Â  Â  Â  Â  Â  Â  Â  if (dom.calendarModalOverlay.classList.contains('flex')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderCalendarView();

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (dom.projectManagementView.style.display === 'flex') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderProjectBoard(currentChatId);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function updateTaskStatus(taskId, updates) {

Â  Â  Â  Â  Â  Â  Â  Â  const found = findTask(taskId);

Â  Â  Â  Â  Â  Â  Â  Â  if (!found) return;



Â  Â  Â  Â  Â  Â  Â  Â  if (found.type === 'personal') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { task, dayKey } = found;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oldDate = dayKey;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newDate = updates.date || oldDate;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (oldDate !== newDate) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskIndex = state.calendar[oldDate].findIndex(t => t.id === taskId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.calendar[oldDate].splice(taskIndex, 1);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(state.calendar[oldDate].length === 0) delete state.calendar[oldDate];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!state.calendar[newDate]) state.calendar[newDate] = [];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.calendar[newDate].push(task);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  delete updates.date;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Object.assign(task, updates);

Â  Â  Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  Â  Â  else if (found.type === 'project') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { task, chat } = found;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const originalCompleted = task.completed;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Object.assign(task, updates);



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (updates.completed !== undefined && updates.completed !== originalCompleted) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let sourceColumn, taskIndex;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(const col of chat.projectData.columns){

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const idx = (col.tasks || []).findIndex(t => t.id === taskId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(idx > -1){

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sourceColumn = col;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskIndex = idx;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (sourceColumn) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const [taskToMove] = sourceColumn.tasks.splice(taskIndex, 1);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (task.completed) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const doneColumn = chat.projectData.columns.find(c => c.id === 'done');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (doneColumn && sourceColumn.id !== 'done') doneColumn.tasks.push(taskToMove);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else sourceColumn.tasks.push(taskToMove); // remain if already in done

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const todoColumn = chat.projectData.columns.find(c => c.id === 'todo');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (todoColumn && sourceColumn.id !== 'todo') todoColumn.tasks.push(taskToMove);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else sourceColumn.tasks.push(taskToMove); // remain if not in done

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  saveState();

Â  Â  Â  Â  Â  Â  Â  Â  if (dom.calendarModalOverlay.classList.contains('flex')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderCalendarView();

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (dom.projectManagementView.style.display === 'flex') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderProjectBoard(currentChatId);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }





Â  Â  Â  Â  Â  Â  function getTasksForDay(dayKey) {

Â  Â  Â  Â  Â  Â  Â  Â  const calendarTasks = (state.calendar[dayKey] || []).map(t => ({...t, text: t.content, source: 'Personal'}));

Â  Â  Â  Â  Â  Â  Â  Â  const projectTasks = [];

Â  Â  Â  Â  Â  Â  Â  Â  Object.values(state.chats).forEach(chat => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (chat.projectData && chat.projectData.columns) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chat.projectData.columns.forEach(column => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (column.tasks || []).forEach(task => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (task.dueDate === dayKey) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  projectTasks.push({...task, source: chat.projectData.title, text: task.content});

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  return [...calendarTasks, ...projectTasks].sort((a, b) => (a.time || '23:59').localeCompare(b.time || '23:59'));

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function updateNotificationBadge() {

Â  Â  Â  Â  Â  Â  Â  Â  Â let pendingNotifications = 0;

Â  Â  Â  Â  Â  Â  Â  Â  const now = dayjs();

Â  Â  Â  Â  Â  Â  Â  Â  Object.keys(state.calendar).forEach(dayKey => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tasksForDay = getTasksForDay(dayKey);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tasksForDay.forEach(task => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (!task.completed) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (task.time) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskDateTime = dayjs(`${dayKey}T${task.time}`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (taskDateTime.isBefore(now)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â pendingNotifications++;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskDate = dayjs(dayKey);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (taskDate.isBefore(now, 'day') || taskDate.isSame(now, 'day')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pendingNotifications++;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (pendingNotifications > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.notificationBadge.textContent = pendingNotifications;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.notificationBadge.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.notificationBadge.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function checkAndNotifyTasks() {

Â  Â  Â  Â  Â  Â  Â  Â  if (!notificationsEnabled) return;

Â  Â  Â  Â  Â  Â  Â  Â  const now = dayjs();

Â  Â  Â  Â  Â  Â  Â  Â  const todayKey = now.format('YYYY-MM-DD');

Â  Â  Â  Â  Â  Â  Â  Â  const currentHourMinute = now.format('HH:mm');

Â  Â  Â  Â  Â  Â  Â  Â  const allTasksToday = getTasksForDay(todayKey);

Â  Â  Â  Â  Â  Â  Â  Â  allTasksToday.forEach(task => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!task.completed && task.time === currentHourMinute && !task.notifiedThisMinute) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lang = localStorage.getItem('goatify-lang') || 'es';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const notificationTitle = translations[lang].notification_title;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const notificationBody = `${translations[lang].notification_task_due} ${task.text} (${task.time})`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: `<i class="fas fa-bell animate-tada text-yellow-400 mr-2"></i> ${notificationTitle}`,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â body: `<p class="text-lg text-center">${notificationBody}</p>`,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmText: 'Entendido',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showCancel: false

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â });



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (Notification.permission === "granted") {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  new Notification(notificationTitle, {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â body: notificationBody,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: './Logos HD.png'

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateTaskNotifiedFlag(task.id, true);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  allTasksToday.forEach(task => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (task.notifiedThisMinute && task.time !== currentHourMinute) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateTaskNotifiedFlag(task.id, false);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  saveState();

Â  Â  Â  Â  Â  Â  Â  Â  updateNotificationBadge();

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function updateTaskNotifiedFlag(taskId, isNotified) {

Â  Â  Â  Â  Â  Â  Â  Â  const found = findTask(taskId);

Â  Â  Â  Â  Â  Â  Â  Â  if (found) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  found.task.notifiedThisMinute = isNotified;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }





Â  Â  Â  Â  Â  Â  function renderCalendarView() {

Â  Â  Â  Â  Â  Â  Â  Â  Â dom.dayViewContainer.style.display = currentCalendarView === 'day' ? 'block' : 'none';

Â  Â  Â  Â  Â  Â  Â  Â  dom.weekViewContainer.style.display = currentCalendarView === 'week' ? 'block' : 'none';

Â  Â  Â  Â  Â  Â  Â  Â  dom.monthViewContainer.style.display = currentCalendarView === 'month' ? 'block' : 'none';

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.dayViewBtn.classList.toggle('active', currentCalendarView === 'day');

Â  Â  Â  Â  Â  Â  Â  Â  dom.weekViewBtn.classList.toggle('active', currentCalendarView === 'week');

Â  Â  Â  Â  Â  Â  Â  Â  dom.monthViewBtn.classList.toggle('active', currentCalendarView === 'month');



Â  Â  Â  Â  Â  Â  Â  Â  if (currentCalendarView === 'day') renderDayView();

Â  Â  Â  Â  Â  Â  Â  Â  if (currentCalendarView === 'week') renderWeekView();

Â  Â  Â  Â  Â  Â  Â  Â  if (currentCalendarView === 'month') renderMonthView();

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  setInterval(checkAndNotifyTasks, 10 * 1000);

Â  Â  Â  Â  Â  Â  if ("Notification" in window) {

Â  Â  Â  Â  Â  Â  Â  Â  if (Notification.permission !== "granted" && Notification.permission !== "denied") {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Notification.requestPermission();

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Browser does not support desktop notifications.");

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function speak(text) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (!speechOn || !('speechSynthesis' in window) || !text) return;

Â  Â  Â  Â  Â  Â  Â  Â  speechSynthesis.cancel();

Â  Â  Â  Â  Â  Â  Â  Â  micWasOnBeforeSpeaking = isRecognizing;

Â  Â  Â  Â  Â  Â  Â  Â  if (isRecognizing) { recognition.stop(); }

Â  Â  Â  Â  Â  Â  Â  Â  const cleanText = text.replace(/<[^>]*>/g, '').replace(/[*_`#~[\]()ðŸ”]|(-{3,})/g, '');

Â  Â  Â  Â  Â  Â  Â  Â  const utterance = new SpeechSynthesisUtterance(cleanText);Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (selectedVoice) { utterance.voice = selectedVoice;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  utterance.rate = 1.15;

Â  Â  Â  Â  Â  Â  Â  Â  utterance.onend = () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (micWasOnBeforeSpeaking) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (recognition && !isRecognizing) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try { recognition.start(); } catch(e) { console.error("Error restarting recognition:", e); }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  micWasOnBeforeSpeaking = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleVoiceSelectorVisibility(false);

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  utterance.onerror = (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Speech synthesis error:', e);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (micWasOnBeforeSpeaking) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (recognition && !isRecognizing) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â try { recognition.start(); } catch(e) { console.error("Error restarting recognition on error:", e); }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  micWasOnBeforeSpeaking = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â toggleVoiceSelectorVisibility(false);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  speechSynthesis.speak(utterance);

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function populateVoiceList() {

Â  Â  Â  Â  Â  Â  Â  Â  const setVoices = () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (typeof speechSynthesis === 'undefined') { return; }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  availableVoices = speechSynthesis.getVoices().filter(v => v.lang.startsWith('es-') || v.lang.startsWith('en-'));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const preferredVoices = [ "Microsoft Sabina Online (Natural) - Spanish (Mexico)", "Paulina", "Google espaÃ±ol de Estados Unidos", "Google espaÃ±ol" ];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  availableVoices.sort((a, b) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let aIdx = preferredVoices.indexOf(a.name); let bIdx = preferredVoices.indexOf(b.name);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (aIdx === -1) aIdx = Infinity; if (bIdx === -1) bIdx = Infinity;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (aIdx !== bIdx) return aIdx - bIdx;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return a.name.localeCompare(b.name);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (availableVoices.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.voiceSelector.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  availableVoices.forEach(voice => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const displayName = voice.name.replace('Microsoft', '').replace('Online (Natural) -', '').replace('Google', '').replace('Spanish (Mexico)','Mex').trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = `${displayName || voice.lang} (${voice.lang})`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  option.value = voice.name;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.voiceSelector.appendChild(option);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedVoice = availableVoices[0];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (selectedVoice) dom.voiceSelector.value = selectedVoice.name;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (speechSynthesis.onvoiceschanged !== undefined) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  speechSynthesis.onvoiceschanged = setVoices;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  setVoices();

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function getModelForRequest(workflow, hasFile, isProjectChat) {

Â  Â  Â  Â  Â  Â  Â  Â  if (isProjectChat) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return document.getElementById('project-model-selector').value;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (workflow === "design-web") return "gpt-4o-mini";

Â  Â  Â  Â  Â  Â  Â  Â  if (hasFile) return "gpt-4o-mini";

Â  Â  Â  Â  Â  Â  Â  Â  return dom.modelSelector.value;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  async function getAIResponse(prompt, history, image, pdf, model, workflow, userName, financialData = null) {

Â  Â  Â  Â  Â  Â  Â  Â  const name = (userName || '').split(' ')[0];

Â  Â  Â  Â  Â  Â  Â  Â  let title = 'Jefe';

Â  Â  Â  Â  Â  Â  Â  Â  if (name.slice(-1).toLowerCase() === 'a' || ['isabel', 'dolores'].includes(name.toLowerCase())) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title = 'Jefa';

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const body = {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  prompt, history, model,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  workflow, userName: name, title,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imageData: image, pdfText: pdf,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  financialData

Â  Â  Â  Â  Â  Â  Â  Â  Â };

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/.netlify/functions/get-ai-response', {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â body: JSON.stringify(body),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorData = await response.json().catch(() => ({details: 'Error desconocido en el servidor'}));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Backend Error:", errorData);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(errorData.details || `Error del servidor: ${response.status}.`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Fetch Error:", error);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw error;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  function getCreditCount() {

Â  Â  Â  Â  Â  Â  Â  Â  const plan = currentUser?.app_metadata?.plan || 'free';

Â  Â  Â  Â  Â  Â  Â  Â  let limit = GUEST_CREDIT_LIMIT;

Â  Â  Â  Â  Â  Â  Â  Â  if (plan === 'free') limit = FREE_PLAN_CREDIT_LIMIT;

Â  Â  Â  Â  Â  Â  Â  Â  if (plan === 'boost') limit = BOOST_PLAN_CREDIT_LIMIT;

Â  Â  Â  Â  Â  Â  Â  Â  if (plan === 'pro') limit = Infinity;



Â  Â  Â  Â  Â  Â  Â  Â  const usageData = JSON.parse(localStorage.getItem(`usage_${currentUser?.id || 'guest'}`)) || { count: 0, date: '' };

Â  Â  Â  Â  Â  Â  Â  Â  const today = dayjs().format('YYYY-MM-DD');



Â  Â  Â  Â  Â  Â  Â  Â  if (usageData.date !== today) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return { remaining: limit, limit: limit }; // Full credits for the new day

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  return { remaining: Math.max(0, limit - usageData.count), limit: limit };

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  function spendCredits(cost) {

Â  Â  Â  Â  Â  Â  Â  Â  const plan = currentUser?.app_metadata?.plan || 'free';

Â  Â  Â  Â  Â  Â  Â  Â  if (plan === 'pro') return true; // Unlimited



Â  Â  Â  Â  Â  Â  Â  Â  const usageKey = `usage_${currentUser?.id || 'guest'}`;

Â  Â  Â  Â  Â  Â  Â  Â  const today = dayjs().format('YYYY-MM-DD');

Â  Â  Â  Â  Â  Â  Â  Â  let usageData = JSON.parse(localStorage.getItem(usageKey)) || { count: 0, date: '' };



Â  Â  Â  Â  Â  Â  Â  Â  // Reset daily count if it's a new day

Â  Â  Â  Â  Â  Â  Â  Â  if (usageData.date !== today) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  usageData = { count: 0, date: today };

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const { remaining } = getCreditCount();



Â  Â  Â  Â  Â  Â  Â  Â  if (remaining >= cost) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  usageData.count += cost;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem(usageKey, JSON.stringify(usageData));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateCreditCounter();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return true;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  // If daily credits are not enough, try to use gamification credits

Â  Â  Â  Â  Â  Â  Â  Â  if (gamificationState.credits >= cost) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.credits -= cost;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveGamificationState(); // This will also call updateCreditCounter

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return true;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  // Not enough credits from any source

Â  Â  Â  Â  Â  Â  Â  Â  return false;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  async function loadStateForUser() {

Â  Â  Â  Â  Â  Â  Â  Â  if (!currentUser) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const saved = localStorage.getItem('guestState');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state = saved ? JSON.parse(saved).state : { chats: {}, projects: {}, structure: [], calendar: {} };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChatId = saved ? JSON.parse(saved).currentChatId : null;

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/.netlify/functions/load-chats', {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ userId: currentUser.id }),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) { throw new Error(`Server error: ${response.status}`); }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dbState = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state = dbState.state || { chats: {}, projects: {}, structure: [], calendar: {} };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChatId = dbState.currentChatId;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Could not load from DB, falling back to localStorage:", error);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const saved = localStorage.getItem(`goatbotState_${currentUser.id}`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parsed = saved ? JSON.parse(saved) : {};

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state = parsed.state || { chats: {}, projects: {}, structure: [], calendar: {} };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChatId = parsed.currentChatId;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  state.calendar = state.calendar || {};

Â  Â  Â  Â  Â  Â  Â  Â  state.projects = state.projects || {};

Â  Â  Â  Â  Â  Â  Â  Â  state.chats = state.chats || {};

Â  Â  Â  Â  Â  Â  Â  Â  state.structure = state.structure || [];

Â  Â  Â  Â  Â  Â  Â  Â  // Ensure project data has a view property

Â  Â  Â  Â  Â  Â  Â  Â  Object.values(state.chats).forEach(chat => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (chat.projectData && !chat.projectData.currentView) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chat.projectData.currentView = 'kanban';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  loadGamificationState();

Â  Â  Â  Â  Â  Â  Â  Â  renderSidebar();

Â  Â  Â  Â  Â  Â  Â  Â  selectChat(currentChatId);

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  async function saveState() {

Â  Â  Â  Â  Â  Â  Â  Â  const stateData = { state, currentChatId };

Â  Â  Â  Â  Â  Â  Â  Â  if (!currentUser) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try { localStorage.setItem('guestState', JSON.stringify(stateData)); }Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  catch (e) { console.error("Guest localStorage is full.", e); }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await fetch('/.netlify/functions/save-chats', {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ userId: currentUser.id, stateToSave: stateData }),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) { console.error("Failed to save state to DB:", error); }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  function updateUserUI() {

Â  Â  Â  Â  Â  Â  Â  Â  if (currentUser) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.loginView.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.userMenuView.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.genericWelcome.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.personalizedWelcome.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userName = currentUser.user_metadata?.full_name?.split(' ')[0] || currentUser.email.split('@')[0];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.userEmail.textContent = currentUser.user_metadata?.full_name || currentUser.email;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.userName.textContent = userName;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.upgradePlanContainer.classList.toggle('hidden', (currentUser.app_metadata?.plan || 'free') !== 'free');

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.loginView.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.userMenuView.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.genericWelcome.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.personalizedWelcome.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.upgradePlanContainer.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  updateCreditCounter();

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function updateCreditCounter() {

Â  Â  Â  Â  Â  Â  Â  Â  const { remaining, limit } = getCreditCount();

Â  Â  Â  Â  Â  Â  Â  Â  const gamCredits = gamificationState.credits || 0;

Â  Â  Â  Â  Â  Â  Â  Â  let displayLimit = limit === Infinity ? 'âˆž' : limit;

Â  Â  Â  Â  Â  Â  Â  Â  dom.messageCounterEl.innerHTML = `${remaining}/${displayLimit} <i class="fas fa-coins text-gold ml-2 mr-1" title="CrÃ©ditos de Recompensa"></i> ${gamCredits}`;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function setTheme(isDark) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  document.body.className = 'w-screen overflow-x-hidden';

Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.add(isDark ? 'dark-theme' : 'light-theme');

Â  Â  Â  Â  Â  Â  Â  Â  dom.themeIcon.className = `fas fa-${isDark ? 'sun' : 'moon'}`;Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (dom.settingsThemeIcon) dom.settingsThemeIcon.className = `fas fa-${isDark ? 'moon' : 'sun'} mr-2`;

Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('theme', isDark ? 'dark' : 'light');

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function toggleSidebar(show) {

Â  Â  Â  Â  Â  Â  Â  Â  const sidebar = dom.sidebar;

Â  Â  Â  Â  Â  Â  Â  Â  if (show) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sidebar.classList.add('is-open');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.sidebarOverlay.classList.remove('pointer-events-none');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.sidebarOverlay.classList.add('opacity-50');

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sidebar.classList.remove('is-open');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.sidebarOverlay.classList.add('pointer-events-none');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.sidebarOverlay.classList.remove('opacity-50');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  function createNewChat(options = {}) {

Â  Â  Â  Â  Â  Â  Â  Â  const id = 'chat-' + crypto.randomUUID();

Â  Â  Â  Â  Â  Â  Â  Â  const name = currentUser ? (currentUser.user_metadata.full_name?.split(' ')[0] || 'TÃº') : 'viajero';

Â  Â  Â  Â  Â  Â  Â  Â  let title = 'Jefe';

Â  Â  Â  Â  Â  Â  Â  Â  if (name.slice(-1).toLowerCase() === 'a' || ['isabel', 'dolores'].includes(name.toLowerCase())) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title = 'Jefa';

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const initialMessages = options.initialMessages ||

Â  Â  Â  Â  Â  Â  Â  Â  [{Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  role: 'assistant',Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content: `Saludos, ${title}. Soy Goatify IA, aquÃ­ para servirte. Cada idea tuya es una estrella a punto de nacer. Â¿En quÃ© universo nos sumergimos hoy?`Â 

Â  Â  Â  Â  Â  Â  Â  Â  }];

Â  Â  Â  Â  Â  Â  Â  Â  state.chats[id] = {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id,Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: options.title || "ConversaciÃ³n CÃ³smica",Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messages: initialMessages,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  workflow: options.workflow || null,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  model: options.model || 'gpt-3.5-turbo-1106'

Â  Â  Â  Â  Â  Â  Â  Â  };Â 

Â  Â  Â  Â  Â  Â  Â  Â  state.structure.unshift(id);Â 

Â  Â  Â  Â  Â  Â  Â  Â  selectChat(id);Â 

Â  Â  Â  Â  Â  Â  Â  Â  saveState();

Â  Â  Â  Â  Â  Â  Â  Â  renderSidebar();Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.modelSelector.value = options.model || 'gpt-3.5-turbo-1106';

Â  Â  Â  Â  Â  Â  Â  Â  if (window.innerWidth < 768) toggleSidebar(false);

Â  Â  Â  Â  Â  Â  Â  Â  return id;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function selectChat(chatId) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (isSelectModeActive) return;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  // Clear any special UI before loading the new one

Â  Â  Â  Â  Â  Â  Â  Â  const financialAssistantUI = dom.chatMessages.querySelector('#financial-assistant-container');

Â  Â  Â  Â  Â  Â  Â  Â  if (financialAssistantUI) financialAssistantUI.remove();

Â  Â  Â  Â  Â  Â  Â  Â  dom.welcomeMessageWrapper.style.display = 'flex'; // Show welcome message by default



Â  Â  Â  Â  Â  Â  Â  Â  if (!chatId || !state.chats[chatId]) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resetChatView();Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 

Â  Â  Â  Â  Â  Â  Â  Â  }Â 



Â  Â  Â  Â  Â  Â  Â  Â  currentChatId = chatId;

Â  Â  Â  Â  Â  Â  Â  Â  const chat = state.chats[chatId];Â 

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.initialViewContainer.style.display = 'none';



Â  Â  Â  Â  Â  Â  Â  Â  if (chat.workflow === 'project-management') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.chatMessagesView.style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.inputArea.style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.projectManagementView.style.display = 'flex';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderProjectView(chatId);

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.projectManagementView.style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.chatMessagesView.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.inputArea.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.chatMessages.innerHTML = '';Â 



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(chat.workflow === 'financial-assistant') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderFinancialAssistant(chat.messages);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chat.messages.forEach((msg, index) => addMessageToUI(msg.role, msg.content, msg.image, index, dom.chatMessages));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  dom.chatTitle.textContent = chat.title;

Â  Â  Â  Â  Â  Â  Â  Â  dom.mobileChatTitle.textContent = chat.title;

Â  Â  Â  Â  Â  Â  Â  Â  dom.modelSelector.value = chat.model || 'gpt-3.5-turbo-1106';

Â  Â  Â  Â  Â  Â  Â  Â  updateActiveChatHighlight();Â 

Â  Â  Â  Â  Â  Â  Â  Â  saveState();

Â  Â  Â  Â  Â  Â  Â  Â  updateContextualFooter(chat.workflow);

Â  Â  Â  Â  Â  Â  Â  Â  if (window.innerWidth < 768) toggleSidebar(false);

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function resetChatView() {Â 

Â  Â  Â  Â  Â  Â  Â  Â  currentChatId = null;

Â  Â  Â  Â  Â  Â  Â  Â  dom.chatTitle.textContent = "Goatify IA";

Â  Â  Â  Â  Â  Â  Â  Â  dom.mobileChatTitle.textContent = "Goatify IA";



Â  Â  Â  Â  Â  Â  Â  Â  dom.chatMessagesView.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  dom.inputArea.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  dom.projectManagementView.style.display = 'none';



Â  Â  Â  Â  Â  Â  Â  Â  dom.chatMessages.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  Â const financialAssistantUI = dom.chatMessages.querySelector('#financial-assistant-container');

Â  Â  Â  Â  Â  Â  Â  Â  if (financialAssistantUI) financialAssistantUI.remove();

Â  Â  Â  Â  Â  Â  Â  Â  dom.welcomeMessageWrapper.style.display = 'flex';

Â  Â  Â  Â  Â  Â  Â  Â  dom.initialViewContainer.style.display = 'flex';Â 



Â  Â  Â  Â  Â  Â  Â  Â  updateUserUI();Â 

Â  Â  Â  Â  Â  Â  Â  Â  updateActiveChatHighlight();Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.modelSelector.value = 'gpt-3.5-turbo-1106';

Â  Â  Â  Â  Â  Â  Â  Â  updateContextualFooter(null);

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function addMessageToUI(role, content, imageSrc, messageIndex, container) {

Â  Â  Â  Â  Â  Â  Â  Â  const wrapper = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  wrapper.className = `chat-bubble-wrapper group flex items-start gap-2 my-2 ${role === 'user' ? 'justify-end' : 'justify-start'}`;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const bubble = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  bubble.className = `p-3 md:p-4 rounded-xl max-w-lg md:max-w-xl ${role === 'user' ? 'chat-bubble-user' : 'chat-bubble-bot'}`;

Â  Â  Â  Â  Â  Â  Â  Â  if (imageSrc) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const img = document.createElement('img');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  img.src = imageSrc;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  img.className = 'rounded-lg mb-2 max-w-full h-auto';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bubble.appendChild(img);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const contentDiv = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  contentDiv.className = 'markdown-content';

Â  Â  Â  Â  Â  Â  Â  Â  contentDiv.innerHTML = content === 'â€¦' ? `<div class="flex items-center space-x-2"><div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: .2s;"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: .4s;"></div></div>` : marked.parse(content || "");

Â  Â  Â  Â  Â  Â  Â  Â  bubble.appendChild(contentDiv);



Â  Â  Â  Â  Â  Â  Â  Â  if (role === 'user' && container === dom.chatMessages) { // Only show edit for main chat

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const editBtn = document.createElement('button');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editBtn.className = 'p-1 text-text-medium opacity-100 transition-opacity';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editBtn.innerHTML = '<i class="fas fa-pencil-alt fa-xs"></i>';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editBtn.title = 'Editar mensaje';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editBtn.onclick = (e) => { e.stopPropagation(); handleEditMessage(messageIndex); };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wrapper.insertBefore(editBtn, wrapper.firstChild);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (role === 'assistant' && /<\/?[a-z][\s\S]*>/i.test(content)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const previewButton = document.createElement('button');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewButton.innerHTML = '<i class="fas fa-eye mr-2"></i>Vista Previa';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewButton.className = 'btn-primary text-xs font-semibold px-3 py-1 rounded-md mt-3';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewButton.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const match = content.match(/```html\n([\s\S]*?)```/);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const htmlToPreview = match ? match[1] : content;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.htmlPreviewIframe.srcdoc = htmlToPreview;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â dom.htmlPreviewModal.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.htmlPreviewModal.classList.add('flex');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bubble.appendChild(previewButton);

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  wrapper.appendChild(bubble);Â 

Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(wrapper);

Â  Â  Â  Â  Â  Â  Â  Â  container.scrollTop = container.scrollHeight;

Â  Â  Â  Â  Â  Â  Â  Â  return bubble;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  async function handleEditMessage(index) {

Â  Â  Â  Â  Â  Â  Â  Â  const chat = state.chats[currentChatId];

Â  Â  Â  Â  Â  Â  Â  Â  if (!chat || !chat.messages[index]) return;

Â  Â  Â  Â  Â  Â  Â  Â  const originalContent = chat.messages[index].content;

Â  Â  Â  Â  Â  Â  Â  Â  const result = await showModal({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'Editar Mensaje',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: `<textarea id="edit-msg-textarea" class="w-full p-2 rounded bg-input border border-themed h-28">${originalContent}</textarea>`,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmText: 'Guardar Cambios'

Â  Â  Â  Â  Â  Â  Â  Â  Â });

Â  Â  Â  Â  Â  Â  Â  Â  if (result.confirmed && result.data['edit-msg-textarea'] && result.data['edit-msg-textarea'].trim() !== originalContent.trim()) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chat.messages[index].content = result.data['edit-msg-textarea'].trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await saveState();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectChat(currentChatId);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function updateMessageInUI(bubble, content, imageSrc, container) {

Â  Â  Â  Â  Â  Â  Â  Â  const newBubble = addMessageToUI('assistant', content, imageSrc, null, container);

Â  Â  Â  Â  Â  Â  Â  Â  if (bubble && bubble.parentElement) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bubble.parentElement.replaceWith(newBubble.parentElement);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â if(container) container.scrollTop = container.scrollHeight;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  function renderSidebar() {Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.sidebarContent.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  const frag = document.createDocumentFragment();Â 

Â  Â  Â  Â  Â  Â  Â  Â  (state.structure || []).forEach(id => {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (id.startsWith('project-')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frag.appendChild(createProjectElement(id));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (id.startsWith('chat-')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frag.appendChild(createChatItemElement(id));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.sidebarContent.appendChild(frag);Â 

Â  Â  Â  Â  Â  Â  Â  Â  updateActiveChatHighlight();Â 

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function createChatItemElement(id, isSubItem = false) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  const chat = state.chats[id];

Â  Â  Â  Â  Â  Â  Â  Â  if (!chat) return document.createDocumentFragment();Â 

Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');Â 

Â  Â  Â  Â  Â  Â  Â  Â  item.className = `chat-item group flex items-center justify-between p-2 rounded-md cursor-pointer ${isSubItem ? 'pl-5' : ''}`; item.dataset.id = id;Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (isSelectModeActive) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.draggable = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isSelected = chatsToDelete.has(id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `<i class="far ${isSelected ? 'fa-check-square' : 'fa-square'} mr-2 text-primary"></i><span class="flex-grow truncate text-sm font-medium">${chat.title}</span>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isSelected) item.classList.add('selected-for-delete');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (chatsToDelete.has(id)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatsToDelete.delete(id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.querySelector('i').classList.replace('fa-check-square', 'fa-square');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â item.classList.remove('selected-for-delete');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatsToDelete.add(id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.querySelector('i').classList.replace('fa-square', 'fa-check-square');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.classList.add('selected-for-delete');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.deleteSelectedBtn.disabled = chatsToDelete.size === 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.draggable = true;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `<i class="far fa-comment-dots mr-2"></i><span class="flex-grow truncate text-sm font-medium">${chat.title}</span><div class="chat-item-actions flex-shrink-0"><button class="rename-btn text-text-medium hover:text-primary p-1"><i class="fas fa-pencil-alt fa-xs"></i></button><button class="delete-btn text-text-medium hover:text-red-500 p-1"><i class="fas fa-trash-alt fa-xs"></i></button></div>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.addEventListener('click', e => { if (!e.target.closest('.chat-item-actions')) selectChat(id); });Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.addEventListener('dragstart', e => handleDragStart(e, id)); item.querySelector('.rename-btn').addEventListener('click', () => renameItem('chat', id));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.querySelector('.delete-btn').addEventListener('click', () => deleteItem('chat', id));

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  return item;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function createProjectElement(id) {

Â  Â  Â  Â  Â  Â  Â  Â  const project = state.projects[id];

Â  Â  Â  Â  Â  Â  Â  Â  if (!project) return document.createDocumentFragment();

Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div'); div.className = 'project'; div.dataset.id = id;

Â  Â  Â  Â  Â  Â  Â  Â  const header = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  header.className = 'project-header group flex items-center p-2 rounded-md cursor-pointer';

Â  Â  Â  Â  Â  Â  Â  Â  header.innerHTML = `<i class="fas fa-chevron-right project-arrow mr-2 transition-transform"></i><i class="fas fa-folder mr-2 text-yellow-500"></i><span class="flex-grow truncate text-sm font-bold">${project.title}</span><div class="chat-item-actions flex-shrink-0"><button class="rename-btn text-text-medium hover:text-primary p-1"><i class="fas fa-pencil-alt fa-xs"></i></button><button class="delete-btn text-text-medium hover:text-red-500 p-1"><i class="fas fa-trash-alt fa-xs"></i></button></div>`;

Â  Â  Â  Â  Â  Â  Â  Â  const content = document.createElement('div'); content.className = 'project-content pl-2 pt-1 space-y-1';

Â  Â  Â  Â  Â  Â  Â  Â  (project.chatIds || []).forEach(chatId => content.appendChild(createChatItemElement(chatId, true)));

Â  Â  Â  Â  Â  Â  Â  Â  div.append(header, content);

Â  Â  Â  Â  Â  Â  Â  Â  header.addEventListener('click', e => { if (!e.target.closest('.chat-item-actions')) div.classList.toggle('open'); });

Â  Â  Â  Â  Â  Â  Â  Â  header.addEventListener('dragover', e => handleDragOver(e, header));

Â  Â  Â  Â  Â  Â  Â  Â  header.addEventListener('dragleave', e => handleDragLeave(e, header));

Â  Â  Â  Â  Â  Â  Â  Â  header.addEventListener('drop', e => handleDrop(e, id, header));

Â  Â  Â  Â  Â  Â  Â  Â  header.querySelector('.rename-btn').addEventListener('click', () => renameItem('project', id));

Â  Â  Â  Â  Â  Â  Â  Â  header.querySelector('.delete-btn').addEventListener('click', () => deleteItem('project', id));

Â  Â  Â  Â  Â  Â  Â  Â  return div;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  let draggedItemId = null;

Â  Â  Â  Â  Â  Â  function handleDragStart(e, id) { draggedItemId = id; e.dataTransfer.effectAllowed = 'move'; e.dataTransfer.setData('text/plain', id); } function handleDragOver(e, el) { e.preventDefault(); el.classList.add('drag-over');

Â  Â  Â  Â  Â  Â  } function handleDragLeave(e, el) { el.classList.remove('drag-over'); }

Â  Â  Â  Â  Â  Â  function handleDrop(e, targetProjectId, targetElement) {

Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  Â  Â  if (targetElement) targetElement.classList.remove('drag-over');

Â  Â  Â  Â  Â  Â  Â  Â  const sourceChatId = e.dataTransfer.getData('text/plain');

Â  Â  Â  Â  Â  Â  Â  Â  if (!sourceChatId || !sourceChatId.startsWith('chat-') || targetProjectId === sourceChatId) return;

Â  Â  Â  Â  Â  Â  Â  Â  state.structure = state.structure.filter(id => id !== sourceChatId);Â 

Â  Â  Â  Â  Â  Â  Â  Â  Object.values(state.projects).forEach(p => { if(p.chatIds) p.chatIds = p.chatIds.filter(id => id !== sourceChatId) });

Â  Â  Â  Â  Â  Â  Â  Â  if(state.projects[targetProjectId]){Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!state.projects[targetProjectId].chatIds) state.projects[targetProjectId].chatIds = [];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.projects[targetProjectId].chatIds.unshift(sourceChatId);Â 

Â  Â  Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  Â  Â  saveState(); renderSidebar();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  async function renameItem(type, id) {

Â  Â  Â  Â  Â  Â  Â  Â  const item = type === 'chat' ? state.chats[id] : state.projects[id];

Â  Â  Â  Â  Â  Â  Â  Â  if(!item) return;

Â  Â  Â  Â  Â  Â  Â  Â  const result = await showModal({Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: `Renombrar ${type === 'chat' ? 'ConversaciÃ³n' : 'Proyecto'}`,Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: `<input type="text" id="rename-input" class="w-full p-2 rounded bg-input border border-themed" value="${item.title}">`,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmText: 'Renombrar'

Â  Â  Â  Â  Â  Â  Â  Â  Â });

Â  Â  Â  Â  Â  Â  Â  Â  if (result.confirmed && result.data['rename-input'] && result.data['rename-input'].trim()) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.title = result.data['rename-input'].trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (type === 'chat' && currentChatId === id) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.chatTitle.textContent = item.title;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (dom.mobileChatTitle) dom.mobileChatTitle.textContent = item.title;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (state.chats[currentChatId].projectData) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â state.chats[currentChatId].projectData.title = item.title;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â dom.projectViewTitle.textContent = item.title;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderSidebar();

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  async function deleteItem(type, id) { const item = type === 'chat' ? state.chats[id] : state.projects[id]; const confResult = await showModal({ title: `Eliminar ${item.title}?`, body: 'Esta acciÃ³n no se puede deshacer.', confirmText: 'Eliminar' });

Â  Â  Â  Â  Â  Â  if (confResult.confirmed) { state.structure = state.structure.filter(i => i !== id);

Â  Â  Â  Â  Â  Â  if (type === 'project') { (item.chatIds || []).forEach(cid => delete state.chats[cid]); delete state.projects[id]; } else { delete state.chats[id];

Â  Â  Â  Â  Â  Â  Object.values(state.projects).forEach(p => { if(p.chatIds) p.chatIds = p.chatIds.filter(cid => cid !== id)});

Â  Â  Â  Â  Â  Â  } if(currentChatId === id || (type === 'project' && (item.chatIds || []).includes(currentChatId))) resetChatView(); saveState(); renderSidebar();

Â  Â  Â  Â  Â  Â  } }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  function updateActiveChatHighlight() {Â 

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.chat-item').forEach(item => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (item.dataset.id === currentChatId) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.classList.add('selected-chat');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.classList.remove('selected-chat');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function clearImageData() { dom.imageUploadInput.value = ''; dom.imagePreviewContainer.classList.add('hidden'); selectedImageBase64 = null; }

Â  Â  Â  Â  Â  Â  function clearPdfData() { dom.pdfUploadInput.value = ''; dom.pdfPreviewContainer.classList.add('hidden'); selectedPdfText = null; }

Â  Â  Â  Â  Â  Â  function hasFile() { return selectedImageBase64 || selectedPdfText; }

Â  Â  Â  Â  Â  Â  async function sendMessage(forceSend = false, spokenMessage = null, isProjectChat = false) {

Â  Â  Â  Â  Â  Â  Â  Â  const inputEl = isProjectChat ? dom.projectMsgInput : dom.msgInput;

Â  Â  Â  Â  Â  Â  Â  Â  const userMessage = spokenMessage || inputEl.value.trim();

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const currentChat = state.chats[currentChatId];

Â  Â  Â  Â  Â  Â  Â  Â  if (!currentChat) return;



Â  Â  Â  Â  Â  Â  Â  Â  if (!userMessage && !selectedImageBase64 && !selectedPdfText && currentChat.workflow !== 'financial-assistant') return;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const messageContainer = isProjectChat ? dom.projectChatMessages : dom.chatMessages;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  let modelToUse = getModelForRequest(currentChat.workflow, hasFile(), isProjectChat);

Â  Â  Â  Â  Â  Â  Â  Â  const webSearchTriggers = ['busca', 'investiga', 'en internet', 'tiempo real', 'quÃ© dÃ­a es hoy', 'quÃ© fecha es hoy', 'cuÃ¡l es el precio de', 'quiÃ©n es', 'quÃ© es', 'noticias sobre'];

Â  Â  Â  Â  Â  Â  Â  Â  const requiresWebSearch = webSearchTriggers.some(trigger => userMessage.toLowerCase().startsWith(trigger));

Â  Â  Â  Â  Â  Â  Â  Â  if (requiresWebSearch && !hasFile() && !currentChat.workflow) { modelToUse = 'sonar';

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  let cost = COSTS.GENERAL;

Â  Â  Â  Â  Â  Â  Â  Â  if(currentChat.workflow) cost = COSTS.COPYWRITING;

Â  Â  Â  Â  Â  Â  Â  Â  if(modelToUse === 'sonar') cost = COSTS.SEARCH;

Â  Â  Â  Â  Â  Â  Â  Â  if(hasFile()) cost = COSTS.NEBULA;



Â  Â  Â  Â  Â  Â  Â  Â  if (!spendCredits(cost)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal({ title: 'CrÃ©ditos Insuficientes', body: 'No tienes suficientes crÃ©ditos de tu plan ni crÃ©ditos de recompensa. Mejora tu plan para continuar.', confirmText: 'Ver Planes' }).then(res => { if (res.confirmed) showPricingModal(); });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  if(currentChat.title === 'ConversaciÃ³n CÃ³smica' && userMessage.length > 5 && !isProjectChat) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChat.title = userMessage.split(' ').slice(0, 4).join(' ');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderSidebar();

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const [image, pdf] = [selectedImageBase64, selectedPdfText];

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  // For financial assistant, gather data from the UI

Â  Â  Â  Â  Â  Â  Â  Â  let financialData = null;

Â  Â  Â  Â  Â  Â  Â  Â  if (currentChat.workflow === 'financial-assistant') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  financialData = { incomes: [], expenses: [] };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('#fin-incomes-list .fin-row').forEach(row => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const desc = row.querySelector('.fin-desc').value;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const amount = parseFloat(row.querySelector('.fin-amount').value);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(desc && !isNaN(amount)) financialData.incomes.push({desc, amount});

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('#fin-expenses-list .fin-row').forEach(row => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const desc = row.querySelector('.fin-desc').value;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const amount = parseFloat(row.querySelector('.fin-amount').value);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(desc && !isNaN(amount)) financialData.expenses.push({desc, amount});

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  currentChat.messages.push({ role: 'user', content: userMessage, image, pdfText: pdf });

Â  Â  Â  Â  Â  Â  Â  Â  if(currentChat.workflow !== 'financial-assistant') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addMessageToUI('user', userMessage, image, currentChat.messages.length - 1, messageContainer);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const thinkingBubble = addMessageToUI('assistant', 'â€¦', null, null, messageContainer);



Â  Â  Â  Â  Â  Â  Â  Â  inputEl.value = '';

Â  Â  Â  Â  Â  Â  Â  Â  inputEl.style.height = 'auto'; clearImageData(); clearPdfData();

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userNameForCall = currentUser ? (currentUser.user_metadata.full_name || currentUser.email) : 'viajero';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const responseData = await getAIResponse(userMessage, currentChat.messages.slice(0, -1), image, pdf, modelToUse, currentChat.workflow, userNameForCall, financialData);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateCreditCounter();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChat.messages.push({ role: 'assistant', content: responseData.reply });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateMessageInUI(thinkingBubble, responseData.reply, null, messageContainer);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  speak(responseData.reply);



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Mission Completion Check

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentChat.workflow) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completeMission(currentChat.workflow, currentChatId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentChat.workflow === 'project-management' && responseData.projectUpdate && responseData.projectUpdate.tasks) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const todoColumn = currentChat.projectData.columns.find(c => c.id === 'todo');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (todoColumn) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responseData.projectUpdate.tasks.forEach(task => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!todoColumn.tasks) todoColumn.tasks = [];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â todoColumn.tasks.push({ id: `proj-${crypto.randomUUID()}`, content: task.content, completed: false, labels: task.labels || [], urgent: false });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderProjectBoard(currentChatId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateMessageInUI(thinkingBubble, `âŒ **Error de ConexiÃ³n**<br><small>${error.message || 'No se pudo conectar al servidor.'}</small>`, null, messageContainer);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  async function generateImage() {

Â  Â  Â  Â  Â  Â  Â  Â  const result = await showModal({ title: 'Crear Imagen', body: 'Describe la imagen que quieres crear:<br><input type="text" id="img-prompt" class="w-full p-2 rounded bg-input border border-themed mt-2" placeholder="Ej: Un astronauta en un caballo cÃ³smico">', confirmText: 'Generar' });

Â  Â  Â  Â  Â  Â  Â  Â  if (!result.confirmed || !result.data['img-prompt']) return;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (!spendCredits(COSTS.IMAGE)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal({ title: 'CrÃ©ditos Insuficientes', body: `Necesitas ${COSTS.IMAGE} crÃ©ditos para generar una imagen.`, confirmText: 'Ver Planes' }).then(res => { if (res.confirmed) showPricingModal(); });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  let chatIdToUpdate = currentChatId || createNewChat({});

Â  Â  Â  Â  Â  Â  Â  Â  const currentChat = state.chats[chatIdToUpdate];

Â  Â  Â  Â  Â  Â  Â  Â  currentChat.messages.push({ role: 'user', content: `Generar imagen: "${result.data['img-prompt']}"` });

Â  Â  Â  Â  Â  Â  Â  Â  addMessageToUI('user', `Generar imagen: "${result.data['img-prompt']}"`, null, currentChat.messages.length - 1, dom.chatMessages);

Â  Â  Â  Â  Â  Â  Â  Â  const thinkingBubble = addMessageToUI('assistant', 'Creando tu visiÃ³n con DALLÂ·E 3...', null, null, dom.chatMessages);

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/.netlify/functions/generate-image', {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â body: JSON.stringify({ prompt: result.data['img-prompt'], model: 'dall-e-3' })

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) { throw new Error((await response.json()).error || 'Error del servidor'); }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { imageData } = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imageContent = `Â¡AquÃ­ estÃ¡ tu creaciÃ³n, Jefe/a!`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentChat.messages.push({ role: 'assistant', content: imageContent, image: imageData });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateMessageInUI(thinkingBubble, imageContent, imageData, dom.chatMessages);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completeMission('image-generated');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateMessageInUI(thinkingBubble, `âŒ **Error al crear la imagen:**<br><small>${error.message}</small>`, null, dom.chatMessages);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function toggleSelectMode(active) {

Â  Â  Â  Â  Â  Â  Â  Â  isSelectModeActive = active;

Â  Â  Â  Â  Â  Â  Â  Â  dom.selectChatsBtn.classList.toggle('hidden', active);

Â  Â  Â  Â  Â  Â  Â  Â  dom.deleteModeControls.classList.toggle('hidden', !active);

Â  Â  Â  Â  Â  Â  Â  Â  if (!active) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatsToDelete.clear();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.deleteSelectedBtn.disabled = true;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  renderSidebar();

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function setupModalClickOutside(modalElement, hideFunction) {

Â  Â  Â  Â  Â  Â  Â  Â  if (!modalElement) return;

Â  Â  Â  Â  Â  Â  Â  Â  modalElement.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target === modalElement) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideFunction();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  function toggleVoiceSelectorVisibility(show) {

Â  Â  Â  Â  Â  Â  Â  Â  dom.voiceSelectorContainer.classList.toggle('hidden', !show);

Â  Â  Â  Â  Â  Â  Â  Â  dom.actionButtonsContainer.classList.toggle('hidden', show);

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // This is the start of the final script part

Â  Â  Â  Â  Â  Â  function setupEventListeners() {

Â  Â  Â  Â  Â  Â  Â  Â  dom.sendBtn?.addEventListener('click', () => sendMessage(false, null, false));

Â  Â  Â  Â  Â  Â  Â  Â  dom.projectSendBtn?.addEventListener('click', () => sendMessage(false, null, true));



Â  Â  Â  Â  Â  Â  Â  Â  const setupInput = (input, isProject) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input?.addEventListener('keydown', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.key === 'Enter' && !e.shiftKey) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â sendMessage(false, null, isProject);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input?.addEventListener('input', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.style.height = 'auto';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.style.height = (input.scrollHeight) + 'px';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  setupInput(dom.msgInput, false);

Â  Â  Â  Â  Â  Â  Â  Â  setupInput(dom.projectMsgInput, true);



Â  Â  Â  Â  Â  Â  Â  Â  dom.newChatBtn?.addEventListener('click', () => createNewChat());

Â  Â  Â  Â  Â  Â  Â  Â  dom.newChatIconBtn?.addEventListener('click', () => createNewChat());

Â  Â  Â  Â  Â  Â  Â  Â  dom.newFolderBtn?.addEventListener('click', async () => { const result = await showModal({ title: 'Crear Nueva Carpeta', body: '<input type="text" id="project-name" class="w-full p-2 rounded bg-input border border-themed" placeholder="Nombre de la Carpeta...">', confirmText: 'Crear' }); if (result.confirmed && result.data['project-name'].trim()) { const id = 'project-' + crypto.randomUUID(); state.projects[id] = { id, title: result.data['project-name'].trim(), chatIds: [] }; state.structure.unshift(id); saveState(); renderSidebar(); } });

Â  Â  Â  Â  Â  Â  Â  Â  dom.upgradePlanBtn?.addEventListener('click', showPricingModal);

Â  Â  Â  Â  Â  Â  Â  Â  dom.closePricingModalBtn?.addEventListener('click', hidePricingModal);

Â  Â  Â  Â  Â  Â  Â  Â  dom.themeToggle?.addEventListener('click', () => setTheme(!document.body.classList.contains('dark-theme')));

Â  Â  Â  Â  Â  Â  Â  Â  dom.loginBtn?.addEventListener('click', () => netlifyIdentity.open('login'));

Â  Â  Â  Â  Â  Â  Â  Â  dom.sidebarToggleDesktop?.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const icon = dom.sidebarToggleDesktop.querySelector('i');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.sidebar.classList.toggle('collapsed');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon.classList.toggle('fa-angle-left');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon.classList.toggle('fa-angle-right');

Â  Â  Â  Â  Â  Â  Â  Â  Â });



Â  Â  Â  Â  Â  Â  Â  Â  dom.chatTitleWrapper?.addEventListener('click', () => { if(currentChatId) renameItem('chat', currentChatId); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.mobileChatTitleWrapper?.addEventListener('click', () => { if(currentChatId) renameItem('chat', currentChatId); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.imageGenBtn?.addEventListener('click', generateImage);

Â  Â  Â  Â  Â  Â  Â  Â  dom.pdfUploadBtn?.addEventListener('click', () => dom.pdfUploadInput.click());

Â  Â  Â  Â  Â  Â  Â  Â  dom.imageUploadBtn?.addEventListener('click', () => dom.imageUploadInput.click());

Â  Â  Â  Â  Â  Â  Â  Â  if (SR && dom.micBtn) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition = new SR();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition.continuous = false; recognition.interimResults = false; recognition.lang = 'es-ES';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition.onstart = () => { isRecognizing = true; dom.micBtn.classList.add('glowing-mic'); toggleVoiceSelectorVisibility(true);};

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition.onend = () => { isRecognizing = false; dom.micBtn.classList.remove('glowing-mic'); if (!speechSynthesis.speaking) toggleVoiceSelectorVisibility(false); };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition.onerror = (e) => { console.error("Speech recognition error", e); isRecognizing = false; dom.micBtn.classList.remove('glowing-mic'); toggleVoiceSelectorVisibility(false); };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition.onresult = (event) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const transcript = event.results[0][0].transcript;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const activeInput = dom.projectManagementView.style.display === 'flex' ? dom.projectMsgInput : dom.msgInput;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(transcript) { activeInput.value = transcript; sendMessage(false, null, activeInput === dom.projectMsgInput);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.micBtn.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(isRecognizing) { recognition.stop(); }Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else { if (speechSynthesis.speaking) { speechSynthesis.cancel(); } try { recognition.start(); } catch(e) {console.error("Could not start recognition", e)} }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  } else { if(dom.micBtn) dom.micBtn.style.display = 'none'; }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.ttsToggle?.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  speechOn = !speechOn;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const icon = dom.ttsToggle.querySelector('i');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â icon.classList.toggle('fa-volume-high', speechOn);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon.classList.toggle('fa-volume-mute', !speechOn);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!speechOn) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  speechSynthesis.cancel();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â });



Â  Â  Â  Â  Â  Â  Â  Â  dom.modelSelector?.addEventListener('change', () => {});

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.clearImageBtn?.addEventListener('click', clearImageData);

Â  Â  Â  Â  Â  Â  Â  Â  dom.clearPdfBtn?.addEventListener('click', clearPdfData);

Â  Â  Â  Â  Â  Â  Â  Â  dom.imageUploadInput?.addEventListener('change', (e) => { if (e.target.files && e.target.files[0]) { clearPdfData(); const reader = new FileReader(); reader.onload = (ev) => { selectedImageBase64 = ev.target.result; dom.imagePreview.src = selectedImageBase64; dom.imagePreviewContainer.classList.remove('hidden'); }; reader.readAsDataURL(e.target.files[0]); } });

Â  Â  Â  Â  Â  Â  Â  Â  dom.pdfUploadInput?.addEventListener('change', (e) => { const file = e.target.files[0]; if (!file || file.type !== 'application/pdf') return; clearImageData(); dom.pdfNameEl.textContent = file.name; dom.pdfStatusEl.textContent = 'Leyendo...'; dom.pdfPreviewContainer.classList.remove('hidden'); const reader = new FileReader(); reader.onload = async (ev) => { dom.pdfStatusEl.textContent = 'Procesando...'; try { const pdf = await pdfjsLib.getDocument({ data: new Uint8Array(ev.target.result) }).promise; let text = ''; for (let i = 1; i <= pdf.numPages; i++) { const page = await pdf.getPage(i); const content = await page.getTextContent(); text += content.items.map(item => item.str).join(' ') + '\n'; } selectedPdfText = text; dom.pdfStatusEl.textContent = `âœ… Listo (${pdf.numPages} pÃ¡g.)`; } catch (err) { console.error("Error al procesar el PDF:", err); dom.pdfStatusEl.textContent = 'âŒ Error al leer PDF.'; selectedPdfText = null; setTimeout(clearPdfData, 2000); } }; reader.readAsArrayBuffer(file); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.menuToggle?.addEventListener('click', (e) => { e.stopPropagation(); toggleSidebar(!dom.sidebar.classList.contains('is-open')); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.sidebarOverlay?.addEventListener('click', () => toggleSidebar(false));

Â  Â  Â  Â  Â  Â  Â  Â  dom.userMenuBtn?.addEventListener('click', (e) => { e.stopPropagation(); dom.userMenuPopup.classList.toggle('hidden'); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.logoutBtn?.addEventListener('click', () => { netlifyIdentity.logout(); dom.userMenuPopup.classList.add('hidden');});

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const workflowConfigs = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'project-management': { title: "Nuevo Proyecto", workflow: 'project-management', initialMessages: [{ role: 'assistant', content: 'Â¡Excelente! Vamos a estructurar este proyecto como un profesional. Para empezar, **Â¿cuÃ¡l es el objetivo final y medible que quieres alcanzar con este proyecto?** DescrÃ­belo y luego definiremos los entregables clave.' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'create-full-post': { title: "Creador de Posts", workflow: 'create-full-post', initialMessages: [{ role: 'assistant', content: 'Â¡Claro! Vamos a crear un post increÃ­ble. Â¿Para quÃ© red social lo necesitas (Instagram, Facebook, LinkedIn, etc.)?' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'persuasive-copy': { title: "Redactor de Copys", workflow: 'persuasive-copy', initialMessages: [{ role: 'assistant', content: 'Estoy listo para redactar textos que vendan. Â¿Para quÃ© necesitas este copy? (ej: Anuncio de Facebook, Post de Venta, DescripciÃ³n de Producto)' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'post-ideas': { title: "Lluvia de Ideas", workflow: 'post-ideas', initialMessages: [{ role: 'assistant', content: 'Â¡Acabemos con el bloqueo creativo! Dime un tema y te darÃ© 7 ideas de contenido excelentes.' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'brand-strategy': { title: "Estratega de Marca", workflow: 'brand-strategy', initialMessages: [{ role: 'assistant', content: 'Definamos el corazÃ³n de tu marca. Â¿CuÃ¡l es el nombre de tu negocio y a quÃ© se dedica?' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'competitor-analysis': { title: "AnÃ¡lisis de Competencia", workflow: 'competitor-analysis', model: 'sonar', initialMessages: [{ role: 'assistant', content: "Estoy listo para analizar a tu competencia usando el buscador web. Por favor, pega la URL (direcciÃ³n web) de la pÃ¡gina que quieres que investigue para entregarte un anÃ¡lisis DAFO simplificado." }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'buyer-persona': { title: "CreaciÃ³n de Cliente Ideal", workflow: 'buyer-persona', initialMessages: [{ role: 'assistant', content: "Vamos a definir a tu cliente ideal (Buyer Persona). Describe tu producto o servicio, y te harÃ© preguntas para construir el perfil detallado paso a paso." }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'brand-names': { title: "Nombres para Marca", workflow: 'brand-names', initialMessages: [{ role: 'assistant', content: "Â¡Excelente! Busquemos un nombre increÃ­ble. Describe brevemente tu idea de negocio, tu pÃºblico y el estilo que buscas (ej. moderno, clÃ¡sico, divertido) para generar nombres y slogans." }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'sales-assistant': { title: "Asistente de Ventas", workflow: 'sales-assistant', initialMessages: [{ role: 'assistant', content: 'Para ayudarte a cerrar esa venta, pega aquÃ­ el mensaje de tu cliente.' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'email-writing': { title: "Redactor de Emails", workflow: 'email-writing', initialMessages: [{ role: 'assistant', content: 'Creemos un email que convierta. Â¿CuÃ¡l es el objetivo principal de este correo?' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'english-teacher-translate': { title: "English Translator", workflow: 'english-teacher-translate', initialMessages: [{ role: 'assistant', content: 'Of course! Please provide the text you want me to translate or correct.' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'english-teacher-vocabulary': { title: "Vocabulary Builder", workflow: 'english-teacher-vocabulary', initialMessages: [{ role: 'assistant', content: 'Excellent! Let\'s learn some new vocabulary. What topic are you interested in? (e.g., "business negotiations", "travel")' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'english-teacher-practice': { title: "Conversation Practice", workflow: 'english-teacher-practice', initialMessages: [{ role: 'assistant', content: 'Great! Let\'s practice our conversation. So, tell me about your day.' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'social-skills': { title: "Consejero Social", workflow: 'social-skills', initialMessages: [{ role: 'assistant', content: 'Las habilidades sociales son clave. Â¿En quÃ© situaciÃ³n te gustarÃ­a mejorar tu comunicaciÃ³n? (Ej: una reuniÃ³n de networking, una conversaciÃ³n difÃ­cil, etc.)' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'design-web': { title: "DiseÃ±ador Web", workflow: 'design-web', model: 'gpt-4o-mini', initialMessages: [{ role: 'assistant', content: 'Estoy listo para diseÃ±ar con cÃ³digo. Describe la pÃ¡gina o componente que quieres crear, y lo programarÃ© para ti.' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'conflict-resolution': { title: "Mediador de Conflictos", workflow: 'conflict-resolution', initialMessages: [{ role: 'assistant', content: 'Entiendo. Las situaciones difÃ­ciles requieren una comunicaciÃ³n clara. Por favor, describe el conflicto objetivamente: Â¿quiÃ©nes estÃ¡n involucrados y cuÃ¡l es el punto principal de desacuerdo?' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'decision-lab': { title: "Laboratorio de Decisiones", workflow: 'decision-lab', initialMessages: [{ role: 'assistant', content: 'Bienvenido al Laboratorio de Decisiones. Para ayudarte a analizar tu situaciÃ³n, por favor, dime: Â¿CuÃ¡l es la decisiÃ³n que necesitas tomar y quÃ© opciones estÃ¡s considerando? <br><br><em class="text-text-medium text-sm">Recuerda que una decisiÃ³n puede cambiar el rumbo de tu vida.</em>' }] },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'financial-assistant': { title: "Asistente Financiero", workflow: 'financial-assistant', initialMessages: [] }, // No initial message, UI is shown instead

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  dom.projectWorkflowHeader.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createNewChat(workflowConfigs['project-management']);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('[data-workflow]').forEach(button => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const workflowKey = button.dataset.workflow;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const config = workflowConfigs[workflowKey];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (config) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.projectManagementView.style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.chatMessagesView.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.inputArea.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.initialViewContainer.style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createNewChat({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â title: config.title,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  workflow: config.workflow,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  model: config.model,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â initialMessages: config.initialMessages

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.workflowsContainer.addEventListener('click', e => {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const header = e.target.closest('.workflow-header');Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (header && header.id !== 'project-workflow-header') {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const category = header.closest('.workflow-category');Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (category) category.classList.toggle('open');Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.webLaunchOfferBtn.addEventListener('click', () => { const offerTitle = `<i class="fas fa-gift mr-2"></i>Tu Oferta de Lanzamiento Exclusiva`; const offerMessage = `<p class="font-bold mb-2">Al suscribirte a nuestro Plan Pro por $17/mes, desbloqueas:</p><ul class="list-disc list-inside space-y-2 text-left"><li><strong>Acceso Ilimitado a Goatify IA:</strong> Todos los modelos y workflows sin restricciones.</li><li><strong>ConstrucciÃ³n de tu PÃ¡gina Web Profesional:</strong> Nosotros construiremos la primera versiÃ³n, Â¡gratis!</li></ul><p class="font-bold mt-4 mb-2">Â¿CÃ³mo funciona?</p><ol class="list-decimal list-inside space-y-1 text-left"><li><strong>Agenda tu SesiÃ³n EstratÃ©gica:</strong> Al confirmar, agenda tu llamada de 20 min.</li><li><strong>Co-creaciÃ³n:</strong> En la llamada definiremos objetivos y crearemos el borrador con IA.</li><li><strong>Entrega:</strong> Nuestro equipo lo pulirÃ¡ y te entregarÃ¡ una web de una secciÃ³n, lista.</li></ol><p class="text-xs mt-4 italic"><strong>Importante:</strong> La web es tuya para siempre. Para mantenerla online con nuestro hosting, necesitas tu suscripciÃ³n Pro activa. Si cancelas, te entregamos el cÃ³digo completo.</p>`; showModal({ title: offerTitle, body: offerMessage, confirmText: 'Agendar SesiÃ³n EstratÃ©gica' }).then(res => { if (res.confirmed) { window.open('https://calendly.com/goatify', '_blank'); } });

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.freeGuidesLink.addEventListener('click', (e) => { e.preventDefault(); const isPaidUser = currentUser && currentUser.app_metadata?.plan && currentUser.app_metadata.plan !== 'free'; if (isPaidUser) { window.open('https://goatify.app/guiasIA', '_blank'); } else { const title = 'Acceso Exclusivo para Suscriptores'; const message = 'Estas guÃ­as se actualizan semanalmente con estrategias de negocio que te ayudarÃ¡n a crecer un montÃ³n. Son un beneficio exclusivo para nuestros suscriptores. Â¡Ãšnete a un plan para desbloquearlas!'; showModal({ title, body: message, confirmText: 'Ver Planes' }).then(res => { if (res.confirmed) { showPricingModal(); } }); } });

Â  Â  Â  Â  Â  Â  Â  Â  dom.closeHtmlPreviewModalBtn?.addEventListener('click', () => { dom.htmlPreviewModal.classList.add('hidden'); dom.htmlPreviewModal.classList.remove('flex'); });

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.voiceSelector?.addEventListener('change', (e) => { selectedVoice = availableVoices.find(voice => voice.name === e.target.value); });



Â  Â  Â  Â  Â  Â  Â  Â  document.addEventListener('click', (e) => {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (dom.userMenuBtn && dom.userMenuPopup && !dom.userMenuBtn.contains(e.target) && !dom.userMenuPopup.contains(e.target)) { dom.userMenuPopup.classList.add('hidden'); }Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (dom.servicesMenu && dom.servicesMenu.classList.contains('show') && !dom.servicesMenuBtn.contains(e.target) && !e.target.closest('#services-menu')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.servicesMenu.classList.remove('show');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (dom.sidebar && window.innerWidth < 768 && dom.sidebar.classList.contains('is-open') && !dom.sidebar.contains(e.target) && !dom.menuToggle.contains(e.target)) { toggleSidebar(false); }

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  dom.servicesMenuBtn.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.servicesMenu.classList.toggle('show');

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  const setAppHeight = () => { const app = document.getElementById('app-container'); if(app) app.style.height = `${window.innerHeight}px`; };

Â  Â  Â  Â  Â  Â  Â  Â  setAppHeight();

Â  Â  Â  Â  Â  Â  Â  Â  window.addEventListener('resize', setAppHeight);

Â  Â  Â  Â  Â  Â  Â  Â  dom.selectChatsBtn?.addEventListener('click', () => toggleSelectMode(true));

Â  Â  Â  Â  Â  Â  Â  Â  dom.cancelSelectModeBtn?.addEventListener('click', () => toggleSelectMode(false));

Â  Â  Â  Â  Â  Â  Â  Â  dom.deleteSelectedBtn?.addEventListener('click', async () => { if (chatsToDelete.size === 0) return; const confirm = await showModal({ title: `Eliminar ${chatsToDelete.size} chat(s)`, body: 'Esta acciÃ³n es irreversible. Â¿Confirmas la eliminaciÃ³n?', confirmText: 'Eliminar' }); if (confirm.confirmed) { chatsToDelete.forEach(id => { state.structure = state.structure.filter(i => i !== id); delete state.chats[id]; Object.values(state.projects).forEach(p => { if(p.chatIds) p.chatIds = p.chatIds.filter(cid => cid !== id) }); if (currentChatId === id) resetChatView(); }); saveState(); toggleSelectMode(false); } });

Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsBtn?.addEventListener('click', showSettingsModal);

Â  Â  Â  Â  Â  Â  Â  Â  dom.closeSettingsModal?.addEventListener('click', hideSettingsModal);

Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsUpgradePlanBtn?.addEventListener('click', () => { hideSettingsModal(); showPricingModal(); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.fontSizeSlider?.addEventListener('input', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fontSize = e.target.value;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.style.setProperty('--base-font-size', `${fontSize}px`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.fontSizeValue.textContent = `${fontSize}px`;

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.settingsThemeToggle?.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTheme(!document.body.classList.contains('dark-theme'));

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.notificationsToggle?.addEventListener('change', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  notificationsEnabled = dom.notificationsToggle.checked;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('goatify-notifications-enabled', notificationsEnabled);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (notificationsEnabled && Notification.permission !== 'granted') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Notification.requestPermission();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.languageSelector?.addEventListener('change', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLanguage(e.target.value);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.connectWhatsappBtn?.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.open('https://wa.me/17439106116?text=Hola%2C%20me%20gustar%C3%ADa%20conectar%20mi%20cuenta%20de%20Goatify%20IA%20a%20WhatsApp.', '_blank');

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.scheduleMeetingBtn?.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.open('https://calendly.com/goatify', '_blank');

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.freePlanButton?.addEventListener('click', showPricingModal);



Â  Â  Â  Â  Â  Â  Â  Â  dom.calendarBtn?.addEventListener('click', showCalendarModal);

Â  Â  Â  Â  Â  Â  Â  Â  dom.projectCalendarBtn?.addEventListener('click', showCalendarModal);

Â  Â  Â  Â  Â  Â  Â  Â  dom.closeCalendarModal?.addEventListener('click', hideCalendarModal);

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.prevMonthBtn?.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.subtract(1, 'month'); renderCalendarView(); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.nextMonthBtn?.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.add(1, 'month'); renderCalendarView(); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.prevWeekBtn?.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.subtract(1, 'week'); renderCalendarView(); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.nextWeekBtn?.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.add(1, 'week'); renderCalendarView(); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.prevDayBtn?.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.subtract(1, 'day'); renderCalendarView(); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.nextDayBtn?.addEventListener('click', () => { selectedCalendarDate = selectedCalendarDate.add(1, 'day'); renderCalendarView(); });



Â  Â  Â  Â  Â  Â  Â  Â  dom.monthViewBtn.addEventListener('click', () => { currentCalendarView = 'month'; renderCalendarView(); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.weekViewBtn.addEventListener('click', () => { currentCalendarView = 'week'; renderCalendarView(); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.dayViewBtn.addEventListener('click', () => { currentCalendarView = 'day'; renderCalendarView(); });

Â  Â  Â  Â  Â  Â  Â  Â  dom.addTaskBtn?.addEventListener('click', () => editCalendarTask(null, selectedCalendarDate.format('YYYY-MM-DD')));



Â  Â  Â  Â  Â  Â  Â  Â  dom.addTaskToBoardBtn.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editProjectTask(currentChatId, null, 'todo');

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  dom.viewToggleKanban.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!currentChatId) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chat = state.chats[currentChatId];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!chat || !chat.projectData) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chat.projectData.currentView = 'kanban';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â renderProjectBoard(currentChatId);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dom.viewToggleList.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!currentChatId) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chat = state.chats[currentChatId];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!chat || !chat.projectData) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chat.projectData.currentView = 'list';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â renderProjectBoard(currentChatId);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  dom.projectChatHeader?.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.projectChatContainer.classList.toggle('collapsed');

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.plan-details-toggle').forEach(button => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const details = button.nextElementSibling;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  details.classList.toggle('open');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â });



Â  Â  Â  Â  Â  Â  Â  Â  setupModalClickOutside(dom.genericModal, ()=>hideModal({confirmed: false}));

Â  Â  Â  Â  Â  Â  Â  Â  setupModalClickOutside(dom.pricingModal, hidePricingModal);

Â  Â  Â  Â  Â  Â  Â  Â  setupModalClickOutside(dom.settingsModal, hideSettingsModal);

Â  Â  Â  Â  Â  Â  Â  Â  setupModalClickOutside(dom.calendarModalOverlay, hideCalendarModal);

Â  Â  Â  Â  Â  Â  Â  Â  setupModalClickOutside(dom.htmlPreviewModal, () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.htmlPreviewModal.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.htmlPreviewModal.classList.remove('flex');

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // Gamification Event Listeners

Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationBtn?.addEventListener('click', () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderGamificationModal();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  domgamificationModal.classList.remove('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gamificationModal.classList.add('flex');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { dom.gamificationModal.querySelector('.modal-content').classList.remove('scale-95'); }, 10);
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  dom.closeGamificationModal?.addEventListener('click', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationModal.querySelector('.modal-content').classList.add('scale-95');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { dom.gamificationModal.classList.add('hidden'); dom.gamificationModal.classList.remove('flex'); }, 300);
 Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.gamification-tab').forEach(tab => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tab.addEventListener('click', (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.gamification-tab').forEach(t => t.classList.remove('active'));
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.gamification-tab-content').forEach(c => c.classList.add('hidden'));

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.currentTarget.classList.add('active');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`gamification-tab-${e.currentTarget.dataset.tab}`).classList.remove('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationRulesBtn?.addEventListener('click', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationRulesModal.classList.remove('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationRulesModal.classList.add('flex');
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  dom.closeGamificationRulesModal?.addEventListener('click', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationRulesModal.classList.add('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationRulesModal.classList.remove('flex');
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  // --- Gamification Functions ---
 Â  Â  Â  Â  Â  Â  function loadGamificationState() {
 Â  Â  Â  Â  Â  Â  Â  Â  const userId = currentUser?.id || 'guest';
 Â  Â  Â  Â  Â  Â  Â  Â  gamificationState = JSON.parse(localStorage.getItem(`goatify-gamification-${userId}`)) || {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  xp: 0,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  level: 0,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  credits: 0,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastLogin: '',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  streak: 0,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  missions: Object.fromEntries(Object.keys(MISSIONS).map(key => [key, { completed: false, claimed: false }])),
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  achievements: Object.fromEntries(Object.keys(ACHIEVEMENTS).map(key => [key, { unlocked: false, claimed: false }])),
 Â  Â  Â  Â  Â  Â  Â  Â  };
 Â  Â  Â  Â  Â  Â  Â  Â  // Initialize new missions if they were added after user started
 Â  Â  Â  Â  Â  Â  Â  Â  for (const key in MISSIONS) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!gamificationState.missions[key]) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.missions[key] = { completed: false, claimed: false };
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  for (const key in ACHIEVEMENTS) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!gamificationState.achievements[key]) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.achievements[key] = { unlocked: false, claimed: false };
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function saveGamificationState() {
 Â  Â  Â  Â  Â  Â  Â  Â  const userId = currentUser?.id || 'guest';
 Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem(`goatify-gamification-${userId}`, JSON.stringify(gamificationState));
 Â  Â  Â  Â  Â  Â  Â  Â  updateCreditCounter(); // Update the UI immediately
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function addXP(amount) {
 Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.xp += amount;
 Â  Â  Â  Â  Â  Â  Â  Â  checkLevelUp();
 Â  Â  Â  Â  Â  Â  Â  Â  saveGamificationState();
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function addCredits(amount) {
 Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.credits += amount;
 Â  Â  Â  Â  Â  Â  Â  Â  saveGamificationState();
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function checkLevelUp() {
 Â  Â  Â  Â  Â  Â  Â  Â  for (let i = gamificationState.level; i < XP_FOR_LEVEL.length - 1; i++) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (gamificationState.xp >= XP_FOR_LEVEL[i + 1]) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.level++;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal({
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: `<i class="fas fa-star text-gold mr-2"></i> Â¡Nivel Completado!`,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: `<p class="text-center text-lg">Â¡Has alcanzado el <strong>Nivel ${gamificationState.level}: ${LEVEL_NAMES[gamificationState.level - 1]}</strong>!</p><p class="text-center mt-2">Â¡Sigue asÃ­ para convertirte en un verdadero G.O.A.T.!</p>`,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmText: 'Â¡Impresionante!',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showCancel: false
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function checkDailyStreak() {
 Â  Â  Â  Â  Â  Â  Â  Â  const today = dayjs().format('YYYY-MM-DD');
 Â  Â  Â  Â  Â  Â  Â  Â  const yesterday = dayjs().subtract(1, 'day').format('YYYY-MM-DD');

 Â  Â  Â  Â  Â  Â  Â  Â  if (gamificationState.lastLogin === today) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Already logged in today, no streak change
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  if (gamificationState.lastLogin === yesterday) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.streak++;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addXP(5); // Small XP for daily login
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addCredits(2); // Small credits for daily login
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (gamificationState.streak % 7 === 0) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Every 7 days, special reward (GOAT Chest)
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  openGOATChest();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addXP(50); // Bonus XP for chest
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  } else {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.streak = 1; // Start new streak
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addXP(5);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addCredits(2);
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.lastLogin = today;
 Â  Â  Â  Â  Â  Â  Â  Â  saveGamificationState();
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function openGOATChest() {
 Â  Â  Â  Â  Â  Â  Â  Â  const rewards = [
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { type: 'credits', amount: 50, text: '50 CrÃ©ditos de Recompensa' },
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { type: 'credits', amount: 75, text: '75 CrÃ©ditos de Recompensa' },
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { type: 'coupon', value: '10%', service: 'pÃ¡gina web', text: '10% de descuento en tu prÃ³xima PÃ¡gina Web' },
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { type: 'coupon', value: '15%', service: 'automatizaciÃ³n', text: '15% de descuento en Automatizaciones de IA' },
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { type: 'consulting', text: 'Â¡Una AsesorÃ­a EstratÃ©gica GRATIS (30 min)!' }
 Â  Â  Â  Â  Â  Â  Â  Â  ];
 Â  Â  Â  Â  Â  Â  Â  Â  const randomReward = rewards[Math.floor(Math.random() * rewards.length)];

 Â  Â  Â  Â  Â  Â  Â  Â  let rewardMessage = '';
 Â  Â  Â  Â  Â  Â  Â  Â  if (randomReward.type === 'credits') {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addCredits(randomReward.amount);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rewardMessage = `<p class="text-xl text-center text-gold"><i class="fas fa-coins mr-2"></i>Â¡Has ganado <strong>${randomReward.text}</strong>!</p>`;
 Â  Â  Â  Â  Â  Â  Â  Â  } else if (randomReward.type === 'coupon') {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rewardMessage = `<p class="text-xl text-center text-gold"><i class="fas fa-tag mr-2"></i>Â¡Has ganado <strong>${randomReward.text}</strong>!</p><p class="text-sm text-center mt-2">Usa el cupÃ³n <strong>GOAT${randomReward.value.replace('%','')}${randomReward.service.toUpperCase()}</strong> al contratar.</p>`;
 Â  Â  Â  Â  Â  Â  Â  Â  } else if (randomReward.type === 'consulting') {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rewardMessage = `<p class="text-xl text-center text-gold"><i class="fas fa-brain mr-2"></i>Â¡Has ganado <strong>${randomReward.text}</strong>!</p><p class="text-sm text-center mt-2">Te contactaremos para agendar tu sesiÃ³n estratÃ©gica.</p>`;
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  showModal({
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: '<i class="fas fa-gift mr-2 text-gold"></i>Â¡Cofre GOAT Desbloqueado!',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: rewardMessage,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmText: 'Â¡Genial!',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showCancel: false
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function completeMission(missionId, relatedId = null) {
 Â  Â  Â  Â  Â  Â  Â  Â  if (gamificationState.missions[missionId] && !gamificationState.missions[missionId].completed) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mission = MISSIONS[missionId];
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (mission.condition) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!mission.condition(relatedId)) return; // Condition not met
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.missions[missionId].completed = true;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Auto-claim for now, or add a 'claim' button in UI later
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addXP(mission.xp);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addCredits(mission.credits);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.missions[missionId].claimed = true;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveGamificationState();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal({
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: '<i class="fas fa-check-circle text-green-500 mr-2"></i> Â¡MisiÃ³n Completada!',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: `<p class="text-center text-lg">Has completado la misiÃ³n: <strong>"${mission.text}"</strong></p><p class="text-center mt-2">Ganaste <strong>${mission.xp} XP</strong> y <strong>${mission.credits} CrÃ©ditos</strong>.</p>`,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmText: 'Â¡A por la siguiente!',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showCancel: false
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkAchievements(); // Check if mission completion unlocks any achievement
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function checkAchievements() {
 Â  Â  Â  Â  Â  Â  Â  Â  for (const key in ACHIEVEMENTS) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!gamificationState.achievements[key].unlocked) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let unlocked = false;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switch (key) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'streak-30':
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  unlocked = gamificationState.streak >= 30;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'project-master':
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let completedProjects = 0;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const chat of Object.values(state.chats)) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (chat.projectData) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const doneColumn = chat.projectData.columns.find(c => c.id === 'done');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (doneColumn && doneColumn.tasks.length > 0 && doneColumn.tasks.every(t => t.completed)) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completedProjects++;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  unlocked = completedProjects >= 10;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'influencer':
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let socialPosts = 0;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const missionId in gamificationState.missions) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (MISSIONS[missionId].workflow && MISSIONS[missionId].workflow.startsWith('create-full-post') && gamificationState.missions[missionId].completed) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  socialPosts++;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  unlocked = socialPosts >= 50;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (unlocked) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.achievements[key].unlocked = true;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addXP(ACHIEVEMENTS[key].xp);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addCredits(ACHIEVEMENTS[key].credits);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gamificationState.achievements[key].claimed = true;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveGamificationState();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal({
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: '<i class="fas fa-medal text-gold mr-2"></i> Â¡Logro Desbloqueado!',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: `<p class="text-center text-lg">Â¡Felicidades! Has desbloqueado el logro <strong>"${ACHIEVEMENTS[key].title}"</strong></p><p class="text-center mt-2">${ACHIEVEMENTS[key].description}</p><p class="text-center mt-2">Ganaste <strong>${ACHIEVEMENTS[key].xp} XP</strong> y <strong>${ACHIEVEMENTS[key].credits} CrÃ©ditos</strong>.</p>${ACHIEVEMENTS[key].reward ? `<p class="text-center mt-2 text-primary font-bold">Recompensa Especial: ${ACHIEVEMENTS[key].reward}</p>` : ''}`,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmText: 'Â¡Vamos!',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showCancel: false
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  // Mission conditions
 Â  Â  Â  Â  Â  Â  function checkWeekOrganized() {
 Â  Â  Â  Â  Â  Â  Â  Â  const startOfWeek = dayjs().startOf('isoWeek');
 Â  Â  Â  Â  Â  Â  Â  Â  for (let i = 0; i < 7; i++) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dayKey = startOfWeek.add(i, 'day').format('YYYY-MM-DD');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (getTasksForDay(dayKey).length === 0) return false;
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  return true;
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function checkProjectCreated(chatId, minTasks) {
 Â  Â  Â  Â  Â  Â  Â  Â  const chat = state.chats[chatId];
 Â  Â  Â  Â  Â  Â  Â  Â  if (!chat || !chat.projectData) return false;
 Â  Â  Â  Â  Â  Â  Â  Â  let totalTasks = 0;
 Â  Â  Â  Â  Â  Â  Â  Â  chat.projectData.columns.forEach(col => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalTasks += (col.tasks || []).length;
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  return totalTasks >= minTasks;
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function renderGamificationModal() {
 Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationLevelName.textContent = `Nivel ${gamificationState.level + 1}: ${LEVEL_NAMES[gamificationState.level]}`;
 Â  Â  Â  Â  Â  Â  Â  Â  const nextLevelXP = XP_FOR_LEVEL[gamificationState.level + 1] || gamificationState.xp;
 Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationXp.textContent = `${gamificationState.xp} / ${nextLevelXP} XP`;
 Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationXpBar.style.width = `${(gamificationState.xp / nextLevelXP) * 100}%`;
 Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationCredits.innerHTML = `<i class="fas fa-coins mr-1"></i>${gamificationState.credits} CrÃ©ditos`;

 Â  Â  Â  Â  Â  Â  Â  Â  // Render Daily Streak
 Â  Â  Â  Â  Â  Â  Â  Â  dom.dailyStreakContainer.innerHTML = '';
 Â  Â  Â  Â  Â  Â  Â  Â  const today = dayjs();
 Â  Â  Â  Â  Â  Â  Â  Â  for (let i = 1; i <= 7; i++) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dayEl = document.createElement('div');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.className = `streak-day flex flex-col items-center justify-center p-2 rounded-lg`;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.innerHTML = `<p class="text-xs text-text-medium">DÃ­a ${i}</p><p class="text-2xl mt-1"><i class="fas fa-square"></i></p>`; // Default icon

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (i <= gamificationState.streak % 7 || (gamificationState.streak % 7 === 0 && i === 7)) { // For completed days in current week or last day of 7-day streak
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.classList.add('completed');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.querySelector('i').classList.replace('fa-square', 'fa-check');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (i === (gamificationState.streak % 7 === 0 ? 7 : gamificationState.streak % 7)) { // Mark current streak day
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.classList.add('active');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (i === 7) { // Special icon for 7th day
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.querySelector('i').classList.replace('fa-check', 'fa-gift');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayEl.querySelector('i').classList.add('text-gold');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.dailyStreakContainer.appendChild(dayEl);
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  // Render Missions
 Â  Â  Â  Â  Â  Â  Â  Â  dom.missionsContainer.innerHTML = '';
 Â  Â  Â  Â  Â  Â  Â  Â  for (const key in MISSIONS) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mission = MISSIONS[key];
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const missionState = gamificationState.missions[key];

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const missionEl = document.createElement('div');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  missionEl.className = `mission-item flex items-center justify-between p-3 rounded-lg bg-current-bg-medium ${missionState.completed ? 'completed' : ''}`;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  missionEl.innerHTML = `
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold text-text-light">${mission.text}</p>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-text-medium"><i class="fas fa-flask mr-1"></i>${mission.xp} XP <i class="fas fa-coins ml-2 mr-1"></i>${mission.credits} CrÃ©ditos</p>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-primary px-3 py-1 rounded-md text-sm ml-4">${missionState.completed ? 'Completada' : 'Realizar'}</button>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const missionBtn = missionEl.querySelector('button');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  missionBtn.disabled = missionState.completed;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!missionState.completed) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  missionBtn.addEventListener('click', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.gamificationModal.classList.add('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (mission.workflow) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const config = workflowConfigs[mission.workflow];
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (config) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.projectManagementView.style.display = 'none';
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.chatMessagesView.style.display = 'block';
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.inputArea.style.display = 'block';
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.initialViewContainer.style.display = 'none';
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createNewChat({
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: config.title,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  workflow: config.workflow,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  model: config.model,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  initialMessages: config.initialMessages
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (mission.action === 'generateImage') {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  generateImage();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.missionsContainer.appendChild(missionEl);
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  // Render Achievements
 Â  Â  Â  Â  Â  Â  Â  Â  dom.achievementsContainer.innerHTML = '';
 Â  Â  Â  Â  Â  Â  Â  Â  for (const key in ACHIEVEMENTS) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const achievement = ACHIEVEMENTS[key];
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const achievementState = gamificationState.achievements[key];

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const achievementEl = document.createElement('div');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  achievementEl.className = `achievement-badge flex flex-col items-center justify-center p-4 rounded-lg bg-current-bg-medium text-center`;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (achievementState.unlocked) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  achievementEl.classList.add('unlocked');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  achievementEl.innerHTML = `
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas ${achievement.icon} fa-3x mb-2"></i>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold mb-1">${achievement.title}</h4>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-text-medium">${achievement.description}</p>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-text-light mt-1">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${achievement.xp > 0 ? `<i class="fas fa-flask mr-1"></i>${achievement.xp} XP` : ''}
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${achievement.credits > 0 ? `<i class="fas fa-coins ml-2 mr-1"></i>${achievement.credits} CrÃ©ditos` : ''}
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${achievement.reward ? `<br><span class="text-gold font-semibold">${achievement.reward}</span>` : ''}
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.achievementsContainer.appendChild(achievementEl);
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  // --- End Gamification Functions ---

 Â  Â  Â  Â  Â  Â  // --- Project Board Functions ---
 Â  Â  Â  Â  Â  Â  function renderProjectView(chatId) {
 Â  Â  Â  Â  Â  Â  Â  Â  const chat = state.chats[chatId];
 Â  Â  Â  Â  Â  Â  Â  Â  if (!chat || !chat.projectData) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Initialize project data if it doesn't exist
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chat.projectData = {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: chat.title,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  columns: [
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'todo', title: 'Por Hacer', tasks: [] },
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'in-progress', title: 'En Progreso', tasks: [] },
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'done', title: 'Hecho', tasks: [] },
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentView: 'kanban',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  dom.projectViewTitle.textContent = chat.projectData.title;
 Â  Â  Â  Â  Â  Â  Â  Â  dom.viewToggleKanban.classList.toggle('active', chat.projectData.currentView === 'kanban');
 Â  Â  Â  Â  Â  Â  Â  Â  dom.viewToggleList.classList.toggle('active', chat.projectData.currentView === 'list');

 Â  Â  Â  Â  Â  Â  Â  Â  if (chat.projectData.currentView === 'kanban') {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.kanbanView.classList.remove('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.listView.classList.add('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.listViewMobile.classList.add('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderKanbanBoard(chat);
 Â  Â  Â  Â  Â  Â  Â  Â  } else { // List view
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.kanbanView.classList.add('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (window.innerWidth < 768) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.listView.classList.add('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.listViewMobile.classList.remove('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderMobileListView(chat);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.listView.classList.remove('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.listViewMobile.classList.add('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderListView(chat);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  renderProjectChatMessages(chat);
 Â  Â  Â  Â  Â  Â  Â  Â  updateProjectTagFilter(chat);
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function renderProjectBoard(chatId) {
 Â  Â  Â  Â  Â  Â  Â  Â  renderProjectView(chatId);
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function renderKanbanBoard(chat) {
 Â  Â  Â  Â  Â  Â  Â  Â  dom.kanbanView.innerHTML = '';
 Â  Â  Â  Â  Â  Â  Â  Â  chat.projectData.columns.forEach(column => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const columnEl = document.createElement('div');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  columnEl.className = 'kanban-column';
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  columnEl.dataset.columnId = column.id;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  columnEl.innerHTML = `<h4 class="kanban-column-title">${column.title} <span class="text-sm text-text-medium ml-2">(${column.tasks.length})</span></h4><div class="kanban-cards" data-column-id="${column.id}"></div>`;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cardsContainer = columnEl.querySelector('.kanban-cards');

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const filteredTasks = activeTagFilter
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? column.tasks.filter(task => task.labels && task.labels.includes(activeTagFilter))
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : column.tasks;

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  filteredTasks.forEach(task => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskEl = createTaskCard(task);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cardsContainer.appendChild(taskEl);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cardsContainer.addEventListener('dragover', handleProjectDragOver);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cardsContainer.addEventListener('dragleave', handleProjectDragLeave);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cardsContainer.addEventListener('drop', handleProjectDrop);

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.kanbanView.appendChild(columnEl);
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function createTaskCard(task) {
 Â  Â  Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
 Â  Â  Â  Â  Â  Â  Â  Â  card.className = `kanban-card ${task.urgent ? 'urgent' : ''} ${task.completed ? 'task-item-completed' : ''}`;
 Â  Â  Â  Â  Â  Â  Â  Â  card.draggable = true;
 Â  Â  Â  Â  Â  Â  Â  Â  card.dataset.taskId = task.id;
 Â  Â  Â  Â  Â  Â  Â  Â  card.innerHTML = `
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-task-btn">&times;</button>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mb-2">${task.content}</p>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-labels">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${task.labels && task.labels.map(label => `<span class="task-label" style="background-color: ${getLabelColor(label)};">${label}</span>`).join('')}
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-footer">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="${task.dueDate ? 'text-primary' : ''}">${task.dueDate || ''} ${task.time || ''}</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-flag ${task.urgent ? 'text-urgent-color' : 'text-text-medium'} cursor-pointer priority-toggle" data-task-id="${task.id}" title="${task.urgent ? 'Urgente' : 'Normal'}"></i>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  `;
 Â  Â  Â  Â  Â  Â  Â  Â  card.addEventListener('click', (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('delete-task-btn') || e.target.classList.contains('priority-toggle')) return;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editProjectTask(currentChatId, task.id);
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  card.addEventListener('dragstart', handleProjectDragStart);
 Â  Â  Â  Â  Â  Â  Â  Â  card.addEventListener('touchstart', handleTouchStart, {passive: false});

 Â  Â  Â  Â  Â  Â  Â  Â  card.querySelector('.priority-toggle').addEventListener('click', (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleTaskUrgency(currentChatId, task.id);
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  card.querySelector('.delete-task-btn').addEventListener('click', (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteTask(task.id, currentChatId); // Pass chat ID as source for project tasks
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  return card;
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function renderListView(chat) {
 Â  Â  Â  Â  Â  Â  Â  Â  dom.listView.innerHTML = `
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="list-view-header">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div></div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>Tarea</div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>Etiquetas</div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>Estado</div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>Fecha LÃ­mite</div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div></div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  `;
 Â  Â  Â  Â  Â  Â  Â  Â  let allTasks = [];
 Â  Â  Â  Â  Â  Â  Â  Â  chat.projectData.columns.forEach(column => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allTasks = allTasks.concat(column.tasks.map(task => ({ ...task, columnId: column.id })));
 Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  const filteredTasks = activeTagFilter
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? allTasks.filter(task => task.labels && task.labels.includes(activeTagFilter))
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : allTasks;

 Â  Â  Â  Â  Â  Â  Â  Â  filteredTasks.sort((a, b) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Sort by urgent tasks first, then by due date
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (a.urgent && !b.urgent) return -1;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!a.urgent && b.urgent) return 1;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return dayjs(a.dueDate).diff(dayjs(b.dueDate));
 Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  filteredTasks.forEach(task => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskEl = document.createElement('div');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.className = `list-view-task ${task.completed ? 'task-item-completed' : ''}`;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.dataset.taskId = task.id;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.innerHTML = `
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} data-task-id="${task.id}"></div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-content-list ${task.urgent ? 'urgent' : ''}">${task.content}</div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-labels">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${task.labels && task.labels.map(label => `<span class="task-label" style="background-color: ${getLabelColor(label)};">${label}</span>`).join('')}
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="priority-cell"><i class="fas fa-flag ${task.urgent ? 'text-urgent-color' : 'text-text-medium'} cursor-pointer priority-toggle" data-task-id="${task.id}" title="${task.urgent ? 'Urgente' : 'Normal'}"></i></div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-text-medium">${task.dueDate || ''} ${task.time || ''}</div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="delete-task-btn-wrapper opacity-0 transition-opacity flex justify-end">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-task-btn">&times;</button>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.listView.appendChild(taskEl);

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.querySelector('.task-checkbox').addEventListener('change', (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateTaskStatus(task.id, { completed: e.target.checked });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.querySelector('.priority-toggle').addEventListener('click', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleTaskUrgency(currentChatId, task.id);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.querySelector('.delete-task-btn').addEventListener('click', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteTask(task.id, currentChatId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.addEventListener('click', (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.type === 'checkbox' || e.target.classList.contains('delete-task-btn') || e.target.classList.contains('priority-toggle')) return;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editProjectTask(currentChatId, task.id);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function renderMobileListView(chat) {
 Â  Â  Â  Â  Â  Â  Â  Â  dom.listViewMobile.innerHTML = '';
 Â  Â  Â  Â  Â  Â  Â  Â  let allTasks = [];
 Â  Â  Â  Â  Â  Â  Â  Â  chat.projectData.columns.forEach(column => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allTasks = allTasks.concat(column.tasks.map(task => ({ ...task, columnId: column.id })));
 Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  const filteredTasks = activeTagFilter
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? allTasks.filter(task => task.labels && task.labels.includes(activeTagFilter))
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : allTasks;

 Â  Â  Â  Â  Â  Â  Â  Â  filteredTasks.sort((a, b) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (a.urgent && !b.urgent) return -1;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!a.urgent && b.urgent) return 1;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return dayjs(a.dueDate).diff(dayjs(b.dueDate));
 Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  filteredTasks.forEach(task => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskEl = document.createElement('div');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.className = `list-view-task-mobile ${task.completed ? 'task-item-completed' : ''}`;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.dataset.taskId = task.id;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.innerHTML = `
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-task-btn">&times;</button>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="list-view-task-mobile-header">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} data-task-id="${task.id}">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="flex-grow font-semibold ${task.urgent ? 'text-urgent-color' : ''}">${task.content}</p>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-labels">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${task.labels && task.labels.map(label => `<span class="task-label" style="background-color: ${getLabelColor(label)};">${label}</span>`).join('')}
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="list-view-task-mobile-footer">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-text-medium">${task.dueDate || ''} ${task.time || ''}</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-flag ${task.urgent ? 'text-urgent-color' : 'text-text-medium'} cursor-pointer priority-toggle" data-task-id="${task.id}" title="${task.urgent ? 'Urgente' : 'Normal'}"></i>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.listViewMobile.appendChild(taskEl);

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.querySelector('.task-checkbox').addEventListener('change', (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateTaskStatus(task.id, { completed: e.target.checked });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.querySelector('.priority-toggle').addEventListener('click', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleTaskUrgency(currentChatId, task.id);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.querySelector('.delete-task-btn').addEventListener('click', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteTask(task.id, currentChatId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskEl.addEventListener('click', (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.type === 'checkbox' || e.target.classList.contains('delete-task-btn') || e.target.classList.contains('priority-toggle')) return;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editProjectTask(currentChatId, task.id);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  let draggedProjectTaskId = null;
 Â  Â  Â  Â  Â  Â  function handleProjectDragStart(e) {
 Â  Â  Â  Â  Â  Â  Â  Â  draggedProjectTaskId = e.target.dataset.taskId;
 Â  Â  Â  Â  Â  Â  Â  Â  e.dataTransfer.setData('text/plain', draggedProjectTaskId);
 Â  Â  Â  Â  Â  Â  Â  Â  e.dataTransfer.effectAllowed = 'move';
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function handleProjectDragOver(e) {
 Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
 Â  Â  Â  Â  Â  Â  Â  Â  e.currentTarget.classList.add('drag-over');
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function handleProjectDragLeave(e) {
 Â  Â  Â  Â  Â  Â  Â  Â  e.currentTarget.classList.remove('drag-over');
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function handleProjectDrop(e) {
 Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
 Â  Â  Â  Â  Â  Â  Â  Â  e.currentTarget.classList.remove('drag-over');
 Â  Â  Â  Â  Â  Â  Â  Â  const taskId = e.dataTransfer.getData('text/plain');
 Â  Â  Â  Â  Â  Â  Â  Â  const targetColumnId = e.currentTarget.dataset.columnId;
 Â  Â  Â  Â  Â  Â  Â  Â  if (taskId && targetColumnId) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  moveTask(currentChatId, taskId, targetColumnId);
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function moveTask(chatId, taskId, targetColumnId) {
 Â  Â  Â  Â  Â  Â  Â  Â  const chat = state.chats[chatId];
 Â  Â  Â  Â  Â  Â  Â  Â  if (!chat || !chat.projectData) return;

 Â  Â  Â  Â  Â  Â  Â  Â  let taskToMove = null;
 Â  Â  Â  Â  Â  Â  Â  Â  let sourceColumn = null;

 Â  Â  Â  Â  Â  Â  Â  Â  for (const column of chat.projectData.columns) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskIndex = column.tasks.findIndex(task => task.id === taskId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (taskIndex !== -1) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskToMove = column.tasks.splice(taskIndex, 1)[0];
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sourceColumn = column;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  if (taskToMove && sourceColumn) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetColumn = chat.projectData.columns.find(column => column.id === targetColumnId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (targetColumn) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetColumn.tasks.push(taskToMove);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (targetColumn.id === 'done') {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskToMove.completed = true;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  taskToMove.completed = false;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderProjectBoard(chatId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function toggleTaskUrgency(chatId, taskId) {
 Â  Â  Â  Â  Â  Â  Â  Â  const chat = state.chats[chatId];
 Â  Â  Â  Â  Â  Â  Â  Â  if (!chat || !chat.projectData) return;

 Â  Â  Â  Â  Â  Â  Â  Â  for (const column of chat.projectData.columns) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const task = column.tasks.find(task => task.id === taskId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (task) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  task.urgent = !task.urgent;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderProjectBoard(chatId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  async function editProjectTask(chatId, taskId = null, defaultColumn = null) {
 Â  Â  Â  Â  Â  Â  Â  Â  const chat = state.chats[chatId];
 Â  Â  Â  Â  Â  Â  Â  Â  if (!chat || !chat.projectData) return;

 Â  Â  Â  Â  Â  Â  Â  Â  let task = null;
 Â  Â  Â  Â  Â  Â  Â  Â  let originalColumnId = defaultColumn;
 Â  Â  Â  Â  Â  Â  Â  Â  if (taskId) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const column of chat.projectData.columns) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const foundTask = column.tasks.find(t => t.id === taskId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (foundTask) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  task = { ...foundTask }; // Create a copy for editing
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  originalColumnId = column.id;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  } else {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  task = {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: `proj-${crypto.randomUUID()}`,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content: '',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dueDate: '',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  time: '',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: [],
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urgent: false,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completed: false
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  const allLabels = [...new Set(chat.projectData.columns.flatMap(c => c.tasks.flatMap(t => t.labels || [])))];

 Â  Â  Â  Â  Â  Â  Â  Â  const result = await showModal({
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: taskId ? 'Editar Tarea del Proyecto' : 'AÃ±adir Tarea al Proyecto',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: `
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-content" class="block text-sm font-medium mb-1">DescripciÃ³n de la Tarea</label>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="task-content" class="w-full p-2 rounded bg-input border border-themed h-24" placeholder="Ej: Investigar herramientas de SEO">${task.content}</textarea>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-due-date" class="block text-sm font-medium mb-1">Fecha LÃ­mite</label>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="task-due-date" class="w-full p-2 rounded bg-input border border-themed" value="${task.dueDate || ''}">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-time" class="block text-sm font-medium mb-1">Hora</label>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="time" id="task-time" class="w-full p-2 rounded bg-input border border-themed" value="${task.time || ''}">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-labels" class="block text-sm font-medium mb-1">Etiquetas (separadas por coma)</label>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="task-labels" class="w-full p-2 rounded bg-input border border-themed" value="${(task.labels || []).join(', ')}" placeholder="Ej: Marketing, DiseÃ±o, Urgente">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="label-suggestions" class="flex flex-wrap gap-2 mt-2">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${allLabels.map(label => `<span class="task-label-suggestion cursor-pointer text-xs p-1 rounded-full bg-gray-500 text-white" data-label="${label}">${label}</span>`).join('')}
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="task-urgent" class="form-checkbox h-5 w-5 text-primary" ${task.urgent ? 'checked' : ''}>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-urgent" class="text-sm font-medium">Marcar como urgente</label>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="task-completed" class="form-checkbox h-5 w-5 text-primary" ${task.completed ? 'checked' : ''}>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-completed" class="text-sm font-medium">Marcar como completada</label>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${taskId ? `<button id="delete-task-modal-btn" class="w-full btn-danger p-2 rounded-lg mt-4">Eliminar Tarea</button>` : ''}
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  `,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmText: taskId ? 'Guardar Cambios' : 'AÃ±adir Tarea'
 Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  if (result.confirmed) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const updatedTask = {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: taskId || `proj-${crypto.randomUUID()}`,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content: result.data['task-content'],
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dueDate: result.data['task-due-date'],
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  time: result.data['task-time'],
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: result.data['task-labels'].split(',').map(s => s.trim()).filter(Boolean),
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urgent: result.data['task-urgent'],
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completed: result.data['task-completed']
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (taskId) { // Editing existing task
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Remove from old column if it exists
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let removed = false;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(const column of chat.projectData.columns) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskIndex = column.tasks.findIndex(t => t.id === taskId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (taskIndex > -1) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  column.tasks.splice(taskIndex, 1);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  removed = true;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Add to correct column based on 'completed' status
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetColId = updatedTask.completed ? 'done' : originalColumnId || 'todo';
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetColumn = chat.projectData.columns.find(c => c.id === targetColId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (targetColumn) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetColumn.tasks.push(updatedTask);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { // Adding new task
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetColumn = chat.projectData.columns.find(c => c.id === (updatedTask.completed ? 'done' : defaultColumn || 'todo'));
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (targetColumn) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetColumn.tasks.push(updatedTask);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completeMission('project-created', chatId); // Check mission completion
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderProjectBoard(chatId);
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  const labelSuggestions = dom.genericModal.querySelector('#label-suggestions');
 Â  Â  Â  Â  Â  Â  Â  Â  if (labelSuggestions) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labelSuggestions.addEventListener('click', (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('task-label-suggestion')) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const labelInput = dom.genericModal.querySelector('#task-labels');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentLabels = labelInput.value.split(',').map(s => s.trim()).filter(Boolean);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newLabel = e.target.dataset.label;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!currentLabels.includes(newLabel)) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentLabels.push(newLabel);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labelInput.value = currentLabels.join(', ');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  const deleteTaskModalBtn = dom.genericModal.querySelector('#delete-task-modal-btn');
 Â  Â  Â  Â  Â  Â  Â  Â  if (deleteTaskModalBtn) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteTaskModalBtn.addEventListener('click', async (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideModal({ confirmed: false }); // Hide the current modal first
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteTask(taskId, chat.projectData.title); // Then ask for confirmation to delete
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  async function editCalendarTask(taskId = null, defaultDate = null, defaultTime = null) {
 Â  Â  Â  Â  Â  Â  Â  Â  let task = null;
 Â  Â  Â  Â  Â  Â  Â  Â  if (taskId) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const found = findTask(taskId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (found && found.type === 'personal') {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  task = { ...found.task };
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  } else {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  task = {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: `cal-${crypto.randomUUID()}`,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content: '',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: defaultDate || dayjs().format('YYYY-MM-DD'),
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  time: defaultTime || '',
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completed: false,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  const result = await showModal({
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: taskId ? 'Editar Tarea Personal' : translations[localStorage.getItem('goatify-lang') || 'es'].calendar_add_task_btn,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: `
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-content" class="block text-sm font-medium mb-1">DescripciÃ³n de la Tarea</label>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="task-content" class="w-full p-2 rounded bg-input border border-themed h-24" placeholder="${translations[localStorage.getItem('goatify-lang') || 'es'].calendar_add_task_placeholder}">${task.content}</textarea>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-date" class="block text-sm font-medium mb-1">Fecha</label>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="task-date" class="w-full p-2 rounded bg-input border border-themed" value="${task.date || ''}">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-time" class="block text-sm font-medium mb-1">Hora</label>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="time" id="task-time" class="w-full p-2 rounded bg-input border border-themed" value="${task.time || ''}">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="task-completed" class="form-checkbox h-5 w-5 text-primary" ${task.completed ? 'checked' : ''}>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-completed" class="text-sm font-medium">Marcar como completada</label>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${taskId ? `<button id="delete-task-modal-btn" class="w-full btn-danger p-2 rounded-lg mt-4">Eliminar Tarea</button>` : ''}
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  `,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmText: taskId ? 'Guardar Cambios' : 'AÃ±adir Tarea'
 Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  if (result.confirmed) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const updatedTask = {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: taskId || `cal-${crypto.randomUUID()}`,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content: result.data['task-content'],
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: result.data['task-date'],
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  time: result.data['task-time'],
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completed: result.data['task-completed']
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oldDate = taskId ? findTask(taskId).dayKey : null;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (taskId && oldDate !== updatedTask.date) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Remove from old date and add to new date
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.calendar[oldDate] = (state.calendar[oldDate] || []).filter(t => t.id !== taskId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (state.calendar[oldDate].length === 0) delete state.calendar[oldDate];
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!state.calendar[updatedTask.date]) state.calendar[updatedTask.date] = [];
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.calendar[updatedTask.date].push(updatedTask);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (taskId) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Update existing task in place
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const taskIndex = state.calendar[updatedTask.date].findIndex(t => t.id === taskId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (taskIndex > -1) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.calendar[updatedTask.date][taskIndex] = updatedTask;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Add new task
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!state.calendar[updatedTask.date]) state.calendar[updatedTask.date] = [];
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.calendar[updatedTask.date].push(updatedTask);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completeMission('week-organized'); // Check mission completion
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderCalendarView();
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  const deleteTaskModalBtn = dom.genericModal.querySelector('#delete-task-modal-btn');
 Â  Â  Â  Â  Â  Â  Â  Â  if (deleteTaskModalBtn) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteTaskModalBtn.addEventListener('click', async (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideModal({ confirmed: false }); // Hide the current modal first
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await deleteTask(taskId, 'Personal'); // Then ask for confirmation to delete
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function renderProjectChatMessages(chat) {
 Â  Â  Â  Â  Â  Â  Â  Â  dom.projectChatMessages.innerHTML = '';
 Â  Â  Â  Â  Â  Â  Â  Â  chat.messages.forEach((msg, index) => addMessageToUI(msg.role, msg.content, msg.image, index, dom.projectChatMessages));
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function getAllProjectTags(chat) {
 Â  Â  Â  Â  Â  Â  Â  Â  const tags = new Set();
 Â  Â  Â  Â  Â  Â  Â  Â  chat.projectData.columns.forEach(column => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  column.tasks.forEach(task => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (task.labels || []).forEach(label => tags.add(label));
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  return Array.from(tags).sort();
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  function updateProjectTagFilter(chat) {
 Â  Â  Â  Â  Â  Â  Â  Â  const allTags = getAllProjectTags(chat);
 Â  Â  Â  Â  Â  Â  Â  Â  dom.tagFilterDropdown.innerHTML = '';
 Â  Â  Â  Â  Â  Â  Â  Â  const allOption = document.createElement('button');
 Â  Â  Â  Â  Â  Â  Â  Â  allOption.textContent = 'Todas';
 Â  Â  Â  Â  Â  Â  Â  Â  allOption.className = `block w-full text-left px-3 py-2 text-sm rounded-md hover:bg-current-bg-medium ${activeTagFilter === null ? 'font-bold' : ''}`;
 Â  Â  Â  Â  Â  Â  Â  Â  allOption.addEventListener('click', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeTagFilter = null;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.tagFilterDropdown.classList.add('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderProjectBoard(currentChatId);
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  dom.tagFilterDropdown.appendChild(allOption);

 Â  Â  Â  Â  Â  Â  Â  Â  allTags.forEach(tag => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tagOption = document.createElement('button');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tagOption.textContent = tag;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tagOption.className = `block w-full text-left px-3 py-2 text-sm rounded-md hover:bg-current-bg-medium ${activeTagFilter === tag ? 'font-bold' : ''}`;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tagOption.addEventListener('click', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeTagFilter = tag;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.tagFilterDropdown.classList.add('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderProjectBoard(currentChatId);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.tagFilterDropdown.appendChild(tagOption);
 Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  dom.tagFilterBtn.addEventListener('click', (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
 Â  Â  Â  Â  Â  Â  Â  Â  dom.tagFilterDropdown.classList.toggle('hidden');
 Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  document.addEventListener('click', (e) => {
 Â  Â  Â  Â  Â  Â  Â  Â  if (!dom.tagFilterBtn.contains(e.target) && !dom.tagFilterDropdown.contains(e.target)) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.tagFilterDropdown.classList.add('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  function getLabelColor(label) {
 Â  Â  Â  Â  Â  Â  Â  Â  const colors = {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Marketing': '#6366F1', // Indigo
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'DiseÃ±o': '#EC4899', // Pink
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Desarrollo': '#10B981', // Emerald
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Contenido': '#EF4444', // Red
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Urgente': '#F97316', // Orange
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'InvestigaciÃ³n': '#3B82F6', // Blue
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'ReuniÃ³n': '#8B5CF6', // Violet
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'AdministraciÃ³n': '#A855F7', // Purple
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Personal': '#6D28D9', // Deep Purple for personal tasks
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'default': '#6B7280', // Gray
 Â  Â  Â  Â  Â  Â  Â  Â  };
 Â  Â  Â  Â  Â  Â  Â  Â  return colors[label] || colors.default;
 Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  // --- End Project Board Functions ---

 Â  Â  Â  Â  Â  Â  // --- Financial Assistant Functions ---
 Â  Â  Â  Â  Â  Â  function renderFinancialAssistant(messages) {
 Â  Â  Â  Â  Â  Â  Â  Â  dom.chatMessages.innerHTML = `
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="financial-assistant-container" class="space-y-4">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold text-primary text-center">Asistente Financiero</h3>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center text-text-medium">Gestiona tus ingresos y gastos. PregÃºntame sobre tu balance, proyecciones, o consejos para ahorrar.</p>

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-semibold mb-2">Ingresos</h4>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="fin-incomes-list"></div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="add-income-btn" class="text-primary hover:text-primary-hover text-sm mt-2"><i class="fas fa-plus-circle mr-1"></i>AÃ±adir Ingreso</button>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-semibold mb-2">Gastos</h4>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="fin-expenses-list"></div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="add-expense-btn" class="text-primary hover:text-primary-hover text-sm mt-2"><i class="fas fa-plus-circle mr-1"></i>AÃ±adir Gasto</button>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="fin-summary" class="text-center">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-text-light text-xl font-bold">Balance Actual: <span id="fin-balance"></span></p>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="fin-chat-history"></div>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
 Â  Â  Â  Â  Â  Â  Â  Â  `;

 Â  Â  Â  Â  Â  Â  Â  Â  const incomesList = dom.chatMessages.querySelector('#fin-incomes-list');
 Â  Â  Â  Â  Â  Â  Â  Â  const expensesList = dom.chatMessages.querySelector('#fin-expenses-list');
 Â  Â  Â  Â  Â  Â  Â  Â  const finChatHistory = dom.chatMessages.querySelector('#fin-chat-history');

 Â  Â  Â  Â  Â  Â  Â  Â  // Filter out chat messages that are not user/assistant roles (i.e. just financial data)
 Â  Â  Â  Â  Â  Â  Â  Â  messages.filter(msg => msg.role === 'user' || msg.role === 'assistant')
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .forEach((msg, index) => addMessageToUI(msg.role, msg.content, msg.image, index, finChatHistory));

 Â  Â  Â  Â  Â  Â  Â  Â  const currentFinancialData = messages.find(msg => msg.financialData)?.financialData || { incomes: [], expenses: [] };

 Â  Â  Â  Â  Â  Â  Â  Â  function addFinRow(list, type, data = { desc: '', amount: '' }) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const row = document.createElement('div');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.className = 'fin-row';
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.innerHTML = `
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="fin-desc flex-grow" placeholder="DescripciÃ³n" value="${data.desc}">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" class="fin-amount w-24" placeholder="Monto" value="${data.amount}">
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-fin-row-btn"><i class="fas fa-trash-alt"></i></button>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.querySelector('.delete-fin-row-btn').addEventListener('click', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.remove();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateFinancialSummary();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.querySelectorAll('input').forEach(input => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.addEventListener('input', updateFinancialSummary);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.appendChild(row);
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  currentFinancialData.incomes.forEach(income => addFinRow(incomesList, 'income', income));
 Â  Â  Â  Â  Â  Â  Â  Â  currentFinancialData.expenses.forEach(expense => addFinRow(expensesList, 'expense', expense));

 Â  Â  Â  Â  Â  Â  Â  Â  dom.chatMessages.querySelector('#add-income-btn').addEventListener('click', () => addFinRow(incomesList, 'income'));
 Â  Â  Â  Â  Â  Â  Â  Â  dom.chatMessages.querySelector('#add-expense-btn').addEventListener('click', () => addFinRow(expensesList, 'expense'));

 Â  Â  Â  Â  Â  Â  Â  Â  function updateFinancialSummary() {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let totalIncome = 0;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  incomesList.querySelectorAll('.fin-row').forEach(row => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalIncome += parseFloat(row.querySelector('.fin-amount').value) || 0;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let totalExpense = 0;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  expensesList.querySelectorAll('.fin-row').forEach(row => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalExpense += parseFloat(row.querySelector('.fin-amount').value) || 0;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const balance = totalIncome - totalExpense;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const balanceEl = dom.chatMessages.querySelector('#fin-balance');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  balanceEl.textContent = `$${balance.toFixed(2)}`;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  balanceEl.classList.toggle('positive', balance >= 0);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  balanceEl.classList.toggle('negative', balance < 0);
 Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  updateFinancialSummary();
 Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  // --- End Financial Assistant Functions ---

 Â  Â  Â  Â  Â  Â  // Initial Setup
 Â  Â  Â  Â  Â  Â  async function initializeApp() {
 Â  Â  Â  Â  Â  Â  Â  Â  const savedTheme = localStorage.getItem('theme');
 Â  Â  Â  Â  Â  Â  Â  Â  setTheme(savedTheme === 'dark' || !savedTheme); // Default to dark

 Â  Â  Â  Â  Â  Â  Â  Â  const savedLang = localStorage.getItem('goatify-lang') || 'es';
 Â  Â  Â  Â  Â  Â  Â  Â  setLanguage(savedLang);

 Â  Â  Â  Â  Â  Â  Â  Â  if ('speechSynthesis' in window) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  populateVoiceList();
 Â  Â  Â  Â  Â  Â  Â  Â  } else {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (dom.ttsToggle) dom.ttsToggle.style.display = 'none';
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (dom.voiceSelectorContainer) dom.voiceSelectorContainer.style.display = 'none';
 Â  Â  Â  Â  Â  Â  Â  Â  }

 Â  Â  Â  Â  Â  Â  Â  Â  netlifyIdentity.on('init', user => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser = user;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user) {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.loadingOverlay.classList.remove('hidden');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.loadingOverlay.classList.add('flex');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadStateForUser().then(() => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.loadingOverlay.classList.add('opacity-0');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.appContainer.classList.remove('opacity-0');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { dom.loadingOverlay.classList.add('hidden'); }, 300);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkDailyStreak();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadStateForUser(); // For guest users
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.loadingOverlay.classList.add('opacity-0');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.appContainer.classList.remove('opacity-0');
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { dom.loadingOverlay.classList.add('hidden'); }, 300);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUserUI();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateNotificationBadge();
 Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  netlifyIdentity.on('login', user => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser = user;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadStateForUser().then(() => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUserUI();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderSidebar();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checkDailyStreak();
 Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  netlifyIdentity.on('logout', () => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser = null;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadStateForUser().then(() => {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUserUI();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderSidebar();
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
 Â  Â  Â  Â  Â  Â  Â  Â  });

 Â  Â  Â  Â  Â  Â  Â  Â  setupEventListeners();
 Â  Â  Â  Â  Â  Â  }
 Â  Â  Â  Â  Â  Â  initializeApp();
 Â  Â  Â  Â  });
 Â  Â  </script>
 </body>
 </html>
